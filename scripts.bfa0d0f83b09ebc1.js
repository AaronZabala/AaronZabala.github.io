const OPERATION_TYPE={API_READY:"API_READY",APP_API_START:"APP_API_START",APP_API_STOP:"APP_API_STOP",SIGNIN:"SIGNIN",SIGNOUT:"SIGNOUT",GO_HOME:"GO_HOME",GO_SITEVIEW:"GO_SITEVIEW",GET_SITEVIEW:"GET_SITEVIEW",GET_LEVEL:"GET_LEVEL",GET_LEVEL_ALL:"GET_LEVEL_ALL",GET_CAPTURE:"GET_CAPTURE",GET_CAPTURE_ALL:"GET_CAPTURE_ALL",GET_PANO:"GET_PANO",GET_PANO_ALL:"GET_PANO_ALL",GET_ANNOTATION:"GET_ANNOTATION",GET_ANNOTATION_ALL:"GET_ANNOTATION_ALL",GET_ROOM:"GET_ROOM",GET_ROOM_ALL:"GET_ROOM_ALL",GET_CAMERA_PARAMETERS:"GET_CAMERA_PARAMETERS",SET_CAMERA_ROTATE:"SET_CAMERA_ROTATE",SET_CAMERA_ZOOM:"SET_CAMERA_ZOOM",SET_CAMERA_LOOKAT:"SET_CAMERA_LOOKAT",SET_CAMERA_RESET:"SET_CAMERA_RESET",SET_CAMERA_MOVE:"SET_CAMERA_MOVE",CHANGE_LEVEL:"CHANGE_LEVEL",CHANGE_CAPTURE:"CHANGE_CAPTURE",CHANGE_PANO:"CHANGE_PANO",FIND_NEAREST_PANOS:"FIND_NEAREST_PANOS",ADD_ANNOTATION_FORM:"ADD_ANNOTATION_FORM",DELETE_ANNOTATION:"DELETE_ANNOTATION",UPDATE_ANNOTATION_FORM:"UPDATE_ANNOTATION_FORM",TOGGLE_RESOLVE_ANNOTATION:"TOGGLE_RESOLVE_ANNOTATION",GET_FORM_TEMPLATE_ALL:"GET_FORM_TEMPLATE_ALL",GET_FORM_TEMPLATE:"GET_FORM_TEMPLATE",GET_ANNOTATION_GROUP:"GET_ANNOTATION_GROUP",GET_ANNOTATION_GROUP_ALL:"GET_ANNOTATION_GROUP_ALL",SET_ACTIVE_ANNOTATION:"SET_ACTIVE_ANNOTATION",RESET_ACTIVE_ANNOTATION:"RESET_ACTIVE_ANNOTATION",CHANGE_LAYOUT:"CHANGE_LAYOUT"},resolvers={},siteView4embed={uuid:0,quiet:!1,ready:!1};function log(...Nt){console.log(`%c${Nt.join(" ")}`,"color: #bada55;")}function ready(){resolvers[-1](!0),siteView4embed.ready=!0}function getJSONContent(Nt){if(null==Nt)return"{}";let Ni;try{Ni=JSON.parse(Nt)}catch{Ni=Nt}return JSON.stringify(Ni,null,2)}function VideoAsset(Nt){this._videoElement=null,this._destroyed=!1,this._emitChange=this.emit.bind(this,"change"),this._lastTimestamp=-1,this._emptyCanvas=document.createElement("canvas"),this._emptyCanvas.width=1,this._emptyCanvas.height=1,this.setVideo(Nt)}function getToday(){alert("Hello Aaron!")}siteView4embed.init=async function(Nt,Ni){window.siteView4embed=siteView4embed;const Ri=document.getElementById(Nt);let Y;if(Ri){const B=document.createElement("iframe");B.onload=()=>{siteView4embed.cupixWindow=B.contentWindow,Y&&Y()},B.style.width="100%",B.style.height="100%",B.src=Ni??"https://apidemo.cupix.works",Ri.appendChild(B)}return new Promise((B,me)=>{Y=B})},siteView4embed.readyPromise=new Promise((Nt,Ni)=>{resolvers[-1]=Nt}),siteView4embed.sendToCupix=async function(Nt,Ni){if(siteView4embed.cupixWindow){Nt.header="CUPIXWORKS_API",Nt.uuid=siteView4embed.uuid.toString(),Nt.timestamp=Date.now();const Ri={error:`timeout: ${Nt.operationType} ${Ni}ms`},Y=new Promise(et=>{const B=siteView4embed.uuid;resolvers[B]=et,setTimeout(()=>{resolvers[B]&&et(Ri),siteView4embed.ready||resolvers[-1](!1)},Ni??5e3)});return await siteView4embed.readyPromise,siteView4embed.cupixWindow.postMessage(Nt,"*"),siteView4embed.quiet||console.log(`sendToCupix: [${Nt.operationType}]`,JSON.stringify(Nt)),siteView4embed.uuid++,Y}},siteView4embed.start=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.APP_API_START},Nt),siteView4embed.stop=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.APP_API_STOP}),siteView4embed.signin=(Nt,Ni,Ri)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SIGNIN,operationArgs:{email:Ni,password:Ri,teamDomain:Nt}}),siteView4embed.signinWithToken=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SIGNIN,operationArgs:{token:Nt}}),siteView4embed.signout=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SIGNOUT}),siteView4embed.goHome=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GO_HOME}),siteView4embed.goSiteView=(Nt,Ni=!0)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GO_SITEVIEW,operationArgs:{siteViewKey:Nt,hideTopBar:Ni}}),siteView4embed.getSiteView=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_SITEVIEW}),siteView4embed.getLevel=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_LEVEL,operationArgs:{levelId:Nt}}),siteView4embed.getLevelAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_LEVEL_ALL}),siteView4embed.getCapture=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_CAPTURE,operationArgs:{captureId:Nt}}),siteView4embed.getCaptureAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_CAPTURE_ALL}),siteView4embed.getPano=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_PANO,operationArgs:{panoId:Nt}}),siteView4embed.getPanoAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_PANO_ALL}),siteView4embed.getAnnotation=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ANNOTATION,operationArgs:{annotationId:Nt}}),siteView4embed.getAnnotationAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ANNOTATION_ALL}),siteView4embed.getRoom=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ROOM,operationArgs:{roomId:Nt}}),siteView4embed.getRoomAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ROOM_ALL}),siteView4embed.getCameraParameters=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_CAMERA_PARAMETERS}),siteView4embed.setCameraRotate=(Nt,Ni)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_CAMERA_ROTATE,operationArgs:{direction:Nt,angle:Ni}}),siteView4embed.setCameraZoom=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_CAMERA_ZOOM,operationArgs:{angleInDegree:Nt}}),siteView4embed.setCameraLookAt=(Nt,Ni,Ri)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_CAMERA_LOOKAT,operationArgs:{lookAtX:Nt,lookAtY:Ni,lookAtZ:Ri}}),siteView4embed.setCameraReset=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_CAMERA_RESET}),siteView4embed.setCameraMove=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_CAMERA_MOVE,operationArgs:{direction:Nt}}),siteView4embed.changeLevel=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.CHANGE_LEVEL,operationArgs:{levelId:Nt}}),siteView4embed.changeCapture=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.CHANGE_CAPTURE,operationArgs:{captureId:Nt}}),siteView4embed.changePano=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.CHANGE_PANO,operationArgs:{panoId:Nt}}),siteView4embed.findNearestPanos=(Nt,Ni,Ri,Y,et,B,me)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.FIND_NEAREST_PANOS,operationArgs:{levelId:Nt,captureId:Ni,coordX:Ri,coordY:Y,normalX:et,normalY:B,maxCount:me}}),siteView4embed.addAnnotation=(Nt,Ni,Ri,Y)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.ADD_ANNOTATION_FORM,operationArgs:{formTemplateId:Nt,annotationGroupId:Ni,name:Ri,values:Y}}),siteView4embed.deleteAnnotation=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.DELETE_ANNOTATION,operationArgs:{annotationId:Nt}}),siteView4embed.updateAnnotation=(Nt,Ni,Ri)=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.UPDATE_ANNOTATION_FORM,operationArgs:{annotationId:Nt,name:Ni,values:Ri}}),siteView4embed.toggleResolveAnnotation=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.TOGGLE_RESOLVE_ANNOTATION,operationArgs:{annotationId:Nt}}),siteView4embed.getFormTemplates=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_FORM_TEMPLATE_ALL}),siteView4embed.getFormTemplate=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_FORM_TEMPLATE,operationArgs:{formTemplateId:Nt}}),siteView4embed.getAnnotationGroup=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ANNOTATION_GROUP,operationArgs:{annotationGroupId:Nt}}),siteView4embed.getAnnotationGroupAll=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.GET_ANNOTATION_GROUP_ALL}),siteView4embed.setActiveAnnotation=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.SET_ACTIVE_ANNOTATION,operationArgs:{annotationId:Nt}}),siteView4embed.resetActiveAnnotation=()=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.RESET_ACTIVE_ANNOTATION}),siteView4embed.changeLayout=Nt=>siteView4embed.sendToCupix({operationType:OPERATION_TYPE.CHANGE_LAYOUT,operationArgs:{layout:Nt}}),window.addEventListener("message",function(Nt){const Ni=Nt&&Nt.data;null!=Ni&&"CUPIXWORKS_API"==Ni.header&&(siteView4embed.quiet||log("[CUPIXWORKS_API]",JSON.stringify(Ni||{})),siteView4embed.ready||ready(Ni),Ni.request?.uuid&&"function"==typeof resolvers[Ni.request.uuid]&&(resolvers[Ni.request.uuid](Ni.response||Ni),resolvers[Ni.request.uuid]=null))},!1),function(Nt){"object"==typeof exports&&typeof module<"u"?module.exports=Nt():"function"==typeof define&&define.amd?define([],Nt):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).Marzipano=Nt()}(function(){return function Y(et,B,me){function ie(Q,$){if(!B[Q]){if(!et[Q]){var de="function"==typeof require&&require;if(!$&&de)return de(Q,!0);if(ue)return ue(Q,!0);var Pe=new Error("Cannot find module '"+Q+"'");throw Pe.code="MODULE_NOT_FOUND",Pe}var ve=B[Q]={exports:{}};et[Q][0].call(ve.exports,function(ne){return ie(et[Q][1][ne]||ne)},ve,ve.exports,Y,et,B,me)}return B[Q].exports}for(var ue="function"==typeof require&&require,Z=0;Z<me.length;Z++)ie(me[Z]);return ie}({1:[function(Y,et,B){var ue;ue=function(){var me=!0;function ie(ve){function ne(si){var K=ve.match(si);return K&&K.length>1&&K[1]||""}function Te(si){var K=ve.match(si);return K&&K.length>1&&K[2]||""}var ae,De=ne(/(ipod|iphone|ipad)/i).toLowerCase(),Be=!/like android/i.test(ve)&&/android/i.test(ve),ft=/nexus\s*[0-6]\s*/i.test(ve),Ae=!ft&&/nexus\s*[0-9]+/i.test(ve),se=/CrOS/.test(ve),Ue=/silk/i.test(ve),Oe=/sailfish/i.test(ve),Ee=/tizen/i.test(ve),Ve=/(web|hpw)(o|0)s/i.test(ve),oe=/windows phone/i.test(ve),ze=(/SamsungBrowser/i.test(ve),!oe&&/windows/i.test(ve)),We=!De&&!Ue&&/macintosh/i.test(ve),mt=!Be&&!Oe&&!Ee&&!Ve&&/linux/i.test(ve),Tt=Te(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),$e=ne(/version\/(\d+(\.\d+)?)/i),Et=/tablet/i.test(ve)&&!/tablet pc/i.test(ve),we=!Et&&/[^-]mobi/i.test(ve),he=/xbox/i.test(ve);/opera/i.test(ve)?ae={name:"Opera",opera:me,version:$e||ne(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(ve)?ae={name:"Opera",opera:me,version:ne(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||$e}:/SamsungBrowser/i.test(ve)?ae={name:"Samsung Internet for Android",samsungBrowser:me,version:$e||ne(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(ve)?ae={name:"NAVER Whale browser",whale:me,version:ne(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(ve)?ae={name:"MZ Browser",mzbrowser:me,version:ne(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(ve)?ae={name:"Opera Coast",coast:me,version:$e||ne(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(ve)?ae={name:"Focus",focus:me,version:ne(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(ve)?ae={name:"Yandex Browser",yandexbrowser:me,version:$e||ne(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(ve)?ae={name:"UC Browser",ucbrowser:me,version:ne(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(ve)?ae={name:"Maxthon",maxthon:me,version:ne(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(ve)?ae={name:"Epiphany",epiphany:me,version:ne(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(ve)?ae={name:"Puffin",puffin:me,version:ne(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(ve)?ae={name:"Sleipnir",sleipnir:me,version:ne(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(ve)?ae={name:"K-Meleon",kMeleon:me,version:ne(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:oe?(ae={name:"Windows Phone",osname:"Windows Phone",windowsphone:me},Tt?(ae.msedge=me,ae.version=Tt):(ae.msie=me,ae.version=ne(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(ve)?ae={name:"Internet Explorer",msie:me,version:ne(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:se?ae={name:"Chrome",osname:"Chrome OS",chromeos:me,chromeBook:me,chrome:me,version:ne(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(ve)?ae={name:"Microsoft Edge",msedge:me,version:Tt}:/vivaldi/i.test(ve)?ae={name:"Vivaldi",vivaldi:me,version:ne(/vivaldi\/(\d+(\.\d+)?)/i)||$e}:Oe?ae={name:"Sailfish",osname:"Sailfish OS",sailfish:me,version:ne(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(ve)?ae={name:"SeaMonkey",seamonkey:me,version:ne(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(ve)?(ae={name:"Firefox",firefox:me,version:ne(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ve)&&(ae.firefoxos=me,ae.osname="Firefox OS")):Ue?ae={name:"Amazon Silk",silk:me,version:ne(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(ve)?ae={name:"PhantomJS",phantom:me,version:ne(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(ve)?ae={name:"SlimerJS",slimer:me,version:ne(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(ve)||/rim\stablet/i.test(ve)?ae={name:"BlackBerry",osname:"BlackBerry OS",blackberry:me,version:$e||ne(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:Ve?(ae={name:"WebOS",osname:"WebOS",webos:me,version:$e||ne(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(ve)&&(ae.touchpad=me)):/bada/i.test(ve)?ae={name:"Bada",osname:"Bada",bada:me,version:ne(/dolfin\/(\d+(\.\d+)?)/i)}:Ee?ae={name:"Tizen",osname:"Tizen",tizen:me,version:ne(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||$e}:/qupzilla/i.test(ve)?ae={name:"QupZilla",qupzilla:me,version:ne(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||$e}:/chromium/i.test(ve)?ae={name:"Chromium",chromium:me,version:ne(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||$e}:/chrome|crios|crmo/i.test(ve)?ae={name:"Chrome",chrome:me,version:ne(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:Be?ae={name:"Android",version:$e}:/safari|applewebkit/i.test(ve)?(ae={name:"Safari",safari:me},$e&&(ae.version=$e)):De?(ae={name:"iphone"==De?"iPhone":"ipad"==De?"iPad":"iPod"},$e&&(ae.version=$e)):ae=/googlebot/i.test(ve)?{name:"Googlebot",googlebot:me,version:ne(/googlebot\/(\d+(\.\d+))/i)||$e}:{name:ne(/^(.*)\/(.*) /),version:Te(/^(.*)\/(.*) /)},!ae.msedge&&/(apple)?webkit/i.test(ve)?(/(apple)?webkit\/537\.36/i.test(ve)?(ae.name=ae.name||"Blink",ae.blink=me):(ae.name=ae.name||"Webkit",ae.webkit=me),!ae.version&&$e&&(ae.version=$e)):!ae.opera&&/gecko\//i.test(ve)&&(ae.name=ae.name||"Gecko",ae.gecko=me,ae.version=ae.version||ne(/gecko\/(\d+(\.\d+)?)/i)),ae.windowsphone||!Be&&!ae.silk?!ae.windowsphone&&De?(ae[De]=me,ae.ios=me,ae.osname="iOS"):We?(ae.mac=me,ae.osname="macOS"):he?(ae.xbox=me,ae.osname="Xbox"):ze?(ae.windows=me,ae.osname="Windows"):mt&&(ae.linux=me,ae.osname="Linux"):(ae.android=me,ae.osname="Android");var Pt="";ae.windows?Pt=function vt(si){switch(si){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(ne(/Windows ((NT|XP)( \d\d?.\d)?)/i)):ae.windowsphone?Pt=ne(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):ae.mac?Pt=(Pt=ne(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):De?Pt=(Pt=ne(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):Be?Pt=ne(/android[ \/-](\d+(\.\d+)*)/i):ae.webos?Pt=ne(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):ae.blackberry?Pt=ne(/rim\stablet\sos\s(\d+(\.\d+)*)/i):ae.bada?Pt=ne(/bada\/(\d+(\.\d+)*)/i):ae.tizen&&(Pt=ne(/tizen[\/\s](\d+(\.\d+)*)/i)),Pt&&(ae.osversion=Pt);var ei=!ae.windows&&Pt.split(".")[0];return Et||Ae||"ipad"==De||Be&&(3==ei||ei>=4&&!we)||ae.silk?ae.tablet=me:(we||"iphone"==De||"ipod"==De||Be||ft||ae.blackberry||ae.webos||ae.bada)&&(ae.mobile=me),ae.msedge||ae.msie&&ae.version>=10||ae.yandexbrowser&&ae.version>=15||ae.vivaldi&&ae.version>=1||ae.chrome&&ae.version>=20||ae.samsungBrowser&&ae.version>=4||ae.whale&&1===$([ae.version,"1.0"])||ae.mzbrowser&&1===$([ae.version,"6.0"])||ae.focus&&1===$([ae.version,"1.0"])||ae.firefox&&ae.version>=20||ae.safari&&ae.version>=6||ae.opera&&ae.version>=10||ae.ios&&ae.osversion&&ae.osversion.split(".")[0]>=6||ae.blackberry&&ae.version>=10.1||ae.chromium&&ae.version>=20?ae.a=me:ae.msie&&ae.version<10||ae.chrome&&ae.version<20||ae.firefox&&ae.version<20||ae.safari&&ae.version<6||ae.opera&&ae.version<10||ae.ios&&ae.osversion&&ae.osversion.split(".")[0]<6||ae.chromium&&ae.version<20?ae.c=me:ae.x=me,ae}var ue=ie(typeof navigator<"u"&&navigator.userAgent||"");function Z(ve){return ve.split(".").length}function Q(ve,ne){var De,Te=[];if(Array.prototype.map)return Array.prototype.map.call(ve,ne);for(De=0;De<ve.length;De++)Te.push(ne(ve[De]));return Te}function $(ve){for(var ne=Math.max(Z(ve[0]),Z(ve[1])),Te=Q(ve,function(De){var Ke=ne-Z(De);return Q((De+=new Array(Ke+1).join(".0")).split("."),function(Be){return new Array(20-Be.length).join("0")+Be}).reverse()});--ne>=0;){if(Te[0][ne]>Te[1][ne])return 1;if(Te[0][ne]!==Te[1][ne])return-1;if(0===ne)return 0}}function de(ve,ne,Te){var De=ue;"string"==typeof ne&&(Te=ne,ne=void 0),void 0===ne&&(ne=!1),Te&&(De=ie(Te));var Ke=""+De.version;for(var Be in ve)if(ve.hasOwnProperty(Be)&&De[Be]){if("string"!=typeof ve[Be])throw new Error("Browser version in the minVersion map should be a string: "+Be+": "+String(ve));return $([Ke,ve[Be]])<0}return ne}return ue.test=function(ve){for(var ne=0;ne<ve.length;++ne){var Te=ve[ne];if("string"==typeof Te&&Te in ue)return!0}return!1},ue.isUnsupportedBrowser=de,ue.compareVersions=$,ue.check=function Pe(ve,ne,Te){return!de(ve,ne,Te)},ue._detect=ie,ue.detect=ie,ue},typeof et<"u"&&et.exports?et.exports=ue():this.bowser=ue()},{}],2:[function(Y,et,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.setMatrixArrayType=function Z(Pe){B.ARRAY_TYPE=ie=Pe},B.toRadian=function $(Pe){return Pe*Q},B.equals=function de(Pe,ve){return Math.abs(Pe-ve)<=1e-6*Math.max(1,Math.abs(Pe),Math.abs(ve))},B.RANDOM=B.ARRAY_TYPE=B.EPSILON=void 0,B.EPSILON=1e-6;var ie=typeof Float32Array<"u"?Float32Array:Array;B.ARRAY_TYPE=ie;var ue=Math.random;B.RANDOM=ue;var Q=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var Pe=0,ve=arguments.length;ve--;)Pe+=arguments[ve]*arguments[ve];return Math.sqrt(Pe)})},{}],3:[function(Y,et,B){"use strict";function me(Be){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Ae){return typeof Ae}:function(Ae){return Ae&&"function"==typeof Symbol&&Ae.constructor===Symbol&&Ae!==Symbol.prototype?"symbol":typeof Ae})(Be)}Object.defineProperty(B,"__esModule",{value:!0}),B.vec4=B.vec3=B.vec2=B.quat2=B.quat=B.mat4=B.mat3=B.mat2d=B.mat2=B.glMatrix=void 0;var ie=Ke(Y("./common.js"));B.glMatrix=ie;var ue=Ke(Y("./mat2.js"));B.mat2=ue;var Z=Ke(Y("./mat2d.js"));B.mat2d=Z;var Q=Ke(Y("./mat3.js"));B.mat3=Q;var $=Ke(Y("./mat4.js"));B.mat4=$;var de=Ke(Y("./quat.js"));B.quat=de;var Pe=Ke(Y("./quat2.js"));B.quat2=Pe;var ve=Ke(Y("./vec2.js"));B.vec2=ve;var ne=Ke(Y("./vec3.js"));B.vec3=ne;var Te=Ke(Y("./vec4.js"));function De(){if("function"!=typeof WeakMap)return null;var Be=new WeakMap;return De=function(){return Be},Be}function Ke(Be){if(Be&&Be.__esModule)return Be;if(null===Be||"object"!==me(Be)&&"function"!=typeof Be)return{default:Be};var ft=De();if(ft&&ft.has(Be))return ft.get(Be);var Ae={},se=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ue in Be)if(Object.prototype.hasOwnProperty.call(Be,Ue)){var Oe=se?Object.getOwnPropertyDescriptor(Be,Ue):null;Oe&&(Oe.get||Oe.set)?Object.defineProperty(Ae,Ue,Oe):Ae[Ue]=Be[Ue]}return Ae.default=Be,ft&&ft.set(Be,Ae),Ae}B.vec4=Te},{"./common.js":2,"./mat2.js":4,"./mat2d.js":5,"./mat3.js":6,"./mat4.js":7,"./quat.js":8,"./quat2.js":9,"./vec2.js":10,"./vec3.js":11,"./vec4.js":12}],4:[function(Y,et,B){"use strict";function me(he){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(vt){return typeof vt}:function(vt){return vt&&"function"==typeof Symbol&&vt.constructor===Symbol&&vt!==Symbol.prototype?"symbol":typeof vt})(he)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function Q(){var he=new ie.ARRAY_TYPE(4);return ie.ARRAY_TYPE!=Float32Array&&(he[1]=0,he[2]=0),he[0]=1,he[3]=1,he},B.clone=function $(he){var ae=new ie.ARRAY_TYPE(4);return ae[0]=he[0],ae[1]=he[1],ae[2]=he[2],ae[3]=he[3],ae},B.copy=function de(he,ae){return he[0]=ae[0],he[1]=ae[1],he[2]=ae[2],he[3]=ae[3],he},B.identity=function Pe(he){return he[0]=1,he[1]=0,he[2]=0,he[3]=1,he},B.fromValues=function ve(he,ae,vt,Pt){var ei=new ie.ARRAY_TYPE(4);return ei[0]=he,ei[1]=ae,ei[2]=vt,ei[3]=Pt,ei},B.set=function ne(he,ae,vt,Pt,ei){return he[0]=ae,he[1]=vt,he[2]=Pt,he[3]=ei,he},B.transpose=function Te(he,ae){if(he===ae){var vt=ae[1];he[1]=ae[2],he[2]=vt}else he[0]=ae[0],he[1]=ae[2],he[2]=ae[1],he[3]=ae[3];return he},B.invert=function De(he,ae){var vt=ae[0],Pt=ae[1],ei=ae[2],si=ae[3],K=vt*si-ei*Pt;return K?(he[0]=si*(K=1/K),he[1]=-Pt*K,he[2]=-ei*K,he[3]=vt*K,he):null},B.adjoint=function Ke(he,ae){var vt=ae[0];return he[0]=ae[3],he[1]=-ae[1],he[2]=-ae[2],he[3]=vt,he},B.determinant=function Be(he){return he[0]*he[3]-he[2]*he[1]},B.multiply=ft,B.rotate=function Ae(he,ae,vt){var Pt=ae[0],ei=ae[1],si=ae[2],K=ae[3],Me=Math.sin(vt),_t=Math.cos(vt);return he[0]=Pt*_t+si*Me,he[1]=ei*_t+K*Me,he[2]=Pt*-Me+si*_t,he[3]=ei*-Me+K*_t,he},B.scale=function se(he,ae,vt){var ei=ae[1],si=ae[2],K=ae[3],Me=vt[0],_t=vt[1];return he[0]=ae[0]*Me,he[1]=ei*Me,he[2]=si*_t,he[3]=K*_t,he},B.fromRotation=function Ue(he,ae){var vt=Math.sin(ae),Pt=Math.cos(ae);return he[0]=Pt,he[1]=vt,he[2]=-vt,he[3]=Pt,he},B.fromScaling=function Oe(he,ae){return he[0]=ae[0],he[1]=0,he[2]=0,he[3]=ae[1],he},B.str=function Ee(he){return"mat2("+he[0]+", "+he[1]+", "+he[2]+", "+he[3]+")"},B.frob=function Ve(he){return Math.hypot(he[0],he[1],he[2],he[3])},B.LDU=function oe(he,ae,vt,Pt){return he[2]=Pt[2]/Pt[0],vt[0]=Pt[0],vt[1]=Pt[1],vt[3]=Pt[3]-he[2]*vt[1],[he,ae,vt]},B.add=function Ye(he,ae,vt){return he[0]=ae[0]+vt[0],he[1]=ae[1]+vt[1],he[2]=ae[2]+vt[2],he[3]=ae[3]+vt[3],he},B.subtract=ze,B.exactEquals=function We(he,ae){return he[0]===ae[0]&&he[1]===ae[1]&&he[2]===ae[2]&&he[3]===ae[3]},B.equals=function mt(he,ae){var vt=he[0],Pt=he[1],ei=he[2],si=he[3],K=ae[0],Me=ae[1],_t=ae[2],Jt=ae[3];return Math.abs(vt-K)<=ie.EPSILON*Math.max(1,Math.abs(vt),Math.abs(K))&&Math.abs(Pt-Me)<=ie.EPSILON*Math.max(1,Math.abs(Pt),Math.abs(Me))&&Math.abs(ei-_t)<=ie.EPSILON*Math.max(1,Math.abs(ei),Math.abs(_t))&&Math.abs(si-Jt)<=ie.EPSILON*Math.max(1,Math.abs(si),Math.abs(Jt))},B.multiplyScalar=function Tt(he,ae,vt){return he[0]=ae[0]*vt,he[1]=ae[1]*vt,he[2]=ae[2]*vt,he[3]=ae[3]*vt,he},B.multiplyScalarAndAdd=function $e(he,ae,vt,Pt){return he[0]=ae[0]+vt[0]*Pt,he[1]=ae[1]+vt[1]*Pt,he[2]=ae[2]+vt[2]*Pt,he[3]=ae[3]+vt[3]*Pt,he},B.sub=B.mul=void 0;var ie=function Z(he){if(he&&he.__esModule)return he;if(null===he||"object"!==me(he)&&"function"!=typeof he)return{default:he};var ae=ue();if(ae&&ae.has(he))return ae.get(he);var vt={},Pt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ei in he)if(Object.prototype.hasOwnProperty.call(he,ei)){var si=Pt?Object.getOwnPropertyDescriptor(he,ei):null;si&&(si.get||si.set)?Object.defineProperty(vt,ei,si):vt[ei]=he[ei]}return vt.default=he,ae&&ae.set(he,vt),vt}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var he=new WeakMap;return ue=function(){return he},he}function ft(he,ae,vt){var Pt=ae[0],ei=ae[1],si=ae[2],K=ae[3],Me=vt[0],_t=vt[1],Jt=vt[2],ti=vt[3];return he[0]=Pt*Me+si*_t,he[1]=ei*Me+K*_t,he[2]=Pt*Jt+si*ti,he[3]=ei*Jt+K*ti,he}function ze(he,ae,vt){return he[0]=ae[0]-vt[0],he[1]=ae[1]-vt[1],he[2]=ae[2]-vt[2],he[3]=ae[3]-vt[3],he}B.mul=ft,B.sub=ze},{"./common.js":2}],5:[function(Y,et,B){"use strict";function me(we){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(ae){return typeof ae}:function(ae){return ae&&"function"==typeof Symbol&&ae.constructor===Symbol&&ae!==Symbol.prototype?"symbol":typeof ae})(we)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function Q(){var we=new ie.ARRAY_TYPE(6);return ie.ARRAY_TYPE!=Float32Array&&(we[1]=0,we[2]=0,we[4]=0,we[5]=0),we[0]=1,we[3]=1,we},B.clone=function $(we){var he=new ie.ARRAY_TYPE(6);return he[0]=we[0],he[1]=we[1],he[2]=we[2],he[3]=we[3],he[4]=we[4],he[5]=we[5],he},B.copy=function de(we,he){return we[0]=he[0],we[1]=he[1],we[2]=he[2],we[3]=he[3],we[4]=he[4],we[5]=he[5],we},B.identity=function Pe(we){return we[0]=1,we[1]=0,we[2]=0,we[3]=1,we[4]=0,we[5]=0,we},B.fromValues=function ve(we,he,ae,vt,Pt,ei){var si=new ie.ARRAY_TYPE(6);return si[0]=we,si[1]=he,si[2]=ae,si[3]=vt,si[4]=Pt,si[5]=ei,si},B.set=function ne(we,he,ae,vt,Pt,ei,si){return we[0]=he,we[1]=ae,we[2]=vt,we[3]=Pt,we[4]=ei,we[5]=si,we},B.invert=function Te(we,he){var ae=he[0],vt=he[1],Pt=he[2],ei=he[3],si=he[4],K=he[5],Me=ae*ei-vt*Pt;return Me?(we[0]=ei*(Me=1/Me),we[1]=-vt*Me,we[2]=-Pt*Me,we[3]=ae*Me,we[4]=(Pt*K-ei*si)*Me,we[5]=(vt*si-ae*K)*Me,we):null},B.determinant=function De(we){return we[0]*we[3]-we[1]*we[2]},B.multiply=Ke,B.rotate=function Be(we,he,ae){var vt=he[0],Pt=he[1],ei=he[2],si=he[3],K=he[4],Me=he[5],_t=Math.sin(ae),Jt=Math.cos(ae);return we[0]=vt*Jt+ei*_t,we[1]=Pt*Jt+si*_t,we[2]=vt*-_t+ei*Jt,we[3]=Pt*-_t+si*Jt,we[4]=K,we[5]=Me,we},B.scale=function ft(we,he,ae){var Pt=he[1],ei=he[2],si=he[3],K=he[4],Me=he[5],_t=ae[0],Jt=ae[1];return we[0]=he[0]*_t,we[1]=Pt*_t,we[2]=ei*Jt,we[3]=si*Jt,we[4]=K,we[5]=Me,we},B.translate=function Ae(we,he,ae){var vt=he[0],Pt=he[1],ei=he[2],si=he[3],K=he[4],Me=he[5],_t=ae[0],Jt=ae[1];return we[0]=vt,we[1]=Pt,we[2]=ei,we[3]=si,we[4]=vt*_t+ei*Jt+K,we[5]=Pt*_t+si*Jt+Me,we},B.fromRotation=function se(we,he){var ae=Math.sin(he),vt=Math.cos(he);return we[0]=vt,we[1]=ae,we[2]=-ae,we[3]=vt,we[4]=0,we[5]=0,we},B.fromScaling=function Ue(we,he){return we[0]=he[0],we[1]=0,we[2]=0,we[3]=he[1],we[4]=0,we[5]=0,we},B.fromTranslation=function Oe(we,he){return we[0]=1,we[1]=0,we[2]=0,we[3]=1,we[4]=he[0],we[5]=he[1],we},B.str=function Ee(we){return"mat2d("+we[0]+", "+we[1]+", "+we[2]+", "+we[3]+", "+we[4]+", "+we[5]+")"},B.frob=function Ve(we){return Math.hypot(we[0],we[1],we[2],we[3],we[4],we[5],1)},B.add=function oe(we,he,ae){return we[0]=he[0]+ae[0],we[1]=he[1]+ae[1],we[2]=he[2]+ae[2],we[3]=he[3]+ae[3],we[4]=he[4]+ae[4],we[5]=he[5]+ae[5],we},B.subtract=Ye,B.multiplyScalar=function ze(we,he,ae){return we[0]=he[0]*ae,we[1]=he[1]*ae,we[2]=he[2]*ae,we[3]=he[3]*ae,we[4]=he[4]*ae,we[5]=he[5]*ae,we},B.multiplyScalarAndAdd=function We(we,he,ae,vt){return we[0]=he[0]+ae[0]*vt,we[1]=he[1]+ae[1]*vt,we[2]=he[2]+ae[2]*vt,we[3]=he[3]+ae[3]*vt,we[4]=he[4]+ae[4]*vt,we[5]=he[5]+ae[5]*vt,we},B.exactEquals=function mt(we,he){return we[0]===he[0]&&we[1]===he[1]&&we[2]===he[2]&&we[3]===he[3]&&we[4]===he[4]&&we[5]===he[5]},B.equals=function Tt(we,he){var ae=we[0],vt=we[1],Pt=we[2],ei=we[3],si=we[4],K=we[5],Me=he[0],_t=he[1],Jt=he[2],ti=he[3],Ai=he[4],vi=he[5];return Math.abs(ae-Me)<=ie.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Me))&&Math.abs(vt-_t)<=ie.EPSILON*Math.max(1,Math.abs(vt),Math.abs(_t))&&Math.abs(Pt-Jt)<=ie.EPSILON*Math.max(1,Math.abs(Pt),Math.abs(Jt))&&Math.abs(ei-ti)<=ie.EPSILON*Math.max(1,Math.abs(ei),Math.abs(ti))&&Math.abs(si-Ai)<=ie.EPSILON*Math.max(1,Math.abs(si),Math.abs(Ai))&&Math.abs(K-vi)<=ie.EPSILON*Math.max(1,Math.abs(K),Math.abs(vi))},B.sub=B.mul=void 0;var ie=function Z(we){if(we&&we.__esModule)return we;if(null===we||"object"!==me(we)&&"function"!=typeof we)return{default:we};var he=ue();if(he&&he.has(we))return he.get(we);var ae={},vt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Pt in we)if(Object.prototype.hasOwnProperty.call(we,Pt)){var ei=vt?Object.getOwnPropertyDescriptor(we,Pt):null;ei&&(ei.get||ei.set)?Object.defineProperty(ae,Pt,ei):ae[Pt]=we[Pt]}return ae.default=we,he&&he.set(we,ae),ae}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var we=new WeakMap;return ue=function(){return we},we}function Ke(we,he,ae){var vt=he[0],Pt=he[1],ei=he[2],si=he[3],K=he[4],Me=he[5],_t=ae[0],Jt=ae[1],ti=ae[2],Ai=ae[3],vi=ae[4],Ci=ae[5];return we[0]=vt*_t+ei*Jt,we[1]=Pt*_t+si*Jt,we[2]=vt*ti+ei*Ai,we[3]=Pt*ti+si*Ai,we[4]=vt*vi+ei*Ci+K,we[5]=Pt*vi+si*Ci+Me,we}function Ye(we,he,ae){return we[0]=he[0]-ae[0],we[1]=he[1]-ae[1],we[2]=he[2]-ae[2],we[3]=he[3]-ae[3],we[4]=he[4]-ae[4],we[5]=he[5]-ae[5],we}B.mul=Ke,B.sub=Ye},{"./common.js":2}],6:[function(Y,et,B){"use strict";function me(K){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_t){return typeof _t}:function(_t){return _t&&"function"==typeof Symbol&&_t.constructor===Symbol&&_t!==Symbol.prototype?"symbol":typeof _t})(K)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function Q(){var K=new ie.ARRAY_TYPE(9);return ie.ARRAY_TYPE!=Float32Array&&(K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0),K[0]=1,K[4]=1,K[8]=1,K},B.fromMat4=function $(K,Me){return K[0]=Me[0],K[1]=Me[1],K[2]=Me[2],K[3]=Me[4],K[4]=Me[5],K[5]=Me[6],K[6]=Me[8],K[7]=Me[9],K[8]=Me[10],K},B.clone=function de(K){var Me=new ie.ARRAY_TYPE(9);return Me[0]=K[0],Me[1]=K[1],Me[2]=K[2],Me[3]=K[3],Me[4]=K[4],Me[5]=K[5],Me[6]=K[6],Me[7]=K[7],Me[8]=K[8],Me},B.copy=function Pe(K,Me){return K[0]=Me[0],K[1]=Me[1],K[2]=Me[2],K[3]=Me[3],K[4]=Me[4],K[5]=Me[5],K[6]=Me[6],K[7]=Me[7],K[8]=Me[8],K},B.fromValues=function ve(K,Me,_t,Jt,ti,Ai,vi,Ci,zi){var N=new ie.ARRAY_TYPE(9);return N[0]=K,N[1]=Me,N[2]=_t,N[3]=Jt,N[4]=ti,N[5]=Ai,N[6]=vi,N[7]=Ci,N[8]=zi,N},B.set=function ne(K,Me,_t,Jt,ti,Ai,vi,Ci,zi,N){return K[0]=Me,K[1]=_t,K[2]=Jt,K[3]=ti,K[4]=Ai,K[5]=vi,K[6]=Ci,K[7]=zi,K[8]=N,K},B.identity=function Te(K){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=1,K[5]=0,K[6]=0,K[7]=0,K[8]=1,K},B.transpose=function De(K,Me){if(K===Me){var _t=Me[1],Jt=Me[2],ti=Me[5];K[1]=Me[3],K[2]=Me[6],K[3]=_t,K[5]=Me[7],K[6]=Jt,K[7]=ti}else K[0]=Me[0],K[1]=Me[3],K[2]=Me[6],K[3]=Me[1],K[4]=Me[4],K[5]=Me[7],K[6]=Me[2],K[7]=Me[5],K[8]=Me[8];return K},B.invert=function Ke(K,Me){var _t=Me[0],Jt=Me[1],ti=Me[2],Ai=Me[3],vi=Me[4],Ci=Me[5],zi=Me[6],N=Me[7],F=Me[8],te=F*vi-Ci*N,Se=-F*Ai+Ci*zi,j=N*Ai-vi*zi,ee=_t*te+Jt*Se+ti*j;return ee?(K[0]=te*(ee=1/ee),K[1]=(-F*Jt+ti*N)*ee,K[2]=(Ci*Jt-ti*vi)*ee,K[3]=Se*ee,K[4]=(F*_t-ti*zi)*ee,K[5]=(-Ci*_t+ti*Ai)*ee,K[6]=j*ee,K[7]=(-N*_t+Jt*zi)*ee,K[8]=(vi*_t-Jt*Ai)*ee,K):null},B.adjoint=function Be(K,Me){var _t=Me[0],Jt=Me[1],ti=Me[2],Ai=Me[3],vi=Me[4],Ci=Me[5],zi=Me[6],N=Me[7],F=Me[8];return K[0]=vi*F-Ci*N,K[1]=ti*N-Jt*F,K[2]=Jt*Ci-ti*vi,K[3]=Ci*zi-Ai*F,K[4]=_t*F-ti*zi,K[5]=ti*Ai-_t*Ci,K[6]=Ai*N-vi*zi,K[7]=Jt*zi-_t*N,K[8]=_t*vi-Jt*Ai,K},B.determinant=function ft(K){var ti=K[3],Ai=K[4],vi=K[5],Ci=K[6],zi=K[7],N=K[8];return K[0]*(N*Ai-vi*zi)+K[1]*(-N*ti+vi*Ci)+K[2]*(zi*ti-Ai*Ci)},B.multiply=Ae,B.translate=function se(K,Me,_t){var Jt=Me[0],ti=Me[1],Ai=Me[2],vi=Me[3],Ci=Me[4],zi=Me[5],N=Me[6],F=Me[7],te=Me[8],Se=_t[0],j=_t[1];return K[0]=Jt,K[1]=ti,K[2]=Ai,K[3]=vi,K[4]=Ci,K[5]=zi,K[6]=Se*Jt+j*vi+N,K[7]=Se*ti+j*Ci+F,K[8]=Se*Ai+j*zi+te,K},B.rotate=function Ue(K,Me,_t){var Jt=Me[0],ti=Me[1],Ai=Me[2],vi=Me[3],Ci=Me[4],zi=Me[5],N=Me[6],F=Me[7],te=Me[8],Se=Math.sin(_t),j=Math.cos(_t);return K[0]=j*Jt+Se*vi,K[1]=j*ti+Se*Ci,K[2]=j*Ai+Se*zi,K[3]=j*vi-Se*Jt,K[4]=j*Ci-Se*ti,K[5]=j*zi-Se*Ai,K[6]=N,K[7]=F,K[8]=te,K},B.scale=function Oe(K,Me,_t){var Jt=_t[0],ti=_t[1];return K[0]=Jt*Me[0],K[1]=Jt*Me[1],K[2]=Jt*Me[2],K[3]=ti*Me[3],K[4]=ti*Me[4],K[5]=ti*Me[5],K[6]=Me[6],K[7]=Me[7],K[8]=Me[8],K},B.fromTranslation=function Ee(K,Me){return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=1,K[5]=0,K[6]=Me[0],K[7]=Me[1],K[8]=1,K},B.fromRotation=function Ve(K,Me){var _t=Math.sin(Me),Jt=Math.cos(Me);return K[0]=Jt,K[1]=_t,K[2]=0,K[3]=-_t,K[4]=Jt,K[5]=0,K[6]=0,K[7]=0,K[8]=1,K},B.fromScaling=function oe(K,Me){return K[0]=Me[0],K[1]=0,K[2]=0,K[3]=0,K[4]=Me[1],K[5]=0,K[6]=0,K[7]=0,K[8]=1,K},B.fromMat2d=function Ye(K,Me){return K[0]=Me[0],K[1]=Me[1],K[2]=0,K[3]=Me[2],K[4]=Me[3],K[5]=0,K[6]=Me[4],K[7]=Me[5],K[8]=1,K},B.fromQuat=function ze(K,Me){var _t=Me[0],Jt=Me[1],ti=Me[2],Ai=Me[3],vi=_t+_t,Ci=Jt+Jt,zi=ti+ti,N=_t*vi,F=Jt*vi,te=Jt*Ci,Se=ti*vi,j=ti*Ci,ee=ti*zi,v=Ai*vi,_=Ai*Ci,O=Ai*zi;return K[0]=1-te-ee,K[3]=F-O,K[6]=Se+_,K[1]=F+O,K[4]=1-N-ee,K[7]=j-v,K[2]=Se-_,K[5]=j+v,K[8]=1-N-te,K},B.normalFromMat4=function We(K,Me){var _t=Me[0],Jt=Me[1],ti=Me[2],Ai=Me[3],vi=Me[4],Ci=Me[5],zi=Me[6],N=Me[7],F=Me[8],te=Me[9],Se=Me[10],j=Me[11],ee=Me[12],v=Me[13],_=Me[14],O=Me[15],G=_t*Ci-Jt*vi,fe=_t*zi-ti*vi,be=_t*N-Ai*vi,He=Jt*zi-ti*Ci,nt=Jt*N-Ai*Ci,lt=ti*N-Ai*zi,gt=F*v-te*ee,wt=F*_-Se*ee,St=F*O-j*ee,Vt=te*_-Se*v,Ut=te*O-j*v,mi=Se*O-j*_,ui=G*mi-fe*Ut+be*Vt+He*St-nt*wt+lt*gt;return ui?(K[0]=(Ci*mi-zi*Ut+N*Vt)*(ui=1/ui),K[1]=(zi*St-vi*mi-N*wt)*ui,K[2]=(vi*Ut-Ci*St+N*gt)*ui,K[3]=(ti*Ut-Jt*mi-Ai*Vt)*ui,K[4]=(_t*mi-ti*St+Ai*wt)*ui,K[5]=(Jt*St-_t*Ut-Ai*gt)*ui,K[6]=(v*lt-_*nt+O*He)*ui,K[7]=(_*be-ee*lt-O*fe)*ui,K[8]=(ee*nt-v*be+O*G)*ui,K):null},B.projection=function mt(K,Me,_t){return K[0]=2/Me,K[1]=0,K[2]=0,K[3]=0,K[4]=-2/_t,K[5]=0,K[6]=-1,K[7]=1,K[8]=1,K},B.str=function Tt(K){return"mat3("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+", "+K[4]+", "+K[5]+", "+K[6]+", "+K[7]+", "+K[8]+")"},B.frob=function $e(K){return Math.hypot(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],K[8])},B.add=function Et(K,Me,_t){return K[0]=Me[0]+_t[0],K[1]=Me[1]+_t[1],K[2]=Me[2]+_t[2],K[3]=Me[3]+_t[3],K[4]=Me[4]+_t[4],K[5]=Me[5]+_t[5],K[6]=Me[6]+_t[6],K[7]=Me[7]+_t[7],K[8]=Me[8]+_t[8],K},B.subtract=we,B.multiplyScalar=function he(K,Me,_t){return K[0]=Me[0]*_t,K[1]=Me[1]*_t,K[2]=Me[2]*_t,K[3]=Me[3]*_t,K[4]=Me[4]*_t,K[5]=Me[5]*_t,K[6]=Me[6]*_t,K[7]=Me[7]*_t,K[8]=Me[8]*_t,K},B.multiplyScalarAndAdd=function ae(K,Me,_t,Jt){return K[0]=Me[0]+_t[0]*Jt,K[1]=Me[1]+_t[1]*Jt,K[2]=Me[2]+_t[2]*Jt,K[3]=Me[3]+_t[3]*Jt,K[4]=Me[4]+_t[4]*Jt,K[5]=Me[5]+_t[5]*Jt,K[6]=Me[6]+_t[6]*Jt,K[7]=Me[7]+_t[7]*Jt,K[8]=Me[8]+_t[8]*Jt,K},B.exactEquals=function vt(K,Me){return K[0]===Me[0]&&K[1]===Me[1]&&K[2]===Me[2]&&K[3]===Me[3]&&K[4]===Me[4]&&K[5]===Me[5]&&K[6]===Me[6]&&K[7]===Me[7]&&K[8]===Me[8]},B.equals=function Pt(K,Me){var _t=K[0],Jt=K[1],ti=K[2],Ai=K[3],vi=K[4],Ci=K[5],zi=K[6],N=K[7],F=K[8],te=Me[0],Se=Me[1],j=Me[2],ee=Me[3],v=Me[4],_=Me[5],O=Me[6],G=Me[7],fe=Me[8];return Math.abs(_t-te)<=ie.EPSILON*Math.max(1,Math.abs(_t),Math.abs(te))&&Math.abs(Jt-Se)<=ie.EPSILON*Math.max(1,Math.abs(Jt),Math.abs(Se))&&Math.abs(ti-j)<=ie.EPSILON*Math.max(1,Math.abs(ti),Math.abs(j))&&Math.abs(Ai-ee)<=ie.EPSILON*Math.max(1,Math.abs(Ai),Math.abs(ee))&&Math.abs(vi-v)<=ie.EPSILON*Math.max(1,Math.abs(vi),Math.abs(v))&&Math.abs(Ci-_)<=ie.EPSILON*Math.max(1,Math.abs(Ci),Math.abs(_))&&Math.abs(zi-O)<=ie.EPSILON*Math.max(1,Math.abs(zi),Math.abs(O))&&Math.abs(N-G)<=ie.EPSILON*Math.max(1,Math.abs(N),Math.abs(G))&&Math.abs(F-fe)<=ie.EPSILON*Math.max(1,Math.abs(F),Math.abs(fe))},B.sub=B.mul=void 0;var ie=function Z(K){if(K&&K.__esModule)return K;if(null===K||"object"!==me(K)&&"function"!=typeof K)return{default:K};var Me=ue();if(Me&&Me.has(K))return Me.get(K);var _t={},Jt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ti in K)if(Object.prototype.hasOwnProperty.call(K,ti)){var Ai=Jt?Object.getOwnPropertyDescriptor(K,ti):null;Ai&&(Ai.get||Ai.set)?Object.defineProperty(_t,ti,Ai):_t[ti]=K[ti]}return _t.default=K,Me&&Me.set(K,_t),_t}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var K=new WeakMap;return ue=function(){return K},K}function Ae(K,Me,_t){var Jt=Me[0],ti=Me[1],Ai=Me[2],vi=Me[3],Ci=Me[4],zi=Me[5],N=Me[6],F=Me[7],te=Me[8],Se=_t[0],j=_t[1],ee=_t[2],v=_t[3],_=_t[4],O=_t[5],G=_t[6],fe=_t[7],be=_t[8];return K[0]=Se*Jt+j*vi+ee*N,K[1]=Se*ti+j*Ci+ee*F,K[2]=Se*Ai+j*zi+ee*te,K[3]=v*Jt+_*vi+O*N,K[4]=v*ti+_*Ci+O*F,K[5]=v*Ai+_*zi+O*te,K[6]=G*Jt+fe*vi+be*N,K[7]=G*ti+fe*Ci+be*F,K[8]=G*Ai+fe*zi+be*te,K}function we(K,Me,_t){return K[0]=Me[0]-_t[0],K[1]=Me[1]-_t[1],K[2]=Me[2]-_t[2],K[3]=Me[3]-_t[3],K[4]=Me[4]-_t[4],K[5]=Me[5]-_t[5],K[6]=Me[6]-_t[6],K[7]=Me[7]-_t[7],K[8]=Me[8]-_t[8],K}B.mul=Ae,B.sub=we},{"./common.js":2}],7:[function(Y,et,B){"use strict";function me(v){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(O){return typeof O}:function(O){return O&&"function"==typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O})(v)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function Q(){var v=new ie.ARRAY_TYPE(16);return ie.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},B.clone=function $(v){var _=new ie.ARRAY_TYPE(16);return _[0]=v[0],_[1]=v[1],_[2]=v[2],_[3]=v[3],_[4]=v[4],_[5]=v[5],_[6]=v[6],_[7]=v[7],_[8]=v[8],_[9]=v[9],_[10]=v[10],_[11]=v[11],_[12]=v[12],_[13]=v[13],_[14]=v[14],_[15]=v[15],_},B.copy=function de(v,_){return v[0]=_[0],v[1]=_[1],v[2]=_[2],v[3]=_[3],v[4]=_[4],v[5]=_[5],v[6]=_[6],v[7]=_[7],v[8]=_[8],v[9]=_[9],v[10]=_[10],v[11]=_[11],v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15],v},B.fromValues=function Pe(v,_,O,G,fe,be,He,nt,lt,gt,wt,St,Vt,Ut,mi,ui){var kt=new ie.ARRAY_TYPE(16);return kt[0]=v,kt[1]=_,kt[2]=O,kt[3]=G,kt[4]=fe,kt[5]=be,kt[6]=He,kt[7]=nt,kt[8]=lt,kt[9]=gt,kt[10]=wt,kt[11]=St,kt[12]=Vt,kt[13]=Ut,kt[14]=mi,kt[15]=ui,kt},B.set=function ve(v,_,O,G,fe,be,He,nt,lt,gt,wt,St,Vt,Ut,mi,ui,kt){return v[0]=_,v[1]=O,v[2]=G,v[3]=fe,v[4]=be,v[5]=He,v[6]=nt,v[7]=lt,v[8]=gt,v[9]=wt,v[10]=St,v[11]=Vt,v[12]=Ut,v[13]=mi,v[14]=ui,v[15]=kt,v},B.identity=ne,B.transpose=function Te(v,_){if(v===_){var O=_[1],G=_[2],fe=_[3],be=_[6],He=_[7],nt=_[11];v[1]=_[4],v[2]=_[8],v[3]=_[12],v[4]=O,v[6]=_[9],v[7]=_[13],v[8]=G,v[9]=be,v[11]=_[14],v[12]=fe,v[13]=He,v[14]=nt}else v[0]=_[0],v[1]=_[4],v[2]=_[8],v[3]=_[12],v[4]=_[1],v[5]=_[5],v[6]=_[9],v[7]=_[13],v[8]=_[2],v[9]=_[6],v[10]=_[10],v[11]=_[14],v[12]=_[3],v[13]=_[7],v[14]=_[11],v[15]=_[15];return v},B.invert=function De(v,_){var O=_[0],G=_[1],fe=_[2],be=_[3],He=_[4],nt=_[5],lt=_[6],gt=_[7],wt=_[8],St=_[9],Vt=_[10],Ut=_[11],mi=_[12],ui=_[13],kt=_[14],Oi=_[15],rn=O*nt-G*He,an=O*lt-fe*He,Zi=O*gt-be*He,Fi=G*lt-fe*nt,Xi=G*gt-be*nt,Dn=fe*gt-be*lt,On=wt*ui-St*mi,Un=wt*kt-Vt*mi,Vn=wt*Oi-Ut*mi,qn=St*kt-Vt*ui,Zn=St*Oi-Ut*ui,Gn=Vt*Oi-Ut*kt,_n=rn*Gn-an*Zn+Zi*qn+Fi*Vn-Xi*Un+Dn*On;return _n?(v[0]=(nt*Gn-lt*Zn+gt*qn)*(_n=1/_n),v[1]=(fe*Zn-G*Gn-be*qn)*_n,v[2]=(ui*Dn-kt*Xi+Oi*Fi)*_n,v[3]=(Vt*Xi-St*Dn-Ut*Fi)*_n,v[4]=(lt*Vn-He*Gn-gt*Un)*_n,v[5]=(O*Gn-fe*Vn+be*Un)*_n,v[6]=(kt*Zi-mi*Dn-Oi*an)*_n,v[7]=(wt*Dn-Vt*Zi+Ut*an)*_n,v[8]=(He*Zn-nt*Vn+gt*On)*_n,v[9]=(G*Vn-O*Zn-be*On)*_n,v[10]=(mi*Xi-ui*Zi+Oi*rn)*_n,v[11]=(St*Zi-wt*Xi-Ut*rn)*_n,v[12]=(nt*Un-He*qn-lt*On)*_n,v[13]=(O*qn-G*Un+fe*On)*_n,v[14]=(ui*an-mi*Fi-kt*rn)*_n,v[15]=(wt*Fi-St*an+Vt*rn)*_n,v):null},B.adjoint=function Ke(v,_){var O=_[0],G=_[1],fe=_[2],be=_[3],He=_[4],nt=_[5],lt=_[6],gt=_[7],wt=_[8],St=_[9],Vt=_[10],Ut=_[11],mi=_[12],ui=_[13],kt=_[14],Oi=_[15];return v[0]=nt*(Vt*Oi-Ut*kt)-St*(lt*Oi-gt*kt)+ui*(lt*Ut-gt*Vt),v[1]=-(G*(Vt*Oi-Ut*kt)-St*(fe*Oi-be*kt)+ui*(fe*Ut-be*Vt)),v[2]=G*(lt*Oi-gt*kt)-nt*(fe*Oi-be*kt)+ui*(fe*gt-be*lt),v[3]=-(G*(lt*Ut-gt*Vt)-nt*(fe*Ut-be*Vt)+St*(fe*gt-be*lt)),v[4]=-(He*(Vt*Oi-Ut*kt)-wt*(lt*Oi-gt*kt)+mi*(lt*Ut-gt*Vt)),v[5]=O*(Vt*Oi-Ut*kt)-wt*(fe*Oi-be*kt)+mi*(fe*Ut-be*Vt),v[6]=-(O*(lt*Oi-gt*kt)-He*(fe*Oi-be*kt)+mi*(fe*gt-be*lt)),v[7]=O*(lt*Ut-gt*Vt)-He*(fe*Ut-be*Vt)+wt*(fe*gt-be*lt),v[8]=He*(St*Oi-Ut*ui)-wt*(nt*Oi-gt*ui)+mi*(nt*Ut-gt*St),v[9]=-(O*(St*Oi-Ut*ui)-wt*(G*Oi-be*ui)+mi*(G*Ut-be*St)),v[10]=O*(nt*Oi-gt*ui)-He*(G*Oi-be*ui)+mi*(G*gt-be*nt),v[11]=-(O*(nt*Ut-gt*St)-He*(G*Ut-be*St)+wt*(G*gt-be*nt)),v[12]=-(He*(St*kt-Vt*ui)-wt*(nt*kt-lt*ui)+mi*(nt*Vt-lt*St)),v[13]=O*(St*kt-Vt*ui)-wt*(G*kt-fe*ui)+mi*(G*Vt-fe*St),v[14]=-(O*(nt*kt-lt*ui)-He*(G*kt-fe*ui)+mi*(G*lt-fe*nt)),v[15]=O*(nt*Vt-lt*St)-He*(G*Vt-fe*St)+wt*(G*lt-fe*nt),v},B.determinant=function Be(v){var _=v[0],O=v[1],G=v[2],fe=v[3],be=v[4],He=v[5],nt=v[6],lt=v[7],gt=v[8],wt=v[9],St=v[10],Vt=v[11],Ut=v[12],mi=v[13],ui=v[14],kt=v[15];return(_*He-O*be)*(St*kt-Vt*ui)-(_*nt-G*be)*(wt*kt-Vt*mi)+(_*lt-fe*be)*(wt*ui-St*mi)+(O*nt-G*He)*(gt*kt-Vt*Ut)-(O*lt-fe*He)*(gt*ui-St*Ut)+(G*lt-fe*nt)*(gt*mi-wt*Ut)},B.multiply=ft,B.translate=function Ae(v,_,O){var He,nt,lt,gt,wt,St,Vt,Ut,mi,ui,kt,Oi,G=O[0],fe=O[1],be=O[2];return _===v?(v[12]=_[0]*G+_[4]*fe+_[8]*be+_[12],v[13]=_[1]*G+_[5]*fe+_[9]*be+_[13],v[14]=_[2]*G+_[6]*fe+_[10]*be+_[14],v[15]=_[3]*G+_[7]*fe+_[11]*be+_[15]):(nt=_[1],lt=_[2],gt=_[3],wt=_[4],St=_[5],Vt=_[6],Ut=_[7],mi=_[8],ui=_[9],kt=_[10],Oi=_[11],v[0]=He=_[0],v[1]=nt,v[2]=lt,v[3]=gt,v[4]=wt,v[5]=St,v[6]=Vt,v[7]=Ut,v[8]=mi,v[9]=ui,v[10]=kt,v[11]=Oi,v[12]=He*G+wt*fe+mi*be+_[12],v[13]=nt*G+St*fe+ui*be+_[13],v[14]=lt*G+Vt*fe+kt*be+_[14],v[15]=gt*G+Ut*fe+Oi*be+_[15]),v},B.scale=function se(v,_,O){var G=O[0],fe=O[1],be=O[2];return v[0]=_[0]*G,v[1]=_[1]*G,v[2]=_[2]*G,v[3]=_[3]*G,v[4]=_[4]*fe,v[5]=_[5]*fe,v[6]=_[6]*fe,v[7]=_[7]*fe,v[8]=_[8]*be,v[9]=_[9]*be,v[10]=_[10]*be,v[11]=_[11]*be,v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15],v},B.rotate=function Ue(v,_,O,G){var lt,gt,wt,St,Vt,Ut,mi,ui,kt,Oi,rn,an,Zi,Fi,Xi,Dn,On,Un,Vn,qn,Zn,Gn,_n,_r,fe=G[0],be=G[1],He=G[2],nt=Math.hypot(fe,be,He);return nt<ie.EPSILON?null:(fe*=nt=1/nt,be*=nt,He*=nt,lt=Math.sin(O),gt=Math.cos(O),Vt=_[1],Ut=_[2],mi=_[3],kt=_[5],Oi=_[6],rn=_[7],Zi=_[9],Fi=_[10],Xi=_[11],Vn=fe*be*(wt=1-gt)-He*lt,qn=be*be*wt+gt,Zn=He*be*wt+fe*lt,Gn=fe*He*wt+be*lt,_n=be*He*wt-fe*lt,_r=He*He*wt+gt,v[0]=(St=_[0])*(Dn=fe*fe*wt+gt)+(ui=_[4])*(On=be*fe*wt+He*lt)+(an=_[8])*(Un=He*fe*wt-be*lt),v[1]=Vt*Dn+kt*On+Zi*Un,v[2]=Ut*Dn+Oi*On+Fi*Un,v[3]=mi*Dn+rn*On+Xi*Un,v[4]=St*Vn+ui*qn+an*Zn,v[5]=Vt*Vn+kt*qn+Zi*Zn,v[6]=Ut*Vn+Oi*qn+Fi*Zn,v[7]=mi*Vn+rn*qn+Xi*Zn,v[8]=St*Gn+ui*_n+an*_r,v[9]=Vt*Gn+kt*_n+Zi*_r,v[10]=Ut*Gn+Oi*_n+Fi*_r,v[11]=mi*Gn+rn*_n+Xi*_r,_!==v&&(v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15]),v)},B.rotateX=function Oe(v,_,O){var G=Math.sin(O),fe=Math.cos(O),be=_[4],He=_[5],nt=_[6],lt=_[7],gt=_[8],wt=_[9],St=_[10],Vt=_[11];return _!==v&&(v[0]=_[0],v[1]=_[1],v[2]=_[2],v[3]=_[3],v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15]),v[4]=be*fe+gt*G,v[5]=He*fe+wt*G,v[6]=nt*fe+St*G,v[7]=lt*fe+Vt*G,v[8]=gt*fe-be*G,v[9]=wt*fe-He*G,v[10]=St*fe-nt*G,v[11]=Vt*fe-lt*G,v},B.rotateY=function Ee(v,_,O){var G=Math.sin(O),fe=Math.cos(O),be=_[0],He=_[1],nt=_[2],lt=_[3],gt=_[8],wt=_[9],St=_[10],Vt=_[11];return _!==v&&(v[4]=_[4],v[5]=_[5],v[6]=_[6],v[7]=_[7],v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15]),v[0]=be*fe-gt*G,v[1]=He*fe-wt*G,v[2]=nt*fe-St*G,v[3]=lt*fe-Vt*G,v[8]=be*G+gt*fe,v[9]=He*G+wt*fe,v[10]=nt*G+St*fe,v[11]=lt*G+Vt*fe,v},B.rotateZ=function Ve(v,_,O){var G=Math.sin(O),fe=Math.cos(O),be=_[0],He=_[1],nt=_[2],lt=_[3],gt=_[4],wt=_[5],St=_[6],Vt=_[7];return _!==v&&(v[8]=_[8],v[9]=_[9],v[10]=_[10],v[11]=_[11],v[12]=_[12],v[13]=_[13],v[14]=_[14],v[15]=_[15]),v[0]=be*fe+gt*G,v[1]=He*fe+wt*G,v[2]=nt*fe+St*G,v[3]=lt*fe+Vt*G,v[4]=gt*fe-be*G,v[5]=wt*fe-He*G,v[6]=St*fe-nt*G,v[7]=Vt*fe-lt*G,v},B.fromTranslation=function oe(v,_){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=_[0],v[13]=_[1],v[14]=_[2],v[15]=1,v},B.fromScaling=function Ye(v,_){return v[0]=_[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=_[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=_[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},B.fromRotation=function ze(v,_,O){var nt,lt,gt,G=O[0],fe=O[1],be=O[2],He=Math.hypot(G,fe,be);return He<ie.EPSILON?null:(G*=He=1/He,fe*=He,be*=He,nt=Math.sin(_),lt=Math.cos(_),v[0]=G*G*(gt=1-lt)+lt,v[1]=fe*G*gt+be*nt,v[2]=be*G*gt-fe*nt,v[3]=0,v[4]=G*fe*gt-be*nt,v[5]=fe*fe*gt+lt,v[6]=be*fe*gt+G*nt,v[7]=0,v[8]=G*be*gt+fe*nt,v[9]=fe*be*gt-G*nt,v[10]=be*be*gt+lt,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},B.fromXRotation=function We(v,_){var O=Math.sin(_),G=Math.cos(_);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=G,v[6]=O,v[7]=0,v[8]=0,v[9]=-O,v[10]=G,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},B.fromYRotation=function mt(v,_){var O=Math.sin(_),G=Math.cos(_);return v[0]=G,v[1]=0,v[2]=-O,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=O,v[9]=0,v[10]=G,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},B.fromZRotation=function Tt(v,_){var O=Math.sin(_),G=Math.cos(_);return v[0]=G,v[1]=O,v[2]=0,v[3]=0,v[4]=-O,v[5]=G,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},B.fromRotationTranslation=$e,B.fromQuat2=function Et(v,_){var O=new ie.ARRAY_TYPE(3),G=-_[0],fe=-_[1],be=-_[2],He=_[3],nt=_[4],lt=_[5],gt=_[6],wt=_[7],St=G*G+fe*fe+be*be+He*He;return St>0?(O[0]=2*(nt*He+wt*G+lt*be-gt*fe)/St,O[1]=2*(lt*He+wt*fe+gt*G-nt*be)/St,O[2]=2*(gt*He+wt*be+nt*fe-lt*G)/St):(O[0]=2*(nt*He+wt*G+lt*be-gt*fe),O[1]=2*(lt*He+wt*fe+gt*G-nt*be),O[2]=2*(gt*He+wt*be+nt*fe-lt*G)),$e(v,_,O),v},B.getTranslation=function we(v,_){return v[0]=_[12],v[1]=_[13],v[2]=_[14],v},B.getScaling=he,B.getRotation=function ae(v,_){var O=new ie.ARRAY_TYPE(3);he(O,_);var G=1/O[0],fe=1/O[1],be=1/O[2],He=_[0]*G,nt=_[1]*fe,lt=_[2]*be,gt=_[4]*G,wt=_[5]*fe,St=_[6]*be,Vt=_[8]*G,Ut=_[9]*fe,mi=_[10]*be,ui=He+wt+mi,kt=0;return ui>0?(kt=2*Math.sqrt(ui+1),v[3]=.25*kt,v[0]=(St-Ut)/kt,v[1]=(Vt-lt)/kt,v[2]=(nt-gt)/kt):He>wt&&He>mi?(kt=2*Math.sqrt(1+He-wt-mi),v[3]=(St-Ut)/kt,v[0]=.25*kt,v[1]=(nt+gt)/kt,v[2]=(Vt+lt)/kt):wt>mi?(kt=2*Math.sqrt(1+wt-He-mi),v[3]=(Vt-lt)/kt,v[0]=(nt+gt)/kt,v[1]=.25*kt,v[2]=(St+Ut)/kt):(kt=2*Math.sqrt(1+mi-He-wt),v[3]=(nt-gt)/kt,v[0]=(Vt+lt)/kt,v[1]=(St+Ut)/kt,v[2]=.25*kt),v},B.fromRotationTranslationScale=function vt(v,_,O,G){var fe=_[0],be=_[1],He=_[2],nt=_[3],lt=fe+fe,gt=be+be,wt=He+He,St=fe*lt,Vt=fe*gt,Ut=fe*wt,mi=be*gt,ui=be*wt,kt=He*wt,Oi=nt*lt,rn=nt*gt,an=nt*wt,Zi=G[0],Fi=G[1],Xi=G[2];return v[0]=(1-(mi+kt))*Zi,v[1]=(Vt+an)*Zi,v[2]=(Ut-rn)*Zi,v[3]=0,v[4]=(Vt-an)*Fi,v[5]=(1-(St+kt))*Fi,v[6]=(ui+Oi)*Fi,v[7]=0,v[8]=(Ut+rn)*Xi,v[9]=(ui-Oi)*Xi,v[10]=(1-(St+mi))*Xi,v[11]=0,v[12]=O[0],v[13]=O[1],v[14]=O[2],v[15]=1,v},B.fromRotationTranslationScaleOrigin=function Pt(v,_,O,G,fe){var be=_[0],He=_[1],nt=_[2],lt=_[3],gt=be+be,wt=He+He,St=nt+nt,Vt=be*gt,Ut=be*wt,mi=be*St,ui=He*wt,kt=He*St,Oi=nt*St,rn=lt*gt,an=lt*wt,Zi=lt*St,Fi=G[0],Xi=G[1],Dn=G[2],On=fe[0],Un=fe[1],Vn=fe[2],qn=(1-(ui+Oi))*Fi,Zn=(Ut+Zi)*Fi,Gn=(mi-an)*Fi,_n=(Ut-Zi)*Xi,_r=(1-(Vt+Oi))*Xi,Ts=(kt+rn)*Xi,Ma=(mi+an)*Dn,oa=(kt-rn)*Dn,pa=(1-(Vt+ui))*Dn;return v[0]=qn,v[1]=Zn,v[2]=Gn,v[3]=0,v[4]=_n,v[5]=_r,v[6]=Ts,v[7]=0,v[8]=Ma,v[9]=oa,v[10]=pa,v[11]=0,v[12]=O[0]+On-(qn*On+_n*Un+Ma*Vn),v[13]=O[1]+Un-(Zn*On+_r*Un+oa*Vn),v[14]=O[2]+Vn-(Gn*On+Ts*Un+pa*Vn),v[15]=1,v},B.fromQuat=function ei(v,_){var O=_[0],G=_[1],fe=_[2],be=_[3],He=O+O,nt=G+G,lt=fe+fe,gt=O*He,wt=G*He,St=G*nt,Vt=fe*He,Ut=fe*nt,mi=fe*lt,ui=be*He,kt=be*nt,Oi=be*lt;return v[0]=1-St-mi,v[1]=wt+Oi,v[2]=Vt-kt,v[3]=0,v[4]=wt-Oi,v[5]=1-gt-mi,v[6]=Ut+ui,v[7]=0,v[8]=Vt+kt,v[9]=Ut-ui,v[10]=1-gt-St,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},B.frustum=function si(v,_,O,G,fe,be,He){var nt=1/(O-_),lt=1/(fe-G),gt=1/(be-He);return v[0]=2*be*nt,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*be*lt,v[6]=0,v[7]=0,v[8]=(O+_)*nt,v[9]=(fe+G)*lt,v[10]=(He+be)*gt,v[11]=-1,v[12]=0,v[13]=0,v[14]=He*be*2*gt,v[15]=0,v},B.perspective=function K(v,_,O,G,fe){var He,be=1/Math.tan(_/2);return v[0]=be/O,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=be,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,null!=fe&&fe!==1/0?(v[10]=(fe+G)*(He=1/(G-fe)),v[14]=2*fe*G*He):(v[10]=-1,v[14]=-2*G),v},B.perspectiveFromFieldOfView=function Me(v,_,O,G){var fe=Math.tan(_.upDegrees*Math.PI/180),be=Math.tan(_.downDegrees*Math.PI/180),He=Math.tan(_.leftDegrees*Math.PI/180),nt=Math.tan(_.rightDegrees*Math.PI/180),lt=2/(He+nt),gt=2/(fe+be);return v[0]=lt,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=gt,v[6]=0,v[7]=0,v[8]=-(He-nt)*lt*.5,v[9]=(fe-be)*gt*.5,v[10]=G/(O-G),v[11]=-1,v[12]=0,v[13]=0,v[14]=G*O/(O-G),v[15]=0,v},B.ortho=function _t(v,_,O,G,fe,be,He){var nt=1/(_-O),lt=1/(G-fe),gt=1/(be-He);return v[0]=-2*nt,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*lt,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*gt,v[11]=0,v[12]=(_+O)*nt,v[13]=(fe+G)*lt,v[14]=(He+be)*gt,v[15]=1,v},B.lookAt=function Jt(v,_,O,G){var fe,be,He,nt,lt,gt,wt,St,Vt,Ut,mi=_[0],ui=_[1],kt=_[2],Oi=G[0],rn=G[1],an=G[2],Zi=O[0],Fi=O[1],Xi=O[2];return Math.abs(mi-Zi)<ie.EPSILON&&Math.abs(ui-Fi)<ie.EPSILON&&Math.abs(kt-Xi)<ie.EPSILON?ne(v):(wt=mi-Zi,St=ui-Fi,Vt=kt-Xi,fe=rn*(Vt*=Ut=1/Math.hypot(wt,St,Vt))-an*(St*=Ut),be=an*(wt*=Ut)-Oi*Vt,He=Oi*St-rn*wt,(Ut=Math.hypot(fe,be,He))?(fe*=Ut=1/Ut,be*=Ut,He*=Ut):(fe=0,be=0,He=0),nt=St*He-Vt*be,lt=Vt*fe-wt*He,gt=wt*be-St*fe,(Ut=Math.hypot(nt,lt,gt))?(nt*=Ut=1/Ut,lt*=Ut,gt*=Ut):(nt=0,lt=0,gt=0),v[0]=fe,v[1]=nt,v[2]=wt,v[3]=0,v[4]=be,v[5]=lt,v[6]=St,v[7]=0,v[8]=He,v[9]=gt,v[10]=Vt,v[11]=0,v[12]=-(fe*mi+be*ui+He*kt),v[13]=-(nt*mi+lt*ui+gt*kt),v[14]=-(wt*mi+St*ui+Vt*kt),v[15]=1,v)},B.targetTo=function ti(v,_,O,G){var fe=_[0],be=_[1],He=_[2],nt=G[0],lt=G[1],gt=G[2],wt=fe-O[0],St=be-O[1],Vt=He-O[2],Ut=wt*wt+St*St+Vt*Vt;Ut>0&&(wt*=Ut=1/Math.sqrt(Ut),St*=Ut,Vt*=Ut);var mi=lt*Vt-gt*St,ui=gt*wt-nt*Vt,kt=nt*St-lt*wt;return(Ut=mi*mi+ui*ui+kt*kt)>0&&(mi*=Ut=1/Math.sqrt(Ut),ui*=Ut,kt*=Ut),v[0]=mi,v[1]=ui,v[2]=kt,v[3]=0,v[4]=St*kt-Vt*ui,v[5]=Vt*mi-wt*kt,v[6]=wt*ui-St*mi,v[7]=0,v[8]=wt,v[9]=St,v[10]=Vt,v[11]=0,v[12]=fe,v[13]=be,v[14]=He,v[15]=1,v},B.str=function Ai(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},B.frob=function vi(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},B.add=function Ci(v,_,O){return v[0]=_[0]+O[0],v[1]=_[1]+O[1],v[2]=_[2]+O[2],v[3]=_[3]+O[3],v[4]=_[4]+O[4],v[5]=_[5]+O[5],v[6]=_[6]+O[6],v[7]=_[7]+O[7],v[8]=_[8]+O[8],v[9]=_[9]+O[9],v[10]=_[10]+O[10],v[11]=_[11]+O[11],v[12]=_[12]+O[12],v[13]=_[13]+O[13],v[14]=_[14]+O[14],v[15]=_[15]+O[15],v},B.subtract=zi,B.multiplyScalar=function N(v,_,O){return v[0]=_[0]*O,v[1]=_[1]*O,v[2]=_[2]*O,v[3]=_[3]*O,v[4]=_[4]*O,v[5]=_[5]*O,v[6]=_[6]*O,v[7]=_[7]*O,v[8]=_[8]*O,v[9]=_[9]*O,v[10]=_[10]*O,v[11]=_[11]*O,v[12]=_[12]*O,v[13]=_[13]*O,v[14]=_[14]*O,v[15]=_[15]*O,v},B.multiplyScalarAndAdd=function F(v,_,O,G){return v[0]=_[0]+O[0]*G,v[1]=_[1]+O[1]*G,v[2]=_[2]+O[2]*G,v[3]=_[3]+O[3]*G,v[4]=_[4]+O[4]*G,v[5]=_[5]+O[5]*G,v[6]=_[6]+O[6]*G,v[7]=_[7]+O[7]*G,v[8]=_[8]+O[8]*G,v[9]=_[9]+O[9]*G,v[10]=_[10]+O[10]*G,v[11]=_[11]+O[11]*G,v[12]=_[12]+O[12]*G,v[13]=_[13]+O[13]*G,v[14]=_[14]+O[14]*G,v[15]=_[15]+O[15]*G,v},B.exactEquals=function te(v,_){return v[0]===_[0]&&v[1]===_[1]&&v[2]===_[2]&&v[3]===_[3]&&v[4]===_[4]&&v[5]===_[5]&&v[6]===_[6]&&v[7]===_[7]&&v[8]===_[8]&&v[9]===_[9]&&v[10]===_[10]&&v[11]===_[11]&&v[12]===_[12]&&v[13]===_[13]&&v[14]===_[14]&&v[15]===_[15]},B.equals=function Se(v,_){var O=v[0],G=v[1],fe=v[2],be=v[3],He=v[4],nt=v[5],lt=v[6],gt=v[7],wt=v[8],St=v[9],Vt=v[10],Ut=v[11],mi=v[12],ui=v[13],kt=v[14],Oi=v[15],rn=_[0],an=_[1],Zi=_[2],Fi=_[3],Xi=_[4],Dn=_[5],On=_[6],Un=_[7],Vn=_[8],qn=_[9],Zn=_[10],Gn=_[11],_n=_[12],_r=_[13],Ts=_[14],Ma=_[15];return Math.abs(O-rn)<=ie.EPSILON*Math.max(1,Math.abs(O),Math.abs(rn))&&Math.abs(G-an)<=ie.EPSILON*Math.max(1,Math.abs(G),Math.abs(an))&&Math.abs(fe-Zi)<=ie.EPSILON*Math.max(1,Math.abs(fe),Math.abs(Zi))&&Math.abs(be-Fi)<=ie.EPSILON*Math.max(1,Math.abs(be),Math.abs(Fi))&&Math.abs(He-Xi)<=ie.EPSILON*Math.max(1,Math.abs(He),Math.abs(Xi))&&Math.abs(nt-Dn)<=ie.EPSILON*Math.max(1,Math.abs(nt),Math.abs(Dn))&&Math.abs(lt-On)<=ie.EPSILON*Math.max(1,Math.abs(lt),Math.abs(On))&&Math.abs(gt-Un)<=ie.EPSILON*Math.max(1,Math.abs(gt),Math.abs(Un))&&Math.abs(wt-Vn)<=ie.EPSILON*Math.max(1,Math.abs(wt),Math.abs(Vn))&&Math.abs(St-qn)<=ie.EPSILON*Math.max(1,Math.abs(St),Math.abs(qn))&&Math.abs(Vt-Zn)<=ie.EPSILON*Math.max(1,Math.abs(Vt),Math.abs(Zn))&&Math.abs(Ut-Gn)<=ie.EPSILON*Math.max(1,Math.abs(Ut),Math.abs(Gn))&&Math.abs(mi-_n)<=ie.EPSILON*Math.max(1,Math.abs(mi),Math.abs(_n))&&Math.abs(ui-_r)<=ie.EPSILON*Math.max(1,Math.abs(ui),Math.abs(_r))&&Math.abs(kt-Ts)<=ie.EPSILON*Math.max(1,Math.abs(kt),Math.abs(Ts))&&Math.abs(Oi-Ma)<=ie.EPSILON*Math.max(1,Math.abs(Oi),Math.abs(Ma))},B.sub=B.mul=void 0;var ie=function Z(v){if(v&&v.__esModule)return v;if(null===v||"object"!==me(v)&&"function"!=typeof v)return{default:v};var _=ue();if(_&&_.has(v))return _.get(v);var O={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var fe in v)if(Object.prototype.hasOwnProperty.call(v,fe)){var be=G?Object.getOwnPropertyDescriptor(v,fe):null;be&&(be.get||be.set)?Object.defineProperty(O,fe,be):O[fe]=v[fe]}return O.default=v,_&&_.set(v,O),O}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var v=new WeakMap;return ue=function(){return v},v}function ne(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function ft(v,_,O){var G=_[0],fe=_[1],be=_[2],He=_[3],nt=_[4],lt=_[5],gt=_[6],wt=_[7],St=_[8],Vt=_[9],Ut=_[10],mi=_[11],ui=_[12],kt=_[13],Oi=_[14],rn=_[15],an=O[0],Zi=O[1],Fi=O[2],Xi=O[3];return v[0]=an*G+Zi*nt+Fi*St+Xi*ui,v[1]=an*fe+Zi*lt+Fi*Vt+Xi*kt,v[2]=an*be+Zi*gt+Fi*Ut+Xi*Oi,v[3]=an*He+Zi*wt+Fi*mi+Xi*rn,v[4]=(an=O[4])*G+(Zi=O[5])*nt+(Fi=O[6])*St+(Xi=O[7])*ui,v[5]=an*fe+Zi*lt+Fi*Vt+Xi*kt,v[6]=an*be+Zi*gt+Fi*Ut+Xi*Oi,v[7]=an*He+Zi*wt+Fi*mi+Xi*rn,v[8]=(an=O[8])*G+(Zi=O[9])*nt+(Fi=O[10])*St+(Xi=O[11])*ui,v[9]=an*fe+Zi*lt+Fi*Vt+Xi*kt,v[10]=an*be+Zi*gt+Fi*Ut+Xi*Oi,v[11]=an*He+Zi*wt+Fi*mi+Xi*rn,v[12]=(an=O[12])*G+(Zi=O[13])*nt+(Fi=O[14])*St+(Xi=O[15])*ui,v[13]=an*fe+Zi*lt+Fi*Vt+Xi*kt,v[14]=an*be+Zi*gt+Fi*Ut+Xi*Oi,v[15]=an*He+Zi*wt+Fi*mi+Xi*rn,v}function $e(v,_,O){var G=_[0],fe=_[1],be=_[2],He=_[3],nt=G+G,lt=fe+fe,gt=be+be,wt=G*nt,St=G*lt,Vt=G*gt,Ut=fe*lt,mi=fe*gt,ui=be*gt,kt=He*nt,Oi=He*lt,rn=He*gt;return v[0]=1-(Ut+ui),v[1]=St+rn,v[2]=Vt-Oi,v[3]=0,v[4]=St-rn,v[5]=1-(wt+ui),v[6]=mi+kt,v[7]=0,v[8]=Vt+Oi,v[9]=mi-kt,v[10]=1-(wt+Ut),v[11]=0,v[12]=O[0],v[13]=O[1],v[14]=O[2],v[15]=1,v}function he(v,_){var be=_[4],He=_[5],nt=_[6],lt=_[8],gt=_[9],wt=_[10];return v[0]=Math.hypot(_[0],_[1],_[2]),v[1]=Math.hypot(be,He,nt),v[2]=Math.hypot(lt,gt,wt),v}function zi(v,_,O){return v[0]=_[0]-O[0],v[1]=_[1]-O[1],v[2]=_[2]-O[2],v[3]=_[3]-O[3],v[4]=_[4]-O[4],v[5]=_[5]-O[5],v[6]=_[6]-O[6],v[7]=_[7]-O[7],v[8]=_[8]-O[8],v[9]=_[9]-O[9],v[10]=_[10]-O[10],v[11]=_[11]-O[11],v[12]=_[12]-O[12],v[13]=_[13]-O[13],v[14]=_[14]-O[14],v[15]=_[15]-O[15],v}B.mul=ft,B.sub=zi},{"./common.js":2}],8:[function(Y,et,B){"use strict";function me(F){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Se){return typeof Se}:function(Se){return Se&&"function"==typeof Symbol&&Se.constructor===Symbol&&Se!==Symbol.prototype?"symbol":typeof Se})(F)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=Pe,B.identity=function ve(F){return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F},B.setAxisAngle=ne,B.getAxisAngle=function Te(F,te){var Se=2*Math.acos(te[3]),j=Math.sin(Se/2);return j>ie.EPSILON?(F[0]=te[0]/j,F[1]=te[1]/j,F[2]=te[2]/j):(F[0]=1,F[1]=0,F[2]=0),Se},B.getAngle=function De(F,te){var Se=ei(F,te);return Math.acos(2*Se*Se-1)},B.multiply=Ke,B.rotateX=function Be(F,te,Se){Se*=.5;var j=te[0],ee=te[1],v=te[2],_=te[3],O=Math.sin(Se),G=Math.cos(Se);return F[0]=j*G+_*O,F[1]=ee*G+v*O,F[2]=v*G-ee*O,F[3]=_*G-j*O,F},B.rotateY=function ft(F,te,Se){Se*=.5;var j=te[0],ee=te[1],v=te[2],_=te[3],O=Math.sin(Se),G=Math.cos(Se);return F[0]=j*G-v*O,F[1]=ee*G+_*O,F[2]=v*G+j*O,F[3]=_*G-ee*O,F},B.rotateZ=function Ae(F,te,Se){Se*=.5;var j=te[0],ee=te[1],v=te[2],_=te[3],O=Math.sin(Se),G=Math.cos(Se);return F[0]=j*G+ee*O,F[1]=ee*G-j*O,F[2]=v*G+_*O,F[3]=_*G-v*O,F},B.calculateW=function se(F,te){var Se=te[0],j=te[1],ee=te[2];return F[0]=Se,F[1]=j,F[2]=ee,F[3]=Math.sqrt(Math.abs(1-Se*Se-j*j-ee*ee)),F},B.exp=Ue,B.ln=Oe,B.pow=function Ee(F,te,Se){return Oe(F,te),Pt(F,F,Se),Ue(F,F),F},B.slerp=Ve,B.random=function oe(F){var te=ie.RANDOM(),Se=ie.RANDOM(),j=ie.RANDOM(),ee=Math.sqrt(1-te),v=Math.sqrt(te);return F[0]=ee*Math.sin(2*Math.PI*Se),F[1]=ee*Math.cos(2*Math.PI*Se),F[2]=v*Math.sin(2*Math.PI*j),F[3]=v*Math.cos(2*Math.PI*j),F},B.invert=function Ye(F,te){var Se=te[0],j=te[1],ee=te[2],v=te[3],_=Se*Se+j*j+ee*ee+v*v,O=_?1/_:0;return F[0]=-Se*O,F[1]=-j*O,F[2]=-ee*O,F[3]=v*O,F},B.conjugate=function ze(F,te){return F[0]=-te[0],F[1]=-te[1],F[2]=-te[2],F[3]=te[3],F},B.fromMat3=We,B.fromEuler=function mt(F,te,Se,j){var ee=.5*Math.PI/180;te*=ee,Se*=ee,j*=ee;var v=Math.sin(te),_=Math.cos(te),O=Math.sin(Se),G=Math.cos(Se),fe=Math.sin(j),be=Math.cos(j);return F[0]=v*G*be-_*O*fe,F[1]=_*O*be+v*G*fe,F[2]=_*G*fe-v*O*be,F[3]=_*G*be+v*O*fe,F},B.str=function Tt(F){return"quat("+F[0]+", "+F[1]+", "+F[2]+", "+F[3]+")"},B.setAxes=B.sqlerp=B.rotationTo=B.equals=B.exactEquals=B.normalize=B.sqrLen=B.squaredLength=B.len=B.length=B.lerp=B.dot=B.scale=B.mul=B.add=B.set=B.copy=B.fromValues=B.clone=void 0;var ie=de(Y("./common.js")),ue=de(Y("./mat3.js")),Z=de(Y("./vec3.js")),Q=de(Y("./vec4.js"));function $(){if("function"!=typeof WeakMap)return null;var F=new WeakMap;return $=function(){return F},F}function de(F){if(F&&F.__esModule)return F;if(null===F||"object"!==me(F)&&"function"!=typeof F)return{default:F};var te=$();if(te&&te.has(F))return te.get(F);var Se={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in F)if(Object.prototype.hasOwnProperty.call(F,ee)){var v=j?Object.getOwnPropertyDescriptor(F,ee):null;v&&(v.get||v.set)?Object.defineProperty(Se,ee,v):Se[ee]=F[ee]}return Se.default=F,te&&te.set(F,Se),Se}function Pe(){var F=new ie.ARRAY_TYPE(4);return ie.ARRAY_TYPE!=Float32Array&&(F[0]=0,F[1]=0,F[2]=0),F[3]=1,F}function ne(F,te,Se){Se*=.5;var j=Math.sin(Se);return F[0]=j*te[0],F[1]=j*te[1],F[2]=j*te[2],F[3]=Math.cos(Se),F}function Ke(F,te,Se){var j=te[0],ee=te[1],v=te[2],_=te[3],O=Se[0],G=Se[1],fe=Se[2],be=Se[3];return F[0]=j*be+_*O+ee*fe-v*G,F[1]=ee*be+_*G+v*O-j*fe,F[2]=v*be+_*fe+j*G-ee*O,F[3]=_*be-j*O-ee*G-v*fe,F}function Ue(F,te){var Se=te[0],j=te[1],ee=te[2],v=te[3],_=Math.sqrt(Se*Se+j*j+ee*ee),O=Math.exp(v),G=_>0?O*Math.sin(_)/_:0;return F[0]=Se*G,F[1]=j*G,F[2]=ee*G,F[3]=O*Math.cos(_),F}function Oe(F,te){var Se=te[0],j=te[1],ee=te[2],v=te[3],_=Math.sqrt(Se*Se+j*j+ee*ee),O=_>0?Math.atan2(_,v)/_:0;return F[0]=Se*O,F[1]=j*O,F[2]=ee*O,F[3]=.5*Math.log(Se*Se+j*j+ee*ee+v*v),F}function Ve(F,te,Se,j){var nt,lt,gt,wt,St,ee=te[0],v=te[1],_=te[2],O=te[3],G=Se[0],fe=Se[1],be=Se[2],He=Se[3];return(lt=ee*G+v*fe+_*be+O*He)<0&&(lt=-lt,G=-G,fe=-fe,be=-be,He=-He),1-lt>ie.EPSILON?(nt=Math.acos(lt),gt=Math.sin(nt),wt=Math.sin((1-j)*nt)/gt,St=Math.sin(j*nt)/gt):(wt=1-j,St=j),F[0]=wt*ee+St*G,F[1]=wt*v+St*fe,F[2]=wt*_+St*be,F[3]=wt*O+St*He,F}function We(F,te){var j,Se=te[0]+te[4]+te[8];if(Se>0)j=Math.sqrt(Se+1),F[3]=.5*j,F[0]=(te[5]-te[7])*(j=.5/j),F[1]=(te[6]-te[2])*j,F[2]=(te[1]-te[3])*j;else{var ee=0;te[4]>te[0]&&(ee=1),te[8]>te[3*ee+ee]&&(ee=2);var v=(ee+1)%3,_=(ee+2)%3;j=Math.sqrt(te[3*ee+ee]-te[3*v+v]-te[3*_+_]+1),F[ee]=.5*j,F[3]=(te[3*v+_]-te[3*_+v])*(j=.5/j),F[v]=(te[3*v+ee]+te[3*ee+v])*j,F[_]=(te[3*_+ee]+te[3*ee+_])*j}return F}B.clone=Q.clone,B.fromValues=Q.fromValues,B.copy=Q.copy,B.set=Q.set,B.add=Q.add,B.mul=Ke;var Pt=Q.scale;B.scale=Pt;var ei=Q.dot;B.dot=ei,B.lerp=Q.lerp;var K=Q.length;B.length=K,B.len=K;var _t=Q.squaredLength;B.squaredLength=_t,B.sqrLen=_t;var ti=Q.normalize;B.normalize=ti,B.exactEquals=Q.exactEquals,B.equals=Q.equals;var F,te,Se,Ci=(F=Z.create(),te=Z.fromValues(1,0,0),Se=Z.fromValues(0,1,0),function(j,ee,v){var _=Z.dot(ee,v);return _<-.999999?(Z.cross(F,te,ee),Z.len(F)<1e-6&&Z.cross(F,Se,ee),Z.normalize(F,F),ne(j,F,Math.PI),j):_>.999999?(j[0]=0,j[1]=0,j[2]=0,j[3]=1,j):(Z.cross(F,ee,v),j[0]=F[0],j[1]=F[1],j[2]=F[2],j[3]=1+_,ti(j,j))});B.rotationTo=Ci;var zi=function(){var F=Pe(),te=Pe();return function(Se,j,ee,v,_,O){return Ve(F,j,_,O),Ve(te,ee,v,O),Ve(Se,F,te,2*O*(1-O)),Se}}();B.sqlerp=zi;var N=function(){var F=ue.create();return function(te,Se,j,ee){return F[0]=j[0],F[3]=j[1],F[6]=j[2],F[1]=ee[0],F[4]=ee[1],F[7]=ee[2],F[2]=-Se[0],F[5]=-Se[1],F[8]=-Se[2],ti(te,We(te,F))}}();B.setAxes=N},{"./common.js":2,"./mat3.js":6,"./vec3.js":11,"./vec4.js":12}],9:[function(Y,et,B){"use strict";function me(N){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(te){return typeof te}:function(te){return te&&"function"==typeof Symbol&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te})(N)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=function de(){var N=new ie.ARRAY_TYPE(8);return ie.ARRAY_TYPE!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0,N[4]=0,N[5]=0,N[6]=0,N[7]=0),N[3]=1,N},B.clone=function Pe(N){var F=new ie.ARRAY_TYPE(8);return F[0]=N[0],F[1]=N[1],F[2]=N[2],F[3]=N[3],F[4]=N[4],F[5]=N[5],F[6]=N[6],F[7]=N[7],F},B.fromValues=function ve(N,F,te,Se,j,ee,v,_){var O=new ie.ARRAY_TYPE(8);return O[0]=N,O[1]=F,O[2]=te,O[3]=Se,O[4]=j,O[5]=ee,O[6]=v,O[7]=_,O},B.fromRotationTranslationValues=function ne(N,F,te,Se,j,ee,v){var _=new ie.ARRAY_TYPE(8);_[0]=N,_[1]=F,_[2]=te,_[3]=Se;var O=.5*j,G=.5*ee,fe=.5*v;return _[4]=O*Se+G*te-fe*F,_[5]=G*Se+fe*N-O*te,_[6]=fe*Se+O*F-G*N,_[7]=-O*N-G*F-fe*te,_},B.fromRotationTranslation=Te,B.fromTranslation=function De(N,F){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=.5*F[0],N[5]=.5*F[1],N[6]=.5*F[2],N[7]=0,N},B.fromRotation=function Ke(N,F){return N[0]=F[0],N[1]=F[1],N[2]=F[2],N[3]=F[3],N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},B.fromMat4=function Be(N,F){var te=ue.create();Z.getRotation(te,F);var Se=new ie.ARRAY_TYPE(3);return Z.getTranslation(Se,F),Te(N,te,Se),N},B.copy=ft,B.identity=function Ae(N){return N[0]=0,N[1]=0,N[2]=0,N[3]=1,N[4]=0,N[5]=0,N[6]=0,N[7]=0,N},B.set=function se(N,F,te,Se,j,ee,v,_,O){return N[0]=F,N[1]=te,N[2]=Se,N[3]=j,N[4]=ee,N[5]=v,N[6]=_,N[7]=O,N},B.getDual=function Oe(N,F){return N[0]=F[4],N[1]=F[5],N[2]=F[6],N[3]=F[7],N},B.setDual=function Ve(N,F){return N[4]=F[0],N[5]=F[1],N[6]=F[2],N[7]=F[3],N},B.getTranslation=function oe(N,F){var te=F[4],Se=F[5],j=F[6],ee=F[7],v=-F[0],_=-F[1],O=-F[2],G=F[3];return N[0]=2*(te*G+ee*v+Se*O-j*_),N[1]=2*(Se*G+ee*_+j*v-te*O),N[2]=2*(j*G+ee*O+te*_-Se*v),N},B.translate=function Ye(N,F,te){var Se=F[0],j=F[1],ee=F[2],v=F[3],_=.5*te[0],O=.5*te[1],G=.5*te[2],fe=F[4],be=F[5],He=F[6],nt=F[7];return N[0]=Se,N[1]=j,N[2]=ee,N[3]=v,N[4]=v*_+j*G-ee*O+fe,N[5]=v*O+ee*_-Se*G+be,N[6]=v*G+Se*O-j*_+He,N[7]=-Se*_-j*O-ee*G+nt,N},B.rotateX=function ze(N,F,te){var Se=-F[0],j=-F[1],ee=-F[2],v=F[3],_=F[4],O=F[5],G=F[6],fe=F[7],be=_*v+fe*Se+O*ee-G*j,He=O*v+fe*j+G*Se-_*ee,nt=G*v+fe*ee+_*j-O*Se,lt=fe*v-_*Se-O*j-G*ee;return ue.rotateX(N,F,te),N[4]=be*(v=N[3])+lt*(Se=N[0])+He*(ee=N[2])-nt*(j=N[1]),N[5]=He*v+lt*j+nt*Se-be*ee,N[6]=nt*v+lt*ee+be*j-He*Se,N[7]=lt*v-be*Se-He*j-nt*ee,N},B.rotateY=function We(N,F,te){var Se=-F[0],j=-F[1],ee=-F[2],v=F[3],_=F[4],O=F[5],G=F[6],fe=F[7],be=_*v+fe*Se+O*ee-G*j,He=O*v+fe*j+G*Se-_*ee,nt=G*v+fe*ee+_*j-O*Se,lt=fe*v-_*Se-O*j-G*ee;return ue.rotateY(N,F,te),N[4]=be*(v=N[3])+lt*(Se=N[0])+He*(ee=N[2])-nt*(j=N[1]),N[5]=He*v+lt*j+nt*Se-be*ee,N[6]=nt*v+lt*ee+be*j-He*Se,N[7]=lt*v-be*Se-He*j-nt*ee,N},B.rotateZ=function mt(N,F,te){var Se=-F[0],j=-F[1],ee=-F[2],v=F[3],_=F[4],O=F[5],G=F[6],fe=F[7],be=_*v+fe*Se+O*ee-G*j,He=O*v+fe*j+G*Se-_*ee,nt=G*v+fe*ee+_*j-O*Se,lt=fe*v-_*Se-O*j-G*ee;return ue.rotateZ(N,F,te),N[4]=be*(v=N[3])+lt*(Se=N[0])+He*(ee=N[2])-nt*(j=N[1]),N[5]=He*v+lt*j+nt*Se-be*ee,N[6]=nt*v+lt*ee+be*j-He*Se,N[7]=lt*v-be*Se-He*j-nt*ee,N},B.rotateByQuatAppend=function Tt(N,F,te){var Se=te[0],j=te[1],ee=te[2],v=te[3],_=F[0],O=F[1],G=F[2],fe=F[3];return N[0]=_*v+fe*Se+O*ee-G*j,N[1]=O*v+fe*j+G*Se-_*ee,N[2]=G*v+fe*ee+_*j-O*Se,N[3]=fe*v-_*Se-O*j-G*ee,N[4]=(_=F[4])*v+(fe=F[7])*Se+(O=F[5])*ee-(G=F[6])*j,N[5]=O*v+fe*j+G*Se-_*ee,N[6]=G*v+fe*ee+_*j-O*Se,N[7]=fe*v-_*Se-O*j-G*ee,N},B.rotateByQuatPrepend=function $e(N,F,te){var Se=F[0],j=F[1],ee=F[2],v=F[3],_=te[0],O=te[1],G=te[2],fe=te[3];return N[0]=Se*fe+v*_+j*G-ee*O,N[1]=j*fe+v*O+ee*_-Se*G,N[2]=ee*fe+v*G+Se*O-j*_,N[3]=v*fe-Se*_-j*O-ee*G,N[4]=Se*(fe=te[7])+v*(_=te[4])+j*(G=te[6])-ee*(O=te[5]),N[5]=j*fe+v*O+ee*_-Se*G,N[6]=ee*fe+v*G+Se*O-j*_,N[7]=v*fe-Se*_-j*O-ee*G,N},B.rotateAroundAxis=function Et(N,F,te,Se){if(Math.abs(Se)<ie.EPSILON)return ft(N,F);var j=Math.hypot(te[0],te[1],te[2]);Se*=.5;var ee=Math.sin(Se),v=ee*te[0]/j,_=ee*te[1]/j,O=ee*te[2]/j,G=Math.cos(Se),fe=F[0],be=F[1],He=F[2],nt=F[3];N[0]=fe*G+nt*v+be*O-He*_,N[1]=be*G+nt*_+He*v-fe*O,N[2]=He*G+nt*O+fe*_-be*v,N[3]=nt*G-fe*v-be*_-He*O;var lt=F[4],gt=F[5],wt=F[6],St=F[7];return N[4]=lt*G+St*v+gt*O-wt*_,N[5]=gt*G+St*_+wt*v-lt*O,N[6]=wt*G+St*O+lt*_-gt*v,N[7]=St*G-lt*v-gt*_-wt*O,N},B.add=function we(N,F,te){return N[0]=F[0]+te[0],N[1]=F[1]+te[1],N[2]=F[2]+te[2],N[3]=F[3]+te[3],N[4]=F[4]+te[4],N[5]=F[5]+te[5],N[6]=F[6]+te[6],N[7]=F[7]+te[7],N},B.multiply=he,B.scale=function vt(N,F,te){return N[0]=F[0]*te,N[1]=F[1]*te,N[2]=F[2]*te,N[3]=F[3]*te,N[4]=F[4]*te,N[5]=F[5]*te,N[6]=F[6]*te,N[7]=F[7]*te,N},B.lerp=function ei(N,F,te,Se){var j=1-Se;return Pt(F,te)<0&&(Se=-Se),N[0]=F[0]*j+te[0]*Se,N[1]=F[1]*j+te[1]*Se,N[2]=F[2]*j+te[2]*Se,N[3]=F[3]*j+te[3]*Se,N[4]=F[4]*j+te[4]*Se,N[5]=F[5]*j+te[5]*Se,N[6]=F[6]*j+te[6]*Se,N[7]=F[7]*j+te[7]*Se,N},B.invert=function si(N,F){var te=Jt(F);return N[0]=-F[0]/te,N[1]=-F[1]/te,N[2]=-F[2]/te,N[3]=F[3]/te,N[4]=-F[4]/te,N[5]=-F[5]/te,N[6]=-F[6]/te,N[7]=F[7]/te,N},B.conjugate=function K(N,F){return N[0]=-F[0],N[1]=-F[1],N[2]=-F[2],N[3]=F[3],N[4]=-F[4],N[5]=-F[5],N[6]=-F[6],N[7]=F[7],N},B.normalize=function Ai(N,F){var te=Jt(F);if(te>0){te=Math.sqrt(te);var Se=F[0]/te,j=F[1]/te,ee=F[2]/te,v=F[3]/te,_=F[4],O=F[5],G=F[6],fe=F[7],be=Se*_+j*O+ee*G+v*fe;N[0]=Se,N[1]=j,N[2]=ee,N[3]=v,N[4]=(_-Se*be)/te,N[5]=(O-j*be)/te,N[6]=(G-ee*be)/te,N[7]=(fe-v*be)/te}return N},B.str=function vi(N){return"quat2("+N[0]+", "+N[1]+", "+N[2]+", "+N[3]+", "+N[4]+", "+N[5]+", "+N[6]+", "+N[7]+")"},B.exactEquals=function Ci(N,F){return N[0]===F[0]&&N[1]===F[1]&&N[2]===F[2]&&N[3]===F[3]&&N[4]===F[4]&&N[5]===F[5]&&N[6]===F[6]&&N[7]===F[7]},B.equals=function zi(N,F){var te=N[0],Se=N[1],j=N[2],ee=N[3],v=N[4],_=N[5],O=N[6],G=N[7],fe=F[0],be=F[1],He=F[2],nt=F[3],lt=F[4],gt=F[5],wt=F[6],St=F[7];return Math.abs(te-fe)<=ie.EPSILON*Math.max(1,Math.abs(te),Math.abs(fe))&&Math.abs(Se-be)<=ie.EPSILON*Math.max(1,Math.abs(Se),Math.abs(be))&&Math.abs(j-He)<=ie.EPSILON*Math.max(1,Math.abs(j),Math.abs(He))&&Math.abs(ee-nt)<=ie.EPSILON*Math.max(1,Math.abs(ee),Math.abs(nt))&&Math.abs(v-lt)<=ie.EPSILON*Math.max(1,Math.abs(v),Math.abs(lt))&&Math.abs(_-gt)<=ie.EPSILON*Math.max(1,Math.abs(_),Math.abs(gt))&&Math.abs(O-wt)<=ie.EPSILON*Math.max(1,Math.abs(O),Math.abs(wt))&&Math.abs(G-St)<=ie.EPSILON*Math.max(1,Math.abs(G),Math.abs(St))},B.sqrLen=B.squaredLength=B.len=B.length=B.dot=B.mul=B.setReal=B.getReal=void 0;var ie=$(Y("./common.js")),ue=$(Y("./quat.js")),Z=$(Y("./mat4.js"));function Q(){if("function"!=typeof WeakMap)return null;var N=new WeakMap;return Q=function(){return N},N}function $(N){if(N&&N.__esModule)return N;if(null===N||"object"!==me(N)&&"function"!=typeof N)return{default:N};var F=Q();if(F&&F.has(N))return F.get(N);var te={},Se=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in N)if(Object.prototype.hasOwnProperty.call(N,j)){var ee=Se?Object.getOwnPropertyDescriptor(N,j):null;ee&&(ee.get||ee.set)?Object.defineProperty(te,j,ee):te[j]=N[j]}return te.default=N,F&&F.set(N,te),te}function Te(N,F,te){var Se=.5*te[0],j=.5*te[1],ee=.5*te[2],v=F[0],_=F[1],O=F[2],G=F[3];return N[0]=v,N[1]=_,N[2]=O,N[3]=G,N[4]=Se*G+j*O-ee*_,N[5]=j*G+ee*v-Se*O,N[6]=ee*G+Se*_-j*v,N[7]=-Se*v-j*_-ee*O,N}function ft(N,F){return N[0]=F[0],N[1]=F[1],N[2]=F[2],N[3]=F[3],N[4]=F[4],N[5]=F[5],N[6]=F[6],N[7]=F[7],N}function he(N,F,te){var Se=F[0],j=F[1],ee=F[2],v=F[3],_=te[4],O=te[5],G=te[6],fe=te[7],be=F[4],He=F[5],nt=F[6],lt=F[7],gt=te[0],wt=te[1],St=te[2],Vt=te[3];return N[0]=Se*Vt+v*gt+j*St-ee*wt,N[1]=j*Vt+v*wt+ee*gt-Se*St,N[2]=ee*Vt+v*St+Se*wt-j*gt,N[3]=v*Vt-Se*gt-j*wt-ee*St,N[4]=Se*fe+v*_+j*G-ee*O+be*Vt+lt*gt+He*St-nt*wt,N[5]=j*fe+v*O+ee*_-Se*G+He*Vt+lt*wt+nt*gt-be*St,N[6]=ee*fe+v*G+Se*O-j*_+nt*Vt+lt*St+be*wt-He*gt,N[7]=v*fe-Se*_-j*O-ee*G+lt*Vt-be*gt-He*wt-nt*St,N}B.getReal=ue.copy,B.setReal=ue.copy,B.mul=he;var Pt=ue.dot;B.dot=Pt;var Me=ue.length;B.length=Me,B.len=Me;var Jt=ue.squaredLength;B.squaredLength=Jt,B.sqrLen=Jt},{"./common.js":2,"./mat4.js":7,"./quat.js":8}],10:[function(Y,et,B){"use strict";function me(j){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v})(j)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=Q,B.clone=function $(j){var ee=new ie.ARRAY_TYPE(2);return ee[0]=j[0],ee[1]=j[1],ee},B.fromValues=function de(j,ee){var v=new ie.ARRAY_TYPE(2);return v[0]=j,v[1]=ee,v},B.copy=function Pe(j,ee){return j[0]=ee[0],j[1]=ee[1],j},B.set=function ve(j,ee,v){return j[0]=ee,j[1]=v,j},B.add=function ne(j,ee,v){return j[0]=ee[0]+v[0],j[1]=ee[1]+v[1],j},B.subtract=Te,B.multiply=De,B.divide=Ke,B.ceil=function Be(j,ee){return j[0]=Math.ceil(ee[0]),j[1]=Math.ceil(ee[1]),j},B.floor=function ft(j,ee){return j[0]=Math.floor(ee[0]),j[1]=Math.floor(ee[1]),j},B.min=function Ae(j,ee,v){return j[0]=Math.min(ee[0],v[0]),j[1]=Math.min(ee[1],v[1]),j},B.max=function se(j,ee,v){return j[0]=Math.max(ee[0],v[0]),j[1]=Math.max(ee[1],v[1]),j},B.round=function Ue(j,ee){return j[0]=Math.round(ee[0]),j[1]=Math.round(ee[1]),j},B.scale=function Oe(j,ee,v){return j[0]=ee[0]*v,j[1]=ee[1]*v,j},B.scaleAndAdd=function Ee(j,ee,v,_){return j[0]=ee[0]+v[0]*_,j[1]=ee[1]+v[1]*_,j},B.distance=Ve,B.squaredDistance=oe,B.length=Ye,B.squaredLength=ze,B.negate=function We(j,ee){return j[0]=-ee[0],j[1]=-ee[1],j},B.inverse=function mt(j,ee){return j[0]=1/ee[0],j[1]=1/ee[1],j},B.normalize=function Tt(j,ee){var v=ee[0],_=ee[1],O=v*v+_*_;return O>0&&(O=1/Math.sqrt(O)),j[0]=ee[0]*O,j[1]=ee[1]*O,j},B.dot=function $e(j,ee){return j[0]*ee[0]+j[1]*ee[1]},B.cross=function Et(j,ee,v){var _=ee[0]*v[1]-ee[1]*v[0];return j[0]=j[1]=0,j[2]=_,j},B.lerp=function we(j,ee,v,_){var O=ee[0],G=ee[1];return j[0]=O+_*(v[0]-O),j[1]=G+_*(v[1]-G),j},B.random=function he(j,ee){ee=ee||1;var v=2*ie.RANDOM()*Math.PI;return j[0]=Math.cos(v)*ee,j[1]=Math.sin(v)*ee,j},B.transformMat2=function ae(j,ee,v){var _=ee[0],O=ee[1];return j[0]=v[0]*_+v[2]*O,j[1]=v[1]*_+v[3]*O,j},B.transformMat2d=function vt(j,ee,v){var _=ee[0],O=ee[1];return j[0]=v[0]*_+v[2]*O+v[4],j[1]=v[1]*_+v[3]*O+v[5],j},B.transformMat3=function Pt(j,ee,v){var _=ee[0],O=ee[1];return j[0]=v[0]*_+v[3]*O+v[6],j[1]=v[1]*_+v[4]*O+v[7],j},B.transformMat4=function ei(j,ee,v){var _=ee[0],O=ee[1];return j[0]=v[0]*_+v[4]*O+v[12],j[1]=v[1]*_+v[5]*O+v[13],j},B.rotate=function si(j,ee,v,_){var O=ee[0]-v[0],G=ee[1]-v[1],fe=Math.sin(_),be=Math.cos(_);return j[0]=O*be-G*fe+v[0],j[1]=O*fe+G*be+v[1],j},B.angle=function K(j,ee){var v=j[0],_=j[1],O=ee[0],G=ee[1],fe=Math.sqrt(v*v+_*_)*Math.sqrt(O*O+G*G);return Math.acos(Math.min(Math.max(fe&&(v*O+_*G)/fe,-1),1))},B.zero=function Me(j){return j[0]=0,j[1]=0,j},B.str=function _t(j){return"vec2("+j[0]+", "+j[1]+")"},B.exactEquals=function Jt(j,ee){return j[0]===ee[0]&&j[1]===ee[1]},B.equals=function ti(j,ee){var v=j[0],_=j[1],O=ee[0],G=ee[1];return Math.abs(v-O)<=ie.EPSILON*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(_-G)<=ie.EPSILON*Math.max(1,Math.abs(_),Math.abs(G))},B.forEach=B.sqrLen=B.sqrDist=B.dist=B.div=B.mul=B.sub=B.len=void 0;var ie=function Z(j){if(j&&j.__esModule)return j;if(null===j||"object"!==me(j)&&"function"!=typeof j)return{default:j};var ee=ue();if(ee&&ee.has(j))return ee.get(j);var v={},_=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in j)if(Object.prototype.hasOwnProperty.call(j,O)){var G=_?Object.getOwnPropertyDescriptor(j,O):null;G&&(G.get||G.set)?Object.defineProperty(v,O,G):v[O]=j[O]}return v.default=j,ee&&ee.set(j,v),v}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var j=new WeakMap;return ue=function(){return j},j}function Q(){var j=new ie.ARRAY_TYPE(2);return ie.ARRAY_TYPE!=Float32Array&&(j[0]=0,j[1]=0),j}function Te(j,ee,v){return j[0]=ee[0]-v[0],j[1]=ee[1]-v[1],j}function De(j,ee,v){return j[0]=ee[0]*v[0],j[1]=ee[1]*v[1],j}function Ke(j,ee,v){return j[0]=ee[0]/v[0],j[1]=ee[1]/v[1],j}function Ve(j,ee){return Math.hypot(ee[0]-j[0],ee[1]-j[1])}function oe(j,ee){var v=ee[0]-j[0],_=ee[1]-j[1];return v*v+_*_}function Ye(j){return Math.hypot(j[0],j[1])}function ze(j){var ee=j[0],v=j[1];return ee*ee+v*v}B.len=Ye,B.sub=Te,B.mul=De,B.div=Ke,B.dist=Ve,B.sqrDist=oe,B.sqrLen=ze;var j,Se=(j=Q(),function(ee,v,_,O,G,fe){var be,He;for(v||(v=2),_||(_=0),He=O?Math.min(O*v+_,ee.length):ee.length,be=_;be<He;be+=v)j[0]=ee[be],j[1]=ee[be+1],G(j,j,fe),ee[be]=j[0],ee[be+1]=j[1];return ee});B.forEach=Se},{"./common.js":2}],11:[function(Y,et,B){"use strict";function me(_){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(G){return typeof G}:function(G){return G&&"function"==typeof Symbol&&G.constructor===Symbol&&G!==Symbol.prototype?"symbol":typeof G})(_)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=Q,B.clone=function $(_){var O=new ie.ARRAY_TYPE(3);return O[0]=_[0],O[1]=_[1],O[2]=_[2],O},B.length=de,B.fromValues=function Pe(_,O,G){var fe=new ie.ARRAY_TYPE(3);return fe[0]=_,fe[1]=O,fe[2]=G,fe},B.copy=function ve(_,O){return _[0]=O[0],_[1]=O[1],_[2]=O[2],_},B.set=function ne(_,O,G,fe){return _[0]=O,_[1]=G,_[2]=fe,_},B.add=function Te(_,O,G){return _[0]=O[0]+G[0],_[1]=O[1]+G[1],_[2]=O[2]+G[2],_},B.subtract=De,B.multiply=Ke,B.divide=Be,B.ceil=function ft(_,O){return _[0]=Math.ceil(O[0]),_[1]=Math.ceil(O[1]),_[2]=Math.ceil(O[2]),_},B.floor=function Ae(_,O){return _[0]=Math.floor(O[0]),_[1]=Math.floor(O[1]),_[2]=Math.floor(O[2]),_},B.min=function se(_,O,G){return _[0]=Math.min(O[0],G[0]),_[1]=Math.min(O[1],G[1]),_[2]=Math.min(O[2],G[2]),_},B.max=function Ue(_,O,G){return _[0]=Math.max(O[0],G[0]),_[1]=Math.max(O[1],G[1]),_[2]=Math.max(O[2],G[2]),_},B.round=function Oe(_,O){return _[0]=Math.round(O[0]),_[1]=Math.round(O[1]),_[2]=Math.round(O[2]),_},B.scale=function Ee(_,O,G){return _[0]=O[0]*G,_[1]=O[1]*G,_[2]=O[2]*G,_},B.scaleAndAdd=function Ve(_,O,G,fe){return _[0]=O[0]+G[0]*fe,_[1]=O[1]+G[1]*fe,_[2]=O[2]+G[2]*fe,_},B.distance=oe,B.squaredDistance=Ye,B.squaredLength=ze,B.negate=function We(_,O){return _[0]=-O[0],_[1]=-O[1],_[2]=-O[2],_},B.inverse=function mt(_,O){return _[0]=1/O[0],_[1]=1/O[1],_[2]=1/O[2],_},B.normalize=function Tt(_,O){var G=O[0],fe=O[1],be=O[2],He=G*G+fe*fe+be*be;return He>0&&(He=1/Math.sqrt(He)),_[0]=O[0]*He,_[1]=O[1]*He,_[2]=O[2]*He,_},B.dot=$e,B.cross=function Et(_,O,G){var fe=O[0],be=O[1],He=O[2],nt=G[0],lt=G[1],gt=G[2];return _[0]=be*gt-He*lt,_[1]=He*nt-fe*gt,_[2]=fe*lt-be*nt,_},B.lerp=function we(_,O,G,fe){var be=O[0],He=O[1],nt=O[2];return _[0]=be+fe*(G[0]-be),_[1]=He+fe*(G[1]-He),_[2]=nt+fe*(G[2]-nt),_},B.hermite=function he(_,O,G,fe,be,He){var nt=He*He,lt=nt*(2*He-3)+1,gt=nt*(He-2)+He,wt=nt*(He-1),St=nt*(3-2*He);return _[0]=O[0]*lt+G[0]*gt+fe[0]*wt+be[0]*St,_[1]=O[1]*lt+G[1]*gt+fe[1]*wt+be[1]*St,_[2]=O[2]*lt+G[2]*gt+fe[2]*wt+be[2]*St,_},B.bezier=function ae(_,O,G,fe,be,He){var nt=1-He,lt=nt*nt,gt=He*He,wt=lt*nt,St=3*He*lt,Vt=3*gt*nt,Ut=gt*He;return _[0]=O[0]*wt+G[0]*St+fe[0]*Vt+be[0]*Ut,_[1]=O[1]*wt+G[1]*St+fe[1]*Vt+be[1]*Ut,_[2]=O[2]*wt+G[2]*St+fe[2]*Vt+be[2]*Ut,_},B.random=function vt(_,O){O=O||1;var G=2*ie.RANDOM()*Math.PI,fe=2*ie.RANDOM()-1,be=Math.sqrt(1-fe*fe)*O;return _[0]=Math.cos(G)*be,_[1]=Math.sin(G)*be,_[2]=fe*O,_},B.transformMat4=function Pt(_,O,G){var fe=O[0],be=O[1],He=O[2],nt=G[3]*fe+G[7]*be+G[11]*He+G[15];return _[0]=(G[0]*fe+G[4]*be+G[8]*He+G[12])/(nt=nt||1),_[1]=(G[1]*fe+G[5]*be+G[9]*He+G[13])/nt,_[2]=(G[2]*fe+G[6]*be+G[10]*He+G[14])/nt,_},B.transformMat3=function ei(_,O,G){var fe=O[0],be=O[1],He=O[2];return _[0]=fe*G[0]+be*G[3]+He*G[6],_[1]=fe*G[1]+be*G[4]+He*G[7],_[2]=fe*G[2]+be*G[5]+He*G[8],_},B.transformQuat=function si(_,O,G){var fe=G[0],be=G[1],He=G[2],lt=O[0],gt=O[1],wt=O[2],St=be*wt-He*gt,Vt=He*lt-fe*wt,Ut=fe*gt-be*lt,mi=be*Ut-He*Vt,ui=He*St-fe*Ut,kt=fe*Vt-be*St,Oi=2*G[3];return Vt*=Oi,Ut*=Oi,ui*=2,kt*=2,_[0]=lt+(St*=Oi)+(mi*=2),_[1]=gt+Vt+ui,_[2]=wt+Ut+kt,_},B.rotateX=function K(_,O,G,fe){var be=[],He=[];return be[0]=O[0]-G[0],be[1]=O[1]-G[1],be[2]=O[2]-G[2],He[0]=be[0],He[1]=be[1]*Math.cos(fe)-be[2]*Math.sin(fe),He[2]=be[1]*Math.sin(fe)+be[2]*Math.cos(fe),_[0]=He[0]+G[0],_[1]=He[1]+G[1],_[2]=He[2]+G[2],_},B.rotateY=function Me(_,O,G,fe){var be=[],He=[];return be[0]=O[0]-G[0],be[1]=O[1]-G[1],be[2]=O[2]-G[2],He[0]=be[2]*Math.sin(fe)+be[0]*Math.cos(fe),He[1]=be[1],He[2]=be[2]*Math.cos(fe)-be[0]*Math.sin(fe),_[0]=He[0]+G[0],_[1]=He[1]+G[1],_[2]=He[2]+G[2],_},B.rotateZ=function _t(_,O,G,fe){var be=[],He=[];return be[0]=O[0]-G[0],be[1]=O[1]-G[1],be[2]=O[2]-G[2],He[0]=be[0]*Math.cos(fe)-be[1]*Math.sin(fe),He[1]=be[0]*Math.sin(fe)+be[1]*Math.cos(fe),He[2]=be[2],_[0]=He[0]+G[0],_[1]=He[1]+G[1],_[2]=He[2]+G[2],_},B.angle=function Jt(_,O){var G=_[0],fe=_[1],be=_[2],He=O[0],nt=O[1],lt=O[2],St=Math.sqrt(G*G+fe*fe+be*be)*Math.sqrt(He*He+nt*nt+lt*lt),Vt=St&&$e(_,O)/St;return Math.acos(Math.min(Math.max(Vt,-1),1))},B.zero=function ti(_){return _[0]=0,_[1]=0,_[2]=0,_},B.str=function Ai(_){return"vec3("+_[0]+", "+_[1]+", "+_[2]+")"},B.exactEquals=function vi(_,O){return _[0]===O[0]&&_[1]===O[1]&&_[2]===O[2]},B.equals=function Ci(_,O){var G=_[0],fe=_[1],be=_[2],He=O[0],nt=O[1],lt=O[2];return Math.abs(G-He)<=ie.EPSILON*Math.max(1,Math.abs(G),Math.abs(He))&&Math.abs(fe-nt)<=ie.EPSILON*Math.max(1,Math.abs(fe),Math.abs(nt))&&Math.abs(be-lt)<=ie.EPSILON*Math.max(1,Math.abs(be),Math.abs(lt))},B.forEach=B.sqrLen=B.len=B.sqrDist=B.dist=B.div=B.mul=B.sub=void 0;var ie=function Z(_){if(_&&_.__esModule)return _;if(null===_||"object"!==me(_)&&"function"!=typeof _)return{default:_};var O=ue();if(O&&O.has(_))return O.get(_);var G={},fe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var be in _)if(Object.prototype.hasOwnProperty.call(_,be)){var He=fe?Object.getOwnPropertyDescriptor(_,be):null;He&&(He.get||He.set)?Object.defineProperty(G,be,He):G[be]=_[be]}return G.default=_,O&&O.set(_,G),G}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var _=new WeakMap;return ue=function(){return _},_}function Q(){var _=new ie.ARRAY_TYPE(3);return ie.ARRAY_TYPE!=Float32Array&&(_[0]=0,_[1]=0,_[2]=0),_}function de(_){return Math.hypot(_[0],_[1],_[2])}function De(_,O,G){return _[0]=O[0]-G[0],_[1]=O[1]-G[1],_[2]=O[2]-G[2],_}function Ke(_,O,G){return _[0]=O[0]*G[0],_[1]=O[1]*G[1],_[2]=O[2]*G[2],_}function Be(_,O,G){return _[0]=O[0]/G[0],_[1]=O[1]/G[1],_[2]=O[2]/G[2],_}function oe(_,O){return Math.hypot(O[0]-_[0],O[1]-_[1],O[2]-_[2])}function Ye(_,O){var G=O[0]-_[0],fe=O[1]-_[1],be=O[2]-_[2];return G*G+fe*fe+be*be}function ze(_){var O=_[0],G=_[1],fe=_[2];return O*O+G*G+fe*fe}function $e(_,O){return _[0]*O[0]+_[1]*O[1]+_[2]*O[2]}B.sub=De,B.mul=Ke,B.div=Be,B.dist=oe,B.sqrDist=Ye,B.len=de,B.sqrLen=ze;var _,v=(_=Q(),function(O,G,fe,be,He,nt){var lt,gt;for(G||(G=3),fe||(fe=0),gt=be?Math.min(be*G+fe,O.length):O.length,lt=fe;lt<gt;lt+=G)_[0]=O[lt],_[1]=O[lt+1],_[2]=O[lt+2],He(_,_,nt),O[lt]=_[0],O[lt+1]=_[1],O[lt+2]=_[2];return O});B.forEach=v},{"./common.js":2}],12:[function(Y,et,B){"use strict";function me(N){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(te){return typeof te}:function(te){return te&&"function"==typeof Symbol&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te})(N)}Object.defineProperty(B,"__esModule",{value:!0}),B.create=Q,B.clone=function $(N){var F=new ie.ARRAY_TYPE(4);return F[0]=N[0],F[1]=N[1],F[2]=N[2],F[3]=N[3],F},B.fromValues=function de(N,F,te,Se){var j=new ie.ARRAY_TYPE(4);return j[0]=N,j[1]=F,j[2]=te,j[3]=Se,j},B.copy=function Pe(N,F){return N[0]=F[0],N[1]=F[1],N[2]=F[2],N[3]=F[3],N},B.set=function ve(N,F,te,Se,j){return N[0]=F,N[1]=te,N[2]=Se,N[3]=j,N},B.add=function ne(N,F,te){return N[0]=F[0]+te[0],N[1]=F[1]+te[1],N[2]=F[2]+te[2],N[3]=F[3]+te[3],N},B.subtract=Te,B.multiply=De,B.divide=Ke,B.ceil=function Be(N,F){return N[0]=Math.ceil(F[0]),N[1]=Math.ceil(F[1]),N[2]=Math.ceil(F[2]),N[3]=Math.ceil(F[3]),N},B.floor=function ft(N,F){return N[0]=Math.floor(F[0]),N[1]=Math.floor(F[1]),N[2]=Math.floor(F[2]),N[3]=Math.floor(F[3]),N},B.min=function Ae(N,F,te){return N[0]=Math.min(F[0],te[0]),N[1]=Math.min(F[1],te[1]),N[2]=Math.min(F[2],te[2]),N[3]=Math.min(F[3],te[3]),N},B.max=function se(N,F,te){return N[0]=Math.max(F[0],te[0]),N[1]=Math.max(F[1],te[1]),N[2]=Math.max(F[2],te[2]),N[3]=Math.max(F[3],te[3]),N},B.round=function Ue(N,F){return N[0]=Math.round(F[0]),N[1]=Math.round(F[1]),N[2]=Math.round(F[2]),N[3]=Math.round(F[3]),N},B.scale=function Oe(N,F,te){return N[0]=F[0]*te,N[1]=F[1]*te,N[2]=F[2]*te,N[3]=F[3]*te,N},B.scaleAndAdd=function Ee(N,F,te,Se){return N[0]=F[0]+te[0]*Se,N[1]=F[1]+te[1]*Se,N[2]=F[2]+te[2]*Se,N[3]=F[3]+te[3]*Se,N},B.distance=Ve,B.squaredDistance=oe,B.length=Ye,B.squaredLength=ze,B.negate=function We(N,F){return N[0]=-F[0],N[1]=-F[1],N[2]=-F[2],N[3]=-F[3],N},B.inverse=function mt(N,F){return N[0]=1/F[0],N[1]=1/F[1],N[2]=1/F[2],N[3]=1/F[3],N},B.normalize=function Tt(N,F){var te=F[0],Se=F[1],j=F[2],ee=F[3],v=te*te+Se*Se+j*j+ee*ee;return v>0&&(v=1/Math.sqrt(v)),N[0]=te*v,N[1]=Se*v,N[2]=j*v,N[3]=ee*v,N},B.dot=function $e(N,F){return N[0]*F[0]+N[1]*F[1]+N[2]*F[2]+N[3]*F[3]},B.cross=function Et(N,F,te,Se){var j=te[0]*Se[1]-te[1]*Se[0],ee=te[0]*Se[2]-te[2]*Se[0],v=te[0]*Se[3]-te[3]*Se[0],_=te[1]*Se[2]-te[2]*Se[1],O=te[1]*Se[3]-te[3]*Se[1],G=te[2]*Se[3]-te[3]*Se[2],fe=F[0],be=F[1],He=F[2],nt=F[3];return N[0]=be*G-He*O+nt*_,N[1]=-fe*G+He*v-nt*ee,N[2]=fe*O-be*v+nt*j,N[3]=-fe*_+be*ee-He*j,N},B.lerp=function we(N,F,te,Se){var j=F[0],ee=F[1],v=F[2],_=F[3];return N[0]=j+Se*(te[0]-j),N[1]=ee+Se*(te[1]-ee),N[2]=v+Se*(te[2]-v),N[3]=_+Se*(te[3]-_),N},B.random=function he(N,F){var te,Se,j,ee,v,_;F=F||1;do{v=(te=2*ie.RANDOM()-1)*te+(Se=2*ie.RANDOM()-1)*Se}while(v>=1);do{_=(j=2*ie.RANDOM()-1)*j+(ee=2*ie.RANDOM()-1)*ee}while(_>=1);var O=Math.sqrt((1-v)/_);return N[0]=F*te,N[1]=F*Se,N[2]=F*j*O,N[3]=F*ee*O,N},B.transformMat4=function ae(N,F,te){var Se=F[0],j=F[1],ee=F[2],v=F[3];return N[0]=te[0]*Se+te[4]*j+te[8]*ee+te[12]*v,N[1]=te[1]*Se+te[5]*j+te[9]*ee+te[13]*v,N[2]=te[2]*Se+te[6]*j+te[10]*ee+te[14]*v,N[3]=te[3]*Se+te[7]*j+te[11]*ee+te[15]*v,N},B.transformQuat=function vt(N,F,te){var Se=F[0],j=F[1],ee=F[2],v=te[0],_=te[1],O=te[2],G=te[3],fe=G*Se+_*ee-O*j,be=G*j+O*Se-v*ee,He=G*ee+v*j-_*Se,nt=-v*Se-_*j-O*ee;return N[0]=fe*G+nt*-v+be*-O-He*-_,N[1]=be*G+nt*-_+He*-v-fe*-O,N[2]=He*G+nt*-O+fe*-_-be*-v,N[3]=F[3],N},B.zero=function Pt(N){return N[0]=0,N[1]=0,N[2]=0,N[3]=0,N},B.str=function ei(N){return"vec4("+N[0]+", "+N[1]+", "+N[2]+", "+N[3]+")"},B.exactEquals=function si(N,F){return N[0]===F[0]&&N[1]===F[1]&&N[2]===F[2]&&N[3]===F[3]},B.equals=function K(N,F){var te=N[0],Se=N[1],j=N[2],ee=N[3],v=F[0],_=F[1],O=F[2],G=F[3];return Math.abs(te-v)<=ie.EPSILON*Math.max(1,Math.abs(te),Math.abs(v))&&Math.abs(Se-_)<=ie.EPSILON*Math.max(1,Math.abs(Se),Math.abs(_))&&Math.abs(j-O)<=ie.EPSILON*Math.max(1,Math.abs(j),Math.abs(O))&&Math.abs(ee-G)<=ie.EPSILON*Math.max(1,Math.abs(ee),Math.abs(G))},B.forEach=B.sqrLen=B.len=B.sqrDist=B.dist=B.div=B.mul=B.sub=void 0;var ie=function Z(N){if(N&&N.__esModule)return N;if(null===N||"object"!==me(N)&&"function"!=typeof N)return{default:N};var F=ue();if(F&&F.has(N))return F.get(N);var te={},Se=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in N)if(Object.prototype.hasOwnProperty.call(N,j)){var ee=Se?Object.getOwnPropertyDescriptor(N,j):null;ee&&(ee.get||ee.set)?Object.defineProperty(te,j,ee):te[j]=N[j]}return te.default=N,F&&F.set(N,te),te}(Y("./common.js"));function ue(){if("function"!=typeof WeakMap)return null;var N=new WeakMap;return ue=function(){return N},N}function Q(){var N=new ie.ARRAY_TYPE(4);return ie.ARRAY_TYPE!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0,N[3]=0),N}function Te(N,F,te){return N[0]=F[0]-te[0],N[1]=F[1]-te[1],N[2]=F[2]-te[2],N[3]=F[3]-te[3],N}function De(N,F,te){return N[0]=F[0]*te[0],N[1]=F[1]*te[1],N[2]=F[2]*te[2],N[3]=F[3]*te[3],N}function Ke(N,F,te){return N[0]=F[0]/te[0],N[1]=F[1]/te[1],N[2]=F[2]/te[2],N[3]=F[3]/te[3],N}function Ve(N,F){return Math.hypot(F[0]-N[0],F[1]-N[1],F[2]-N[2],F[3]-N[3])}function oe(N,F){var te=F[0]-N[0],Se=F[1]-N[1],j=F[2]-N[2],ee=F[3]-N[3];return te*te+Se*Se+j*j+ee*ee}function Ye(N){return Math.hypot(N[0],N[1],N[2],N[3])}function ze(N){var F=N[0],te=N[1],Se=N[2],j=N[3];return F*F+te*te+Se*Se+j*j}B.sub=Te,B.mul=De,B.div=Ke,B.dist=Ve,B.sqrDist=oe,B.len=Ye,B.sqrLen=ze;var N,zi=(N=Q(),function(F,te,Se,j,ee,v){var _,O;for(te||(te=4),Se||(Se=0),O=j?Math.min(j*te+Se,F.length):F.length,_=Se;_<O;_+=te)N[0]=F[_],N[1]=F[_+1],N[2]=F[_+2],N[3]=F[_+3],ee(N,N,v),F[_]=N[0],F[_+1]=N[1],F[_+2]=N[2],F[_+3]=N[3];return F});B.forEach=zi},{"./common.js":2}],13:[function(Y,et,B){!function(me,ie,ue,Z){"use strict";var Q=["","webkit","moz","MS","ms","o"],$=ie.createElement("div"),Pe=Math.round,ve=Math.abs,ne=Date.now;function Te(ye,Le,at){return setTimeout(se(ye,at),Le)}function De(ye,Le,at){return!!Array.isArray(ye)&&(Ke(ye,at[Le],at),!0)}function Ke(ye,Le,at){var Ht;if(ye)if(ye.forEach)ye.forEach(Le,at);else if(ye.length!==Z)for(Ht=0;Ht<ye.length;)Le.call(at,ye[Ht],Ht,ye),Ht++;else for(Ht in ye)ye.hasOwnProperty(Ht)&&Le.call(at,ye[Ht],Ht,ye)}function Be(ye,Le,at){for(var Ht=Object.keys(Le),bi=0;bi<Ht.length;)(!at||at&&ye[Ht[bi]]===Z)&&(ye[Ht[bi]]=Le[Ht[bi]]),bi++;return ye}function ft(ye,Le){return Be(ye,Le,!0)}function Ae(ye,Le,at){var bi,Ht=Le.prototype;(bi=ye.prototype=Object.create(Ht)).constructor=ye,bi._super=Ht,at&&Be(bi,at)}function se(ye,Le){return function(){return ye.apply(Le,arguments)}}function Ue(ye,Le){return"function"==typeof ye?ye.apply(Le&&Le[0]||Z,Le):ye}function Oe(ye,Le){return ye===Z?Le:ye}function Ee(ye,Le,at){Ke(ze(Le),function(Ht){ye.addEventListener(Ht,at,!1)})}function Ve(ye,Le,at){Ke(ze(Le),function(Ht){ye.removeEventListener(Ht,at,!1)})}function oe(ye,Le){for(;ye;){if(ye==Le)return!0;ye=ye.parentNode}return!1}function Ye(ye,Le){return ye.indexOf(Le)>-1}function ze(ye){return ye.trim().split(/\s+/g)}function We(ye,Le,at){if(ye.indexOf&&!at)return ye.indexOf(Le);for(var Ht=0;Ht<ye.length;){if(at&&ye[Ht][at]==Le||!at&&ye[Ht]===Le)return Ht;Ht++}return-1}function mt(ye){return Array.prototype.slice.call(ye,0)}function Tt(ye,Le,at){for(var Ht=[],bi=[],sn=0;sn<ye.length;){var wi=Le?ye[sn][Le]:ye[sn];We(bi,wi)<0&&Ht.push(ye[sn]),bi[sn]=wi,sn++}return at&&(Ht=Le?Ht.sort(function(Dr,qi){return Dr[Le]>qi[Le]}):Ht.sort()),Ht}function $e(ye,Le){for(var at,Ht,bi=Le[0].toUpperCase()+Le.slice(1),sn=0;sn<Q.length;){if((Ht=(at=Q[sn])?at+bi:Le)in ye)return Ht;sn++}return Z}var Et=1;function he(ye){var Le=ye.ownerDocument;return Le.defaultView||Le.parentWindow}var vt="ontouchstart"in me,Pt=$e(me,"PointerEvent")!==Z,ei=vt&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),si="touch",Me="mouse",_=["x","y"],O=["clientX","clientY"];function G(ye,Le){var at=this;this.manager=ye,this.callback=Le,this.element=ye.element,this.target=ye.options.inputTarget,this.domHandler=function(Ht){Ue(ye.options.enable,[ye])&&at.handler(Ht)},this.init()}function be(ye,Le,at){var Ht=at.pointers.length,bi=at.changedPointers.length,sn=1&Le&&Ht-bi==0,wi=12&Le&&Ht-bi==0;at.isFirst=!!sn,at.isFinal=!!wi,sn&&(ye.session={}),at.eventType=Le,function He(ye,Le){var at=ye.session,Ht=Le.pointers,bi=Ht.length;at.firstInput||(at.firstInput=gt(Le)),bi>1&&!at.firstMultiple?at.firstMultiple=gt(Le):1===bi&&(at.firstMultiple=!1);var sn=at.firstInput,wi=at.firstMultiple,Qt=wi?wi.center:sn.center,Dr=Le.center=wt(Ht);Le.timeStamp=ne(),Le.deltaTime=Le.timeStamp-sn.timeStamp,Le.angle=mi(Qt,Dr),Le.distance=Ut(Qt,Dr),function nt(ye,Le){var at=Le.center,Ht=ye.offsetDelta||{},bi=ye.prevDelta||{},sn=ye.prevInput||{};(1===Le.eventType||4===sn.eventType)&&(bi=ye.prevDelta={x:sn.deltaX||0,y:sn.deltaY||0},Ht=ye.offsetDelta={x:at.x,y:at.y}),Le.deltaX=bi.x+(at.x-Ht.x),Le.deltaY=bi.y+(at.y-Ht.y)}(at,Le),Le.offsetDirection=Vt(Le.deltaX,Le.deltaY),Le.scale=wi?function kt(ye,Le){return Ut(Le[0],Le[1],O)/Ut(ye[0],ye[1],O)}(wi.pointers,Ht):1,Le.rotation=wi?function ui(ye,Le){return mi(Le[1],Le[0],O)-mi(ye[1],ye[0],O)}(wi.pointers,Ht):0,function lt(ye,Le){var bi,sn,wi,Qt,at=ye.lastInterval||Le,Ht=Le.timeStamp-at.timeStamp;if(8!=Le.eventType&&(Ht>25||at.velocity===Z)){var Dr=at.deltaX-Le.deltaX,qi=at.deltaY-Le.deltaY,Zs=function St(ye,Le,at){return{x:Le/ye||0,y:at/ye||0}}(Ht,Dr,qi);sn=Zs.x,wi=Zs.y,bi=ve(Zs.x)>ve(Zs.y)?Zs.x:Zs.y,Qt=Vt(Dr,qi),ye.lastInterval=Le}else bi=at.velocity,sn=at.velocityX,wi=at.velocityY,Qt=at.direction;Le.velocity=bi,Le.velocityX=sn,Le.velocityY=wi,Le.direction=Qt}(at,Le);var qi=ye.element;oe(Le.srcEvent.target,qi)&&(qi=Le.srcEvent.target),Le.target=qi}(ye,at),ye.emit("hammer.input",at),ye.recognize(at),ye.session.prevInput=at}function gt(ye){for(var Le=[],at=0;at<ye.pointers.length;)Le[at]={clientX:Pe(ye.pointers[at].clientX),clientY:Pe(ye.pointers[at].clientY)},at++;return{timeStamp:ne(),pointers:Le,center:wt(Le),deltaX:ye.deltaX,deltaY:ye.deltaY}}function wt(ye){var Le=ye.length;if(1===Le)return{x:Pe(ye[0].clientX),y:Pe(ye[0].clientY)};for(var at=0,Ht=0,bi=0;bi<Le;)at+=ye[bi].clientX,Ht+=ye[bi].clientY,bi++;return{x:Pe(at/Le),y:Pe(Ht/Le)}}function Vt(ye,Le){return ye===Le?1:ve(ye)>=ve(Le)?ye>0?2:4:Le>0?8:16}function Ut(ye,Le,at){at||(at=_);var Ht=Le[at[0]]-ye[at[0]],bi=Le[at[1]]-ye[at[1]];return Math.sqrt(Ht*Ht+bi*bi)}function mi(ye,Le,at){return at||(at=_),180*Math.atan2(Le[at[1]]-ye[at[1]],Le[at[0]]-ye[at[0]])/Math.PI}G.prototype={handler:function(){},init:function(){this.evEl&&Ee(this.element,this.evEl,this.domHandler),this.evTarget&&Ee(this.target,this.evTarget,this.domHandler),this.evWin&&Ee(he(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ve(this.element,this.evEl,this.domHandler),this.evTarget&&Ve(this.target,this.evTarget,this.domHandler),this.evWin&&Ve(he(this.element),this.evWin,this.domHandler)}};var Oi={mousedown:1,mousemove:2,mouseup:4},rn="mousedown",an="mousemove mouseup";function Zi(){this.evEl=rn,this.evWin=an,this.allow=!0,this.pressed=!1,G.apply(this,arguments)}Ae(Zi,G,{handler:function(Le){var at=Oi[Le.type];1&at&&0===Le.button&&(this.pressed=!0),2&at&&1!==Le.which&&(at=4),this.pressed&&this.allow&&(4&at&&(this.pressed=!1),this.callback(this.manager,at,{pointers:[Le],changedPointers:[Le],pointerType:Me,srcEvent:Le}))}});var Fi={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Xi={2:si,3:"pen",4:Me,5:"kinect"},Dn="pointerdown",On="pointermove pointerup pointercancel";function Un(){this.evEl=Dn,this.evWin=On,G.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}me.MSPointerEvent&&(Dn="MSPointerDown",On="MSPointerMove MSPointerUp MSPointerCancel"),Ae(Un,G,{handler:function(Le){var at=this.store,Ht=!1,bi=Le.type.toLowerCase().replace("ms",""),sn=Fi[bi],wi=Xi[Le.pointerType]||Le.pointerType,Qt=wi==si,Dr=We(at,Le.pointerId,"pointerId");1&sn&&(0===Le.button||Qt)?Dr<0&&(at.push(Le),Dr=at.length-1):12&sn&&(Ht=!0),!(Dr<0)&&(at[Dr]=Le,this.callback(this.manager,sn,{pointers:at,changedPointers:[Le],pointerType:wi,srcEvent:Le}),Ht&&at.splice(Dr,1))}});var Vn={touchstart:1,touchmove:2,touchend:4,touchcancel:8},qn="touchstart",Zn="touchstart touchmove touchend touchcancel";function Gn(){this.evTarget=qn,this.evWin=Zn,this.started=!1,G.apply(this,arguments)}function _n(ye,Le){var at=mt(ye.touches),Ht=mt(ye.changedTouches);return 12&Le&&(at=Tt(at.concat(Ht),"identifier",!0)),[at,Ht]}Ae(Gn,G,{handler:function(Le){var at=Vn[Le.type];if(1===at&&(this.started=!0),this.started){var Ht=_n.call(this,Le,at);12&at&&Ht[0].length-Ht[1].length==0&&(this.started=!1),this.callback(this.manager,at,{pointers:Ht[0],changedPointers:Ht[1],pointerType:si,srcEvent:Le})}}});var _r={touchstart:1,touchmove:2,touchend:4,touchcancel:8},Ts="touchstart touchmove touchend touchcancel";function Ma(){this.evTarget=Ts,this.targetIds={},G.apply(this,arguments)}function oa(ye,Le){var at=mt(ye.touches),Ht=this.targetIds;if(3&Le&&1===at.length)return Ht[at[0].identifier]=!0,[at,at];var bi,sn,wi=mt(ye.changedTouches),Qt=[],Dr=this.target;if(sn=at.filter(function(qi){return oe(qi.target,Dr)}),1===Le)for(bi=0;bi<sn.length;)Ht[sn[bi].identifier]=!0,bi++;for(bi=0;bi<wi.length;)Ht[wi[bi].identifier]&&Qt.push(wi[bi]),12&Le&&delete Ht[wi[bi].identifier],bi++;return Qt.length?[Tt(sn.concat(Qt),"identifier",!0),Qt]:void 0}function pa(){G.apply(this,arguments);var ye=se(this.handler,this);this.touch=new Ma(this.manager,ye),this.mouse=new Zi(this.manager,ye)}Ae(Ma,G,{handler:function(Le){var at=_r[Le.type],Ht=oa.call(this,Le,at);!Ht||this.callback(this.manager,at,{pointers:Ht[0],changedPointers:Ht[1],pointerType:si,srcEvent:Le})}}),Ae(pa,G,{handler:function(Le,at,Ht){var sn=Ht.pointerType==Me;if(Ht.pointerType==si)this.mouse.allow=!1;else if(sn&&!this.mouse.allow)return;12&at&&(this.mouse.allow=!0),this.callback(Le,at,Ht)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Mr=$e($.style,"touchAction"),Ca=Mr!==Z,Hr="compute",Xs="manipulation",Pa="none",Ha="pan-x",xr="pan-y";function mr(ye,Le){this.manager=ye,this.set(Le)}function Fn(ye){this.id=function we(){return Et++}(),this.manager=null,this.options=ft(ye||{},this.defaults),this.options.enable=Oe(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Ks(ye){return 16==ye?"down":8==ye?"up":2==ye?"left":4==ye?"right":""}function Kr(ye,Le){var at=Le.manager;return at?at.get(ye):ye}function va(){Fn.apply(this,arguments)}function ws(){va.apply(this,arguments),this.pX=null,this.pY=null}function Ss(){va.apply(this,arguments)}function rl(){Fn.apply(this,arguments),this._timer=null,this._input=null}function al(){va.apply(this,arguments)}function po(){va.apply(this,arguments)}function La(){Fn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function rs(ye,Le){return(Le=Le||{}).recognizers=Oe(Le.recognizers,rs.defaults.preset),new sl(ye,Le)}function sl(ye,Le){this.options=ft(Le=Le||{},rs.defaults),this.options.inputTarget=this.options.inputTarget||ye,this.handlers={},this.session={},this.recognizers=[],this.element=ye,this.input=function fe(ye){return new(ye.options.inputClass||(Pt?Un:ei?Ma:vt?pa:Zi))(ye,be)}(this),this.touchAction=new mr(this,this.options.touchAction),mo(this,!0),Ke(Le.recognizers,function(at){var Ht=this.add(new at[0](at[1]));at[2]&&Ht.recognizeWith(at[2]),at[3]&&Ht.requireFailure(at[3])},this)}function mo(ye,Le){var at=ye.element;Ke(ye.options.cssProps,function(Ht,bi){at.style[$e(at.style,bi)]=Le?Ht:""})}mr.prototype={set:function(ye){ye==Hr&&(ye=this.compute()),Ca&&(this.manager.element.style[Mr]=ye),this.actions=ye.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ye=[];return Ke(this.manager.recognizers,function(Le){Ue(Le.options.enable,[Le])&&(ye=ye.concat(Le.getTouchAction()))}),function qs(ye){if(Ye(ye,Pa))return Pa;var Le=Ye(ye,Ha),at=Ye(ye,xr);return Le&&at?Ha+" "+xr:Le||at?Le?Ha:xr:Ye(ye,Xs)?Xs:"auto"}(ye.join(" "))},preventDefaults:function(ye){if(!Ca){var Le=ye.srcEvent,at=ye.offsetDirection;if(this.manager.session.prevented)return void Le.preventDefault();var Ht=this.actions,bi=Ye(Ht,Pa),sn=Ye(Ht,xr),wi=Ye(Ht,Ha);if(bi||sn&&6&at||wi&&24&at)return this.preventSrc(Le)}},preventSrc:function(ye){this.manager.session.prevented=!0,ye.preventDefault()}},Fn.prototype={defaults:{},set:function(ye){return Be(this.options,ye),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ye){if(De(ye,"recognizeWith",this))return this;var Le=this.simultaneous;return Le[(ye=Kr(ye,this)).id]||(Le[ye.id]=ye,ye.recognizeWith(this)),this},dropRecognizeWith:function(ye){return De(ye,"dropRecognizeWith",this)||(ye=Kr(ye,this),delete this.simultaneous[ye.id]),this},requireFailure:function(ye){if(De(ye,"requireFailure",this))return this;var Le=this.requireFail;return-1===We(Le,ye=Kr(ye,this))&&(Le.push(ye),ye.requireFailure(this)),this},dropRequireFailure:function(ye){if(De(ye,"dropRequireFailure",this))return this;ye=Kr(ye,this);var Le=We(this.requireFail,ye);return Le>-1&&this.requireFail.splice(Le,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ye){return!!this.simultaneous[ye.id]},emit:function(ye){var Le=this,at=this.state;function Ht(bi){Le.manager.emit(Le.options.event+(bi?function Qs(ye){return 16&ye?"cancel":8&ye?"end":4&ye?"move":2&ye?"start":""}(at):""),ye)}at<8&&Ht(!0),Ht(),at>=8&&Ht(!0)},tryEmit:function(ye){if(this.canEmit())return this.emit(ye);this.state=32},canEmit:function(){for(var ye=0;ye<this.requireFail.length;){if(!(33&this.requireFail[ye].state))return!1;ye++}return!0},recognize:function(ye){var Le=Be({},ye);if(!Ue(this.options.enable,[this,Le]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(Le),30&this.state&&this.tryEmit(Le)},process:function(ye){},getTouchAction:function(){},reset:function(){}},Ae(va,Fn,{defaults:{pointers:1},attrTest:function(ye){var Le=this.options.pointers;return 0===Le||ye.pointers.length===Le},process:function(ye){var Le=this.state,at=ye.eventType,Ht=6&Le,bi=this.attrTest(ye);return Ht&&(8&at||!bi)?16|Le:Ht||bi?4&at?8|Le:2&Le?4|Le:2:32}}),Ae(ws,va,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var ye=this.options.direction,Le=[];return 6&ye&&Le.push(xr),24&ye&&Le.push(Ha),Le},directionTest:function(ye){var Le=this.options,at=!0,Ht=ye.distance,bi=ye.direction,sn=ye.deltaX,wi=ye.deltaY;return bi&Le.direction||(6&Le.direction?(bi=0===sn?1:sn<0?2:4,at=sn!=this.pX,Ht=Math.abs(ye.deltaX)):(bi=0===wi?1:wi<0?8:16,at=wi!=this.pY,Ht=Math.abs(ye.deltaY))),ye.direction=bi,at&&Ht>Le.threshold&&bi&Le.direction},attrTest:function(ye){return va.prototype.attrTest.call(this,ye)&&(2&this.state||!(2&this.state)&&this.directionTest(ye))},emit:function(ye){this.pX=ye.deltaX,this.pY=ye.deltaY;var Le=Ks(ye.direction);Le&&this.manager.emit(this.options.event+Le,ye),this._super.emit.call(this,ye)}}),Ae(Ss,va,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pa]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.scale-1)>this.options.threshold||2&this.state)},emit:function(ye){this._super.emit.call(this,ye),1!==ye.scale&&this.manager.emit(this.options.event+(ye.scale<1?"in":"out"),ye)}}),Ae(rl,Fn,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(ye){var Le=this.options,at=ye.pointers.length===Le.pointers,Ht=ye.distance<Le.threshold,bi=ye.deltaTime>Le.time;if(this._input=ye,!Ht||!at||12&ye.eventType&&!bi)this.reset();else if(1&ye.eventType)this.reset(),this._timer=Te(function(){this.state=8,this.tryEmit()},Le.time,this);else if(4&ye.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(ye){8===this.state&&(ye&&4&ye.eventType?this.manager.emit(this.options.event+"up",ye):(this._input.timeStamp=ne(),this.manager.emit(this.options.event,this._input)))}}),Ae(al,va,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pa]},attrTest:function(ye){return this._super.attrTest.call(this,ye)&&(Math.abs(ye.rotation)>this.options.threshold||2&this.state)}}),Ae(po,va,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return ws.prototype.getTouchAction.call(this)},attrTest:function(ye){var at,Le=this.options.direction;return 30&Le?at=ye.velocity:6&Le?at=ye.velocityX:24&Le&&(at=ye.velocityY),this._super.attrTest.call(this,ye)&&Le&ye.direction&&ye.distance>this.options.threshold&&ve(at)>this.options.velocity&&4&ye.eventType},emit:function(ye){var Le=Ks(ye.direction);Le&&this.manager.emit(this.options.event+Le,ye),this.manager.emit(this.options.event,ye)}}),Ae(La,Fn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Xs]},process:function(ye){var Le=this.options,at=ye.pointers.length===Le.pointers,Ht=ye.distance<Le.threshold,bi=ye.deltaTime<Le.time;if(this.reset(),1&ye.eventType&&0===this.count)return this.failTimeout();if(Ht&&bi&&at){if(4!=ye.eventType)return this.failTimeout();var sn=!this.pTime||ye.timeStamp-this.pTime<Le.interval,wi=!this.pCenter||Ut(this.pCenter,ye.center)<Le.posThreshold;if(this.pTime=ye.timeStamp,this.pCenter=ye.center,wi&&sn?this.count+=1:this.count=1,this._input=ye,0==this.count%Le.taps)return this.hasRequireFailures()?(this._timer=Te(function(){this.state=8,this.tryEmit()},Le.interval,this),2):8}return 32},failTimeout:function(){return this._timer=Te(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),rs.VERSION="2.0.4",rs.defaults={domEvents:!1,touchAction:Hr,enable:!0,inputTarget:null,inputClass:null,preset:[[al,{enable:!1}],[Ss,{enable:!1},["rotate"]],[po,{direction:6}],[ws,{direction:6},["swipe"]],[La],[La,{event:"doubletap",taps:2},["tap"]],[rl]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},sl.prototype={set:function(ye){return Be(this.options,ye),ye.touchAction&&this.touchAction.update(),ye.inputTarget&&(this.input.destroy(),this.input.target=ye.inputTarget,this.input.init()),this},stop:function(ye){this.session.stopped=ye?2:1},recognize:function(ye){var Le=this.session;if(!Le.stopped){this.touchAction.preventDefaults(ye);var at,Ht=this.recognizers,bi=Le.curRecognizer;(!bi||bi&&8&bi.state)&&(bi=Le.curRecognizer=null);for(var sn=0;sn<Ht.length;)at=Ht[sn],2===Le.stopped||bi&&at!=bi&&!at.canRecognizeWith(bi)?at.reset():at.recognize(ye),!bi&&14&at.state&&(bi=Le.curRecognizer=at),sn++}},get:function(ye){if(ye instanceof Fn)return ye;for(var Le=this.recognizers,at=0;at<Le.length;at++)if(Le[at].options.event==ye)return Le[at];return null},add:function(ye){if(De(ye,"add",this))return this;var Le=this.get(ye.options.event);return Le&&this.remove(Le),this.recognizers.push(ye),ye.manager=this,this.touchAction.update(),ye},remove:function(ye){if(De(ye,"remove",this))return this;var Le=this.recognizers;return ye=this.get(ye),Le.splice(We(Le,ye),1),this.touchAction.update(),this},on:function(ye,Le){var at=this.handlers;return Ke(ze(ye),function(Ht){at[Ht]=at[Ht]||[],at[Ht].push(Le)}),this},off:function(ye,Le){var at=this.handlers;return Ke(ze(ye),function(Ht){Le?at[Ht].splice(We(at[Ht],Le),1):delete at[Ht]}),this},emit:function(ye,Le){this.options.domEvents&&function rr(ye,Le){var at=ie.createEvent("Event");at.initEvent(ye,!0,!0),at.gesture=Le,Le.target.dispatchEvent(at)}(ye,Le);var at=this.handlers[ye]&&this.handlers[ye].slice();if(at&&at.length){Le.type=ye,Le.preventDefault=function(){Le.srcEvent.preventDefault()};for(var Ht=0;Ht<at.length;)at[Ht](Le),Ht++}},destroy:function(){this.element&&mo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},Be(rs,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:sl,Input:G,TouchAction:mr,TouchInput:Ma,MouseInput:Zi,PointerEventInput:Un,TouchMouseInput:pa,SingleTouchInput:Gn,Recognizer:Fn,AttrRecognizer:va,Tap:La,Pan:ws,Swipe:po,Pinch:Ss,Rotate:al,Press:rl,on:Ee,off:Ve,each:Ke,merge:ft,extend:Be,inherit:Ae,bindFn:se,prefixed:$e}),typeof et<"u"&&et.exports?et.exports=rs:me.Hammer=rs}(window,document)},{}],14:[function(Y,et,B){"use strict";function me(){}me.prototype.addEventListener=function(ue,Z){var Q=this.__events=this.__events||{},$=Q[ue]=Q[ue]||[];$.indexOf(Z)<0&&$.push(Z)},me.prototype.removeEventListener=function(ue,Z){var $=(this.__events=this.__events||{})[ue];if($){var de=$.indexOf(Z);de>=0&&$.splice(de,1)}},me.prototype.emit=function(ue,Z){var Q=this.__events=this.__events||{},$=Q[ue],de=Array.prototype.slice.call(arguments,1);if($)for(var Pe=0;Pe<$.length;Pe++){var ve=$[Pe];ve.apply(this,de)}},et.exports=function ie(ue){for(var Z in me.prototype)me.prototype.hasOwnProperty(Z)&&(ue.prototype[Z]=me.prototype[Z])}},{}],15:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./util/positionAbsolutely"),ue=Y("./util/dom").setTransform,Z=Y("./util/clearOwnProperties");function Q($,de,Pe,ve,ne){(ne=ne||{}).perspective=ne.perspective||{},ne.perspective.extraTransforms=null!=ne.perspective.extraTransforms?ne.perspective.extraTransforms:"",this._domElement=$,this._parentDomElement=de,this._view=Pe,this._coords={},this._perspective={},this.setPosition(ve),this._parentDomElement.appendChild(this._domElement),this.setPerspective(ne.perspective),this._visible=!0,this._position={x:0,y:0}}me(Q),Q.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),Z(this)},Q.prototype.domElement=function(){return this._domElement},Q.prototype.position=function(){return this._coords},Q.prototype.setPosition=function($){for(var de in $)this._coords[de]=$[de];this._update()},Q.prototype.perspective=function(){return this._perspective},Q.prototype.setPerspective=function($){for(var de in $)this._perspective[de]=$[de];this._update()},Q.prototype.show=function(){this._visible||(this._visible=!0,this._update())},Q.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},Q.prototype._update=function(){var ve,ne,$=this._domElement,de=this._coords,Pe=this._position,Te=!1;if(this._visible){var De=this._view;this._perspective.radius?(Te=!0,this._setEmbeddedPosition(De,de)):(De.coordinatesToScreen(de,Pe),ne=Pe.y,null!=(ve=Pe.x)&&null!=ne&&(Te=!0,this._setPosition(ve,ne)))}Te?($.style.display="block",$.style.position="absolute"):($.style.display="none",$.style.position="")},Q.prototype._setEmbeddedPosition=function($,de){var Pe=$.coordinatesToPerspectiveTransform(de,this._perspective.radius,this._perspective.extraTransforms);ue(this._domElement,Pe)},Q.prototype._setPosition=function($,de){ie(this._domElement,$,de,this._perspective.extraTransforms)},et.exports=Q},{"./util/clearOwnProperties":76,"./util/dom":85,"./util/positionAbsolutely":96,"minimal-event-emitter":14}],16:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Hotspot"),ue=Y("./util/calcRect"),Z=Y("./util/positionAbsolutely"),Q=Y("./util/dom").setAbsolute,$=Y("./util/dom").setOverflowHidden,de=Y("./util/dom").setOverflowVisible,Pe=Y("./util/dom").setNullSize,ve=Y("./util/dom").setPixelSize,ne=Y("./util/dom").setWithVendorPrefix("pointer-events"),Te=Y("./util/clearOwnProperties");function De(Ke,Be,ft,Ae,se){se=se||{},this._parentDomElement=Ke,this._stage=Be,this._view=ft,this._renderLoop=Ae,this._hotspots=[],this._visible=!0,this._rect=se.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Q(this._hotspotContainerWrapper),ne(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Q(this._hotspotContainer),ne(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}me(De),De.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),Te(this)},De.prototype.domElement=function(){return this._hotspotContainer},De.prototype.setRect=function(Ke){this._rect=Ke,this._visibilityOrRectChanged=!0},De.prototype.rect=function(){return this._rect},De.prototype.createHotspot=function(Ke,Be,ft){var Ae=new ie(Ke,this._hotspotContainer,this._view,Be=Be||{},ft);return this._hotspots.push(Ae),Ae._update(),this.emit("hotspotsChange"),Ae},De.prototype.hasHotspot=function(Ke){return this._hotspots.indexOf(Ke)>=0},De.prototype.listHotspots=function(){return[].concat(this._hotspots)},De.prototype.destroyHotspot=function(Ke){var Be=this._hotspots.indexOf(Ke);if(Be<0)throw new Error("No such hotspot");this._hotspots.splice(Be,1),Ke.destroy(),this.emit("hotspotsChange")},De.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},De.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},De.prototype._update=function(){var Ke=this._hotspotContainerWrapper,Be=this._stage.width(),ft=this._stage.height(),Ae=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(Be!==this._stageWidth||ft!==this._stageHeight)){var se=this._visible;Ke.style.display=se?"block":"none",se&&(this._rect?(ue(Be,ft,this._rect,Ae),Z(Ke,Be*Ae.x,ft*Ae.y),ve(Ke,Be*Ae.width,ft*Ae.height),$(Ke)):(Z(Ke,0,0),Pe(Ke),de(Ke))),this._stageWidth=Be,this._stageHeight=ft,this._visibilityOrRectChanged=!1}for(var Ue=0;Ue<this._hotspots.length;Ue++)this._hotspots[Ue]._update()},et.exports=De},{"./Hotspot":15,"./util/calcRect":72,"./util/clearOwnProperties":76,"./util/dom":85,"./util/positionAbsolutely":96,"minimal-event-emitter":14}],17:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./util/extend"),ue=Y("./util/clearOwnProperties");function Z(Q,$,de,Pe,ve){ve=ve||{};var ne=this;this._source=Q,this._geometry=$,this._view=de,this._textureStore=Pe,this._effects=ve.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){ne.emit("viewChange",ne.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){ne.emit("textureStoreChange",ne.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}me(Z),Z.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),ue(this)},Z.prototype.source=function(){return this._source},Z.prototype.geometry=function(){return this._geometry},Z.prototype.view=function(){return this._view},Z.prototype.textureStore=function(){return this._textureStore},Z.prototype.effects=function(){return this._effects},Z.prototype.setEffects=function(Q){this._effects=Q,this.emit("effectsChange",this._effects)},Z.prototype.mergeEffects=function(Q){ie(this._effects,Q),this.emit("effectsChange",this._effects)},Z.prototype.fixedLevel=function(){return this._fixedLevelIndex},Z.prototype.setFixedLevel=function(Q){if(Q!==this._fixedLevelIndex){if(null!=Q&&(Q>=this._geometry.levelList.length||Q<0))throw new Error("Level index out of range: "+Q);this._fixedLevelIndex=Q,this.emit("fixedLevelChange",this._fixedLevelIndex)}},Z.prototype._selectLevel=function(){return null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},Z.prototype.visibleTiles=function(Q){var $=this._selectLevel();return this._geometry.visibleTiles(this._view,$,Q)},Z.prototype.pinLevel=function(Q){for(var de=this._geometry.levelTiles(this._geometry.levelList[Q]),Pe=0;Pe<de.length;Pe++)this._textureStore.pin(de[Pe])},Z.prototype.unpinLevel=function(Q){for(var de=this._geometry.levelTiles(this._geometry.levelList[Q]),Pe=0;Pe<de.length;Pe++)this._textureStore.unpin(de[Pe])},Z.prototype.pinFirstLevel=function(){return this.pinLevel(0)},Z.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},et.exports=Z},{"./util/clearOwnProperties":76,"./util/extend":86,"minimal-event-emitter":14}],18:[function(Y,et,B){"use strict";function ie(ue){this.constructor.super_.apply(this,arguments),this.message=ue}Y("./util/inherits")(ie,Error),et.exports=ie},{"./util/inherits":89}],19:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./util/clearOwnProperties");function ue(Z){var Q=this;this._stage=Z,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){Q._rendering||Q.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}me(ue),ue.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),ie(this)},ue.prototype.stage=function(){return this._stage},ue.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},ue.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},ue.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},ue.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")},et.exports=ue},{"./util/clearOwnProperties":76,"minimal-event-emitter":14}],20:[function(Y,et,B){"use strict";var me=Y("./Layer"),ie=Y("./TextureStore"),ue=Y("./HotspotContainer"),Z=Y("minimal-event-emitter"),Q=Y("./util/now"),$=Y("./util/noop"),de=Y("./util/type"),Pe=Y("./util/defaults"),ve=Y("./util/clearOwnProperties");function ne(Te,De){this._viewer=Te,this._view=De,this._layers=[],this._hotspotContainer=new ue(Te._controlContainer,Te.stage(),this._view,Te.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}Z(ne),ne.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),ve(this)},ne.prototype.hotspotContainer=function(){return this._hotspotContainer},ne.prototype.layer=function(){return this._layers[0]},ne.prototype.listLayers=function(){return[].concat(this._layers)},ne.prototype.view=function(){return this._view},ne.prototype.viewer=function(){return this._viewer},ne.prototype.visible=function(){return this._viewer.scene()===this},ne.prototype.createLayer=function(Te){var De=(Te=Te||{}).textureStoreOpts||{},Ke=Te.layerOpts||{},Be=Te.source,ft=Te.geometry,Ae=this._view,se=this._viewer.stage(),Ue=new ie(Be,se,De),Oe=new me(Be,ft,Ae,Ue,Ke);return this._layers.push(Oe),Te.pinFirstLevel&&Oe.pinFirstLevel(),this.emit("layerChange"),Oe},ne.prototype.destroyLayer=function(Te){var De=this._layers.indexOf(Te);if(De<0)throw new Error("No such layer in scene");this._layers.splice(De,1),this.emit("layerChange"),Te.textureStore().destroy(),Te.destroy()},ne.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},ne.prototype.switchTo=function(Te,De){return this._viewer.switchScene(this,Te,De)},ne.prototype.lookTo=function(Te,De,Ke){var Be=this;if(De=De||{},Ke=Ke||$,"object"!==de(Te))throw new Error("Target view parameters must be an object");var Ae=null!=De.ease?De.ease:function(We){return(We*=2)<1?.5*We*We:-.5*(--We*(We-2)-1)},se=null!=De.controlsInterrupt&&De.controlsInterrupt,Ue=null!=De.transitionDuration?De.transitionDuration:1e3,Oe=null==De.shortest||De.shortest,Ee=this._view,Ve=Ee.parameters(),oe={};Pe(oe,Te),Pe(oe,Ve),Oe&&Ee.normalizeToClosest&&Ee.normalizeToClosest(oe,oe);var ze=this._viewer.controls().enabled();se||this._viewer.controls().disable(),this.startMovement(function(){var We=!1;return function(mt,Tt){if(Tt>=Ue&&We)return null;var $e=Math.min(Tt/Ue,1);for(var Et in mt){var we=Ve[Et],he=oe[Et];mt[Et]=we+Ae($e)*(he-we)}return We=Tt>=Ue,mt}},function(){ze&&Be._viewer.controls().enable(),Ke()})},ne.prototype.startMovement=function(Te,De){var Ke=this._viewer.renderLoop();this._movement&&this.stopMovement();var Be=Te();if("function"!=typeof Be)throw new Error("Bad movement");this._movement=Te,this._movementStep=Be,this._movementStartTime=Q(),this._movementParams={},this._movementCallback=De,Ke.addEventListener("beforeRender",this._updateMovementHandler),Ke.renderOnNextFrame()},ne.prototype.stopMovement=function(){var Te=this._movementCallback,De=this._viewer.renderLoop();!this._movement||(this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null,De.removeEventListener("beforeRender",this._updateMovementHandler),Te&&Te())},ne.prototype.movement=function(){return this._movement},ne.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var Te=this._viewer.renderLoop(),De=this._view,Ke=Q()-this._movementStartTime,ft=this._movementParams;null==(ft=(0,this._movementStep)(ft=De.parameters(ft),Ke))?this.stopMovement():(De.setParameters(ft),Te.renderOnNextFrame())},ne.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()},et.exports=ne},{"./HotspotContainer":16,"./Layer":17,"./TextureStore":21,"./util/clearOwnProperties":76,"./util/defaults":81,"./util/noop":92,"./util/now":93,"./util/type":101,"minimal-event-emitter":14}],21:[function(Y,et,B){"use strict";var me=Y("./collections/Map"),ie=Y("./collections/Set"),ue=Y("./collections/LruSet"),Z=Y("minimal-event-emitter"),Q=Y("./util/defaults"),$=Y("./util/retry"),de=Y("./util/chain"),Pe=Y("./util/inherits"),ve=Y("./util/clearOwnProperties"),ne=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.textureStore,De={previouslyVisibleCacheSize:512},Ke=0;function Be(){}function ft(se,Ue){var Oe=this,Ee=Ke++;Oe._id=Ee,Oe._store=se,Oe._tile=Ue,Oe._asset=null,Oe._texture=null,Oe._changeHandler=function(){se.emit("textureInvalid",Ue)};var Ve=se.source(),oe=se.stage(),Ye=Ve.loadAsset.bind(Ve),ze=oe.createTexture.bind(oe),We=de($(Ye),ze);se.emit("textureStartLoad",Ue),ne&&console.log("loading",Ee,Ue),Oe._cancel=We(oe,Ue,function(mt,Tt,$e,Et){if(Oe._cancel=null,mt)return $e&&$e.destroy(),Et&&Et.destroy(),void(mt instanceof Be?(se.emit("textureCancel",Ue),ne&&console.log("cancel",Ee,Ue)):(se.emit("textureError",Ue,mt),ne&&console.log("error",Ee,Ue)));Oe._texture=Et,$e.isDynamic()?(Oe._asset=$e,$e.addEventListener("change",Oe._changeHandler)):$e.destroy(),se.emit("textureLoad",Ue),ne&&console.log("load",Ee,Ue)})}function Ae(se,Ue,Oe){Oe=Q(Oe||{},De),this._source=se,this._stage=Ue,this._state=0,this._delimCount=0,this._itemMap=new me,this._visible=new ie,this._previouslyVisible=new ue(Oe.previouslyVisibleCacheSize),this._pinMap=new me,this._newVisible=new ie,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}Pe(Be,Error),ft.prototype.asset=function(){return this._asset},ft.prototype.texture=function(){return this._texture},ft.prototype.destroy=function(){var se=this._id,Ue=this._store,Oe=this._tile,Ee=this._asset,Ve=this._texture,oe=this._cancel;oe?oe(new Be("Texture load cancelled")):(Ee&&(Ee.removeEventListener("change",this._changeHandler),Ee.destroy()),Ve&&Ve.destroy(),Ue.emit("textureUnload",Oe),ne&&console.log("unload",se,Oe),ve(this))},Z(ft),Z(Ae),Ae.prototype.destroy=function(){this.clear(),ve(this)},Ae.prototype.stage=function(){return this._stage},Ae.prototype.source=function(){return this._source},Ae.prototype.clear=function(){var se=this;se._evicted.length=0,se._itemMap.forEach(function(Ue){se._evicted.push(Ue)}),se._evicted.forEach(function(Ue){se._unloadTile(Ue)}),se._itemMap.clear(),se._visible.clear(),se._previouslyVisible.clear(),se._pinMap.clear(),se._newVisible.clear(),se._noLongerVisible.length=0,se._visibleAgain.length=0,se._evicted.length=0},Ae.prototype.clearNotPinned=function(){var se=this;se._evicted.length=0,se._itemMap.forEach(function(Ue){se._pinMap.has(Ue)||se._evicted.push(Ue)}),se._evicted.forEach(function(Ue){se._unloadTile(Ue)}),se._visible.clear(),se._previouslyVisible.clear(),se._evicted.length=0},Ae.prototype.startFrame=function(){if(0!==this._state&&1!==this._state)throw new Error("TextureStore: startFrame called out of sequence");this._state=1,this._delimCount++},Ae.prototype.markTile=function(se){if(1!==this._state&&2!==this._state)throw new Error("TextureStore: markTile called out of sequence");this._state=2;var Ue=this._itemMap.get(se),Oe=Ue&&Ue.texture(),Ee=Ue&&Ue.asset();Oe&&Ee&&Oe.refresh(se,Ee),this._newVisible.add(se)},Ae.prototype.endFrame=function(){if(1!==this._state&&2!==this._state&&3!==this._state)throw new Error("TextureStore: endFrame called out of sequence");this._state=3,this._delimCount--,this._delimCount||(this._update(),this._state=0)},Ae.prototype._update=function(){var se=this;se._noLongerVisible.length=0,se._visible.forEach(function(Oe){se._newVisible.has(Oe)||se._noLongerVisible.push(Oe)}),se._visibleAgain.length=0,se._newVisible.forEach(function(Oe){se._previouslyVisible.has(Oe)&&se._visibleAgain.push(Oe)}),se._visibleAgain.forEach(function(Oe){se._previouslyVisible.remove(Oe)}),se._evicted.length=0,se._noLongerVisible.forEach(function(Oe){var Ee=se._itemMap.get(Oe);if(Ee&&Ee.texture()){var oe=se._previouslyVisible.add(Oe);null!=oe&&se._evicted.push(oe)}else Ee&&se._unloadTile(Oe)}),se._evicted.forEach(function(Oe){se._pinMap.has(Oe)||se._unloadTile(Oe)}),se._newVisible.forEach(function(Oe){se._itemMap.get(Oe)||se._loadTile(Oe)});var Ue=se._visible;se._visible=se._newVisible,se._newVisible=Ue,se._newVisible.clear(),se._noLongerVisible.length=0,se._visibleAgain.length=0,se._evicted.length=0},Ae.prototype._loadTile=function(se){if(this._itemMap.has(se))throw new Error("TextureStore: loading texture already in cache");var Ue=new ft(this,se);this._itemMap.set(se,Ue)},Ae.prototype._unloadTile=function(se){var Ue=this._itemMap.del(se);if(!Ue)throw new Error("TextureStore: unloading texture not in cache");Ue.destroy()},Ae.prototype.asset=function(se){var Ue=this._itemMap.get(se);return Ue?Ue.asset():null},Ae.prototype.texture=function(se){var Ue=this._itemMap.get(se);return Ue?Ue.texture():null},Ae.prototype.pin=function(se){var Ue=(this._pinMap.get(se)||0)+1;return this._pinMap.set(se,Ue),this._itemMap.has(se)||this._loadTile(se),Ue},Ae.prototype.unpin=function(se){var Ue=this._pinMap.get(se);if(!Ue)throw new Error("TextureStore: unpin when not pinned");return--Ue>0?this._pinMap.set(se,Ue):(this._pinMap.del(se),!this._visible.has(se)&&!this._previouslyVisible.has(se)&&this._unloadTile(se)),Ue},Ae.prototype.query=function(se){var Ue=this._itemMap.get(se),Oe=this._pinMap.get(se)||0;return{visible:this._visible.has(se),previouslyVisible:this._previouslyVisible.has(se),hasAsset:null!=Ue&&null!=Ue.asset(),hasTexture:null!=Ue&&null!=Ue.texture(),pinned:0!==Oe,pinCount:Oe}},et.exports=Ae},{"./collections/LruSet":29,"./collections/Map":30,"./collections/Set":31,"./util/chain":74,"./util/clearOwnProperties":76,"./util/defaults":81,"./util/inherits":89,"./util/retry":99,"minimal-event-emitter":14}],22:[function(Y,et,B){"use strict";var me=Y("./collections/Set");function ie(){this._stack=[],this._visited=new me,this._vertices=null}ie.prototype.search=function(ue,Z,Q){var $=this._stack,de=this._visited,Pe=this._vertices,ve=0;for(this._clear(),$.push(Z);$.length>0;){var ne=$.pop();if(!de.has(ne)&&ue.intersects(ne.vertices(Pe))){de.add(ne);for(var Te=ne.neighbors(),De=0;De<Te.length;De++)$.push(Te[De]);Q.push(ne),ve++}}return this._vertices=Pe,this._clear(),ve},ie.prototype._clear=function(){this._stack.length=0,this._visited.clear()},et.exports=ie},{"./collections/Set":31}],23:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./util/defaults"),ue=Y("./util/now"),Z={duration:1/0};function Q($){$=ie($||{},Z),this._duration=$.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}me(Q),Q.prototype.start=function(){this._startTime=ue(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},Q.prototype.started=function(){return null!=this._startTime},Q.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},Q.prototype._setup=function($){this._handle=setTimeout(this._check,$)},Q.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Q.prototype._check=function(){var $=ue(),Pe=this._duration-($-this._startTime);this._teardown(),Pe<=0?(this.emit("timeout"),this._startTime=null):Pe<1/0&&this._setup(Pe)},Q.prototype.duration=function(){return this._duration},Q.prototype.setDuration=function($){this._duration=$,null!=this._startTime&&this._check()},et.exports=Q},{"./util/defaults":81,"./util/now":93,"minimal-event-emitter":14}],24:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./RenderLoop"),ue=Y("./controls/Controls"),Z=Y("./Scene"),Q=Y("./Timer"),$=Y("./stages/WebGl"),de=Y("./controls/ControlCursor"),Pe=Y("./controls/HammerGestures"),ve=Y("./controls/registerDefaultControls"),ne=Y("./renderers/registerDefaultRenderers"),Te=Y("./util/dom").setOverflowHidden,De=Y("./util/dom").setAbsolute,Ke=Y("./util/dom").setFullSize,Be=Y("./util/tween"),ft=Y("./util/noop"),Ae=Y("./util/clearOwnProperties");function se(Ee,Ve){Ve=Ve||{},this._domElement=Ee,Te(Ee),this._stage=new $(Ve.stage),ne(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),De(this._controlContainer),Ke(this._controlContainer),Ee.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new ie(this._stage),this._controls=new ue,this._controlMethods=ve(this._controls,this._controlContainer,Ve.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=Pe.get(this._controlContainer,"touch"),this._hammerManagerMouse=Pe.get(this._controlContainer,"mouse"),this._dragCursor=new de(this._controls,"mouseViewDrag",Ee,Ve.cursors&&Ve.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new Q,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}function Oe(Ee,Ve,oe){Ve.listLayers().forEach(function(ze){ze.mergeEffects({opacity:Ee})}),Ve._hotspotContainer.domElement().style.opacity=Ee}me(se),se.prototype.destroy=function(){for(var Ee in window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy(),this._controlMethods)this._controlMethods[Ee].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),Ae(this)},se.prototype.updateSize=function(){var Ee=this._size;Ee.width=this._domElement.clientWidth,Ee.height=this._domElement.clientHeight,this._stage.setSize(Ee)},se.prototype.stage=function(){return this._stage},se.prototype.renderLoop=function(){return this._renderLoop},se.prototype.controls=function(){return this._controls},se.prototype.domElement=function(){return this._domElement},se.prototype.createScene=function(Ee){var Ve=this.createEmptyScene({view:(Ee=Ee||{}).view});return Ve.createLayer({source:Ee.source,geometry:Ee.geometry,pinFirstLevel:Ee.pinFirstLevel,textureStoreOpts:Ee.textureStoreOpts,layerOpts:Ee.layerOpts}),Ve},se.prototype.createEmptyScene=function(Ee){var Ve=new Z(this,(Ee=Ee||{}).view);return this._scenes.push(Ve),Ve},se.prototype._updateSceneLayers=function(){var Ee,Ve,Ye=this._currentScene,ze=this._replacedScene,We=this._stage.listLayers(),mt=[];if(ze&&(mt=mt.concat(ze.listLayers())),Ye&&(mt=mt.concat(Ye.listLayers())),1!==Math.abs(We.length-mt.length))throw new Error("Stage and scene out of sync");if(mt.length<We.length)for(Ee=0;Ee<We.length;Ee++)if(mt.indexOf(Ve=We[Ee])<0){this._removeLayerFromStage(Ve);break}if(mt.length>We.length)for(Ee=0;Ee<mt.length;Ee++)We.indexOf(Ve=mt[Ee])<0&&this._addLayerToStage(Ve,Ee)},se.prototype._addLayerToStage=function(Ee,Ve){Ee.pinFirstLevel(),this._stage.addLayer(Ee,Ve)},se.prototype._removeLayerFromStage=function(Ee){this._stage.removeLayer(Ee),Ee.unpinFirstLevel(),Ee.textureStore().clearNotPinned()},se.prototype._addSceneEventListeners=function(Ee){Ee.addEventListener("layerChange",this._layerChangeHandler),Ee.addEventListener("viewChange",this._viewChangeHandler)},se.prototype._removeSceneEventListeners=function(Ee){Ee.removeEventListener("layerChange",this._layerChangeHandler),Ee.removeEventListener("viewChange",this._viewChangeHandler)},se.prototype.destroyScene=function(Ee){var oe,Ye,Ve=this._scenes.indexOf(Ee);if(Ve<0)throw new Error("No such scene in viewer");if(this._currentScene===Ee){for(this._removeSceneEventListeners(Ee),Ye=Ee.listLayers(),oe=0;oe<Ye.length;oe++)this._removeLayerFromStage(Ye[oe]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===Ee){for(this._removeSceneEventListeners(Ee),Ye=Ee.listLayers(),oe=0;oe<Ye.length;oe++)this._removeLayerFromStage(Ye[oe]);this._replacedScene=null}this._scenes.splice(Ve,1),Ee.destroy()},se.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},se.prototype.hasScene=function(Ee){return this._scenes.indexOf(Ee)>=0},se.prototype.listScenes=function(){return[].concat(this._scenes)},se.prototype.scene=function(){return this._currentScene},se.prototype.view=function(){var Ee=this._currentScene;return Ee?Ee.view():null},se.prototype.lookTo=function(Ee,Ve,oe){var Ye=this._currentScene;Ye&&Ye.lookTo(Ee,Ve,oe)},se.prototype.startMovement=function(Ee,Ve){var oe=this._currentScene;!oe||oe.startMovement(Ee,Ve)},se.prototype.stopMovement=function(){var Ee=this._currentScene;!Ee||Ee.stopMovement()},se.prototype.movement=function(){var Ee=this._currentScene;if(Ee)return Ee.movement()},se.prototype.setIdleMovement=function(Ee,Ve){this._idleTimer.setDuration(Ee),this._idleMovement=Ve},se.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},se.prototype._resetIdleTimer=function(){this._idleTimer.start()},se.prototype._triggerIdleTimer=function(){var Ee=this._idleMovement;!Ee||this.startMovement(Ee)},se.prototype.switchScene=function(Ee,Ve,oe){var Ye=this;Ve=Ve||{},oe=oe||ft;var ze=this._stage,We=this._currentScene;if(We!==Ee){if(this._scenes.indexOf(Ee)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var mt=We?We.listLayers():[],Tt=Ee.listLayers(),$e=ze.listLayers();if(We&&($e.length!==mt.length||$e.length>1&&$e[0]!=mt[0]))throw new Error("Stage not in sync with viewer");for(var Et=null!=Ve.transitionDuration?Ve.transitionDuration:1e3,we=null!=Ve.transitionUpdate?Ve.transitionUpdate:Oe,he=0;he<Tt.length;he++)this._addLayerToStage(Tt[he]);this._cancelCurrentTween=Be(Et,function ae(Pt){we(Pt,Ee,We)},function vt(){if(Ye._replacedScene){Ye._removeSceneEventListeners(Ye._replacedScene),mt=Ye._replacedScene.listLayers();for(var Pt=0;Pt<mt.length;Pt++)Ye._removeLayerFromStage(mt[Pt]);Ye._replacedScene=null}Ye._cancelCurrentTween=null,oe()}),this._currentScene=Ee,this._replacedScene=We,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(Ee)}else oe()},et.exports=se},{"./RenderLoop":19,"./Scene":20,"./Timer":23,"./controls/ControlCursor":36,"./controls/Controls":37,"./controls/HammerGestures":41,"./controls/registerDefaultControls":47,"./renderers/registerDefaultRenderers":61,"./stages/WebGl":70,"./util/clearOwnProperties":76,"./util/dom":85,"./util/noop":92,"./util/tween":100,"minimal-event-emitter":14}],25:[function(Y,et,B){"use strict";var me=Y("./Static"),ie=Y("../util/inherits"),ue=Y("minimal-event-emitter"),Z=Y("../util/clearOwnProperties");function Q($){this.constructor.super_.call(this,$),this._timestamp=0}ie(Q,me),ue(Q),Q.prototype.destroy=function(){Z(this)},Q.prototype.timestamp=function(){return this._timestamp},Q.prototype.isDynamic=function(){return!0},Q.prototype.markDirty=function(){this._timestamp++,this.emit("change")},et.exports=Q},{"../util/clearOwnProperties":76,"../util/inherits":89,"./Static":26,"minimal-event-emitter":14}],26:[function(Y,et,B){"use strict";var me=Y("../util/global"),ie=Y("minimal-event-emitter"),ue=Y("../util/clearOwnProperties"),Z={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function Q($){var de=!1;for(var Pe in Z)if(me[Pe]&&$ instanceof me[Pe]){de=!0,this._widthProp=Z[Pe][0],this._heightProp=Z[Pe][1];break}if(!de)throw new Error("Unsupported pixel source");this._element=$}ie(Q),Q.prototype.destroy=function(){ue(this)},Q.prototype.element=function(){return this._element},Q.prototype.width=function(){return this._element[this._widthProp]},Q.prototype.height=function(){return this._element[this._heightProp]},Q.prototype.timestamp=function(){return 0},Q.prototype.isDynamic=function(){return!1},et.exports=Q},{"../util/clearOwnProperties":76,"../util/global":87,"minimal-event-emitter":14}],27:[function(Y,et,B){"use strict";var me=Y("./util/defaults"),Z={yawSpeed:.1,pitchSpeed:.1,fovSpeed:.1,yawAccel:.01,pitchAccel:.01,fovAccel:.01,targetPitch:0,targetFov:null};et.exports=function Q($){var de=($=me($||{},Z)).yawSpeed,Pe=$.pitchSpeed,ve=$.fovSpeed,ne=$.yawAccel,Te=$.pitchAccel,De=$.fovAccel,Ke=$.targetPitch,Be=$.targetFov;return function(){var Ye,We,mt,Ae=0,se=0,Ue=0,Oe=0,Ee=0,Ve=0,oe=0;return function($e,Et){if(Ye=(Et-Ae)/1e3,Ee=Math.min(se+Ye*ne,de),$e.yaw=$e.yaw+Ee*Ye,null!=Ke&&$e.pitch!==Ke){var we=.5*Ue*Ue/Te;Ve=Math.abs(Ke-$e.pitch)>we?Math.min(Ue+Ye*Te,Pe):Math.max(Ue-Ye*Te,0),We=Ve*Ye,Ke<$e.pitch&&($e.pitch=Math.max(Ke,$e.pitch-We)),Ke>$e.pitch&&($e.pitch=Math.min(Ke,$e.pitch+We))}if(null!=Be&&$e.fov!==Ke){var he=.5*Oe*Oe/De;oe=Math.abs(Be-$e.fov)>he?Math.min(Oe+Ye*De,ve):Math.max(Oe-Ye*De,0),mt=oe*Ye,Be<$e.fov&&($e.fov=Math.max(Be,$e.fov-mt)),Be>$e.fov&&($e.fov=Math.min(Be,$e.fov+mt))}return Ae=Et,se=Ee,Ue=Ve,Oe=oe,$e}}}},{"./util/defaults":81}],28:[function(Y,et,B){"use strict";var me=Y("../util/mod");function ie(ue){if(!isFinite(ue)||Math.floor(ue)!==ue||ue<0)throw new Error("LruMap: invalid capacity");this._capacity=ue,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}ie.prototype._index=function(ue){return me(this._start+ue,this._capacity)},ie.prototype.get=function(ue){for(var Z=0;Z<this._size;Z++){var Q=this._keys[this._index(Z)];if(ue.equals(Q))return this._values[this._index(Z)]}return null},ie.prototype.set=function(ue,Z){if(0===this._capacity)return ue;this.del(ue);var Q=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=ue,this._values[this._index(this._size)]=Z,this._size<this._capacity?this._size++:this._start=this._index(1),Q},ie.prototype.del=function(ue){for(var Z=0;Z<this._size;Z++)if(ue.equals(this._keys[this._index(Z)])){for(var Q=this._values[this._index(Z)],$=Z;$<this._size-1;$++)this._keys[this._index($)]=this._keys[this._index($+1)],this._values[this._index($)]=this._values[this._index($+1)];return this._size--,Q}return null},ie.prototype.has=function(ue){for(var Z=0;Z<this._size;Z++)if(ue.equals(this._keys[this._index(Z)]))return!0;return!1},ie.prototype.size=function(){return this._size},ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},ie.prototype.forEach=function(ue){for(var Z=0,Q=0;Q<this._size;Q++)ue(this._keys[this._index(Q)],this._values[this._index(Q)]),Z+=1;return Z},et.exports=ie},{"../util/mod":91}],29:[function(Y,et,B){"use strict";var me=Y("../util/mod");function ie(ue){if(!isFinite(ue)||Math.floor(ue)!==ue||ue<0)throw new Error("LruSet: invalid capacity");this._capacity=ue,this._elements=new Array(this._capacity),this._start=0,this._size=0}ie.prototype._index=function(ue){return me(this._start+ue,this._capacity)},ie.prototype.add=function(ue){if(0===this._capacity)return ue;this.remove(ue);var Z=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=ue,this._size<this._capacity?this._size++:this._start=this._index(1),Z},ie.prototype.remove=function(ue){for(var Z=0;Z<this._size;Z++){var Q=this._elements[this._index(Z)];if(ue.equals(Q)){for(var $=Z;$<this._size-1;$++)this._elements[this._index($)]=this._elements[this._index($+1)];return this._size--,Q}}return null},ie.prototype.has=function(ue){for(var Z=0;Z<this._size;Z++)if(ue.equals(this._elements[this._index(Z)]))return!0;return!1},ie.prototype.size=function(){return this._size},ie.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},ie.prototype.forEach=function(ue){for(var Z=0,Q=0;Q<this._size;Q++)ue(this._elements[this._index(Q)]),Z+=1;return Z},et.exports=ie},{"../util/mod":91}],30:[function(Y,et,B){"use strict";var me=Y("../util/mod");function ue(Z){if(null!=Z&&(!isFinite(Z)||Math.floor(Z)!==Z||Z<1))throw new Error("Map: invalid capacity");this._capacity=Z||64,this._keyBuckets=[],this._valBuckets=[];for(var Q=0;Q<this._capacity;Q++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}ue.prototype.get=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._keyBuckets[Q],de=0;de<$.length;de++)if(Z.equals($[de]))return this._valBuckets[Q][de];return null},ue.prototype.set=function(Z,Q){for(var $=me(Z.hash(),this._capacity),de=this._keyBuckets[$],Pe=this._valBuckets[$],ve=0;ve<de.length;ve++)if(Z.equals(de[ve])){var Te=Pe[ve];return de[ve]=Z,Pe[ve]=Q,Te}return de.push(Z),Pe.push(Q),this._size++,null},ue.prototype.del=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._keyBuckets[Q],de=this._valBuckets[Q],Pe=0;Pe<$.length;Pe++)if(Z.equals($[Pe])){for(var ne=de[Pe],Te=Pe;Te<$.length-1;Te++)$[Te]=$[Te+1],de[Te]=de[Te+1];return $.length=$.length-1,de.length=de.length-1,this._size--,ne}return null},ue.prototype.has=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._keyBuckets[Q],de=0;de<$.length;de++)if(Z.equals($[de]))return!0;return!1},ue.prototype.size=function(){return this._size},ue.prototype.clear=function(){for(var Z=0;Z<this._capacity;Z++)this._keyBuckets[Z].length=0,this._valBuckets[Z].length=0;this._size=0},ue.prototype.forEach=function(Z){for(var Q=0,$=0;$<this._capacity;$++)for(var de=this._keyBuckets[$],Pe=this._valBuckets[$],ve=0;ve<de.length;ve++)Z(de[ve],Pe[ve]),Q+=1;return Q},et.exports=ue},{"../util/mod":91}],31:[function(Y,et,B){"use strict";var me=Y("../util/mod");function ue(Z){if(null!=Z&&(!isFinite(Z)||Math.floor(Z)!==Z||Z<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||64,this._buckets=[];for(var Q=0;Q<this._capacity;Q++)this._buckets.push([]);this._size=0}ue.prototype.add=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._buckets[Q],de=0;de<$.length;de++){var Pe=$[de];if(Z.equals(Pe))return $[de]=Z,Pe}return $.push(Z),this._size++,null},ue.prototype.remove=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._buckets[Q],de=0;de<$.length;de++){var Pe=$[de];if(Z.equals(Pe)){for(var ve=de;ve<$.length-1;ve++)$[ve]=$[ve+1];return $.length=$.length-1,this._size--,Pe}}return null},ue.prototype.has=function(Z){for(var Q=me(Z.hash(),this._capacity),$=this._buckets[Q],de=0;de<$.length;de++)if(Z.equals($[de]))return!0;return!1},ue.prototype.size=function(){return this._size},ue.prototype.clear=function(){for(var Z=0;Z<this._capacity;Z++)this._buckets[Z].length=0;this._size=0},ue.prototype.forEach=function(Z){for(var Q=0,$=0;$<this._capacity;$++)for(var de=this._buckets[$],Pe=0;Pe<de.length;Pe++)Z(de[Pe]),Q+=1;return Q},et.exports=ue},{"../util/mod":91}],32:[function(Y,et,B){"use strict";var me=Y("./WorkQueue"),ie=Y("../util/mod");function ue(Z){this._concurrency=Z&&Z.concurrency||1,this._paused=Z&&!!Z.paused||!1,this._pool=[];for(var Q=0;Q<this._concurrency;Q++)this._pool.push(new me(Z));this._next=0}ue.prototype.length=function(){for(var Z=0,Q=0;Q<this._pool.length;Q++)Z+=this._pool[Q].length();return Z},ue.prototype.push=function(Z,Q){var de=this._pool[this._next].push(Z,Q);return this._next=ie(this._next+1,this._concurrency),de},ue.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var Z=0;Z<this._concurrency;Z++)this._pool[Z].pause()}},ue.prototype.resume=function(){if(this._paused){this._paused=!1;for(var Z=0;Z<this._concurrency;Z++)this._pool[Z].resume()}},et.exports=ue},{"../util/mod":91,"./WorkQueue":33}],33:[function(Y,et,B){"use strict";var me=Y("../util/now");function ie(Z,Q){this.fn=Z,this.cb=Q,this.cfn=null}function ue(Z){this._queue=[],this._delay=Z&&Z.delay||0,this._paused=Z&&!!Z.paused||!1,this._currentTask=null,this._lastFinished=null}ue.prototype.length=function(){return this._queue.length},ue.prototype.push=function(Z,Q){var $=new ie(Z,Q),de=this._cancel.bind(this,$);return this._queue.push($),this._next(),de},ue.prototype.pause=function(){this._paused||(this._paused=!0)},ue.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},ue.prototype._start=function(Z){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=Z;var Q=this._finish.bind(this,Z);if(Z.cfn=Z.fn(Q),"function"!=typeof Z.cfn)throw new Error("WorkQueue: function is not cancellable")},ue.prototype._finish=function(Z){var Q=Array.prototype.slice.call(arguments,1);if(this._currentTask!==Z)throw new Error("WorkQueue: called finish on wrong task");Z.cb.apply(null,Q),this._currentTask=null,this._lastFinished=me(),this._next()},ue.prototype._cancel=function(Z){var Q=Array.prototype.slice.call(arguments,1);if(this._currentTask===Z)Z.cfn.apply(null,Q);else{var $=this._queue.indexOf(Z);$>=0&&(this._queue.splice($,1),Z.cb.apply(null,Q))}},ue.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var Z=me()-this._lastFinished,Q=this._delay-Z;if(Q>0)return void setTimeout(this._next.bind(this),Q)}var $=this._queue.shift();this._start($)}},et.exports=ue},{"../util/now":93}],34:[function(Y,et,B){"use strict";var me=Y("gl-matrix").vec4,ie=Y("gl-matrix").mat4;function Z(Pe,ve,ne){(function Q(Pe,ve,ne){var Te=ve[0],De=ve[1],Ke=ve[2],Be=ve[3];Pe[0]=ne[0]*Te+ne[1]*De+ne[2]*Ke+ne[3]*Be,Pe[1]=ne[4]*Te+ne[5]*De+ne[6]*Ke+ne[7]*Be,Pe[2]=ne[8]*Te+ne[9]*De+ne[10]*Ke+ne[11]*Be,Pe[3]=ne[12]*Te+ne[13]*De+ne[14]*Ke+ne[15]*Be})(ne,Pe,ve.colorMatrix),me.add(ne,ne,ve.colorOffset)}var $=me.create();et.exports={identity:function ue(Pe){var ve=Pe||{};return ve.colorOffset=ve.colorOffset||me.create(),ve.colorMatrix=ve.colorMatrix||ie.create(),ve},applyToPixel:Z,applyToImageData:function de(Pe,ve){for(var ne=Pe.width,Te=Pe.height,De=Pe.data,Ke=0;Ke<ne*Te;Ke++)me.set($,De[4*Ke+0]/255,De[4*Ke+1]/255,De[4*Ke+2]/255,De[4*Ke+3]/255),Z($,ve,$),De[4*Ke+0]=255*$[0],De[4*Ke+1]=255*$[1],De[4*Ke+2]=255*$[2],De[4*Ke+3]=255*$[3]}}},{"gl-matrix":3}],35:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("../util/now"),Z=Y("../util/clearOwnProperties");function Q($){$=$||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=$.nowForTesting||ue,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}me(Q),Q.prototype.add=function($){if(!this.has($)){var de={};this._parameters.forEach(function(ne){de[ne]={dynamics:new ie,time:null}});var Pe=this._updateDynamics.bind(this,de),ve={instance:$,dynamics:de,parameterDynamicsHandler:Pe};$.addEventListener("parameterDynamics",Pe),this._methods.push(ve)}},Q.prototype.remove=function($){var de=this._indexOfInstance($);if(de>=0){var Pe=this._methods.splice(de,1)[0];Pe.instance.removeEventListener("parameterDynamics",Pe.parameterDynamicsHandler)}},Q.prototype.has=function($){return this._indexOfInstance($)>=0},Q.prototype._indexOfInstance=function($){for(var de=0;de<this._methods.length;de++)if(this._methods[de].instance===$)return de;return-1},Q.prototype.list=function(){for(var $=[],de=0;de<this._methods.length;de++)$.push(this._methods[de].instance);return $},Q.prototype._updateDynamics=function($,de,Pe){var ve=$[de];if(!ve)throw new Error("Unknown control parameter "+de);var ne=this._now();ve.dynamics.update(Pe,(ne-ve.time)/1e3),ve.time=ne,this.emit("change")},Q.prototype._resetComposedOffsets=function(){for(var $=0;$<this._parameters.length;$++)this._composedOffsets[this._parameters[$]]=0},Q.prototype.offsets=function(){var $,de=!1,Pe=this._now();this._resetComposedOffsets();for(var ve=0;ve<this._methods.length;ve++)for(var ne=this._methods[ve].dynamics,Te=0;Te<this._parameters.length;Te++){var De=ne[$=this._parameters[Te]],Ke=De.dynamics;null!=Ke.offset&&(this._composedOffsets[$]+=Ke.offset,Ke.offset=null);var Be=(Pe-De.time)/1e3,ft=Ke.offsetFromVelocity(Be);ft&&(this._composedOffsets[$]+=ft);var Ae=Ke.velocityAfter(Be);Ke.velocity=Ae,Ae&&(de=!0),De.time=Pe}return this._composeReturn.changing=de,this._composeReturn},Q.prototype.destroy=function(){for(var $=this.list(),de=0;de<$.length;de++)this.remove($[de]);Z(this)},et.exports=Q},{"../util/clearOwnProperties":76,"../util/now":93,"./Dynamics":39,"minimal-event-emitter":14}],36:[function(Y,et,B){"use strict";var me=Y("../util/defaults"),ie=Y("../util/clearOwnProperties"),ue={active:"move",inactive:"default",disabled:"default"};function Z(Q,$,de,Pe){Pe=me(Pe||{},ue),this._element=de,this._controls=Q,this._id=$,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,Pe.active),this._setInactiveCursor=this._setCursor.bind(this,Pe.inactive),this._setDisabledCursor=this._setCursor.bind(this,Pe.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),Q.addEventListener("methodEnabled",this._updateAttachmentHandler),Q.addEventListener("methodDisabled",this._updateAttachmentHandler),Q.addEventListener("enabled",this._updateAttachmentHandler),Q.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}Z.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),ie(this)},Z.prototype._updateAttachment=function(){var Q=this._controls,$=this._id;Q.enabled()&&Q.method($).enabled?this._attachToControlMethod(Q.method($)):this._detachFromControlMethod(Q.method($))},Z.prototype._attachToControlMethod=function(Q){this._attached||(Q.instance.addEventListener("active",this._setActiveCursor),Q.instance.addEventListener("inactive",this._setInactiveCursor),Q.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},Z.prototype._detachFromControlMethod=function(Q){this._attached&&(Q.instance.removeEventListener("active",this._setActiveCursor),Q.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},Z.prototype._setCursor=function(Q){this._element.style.cursor=Q},et.exports=Z},{"../util/clearOwnProperties":76,"../util/defaults":81}],37:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Composer"),ue=Y("../util/clearOwnProperties"),Z=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function Q($){$=$||{},this._methods={},this._methodGroups={},this._composer=new ie,this._enabled=!$||!$.enabled||!!$.enabled,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}me(Q),Q.prototype.destroy=function(){this.detach(),this._composer.destroy(),ue(this)},Q.prototype.methods=function(){var $={};for(var de in this._methods)$[de]=this._methods[de];return $},Q.prototype.method=function($){return this._methods[$]},Q.prototype.registerMethod=function($,de,Pe){if(this._methods[$])throw new Error("Control method already registered with id "+$);this._methods[$]={instance:de,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,$),inactiveHandler:this._handleInactive.bind(this,$)},Pe&&this.enableMethod($,de)},Q.prototype.unregisterMethod=function($){var de=this._methods[$];if(!de)throw new Error("No control method registered with id "+$);de.enabled&&this.disableMethod($),delete this._methods[$]},Q.prototype.enableMethod=function($){var de=this._methods[$];if(!de)throw new Error("No control method registered with id "+$);de.enabled||(de.enabled=!0,de.active&&this._incrementActiveCount(),this._listen($),this._updateComposer(),this.emit("methodEnabled",$))},Q.prototype.disableMethod=function($){var de=this._methods[$];if(!de)throw new Error("No control method registered with id "+$);!de.enabled||(de.enabled=!1,de.active&&this._decrementActiveCount(),this._unlisten($),this._updateComposer(),this.emit("methodDisabled",$))},Q.prototype.addMethodGroup=function($,de){this._methodGroups[$]=de},Q.prototype.removeMethodGroup=function($){delete this._methodGroups[$]},Q.prototype.methodGroups=function(){var $={};for(var de in this._methodGroups)$[de]=this._methodGroups[de];return $},Q.prototype.enableMethodGroup=function($){var de=this;de._methodGroups[$].forEach(function(Pe){de.enableMethod(Pe)})},Q.prototype.disableMethodGroup=function($){var de=this;de._methodGroups[$].forEach(function(Pe){de.disableMethod(Pe)})},Q.prototype.enabled=function(){return this._enabled},Q.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},Q.prototype.disable=function(){!this._enabled||(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},Q.prototype.attach=function($){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=$,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=$.renderOnNextFrame.bind($),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},Q.prototype.detach=function(){!this._attachedRenderLoop||(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},Q.prototype.attached=function(){return null!=this._attachedRenderLoop},Q.prototype._listen=function($){var de=this._methods[$];if(!de)throw new Error("Bad method id");de.instance.addEventListener("active",de.activeHandler),de.instance.addEventListener("inactive",de.inactiveHandler)},Q.prototype._unlisten=function($){var de=this._methods[$];if(!de)throw new Error("Bad method id");de.instance.removeEventListener("active",de.activeHandler),de.instance.removeEventListener("inactive",de.inactiveHandler)},Q.prototype._handleActive=function($){var de=this._methods[$];if(!de)throw new Error("Bad method id");if(!de.enabled)throw new Error("Should not receive event from disabled control method");de.active||(de.active=!0,this._incrementActiveCount())},Q.prototype._handleInactive=function($){var de=this._methods[$];if(!de)throw new Error("Bad method id");if(!de.enabled)throw new Error("Should not receive event from disabled control method");de.active&&(de.active=!1,this._decrementActiveCount())},Q.prototype._incrementActiveCount=function(){this._activeCount++,Z&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},Q.prototype._decrementActiveCount=function(){this._activeCount--,Z&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},Q.prototype._checkActiveCount=function(){var $=0;for(var de in this._methods){var Pe=this._methods[de];Pe.enabled&&Pe.active&&$++}if($!=this._activeCount)throw new Error("Bad control state")},Q.prototype._updateComposer=function(){var $=this._composer;for(var de in this._methods){var Pe=this._methods[de],ve=this._enabled&&Pe.enabled;ve&&!$.has(Pe.instance)&&$.add(Pe.instance),!ve&&$.has(Pe.instance)&&$.remove(Pe.instance)}},Q.prototype._updateViewsWithControls=function(){var $=this._composer.offsets();$.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var de=this._attachedRenderLoop.stage().listLayers(),Pe=0;Pe<de.length;Pe++){var ve=de[Pe].view();this.updatedViews_.indexOf(ve)<0&&(de[Pe].view().updateWithControlParameters($.offsets),this.updatedViews_.push(ve))}},et.exports=Q},{"../util/clearOwnProperties":76,"./Composer":35,"minimal-event-emitter":14}],38:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("./HammerGestures"),Z=Y("../util/defaults"),Q=Y("./util").maxFriction,$=Y("../util/clearOwnProperties"),de={friction:6,maxFrictionTime:.3,hammerEvent:"pan"},Pe=typeof MARZIPANODEBUG<"u"&&MARZIPANODEBUG.controls;function ve(Te,De,Ke){if(this._element=Te,this._opts=Z(Ke||{},de),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new ie,y:new ie},this._hammer=ue.get(Te,De),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),"pan"!=this._opts.hammerEvent&&"pinch"!=this._opts.hammerEvent)throw new Error(this._opts.hammerEvent+" is not a hammerEvent managed in DragControlMethod");this._hammer.on(this._opts.hammerEvent+"start",this._handleStart.bind(this)),this._hammer.on(this._opts.hammerEvent+"move",this._handleMove.bind(this)),this._hammer.on(this._opts.hammerEvent+"end",this._handleEnd.bind(this)),this._hammer.on(this._opts.hammerEvent+"cancel",this._handleEnd.bind(this))}me(ve),ve.prototype.destroy=function(){this._hammer.release(),$(this)},ve.prototype._handleHammerEvent=function(Te){if(Te.isFirst){if(Pe&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(Te.isFinal){if(Pe&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},ve.prototype._handleStart=function(Te){Te.preventDefault(),this._startEvent=Te},ve.prototype._handleMove=function(Te){Te.preventDefault(),this._startEvent&&(this._updateDynamicsMove(Te),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},ve.prototype._handleEnd=function(Te){Te.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(Te),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},ve.prototype._updateDynamicsMove=function(Te){var De=Te.deltaX,Ke=Te.deltaY,Be=this._lastEvent||this._startEvent;Be&&(De-=Be.deltaX,Ke-=Be.deltaY);var ft=this._element.getBoundingClientRect();De/=ft.right-ft.left,Ke/=ft.bottom-ft.top,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-De,this._dynamics.y.offset=-Ke,this._lastEvent=Te};var ne=[null,null];ve.prototype._updateDynamicsRelease=function(Te){var De=this._element.getBoundingClientRect(),ft=1e3*Te.velocityX/(De.right-De.left),Ae=1e3*Te.velocityY/(De.bottom-De.top);this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=ft,this._dynamics.y.velocity=Ae,Q(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,ne),this._dynamics.x.friction=ne[0],this._dynamics.y.friction=ne[1]},et.exports=ve},{"../util/clearOwnProperties":76,"../util/defaults":81,"./Dynamics":39,"./HammerGestures":41,"./util":48,"minimal-event-emitter":14}],39:[function(Y,et,B){"use strict";function me(){this.velocity=null,this.friction=null,this.offset=null}me.equals=function(ue,Z){return ue.velocity===Z.velocity&&ue.friction===Z.friction&&ue.offset===Z.offset},me.prototype.equals=function(ue){return me.equals(this,ue)},me.prototype.update=function(ue,Z){ue.offset&&(this.offset=this.offset||0,this.offset+=ue.offset);var Q=this.offsetFromVelocity(Z);Q&&(this.offset=this.offset||0,this.offset+=Q),this.velocity=ue.velocity,this.friction=ue.friction},me.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},me.prototype.velocityAfter=function(ue){return this.velocity?this.friction?function ie(ue,Z){return ue<0?Math.min(0,ue+Z):ue>0?Math.max(0,ue-Z):0}(this.velocity,this.friction*ue):this.velocity:null},me.prototype.offsetFromVelocity=function(ue){ue=Math.min(ue,this.nullVelocityTime());var Z=this.velocityAfter(ue);return(this.velocity+Z)/2*ue},me.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},et.exports=me},{}],40:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("../util/clearOwnProperties");function Z(Q,$,de,Pe){if(!Q)throw new Error("ElementPressControlMethod: element must be defined");if(!$)throw new Error("ElementPressControlMethod: parameter must be defined");if(!de)throw new Error("ElementPressControlMethod: velocity must be defined");if(!Pe)throw new Error("ElementPressControlMethod: friction must be defined");this._element=Q,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),Q.addEventListener("mousedown",this._pressHandler),Q.addEventListener("mouseup",this._releaseHandler),Q.addEventListener("mouseleave",this._releaseHandler),Q.addEventListener("touchstart",this._pressHandler),Q.addEventListener("touchmove",this._releaseHandler),Q.addEventListener("touchend",this._releaseHandler),this._parameter=$,this._velocity=de,this._friction=Pe,this._dynamics=new ie,this._pressing=!1}me(Z),Z.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),ue(this)},Z.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},Z.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1},et.exports=Z},{"../util/clearOwnProperties":76,"./Dynamics":39,"minimal-event-emitter":14}],41:[function(Y,et,B){"use strict";var me=Y("hammerjs"),ie=1,ue="MarzipanoHammerElementId";function Z(de,Pe){return de[ue]||(de[ue]=ie++),Pe+de[ue]}function Q(){this._managers={},this._refCount={}}function $(de,Pe,ve,ne){this._manager=Pe,this._element=ve,this._type=ne,this._hammerGestures=de,this._eventHandlers=[]}Q.prototype.get=function(de,Pe){var ve=Z(de,Pe);return this._managers[ve]||(this._managers[ve]=this._createManager(de,Pe),this._refCount[ve]=0),this._refCount[ve]++,new $(this,this._managers[ve],de,Pe)},Q.prototype._createManager=function(de,Pe){var ve=new me.Manager(de);return"mouse"===Pe?ve.add(new me.Pan({direction:me.DIRECTION_ALL,threshold:0})):("touch"===Pe||"pen"===Pe||"kinect"===Pe)&&(ve.add(new me.Pan({direction:me.DIRECTION_ALL,threshold:20,pointers:1})),ve.add(new me.Pinch)),ve},Q.prototype._releaseHandle=function(de,Pe){var ve=Z(de,Pe);this._refCount[ve]&&(this._refCount[ve]--,this._refCount[ve]||(this._managers[ve].destroy(),delete this._managers[ve],delete this._refCount[ve]))},$.prototype.on=function(de,Pe){var ve=this._type,ne=function(Te){ve===Te.pointerType&&Pe(Te)};this._eventHandlers.push({events:de,handler:ne}),this._manager.on(de,ne)},$.prototype.release=function(){for(var de=0;de<this._eventHandlers.length;de++){var Pe=this._eventHandlers[de];this._manager.off(Pe.events,Pe.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},$.prototype.manager=function(){return this._manager},et.exports=new Q},{hammerjs:13}],42:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("../util/clearOwnProperties");function Z(Q,$,de,Pe,ve){if(!Q)throw new Error("KeyControlMethod: keyCode must be defined");if(!$)throw new Error("KeyControlMethod: parameter must be defined");if(!de)throw new Error("KeyControlMethod: velocity must be defined");if(!Pe)throw new Error("KeyControlMethod: friction must be defined");ve=ve||document,this._keyCode=Q,this._parameter=$,this._velocity=de,this._friction=Pe,this._element=ve,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new ie,this._pressing=!1}me(Z),Z.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),ue(this)},Z.prototype._handlePress=function(Q){Q.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},Z.prototype._handleRelease=function(Q){Q.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},Z.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1},et.exports=Z},{"../util/clearOwnProperties":76,"./Dynamics":39,"minimal-event-emitter":14}],43:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("./HammerGestures"),Z=Y("../util/clearOwnProperties");function Q($,de,Pe){this._hammer=ue.get($,de),this._lastEvent=null,this._active=!1,this._dynamics=new ie,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}me(Q),Q.prototype.destroy=function(){this._hammer.release(),Z(this)},Q.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},Q.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},Q.prototype._handleEvent=function($){var de=$.scale;this._lastEvent&&(de/=this._lastEvent.scale),this._dynamics.offset=-1*(de-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=$},et.exports=Q},{"../util/clearOwnProperties":76,"./Dynamics":39,"./HammerGestures":41,"minimal-event-emitter":14}],44:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("./HammerGestures"),Z=Y("../util/defaults"),Q=Y("./util").maxFriction,$=Y("../util/clearOwnProperties"),de={speed:8,friction:6,maxFrictionTime:.3};function Pe(ne,Te,De){this._element=ne,this._opts=Z(De||{},de),this._active=!1,this._hammer=ue.get(ne,Te),this._dynamics={x:new ie,y:new ie},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}me(Pe),Pe.prototype.destroy=function(){this._hammer.release(),$(this)},Pe.prototype._handleStart=function(ne){ne.preventDefault(),this._active||(this._active=!0,this.emit("active"))},Pe.prototype._handleMove=function(ne){ne.preventDefault(),this._updateDynamics(ne,!1)},Pe.prototype._handleRelease=function(ne){ne.preventDefault(),this._updateDynamics(ne,!0),this._active&&(this._active=!1,this.emit("inactive"))};var ve=[null,null];Pe.prototype._updateDynamics=function(ne,Te){var De=this._element.getBoundingClientRect(),ft=Math.max(De.right-De.left,De.bottom-De.top),Ae=ne.deltaX/ft*this._opts.speed,se=ne.deltaY/ft*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=Ae,this._dynamics.y.velocity=se,Te&&(Q(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,ve),this._dynamics.x.friction=ve[0],this._dynamics.y.friction=ve[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},et.exports=Pe},{"../util/clearOwnProperties":76,"../util/defaults":81,"./Dynamics":39,"./HammerGestures":41,"./util":48,"minimal-event-emitter":14}],45:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("../util/defaults"),Z=Y("../util/clearOwnProperties"),Q={frictionTime:.2,zoomDelta:.001};function $(Pe,ve){this._element=Pe,this._opts=ue(ve||{},Q),this._dynamics=new ie,this._eventList=[],this._wheelListener=(this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing).bind(this),Pe.addEventListener("wheel",this._wheelListener)}function de(Pe){return Pe.deltaY*(1==Pe.deltaMode?20:1)}me($),$.prototype.destroy=function(){this._element.removeEventListener("wheel",this._wheelListener),Z(this)},$.prototype.withoutSmoothing=function(Pe){this._dynamics.offset=de(Pe)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),Pe.preventDefault(),this.emit("active"),this.emit("inactive")},$.prototype.withSmoothing=function(Pe){var ve=Pe.timeStamp;for(this._eventList.push(Pe);this._eventList[0].timeStamp<ve-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var ne=0,Te=0;Te<this._eventList.length;Te++)ne+=de(this._eventList[Te])*this._opts.zoomDelta/this._opts.frictionTime;this._dynamics.velocity=ne,this._dynamics.friction=Math.abs(ne)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),Pe.preventDefault(),this.emit("active"),this.emit("inactive")},et.exports=$},{"../util/clearOwnProperties":76,"../util/defaults":81,"./Dynamics":39,"minimal-event-emitter":14}],46:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("./Dynamics"),ue=Y("../util/clearOwnProperties");function Z(Q){if(!Q)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=Q,this._dynamics=new ie}me(Z),Z.prototype.destroy=function(){ue(this)},Z.prototype.setVelocity=function(Q){this._dynamics.velocity=Q,this.emit("parameterDynamics",this._parameter,this._dynamics)},Z.prototype.setFriction=function(Q){this._dynamics.friction=Q,this.emit("parameterDynamics",this._parameter,this._dynamics)},et.exports=Z},{"../util/clearOwnProperties":76,"./Dynamics":39,"minimal-event-emitter":14}],47:[function(Y,et,B){"use strict";var me=Y("../util/defaults"),ie=Y("./Drag"),ue=Y("./Qtvr"),Z=Y("./ScrollZoom"),Q=Y("./PinchZoom"),$=Y("./Key"),de={mouseViewMode:"drag",dragMode:"pan"};et.exports=function Pe(ve,ne,Te){Te=me(Te||{},de);var De={mouseViewDrag:new ie(ne,"mouse"),mouseViewQtvr:new ue(ne,"mouse"),leftArrowKey:new $(37,"x",-.7,3),rightArrowKey:new $(39,"x",.7,3),upArrowKey:new $(38,"y",-.7,3),downArrowKey:new $(40,"y",.7,3),plusKey:new $(107,"zoom",-.7,3),minusKey:new $(109,"zoom",.7,3),wKey:new $(87,"y",-.7,3),aKey:new $(65,"x",-.7,3),sKey:new $(83,"y",.7,3),dKey:new $(68,"x",.7,3),qKey:new $(81,"roll",.7,3),eKey:new $(69,"roll",-.7,3)},Ke=["scrollZoom","touchView","pinch"];!1!==Te.scrollZoom&&(De.scrollZoom=new Z(ne));var Be={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]};switch(Te.dragMode){case"pinch":De.pinch=new ie(ne,"touch",{hammerEvent:"pinch"});break;case"pan":De.touchView=new ie(ne,"touch"),De.pinch=new Q(ne,"touch");break;default:throw new Error("Unknown drag mode: "+Te.dragMode)}switch(Te.mouseViewMode){case"drag":Ke.push("mouseViewDrag");break;case"qtvr":Ke.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+Te.mouseViewMode)}for(var ft in De)ve.registerMethod(ft,De[ft]),Ke.indexOf(ft)>=0&&ve.enableMethod(ft);for(var se in Be)ve.addMethodGroup(se,Be[se]);return De}},{"../util/defaults":81,"./Drag":38,"./Key":42,"./PinchZoom":43,"./Qtvr":44,"./ScrollZoom":45}],48:[function(Y,et,B){"use strict";function ie(ue,Z,Q,$){var de=Math.atan(Z/ue);$[0]=Q*Math.cos(de),$[1]=Q*Math.sin(de)}et.exports={maxFriction:function me(ue,Z,Q,$,de){var Pe=Math.sqrt(Math.pow(Z,2)+Math.pow(Q,2));ie(Z,Q,ue=Math.max(ue,Pe/$),de),de[0]=Math.abs(de[0]),de[1]=Math.abs(de[1])},changeVectorNorm:ie}},{}],49:[function(Y,et,B){"use strict";var me=Y("../util/inherits"),ie=Y("../util/hash"),ue=Y("../TileSearcher"),Z=Y("../collections/LruMap"),Q=Y("./Level"),$=Y("./common").makeLevelList,de=Y("./common").makeSelectableLevelList,Pe=Y("../util/clamp"),ve=Y("../util/cmp"),ne=Y("../util/type"),Te=Y("gl-matrix").vec3,De=Y("gl-matrix").vec4,Be="fudlrb",ft={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},Ae=Te.create();function se($e,Et,we,he){Et&&Te.rotateZ($e,$e,Ae,Et),we&&Te.rotateX($e,$e,Ae,we),he&&Te.rotateY($e,$e,Ae,he)}for(var Ue={},Oe=0;Oe<Be.length;Oe++){var Ee=Be[Oe],Ve=ft[Ee],oe=Te.fromValues(0,0,-1);se(oe,0,Ve.x,Ve.y),Ue[Ee]=oe}var Ye={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},ze=[[0,1],[1,0],[0,-1],[-1,0]];function We($e,Et,we,he,ae){this.face=$e,this.x=Et,this.y=we,this.z=he,this._geometry=ae,this._level=ae.levelList[he]}function mt($e){if(this.constructor.super_.call(this,$e),this._size=$e.size,this._tileSize=$e.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function Tt($e){if("array"!==ne($e))throw new Error("Level list must be an array");this.levelList=$($e,mt),this.selectableLevelList=de(this.levelList);for(var Et=1;Et<this.levelList.length;Et++)this.levelList[Et]._validateWithParentLevel(this.levelList[Et-1]);this._tileSearcher=new ue(this),this._neighborsCache=new Z(64),this._vec=De.create(),this._viewSize={}}We.prototype.rotX=function(){return ft[this.face].x},We.prototype.rotY=function(){return ft[this.face].y},We.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},We.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},We.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},We.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},We.prototype.vertices=function($e){$e||($e=[Te.create(),Te.create(),Te.create(),Te.create()]);var Et=ft[this.face];function we(ei,si,K){Te.set(ei,si,K,-.5),se(ei,0,Et.x,Et.y)}var he=this.centerX()-this.scaleX()/2,ae=this.centerX()+this.scaleX()/2,vt=this.centerY()-this.scaleY()/2,Pt=this.centerY()+this.scaleY()/2;return we($e[0],he,Pt),we($e[1],ae,Pt),we($e[2],ae,vt),we($e[3],he,vt),$e},We.prototype.parent=function(){if(0===this.z)return null;var Et=this.z,he=this.y,ae=this._geometry,vt=ae.levelList[Et],Pt=ae.levelList[Et-1];return new We(this.face,Math.floor(this.x/vt.numHorizontalTiles()*Pt.numHorizontalTiles()),Math.floor(he/vt.numVerticalTiles()*Pt.numVerticalTiles()),Et-1,ae)},We.prototype.children=function($e){if(this.z===this._geometry.levelList.length-1)return null;var Et=this.face,we=this.z,he=this.x,ae=this.y,vt=this._geometry,Pt=vt.levelList[we],ei=vt.levelList[we+1],si=ei.numHorizontalTiles()/Pt.numHorizontalTiles(),K=ei.numVerticalTiles()/Pt.numVerticalTiles();$e=$e||[];for(var Me=0;Me<si;Me++)for(var _t=0;_t<K;_t++)$e.push(new We(Et,si*he+Me,K*ae+_t,we+1,vt));return $e},We.prototype.neighbors=function(){var $e=this._geometry,Et=$e._neighborsCache,we=Et.get(this);if(we)return we;for(var he=$e._vec,ae=this.face,vt=this.x,Pt=this.y,ei=this.z,si=this._level,K=si.numHorizontalTiles(),Me=si.numVerticalTiles(),_t=[],Jt=0;Jt<ze.length;Jt++){var vi=vt+ze[Jt][0],Ci=Pt+ze[Jt][1],zi=ei,N=ae;if(vi<0||vi>=K||Ci<0||Ci>=Me){var Se,F=this.centerX(),te=this.centerY();vi<0?(Te.set(he,-.5,te,-.5),N=Ye[ae][0]):vi>=K?(Te.set(he,.5,te,-.5),N=Ye[ae][1]):Ci<0?(Te.set(he,F,.5,-.5),N=Ye[ae][2]):Ci>=Me&&(Te.set(he,F,-.5,-.5),N=Ye[ae][3]),se(he,0,(Se=ft[ae]).x,Se.y),se(he,0,-(Se=ft[N]).x,-Se.y),vi=Pe(Math.floor((.5+he[0])*K),0,K-1),Ci=Pe(Math.floor((.5-he[1])*Me),0,Me-1)}_t.push(new We(N,vi,Ci,zi,$e))}return Et.set(this,_t),_t},We.prototype.hash=function(){return ie(Be.indexOf(this.face),this.z,this.y,this.x)},We.prototype.equals=function($e){return this._geometry===$e._geometry&&this.face===$e.face&&this.z===$e.z&&this.y===$e.y&&this.x===$e.x},We.prototype.cmp=function($e){return ve(this.z,$e.z)||ve(Be.indexOf(this.face),Be.indexOf($e.face))||ve(this.y,$e.y)||ve(this.x,$e.x)},We.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"},me(mt,Q),mt.prototype.width=function(){return this._size},mt.prototype.height=function(){return this._size},mt.prototype.tileWidth=function(){return this._tileSize},mt.prototype.tileHeight=function(){return this._tileSize},mt.prototype._validateWithParentLevel=function($e){var Et=this.width(),we=this.height(),he=this.tileWidth(),ae=this.tileHeight(),vt=this.numHorizontalTiles(),Pt=this.numVerticalTiles(),ei=$e.width(),si=$e.height(),K=$e.tileWidth(),Me=$e.tileHeight(),_t=$e.numHorizontalTiles(),Jt=$e.numVerticalTiles();if(Et%ei!=0)throw new Error("Level width must be multiple of parent level: "+Et+" vs. "+ei);if(we%si!=0)throw new Error("Level height must be multiple of parent level: "+we+" vs. "+si);if(vt%_t!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+vt+" ("+Et+"/"+he+") vs. "+_t+" ("+ei+"/"+K+")");if(Pt%Jt!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+Pt+" ("+we+"/"+ae+") vs. "+Jt+" ("+si+"/"+Me+")")},Tt.prototype.maxTileSize=function(){for(var $e=0,Et=0;Et<this.levelList.length;Et++){var we=this.levelList[Et];$e=Math.max($e,we.tileWidth,we.tileHeight)}return $e},Tt.prototype.levelTiles=function($e,Et){var we=this.levelList.indexOf($e),he=$e.numHorizontalTiles()-1,ae=$e.numVerticalTiles()-1;Et=Et||[];for(var vt=0;vt<Be.length;vt++)for(var Pt=Be[vt],ei=0;ei<=he;ei++)for(var si=0;si<=ae;si++)Et.push(new We(Pt,ei,si,we,this));return Et},Tt.prototype._closestTile=function($e,Et){var we=this._vec;De.set(we,0,0,1,1),De.transformMat4(we,we,$e.inverseProjection());var he=1/0,ae=null;for(var vt in Ue){var ei=1-Te.dot(Ue[vt],we);ei<he&&(he=ei,ae=vt)}for(var si=Math.max(Math.abs(we[0]),Math.abs(we[1]),Math.abs(we[2]))/.5,K=0;K<3;K++)we[K]=we[K]/si;var Me=ft[ae];se(we,0,-Me.x,-Me.y);var _t=this.levelList.indexOf(Et),Jt=Et.numHorizontalTiles(),ti=Et.numVerticalTiles();return new We(ae,Pe(Math.floor((.5+we[0])*Jt),0,Jt-1),Pe(Math.floor((.5-we[1])*ti),0,ti-1),_t,this)},Tt.prototype.visibleTiles=function($e,Et,we){var he=this._viewSize,ae=this._tileSearcher;if(we=we||[],$e.size(he),0===he.width||0===he.height)return we;var vt=this._closestTile($e,Et);if(!ae.search($e,vt,we))throw new Error("Starting tile is not visible");return we},Tt.Tile=Tt.prototype.Tile=We,Tt.type=Tt.prototype.type="cube",We.type=We.prototype.type="cube",et.exports=Tt},{"../TileSearcher":22,"../collections/LruMap":28,"../util/clamp":75,"../util/cmp":77,"../util/hash":88,"../util/inherits":89,"../util/type":101,"./Level":52,"./common":53,"gl-matrix":3}],50:[function(Y,et,B){"use strict";var me=Y("../util/inherits"),ie=Y("../util/hash"),ue=Y("../util/cmp"),Z=Y("./common"),Q=Y("./Level"),$=Y("../util/type");function de(ne,Te){this.z=ne,this._geometry=Te,this._level=Te.levelList[ne]}function Pe(ne){this.constructor.super_.call(this,ne),this._width=ne.width}function ve(ne){if("array"!==$(ne))throw new Error("Level list must be an array");this.levelList=Z.makeLevelList(ne,Pe),this.selectableLevelList=Z.makeSelectableLevelList(this.levelList)}de.prototype.rotX=function(){return 0},de.prototype.rotY=function(){return 0},de.prototype.centerX=function(){return.5},de.prototype.centerY=function(){return.5},de.prototype.scaleX=function(){return 1},de.prototype.scaleY=function(){return 1},de.prototype.parent=function(){return 0===this.z?null:new de(this.z-1,this._geometry)},de.prototype.children=function(ne){return this.z===this._geometry.levelList.length-1?null:((ne=ne||[]).push(new de(this.z+1,this._geometry)),ne)},de.prototype.neighbors=function(){return[]},de.prototype.hash=function(){return ie(this.z)},de.prototype.equals=function(ne){return this._geometry===ne._geometry&&this.z===ne.z},de.prototype.cmp=function(ne){return ue(this.z,ne.z)},de.prototype.str=function(){return"EquirectTile("+tile.z+")"},me(Pe,Q),Pe.prototype.width=function(){return this._width},Pe.prototype.height=function(){return this._width/2},Pe.prototype.tileWidth=function(){return this._width},Pe.prototype.tileHeight=function(){return this._width/2},ve.prototype.maxTileSize=function(){for(var ne=0,Te=0;Te<this.levelList.length;Te++){var De=this.levelList[Te];ne=Math.max(ne,De.tileWidth,De.tileHeight)}return ne},ve.prototype.levelTiles=function(ne,Te){var De=this.levelList.indexOf(ne);return(Te=Te||[]).push(new de(De,this)),Te},ve.prototype.visibleTiles=function(ne,Te,De){var Ke=new de(this.levelList.indexOf(Te),this);(De=De||[]).length=0,De.push(Ke)},ve.Tile=ve.prototype.Tile=de,ve.type=ve.prototype.type="equirect",de.type=de.prototype.type="equirect",et.exports=ve},{"../util/cmp":77,"../util/hash":88,"../util/inherits":89,"../util/type":101,"./Level":52,"./common":53}],51:[function(Y,et,B){"use strict";var me=Y("../util/inherits"),ie=Y("../util/hash"),ue=Y("../TileSearcher"),Z=Y("../collections/LruMap"),Q=Y("./Level"),$=Y("./common").makeLevelList,de=Y("./common").makeSelectableLevelList,Pe=Y("../util/clamp"),ve=Y("../util/mod"),ne=Y("../util/cmp"),Te=Y("../util/type"),De=Y("gl-matrix").vec2,Ke=Y("gl-matrix").vec4,ft=[[0,1],[1,0],[0,-1],[-1,0]];function Ae(Oe,Ee,Ve,oe){this.x=Oe,this.y=Ee,this.z=Ve,this._geometry=oe,this._level=oe.levelList[Ve]}function se(Oe){this.constructor.super_.call(this,Oe),this._width=Oe.width,this._height=Oe.height,this._tileWidth=Oe.tileWidth,this._tileHeight=Oe.tileHeight}function Ue(Oe){if("array"!==Te(Oe))throw new Error("Level list must be an array");this.levelList=$(Oe,se),this.selectableLevelList=de(this.levelList);for(var Ee=1;Ee<this.levelList.length;Ee++)this.levelList[Ee]._validateWithParentLevel(this.levelList[Ee-1]);this._tileSearcher=new ue(this),this._neighborsCache=new Z(64),this._vec=Ke.create(),this._viewSize={}}Ae.prototype.rotX=function(){return 0},Ae.prototype.rotY=function(){return 0},Ae.prototype.centerX=function(){var Oe=this._level.width(),Ee=this._level.tileWidth();return(this.x*Ee+.5*this.width())/Oe-.5},Ae.prototype.centerY=function(){var Oe=this._level.height(),Ee=this._level.tileHeight();return.5-(this.y*Ee+.5*this.height())/Oe},Ae.prototype.scaleX=function(){var Oe=this._level.width();return this.width()/Oe},Ae.prototype.scaleY=function(){var Oe=this._level.height();return this.height()/Oe},Ae.prototype.width=function(){var Oe=this._level.width(),Ee=this._level.tileWidth();return this.x===this._level.numHorizontalTiles()-1&&ve(Oe,Ee)||Ee},Ae.prototype.height=function(){var Oe=this._level.height(),Ee=this._level.tileHeight();return this.y===this._level.numVerticalTiles()-1&&ve(Oe,Ee)||Ee},Ae.prototype.levelWidth=function(){return this._level.width()},Ae.prototype.levelHeight=function(){return this._level.height()},Ae.prototype.vertices=function(Oe){Oe||(Oe=[De.create(),De.create(),De.create(),De.create()]);var Ee=this.centerX()-this.scaleX()/2,Ve=this.centerX()+this.scaleX()/2,oe=this.centerY()-this.scaleY()/2,Ye=this.centerY()+this.scaleY()/2;return De.set(Oe[0],Ee,Ye),De.set(Oe[1],Ve,Ye),De.set(Oe[2],Ve,oe),De.set(Oe[3],Ee,oe),Oe},Ae.prototype.parent=function(){if(0===this.z)return null;var Oe=this._geometry,Ee=this.z-1;return new Ae(Math.floor(this.x/2),Math.floor(this.y/2),Ee,Oe)},Ae.prototype.children=function(Oe){if(this.z===this._geometry.levelList.length-1)return null;var Ee=this._geometry,Ve=this.z+1;return(Oe=Oe||[]).push(new Ae(2*this.x,2*this.y,Ve,Ee)),Oe.push(new Ae(2*this.x,2*this.y+1,Ve,Ee)),Oe.push(new Ae(2*this.x+1,2*this.y,Ve,Ee)),Oe.push(new Ae(2*this.x+1,2*this.y+1,Ve,Ee)),Oe},Ae.prototype.neighbors=function(){var Oe=this._geometry,Ee=Oe._neighborsCache,Ve=Ee.get(this);if(Ve)return Ve;for(var oe=this.x,Ye=this.y,ze=this.z,We=this._level,mt=We.numHorizontalTiles()-1,Tt=We.numVerticalTiles()-1,$e=[],Et=0;Et<ft.length;Et++){var ae=oe+ft[Et][0],vt=Ye+ft[Et][1];0<=ae&&ae<=mt&&0<=vt&&vt<=Tt&&$e.push(new Ae(ae,vt,ze,Oe))}return Ee.set(this,$e),$e},Ae.prototype.hash=function(){return ie(this.z,this.y,this.x)},Ae.prototype.equals=function(Oe){return this._geometry===Oe._geometry&&this.z===Oe.z&&this.y===Oe.y&&this.x===Oe.x},Ae.prototype.cmp=function(Oe){return ne(this.z,Oe.z)||ne(this.y,Oe.y)||ne(this.x,Oe.x)},Ae.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"},me(se,Q),se.prototype.width=function(){return this._width},se.prototype.height=function(){return this._height},se.prototype.tileWidth=function(){return this._tileWidth},se.prototype.tileHeight=function(){return this._tileHeight},se.prototype._validateWithParentLevel=function(Oe){var Ee=this.width(),Ve=this.height(),oe=this.tileWidth(),Ye=this.tileHeight(),ze=Oe.width(),We=Oe.height(),mt=Oe.tileWidth(),Tt=Oe.tileHeight();return Ee%ze!=0?new Error("Level width must be multiple of parent level: "+Ee+" vs. "+ze):Ve%We!=0?new Error("Level height must be multiple of parent level: "+Ve+" vs. "+We):oe%mt!=0?new Error("Level tile width must be multiple of parent level: "+oe+" vs. "+mt):Ye%Tt!=0?new Error("Level tile height must be multiple of parent level: "+Ye+" vs. "+Tt):void 0},Ue.prototype.maxTileSize=function(){for(var Oe=0,Ee=0;Ee<this.levelList.length;Ee++){var Ve=this.levelList[Ee];Oe=Math.max(Oe,Ve.tileWidth,Ve.tileHeight)}return Oe},Ue.prototype.levelTiles=function(Oe,Ee){var Ve=this.levelList.indexOf(Oe),oe=Oe.numHorizontalTiles()-1,Ye=Oe.numVerticalTiles()-1;Ee||(Ee=[]);for(var ze=0;ze<=oe;ze++)for(var We=0;We<=Ye;We++)Ee.push(new Ae(ze,We,Ve,this));return Ee},Ue.prototype._closestTile=function(Oe,Ee){var Ve=this._vec;Ke.set(Ve,0,0,1,1),Ke.transformMat4(Ve,Ve,Oe.inverseProjection());var oe=.5+Ve[0],Ye=.5-Ve[1],ze=this.levelList.indexOf(Ee),We=Ee.width(),mt=Ee.height(),Tt=Ee.tileWidth(),$e=Ee.tileHeight(),Et=Ee.numHorizontalTiles(),we=Ee.numVerticalTiles();return new Ae(Pe(Math.floor(oe*We/Tt),0,Et-1),Pe(Math.floor(Ye*mt/$e),0,we-1),ze,this)},Ue.prototype.visibleTiles=function(Oe,Ee,Ve){var oe=this._viewSize,Ye=this._tileSearcher;if(Ve=Ve||[],Oe.size(oe),0===oe.width||0===oe.height)return Ve;var ze=this._closestTile(Oe,Ee);if(!Ye.search(Oe,ze,Ve))throw new Error("Starting tile is not visible");return Ve},Ue.Tile=Ue.prototype.Tile=Ae,Ue.type=Ue.prototype.type="flat",Ae.type=Ae.prototype.type="flat",et.exports=Ue},{"../TileSearcher":22,"../collections/LruMap":28,"../util/clamp":75,"../util/cmp":77,"../util/hash":88,"../util/inherits":89,"../util/mod":91,"../util/type":101,"./Level":52,"./common":53,"gl-matrix":3}],52:[function(Y,et,B){"use strict";function me(ie){this._fallbackOnly=!!ie.fallbackOnly}me.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},me.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},me.prototype.fallbackOnly=function(){return this._fallbackOnly},et.exports=me},{}],53:[function(Y,et,B){"use strict";var me=Y("../util/cmp");et.exports={makeLevelList:function ie(Z,Q){for(var $=[],de=0;de<Z.length;de++)$.push(new Q(Z[de]));return $.sort(function(Pe,ve){return me(Pe.width(),ve.width())}),$},makeSelectableLevelList:function ue(Z){for(var Q=[],$=0;$<Z.length;$++)Z[$]._fallbackOnly||Q.push(Z[$]);if(!Q.length)throw new Error("No selectable levels in list");return Q}}},{"../util/cmp":77}],54:[function(Y,et,B){"use strict";et.exports={WebGlStage:Y("./stages/WebGl"),WebGlCubeRenderer:Y("./renderers/WebGlCube"),WebGlFlatRenderer:Y("./renderers/WebGlFlat"),WebGlEquirectRenderer:Y("./renderers/WebGlEquirect"),registerDefaultRenderers:Y("./renderers/registerDefaultRenderers"),CubeGeometry:Y("./geometries/Cube"),FlatGeometry:Y("./geometries/Flat"),EquirectGeometry:Y("./geometries/Equirect"),RectilinearView:Y("./views/Rectilinear"),FlatView:Y("./views/Flat"),ImageUrlSource:Y("./sources/ImageUrl"),SingleAssetSource:Y("./sources/SingleAsset"),StaticAsset:Y("./assets/Static"),DynamicAsset:Y("./assets/Dynamic"),TextureStore:Y("./TextureStore"),Layer:Y("./Layer"),RenderLoop:Y("./RenderLoop"),KeyControlMethod:Y("./controls/Key"),DragControlMethod:Y("./controls/Drag"),QtvrControlMethod:Y("./controls/Qtvr"),ScrollZoomControlMethod:Y("./controls/ScrollZoom"),PinchZoomControlMethod:Y("./controls/PinchZoom"),VelocityControlMethod:Y("./controls/Velocity"),ElementPressControlMethod:Y("./controls/ElementPress"),Controls:Y("./controls/Controls"),Dynamics:Y("./controls/Dynamics"),Viewer:Y("./Viewer"),Scene:Y("./Scene"),Hotspot:Y("./Hotspot"),HotspotContainer:Y("./HotspotContainer"),colorEffects:Y("./colorEffects"),registerDefaultControls:Y("./controls/registerDefaultControls"),autorotate:Y("./autorotate"),util:{async:Y("./util/async"),cancelize:Y("./util/cancelize"),chain:Y("./util/chain"),clamp:Y("./util/clamp"),clearOwnProperties:Y("./util/clearOwnProperties"),cmp:Y("./util/cmp"),compose:Y("./util/compose"),convertFov:Y("./util/convertFov"),decimal:Y("./util/decimal"),defaults:Y("./util/defaults"),defer:Y("./util/defer"),degToRad:Y("./util/degToRad"),delay:Y("./util/delay"),dom:Y("./util/dom"),extend:Y("./util/extend"),hash:Y("./util/hash"),inherits:Y("./util/inherits"),mod:Y("./util/mod"),noop:Y("./util/noop"),now:Y("./util/now"),once:Y("./util/once"),pixelRatio:Y("./util/pixelRatio"),radToDeg:Y("./util/radToDeg"),real:Y("./util/real"),retry:Y("./util/retry"),tween:Y("./util/tween"),type:Y("./util/type")},dependencies:{bowser:Y("bowser"),glMatrix:Y("gl-matrix"),eventEmitter:Y("minimal-event-emitter"),hammerjs:Y("hammerjs")}}},{"./Hotspot":15,"./HotspotContainer":16,"./Layer":17,"./RenderLoop":19,"./Scene":20,"./TextureStore":21,"./Viewer":24,"./assets/Dynamic":25,"./assets/Static":26,"./autorotate":27,"./colorEffects":34,"./controls/Controls":37,"./controls/Drag":38,"./controls/Dynamics":39,"./controls/ElementPress":40,"./controls/Key":42,"./controls/PinchZoom":43,"./controls/Qtvr":44,"./controls/ScrollZoom":45,"./controls/Velocity":46,"./controls/registerDefaultControls":47,"./geometries/Cube":49,"./geometries/Equirect":50,"./geometries/Flat":51,"./renderers/WebGlCube":58,"./renderers/WebGlEquirect":59,"./renderers/WebGlFlat":60,"./renderers/registerDefaultRenderers":61,"./sources/ImageUrl":66,"./sources/SingleAsset":67,"./stages/WebGl":70,"./util/async":71,"./util/cancelize":73,"./util/chain":74,"./util/clamp":75,"./util/clearOwnProperties":76,"./util/cmp":77,"./util/compose":78,"./util/convertFov":79,"./util/decimal":80,"./util/defaults":81,"./util/defer":82,"./util/degToRad":83,"./util/delay":84,"./util/dom":85,"./util/extend":86,"./util/hash":88,"./util/inherits":89,"./util/mod":91,"./util/noop":92,"./util/now":93,"./util/once":94,"./util/pixelRatio":95,"./util/radToDeg":97,"./util/real":98,"./util/retry":99,"./util/tween":100,"./util/type":101,"./views/Flat":102,"./views/Rectilinear":103,bowser:1,"gl-matrix":3,hammerjs:13,"minimal-event-emitter":14}],55:[function(Y,et,B){"use strict";var me=Y("../assets/Static"),ie=Y("../NetworkError"),ue=Y("bowser"),Z=Y("../util/global"),Q=Y("../util/once"),$=!!Z.createImageBitmap&&!ue.firefox&&!ue.safari,de={imageOrientation:"flipY",premultiplyAlpha:"premultiply"};function Pe(ve){this._stage=ve}Pe.prototype.loadImage=function(ve,ne,Te){var De=this,Ke=new Image;Ke.crossOrigin="anonymous";var Be=ne&&ne.x||0,ft=ne&&ne.y||0,Ae=ne&&ne.width||1,se=ne&&ne.height||1;return Te=Q(Te),Ke.onload=function(){De._handleLoad(Ke,Be,ft,Ae,se,Te)},Ke.onerror=function(){De._handleError(ve,Te)},Ke.src=ve,function Ue(){Ke.onload=Ke.onerror=null,Ke.src="",Te.apply(null,arguments)}},Pe.prototype._handleLoad=function(ve,ne,Te,De,Ke,Be){if(0!==ne||0!==Te||1!==De||1!==Ke)if(ne*=ve.naturalWidth,Te*=ve.naturalHeight,De*=ve.naturalWidth,Ke*=ve.naturalHeight,$)Z.createImageBitmap(ve,ne,Te,De,Ke,de).then(function(se){Be(null,new me(se))});else{var ft=document.createElement("canvas");ft.width=De,ft.height=Ke,ft.getContext("2d").drawImage(ve,ne,Te,De,Ke,0,0,De,Ke),Be(null,new me(ft))}else Be(null,new me(ve))},Pe.prototype._handleError=function(ve,ne){ne(new ie("Network error: "+ve))},et.exports=Pe},{"../NetworkError":18,"../assets/Static":26,"../util/global":87,"../util/once":94,bowser:1}],56:[function(Y,et,B){"use strict";var me=Y("gl-matrix").mat4,ie=Y("gl-matrix").vec3,ue=Y("../util/clearOwnProperties"),Z=Y("./WebGlCommon"),Q=Z.createConstantBuffers,$=Z.destroyConstantBuffers,de=Z.createShaderProgram,Pe=Z.destroyShaderProgram,ve=Z.enableAttributes,ne=Z.disableAttributes,Te=Z.setViewport,De=Z.setupPixelEffectUniforms,Ke=Z.setDepth,Be=Z.setTexture,ft=Y("../shaders/vertexNormal"),Ae=Y("../shaders/fragmentNormal"),se=[0,1,2,0,2,3],Ue=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],Oe=[0,0,1,0,1,1,0,1],Ee=["aVertexPosition","aTextureCoord"],Ve=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function oe(Ye){this.gl=Ye,this.projMatrix=me.create(),this.viewportMatrix=me.create(),this.translateVector=ie.create(),this.scaleVector=ie.create(),this.constantBuffers=Q(Ye,se,Ue,Oe),this.shaderProgram=de(Ye,ft,Ae,Ee,Ve)}oe.prototype.destroy=function(){$(this.gl,this.constantBuffers),Pe(this.gl,this.shaderProgram),ue(this)},oe.prototype.startLayer=function(Ye,ze){var We=this.gl,mt=this.shaderProgram,Tt=this.constantBuffers,$e=this.viewportMatrix;We.useProgram(mt),ve(We,mt),Te(We,Ye,ze,$e),We.uniformMatrix4fv(mt.uViewportMatrix,!1,$e),We.bindBuffer(We.ARRAY_BUFFER,Tt.vertexPositions),We.vertexAttribPointer(mt.aVertexPosition,3,We.FLOAT,We.FALSE,0,0),We.bindBuffer(We.ARRAY_BUFFER,Tt.textureCoords),We.vertexAttribPointer(mt.aTextureCoord,2,We.FLOAT,We.FALSE,0,0),De(We,Ye.effects(),{opacity:mt.uOpacity,colorOffset:mt.uColorOffset,colorMatrix:mt.uColorMatrix})},oe.prototype.endLayer=function(Ye,ze){ne(this.gl,this.shaderProgram)},oe.prototype.renderTile=function(Ye,ze,We,mt){var Tt=this.gl,$e=this.shaderProgram,Et=this.constantBuffers,we=this.projMatrix,he=this.translateVector,ae=this.scaleVector;he[0]=Ye.centerX(),he[1]=Ye.centerY(),he[2]=-.5,ae[0]=Ye.scaleX(),ae[1]=Ye.scaleY(),ae[2]=1,me.copy(we,We.view().projection()),me.rotateX(we,we,Ye.rotX()),me.rotateY(we,we,Ye.rotY()),me.translate(we,we,he),me.scale(we,we,ae),Tt.uniformMatrix4fv($e.uProjMatrix,!1,we),Ke(Tt,$e,mt,Ye.z),Be(Tt,$e,ze),Tt.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,Et.vertexIndices),Tt.drawElements(Tt.TRIANGLES,se.length,Tt.UNSIGNED_SHORT,0)},et.exports=oe},{"../shaders/fragmentNormal":63,"../shaders/vertexNormal":65,"../util/clearOwnProperties":76,"./WebGlCommon":57,"gl-matrix":3}],57:[function(Y,et,B){"use strict";var ue=Y("../util/clamp"),Z=Y("gl-matrix").vec4,Q=Y("gl-matrix").vec3,$=Y("gl-matrix").mat4;function de(ze,We,mt){var Tt=ze.createShader(We);if(ze.shaderSource(Tt,mt),ze.compileShader(Tt),!ze.getShaderParameter(Tt,ze.COMPILE_STATUS))throw ze.getShaderInfoLog(Tt);return Tt}function ne(ze,We,mt,Tt){var $e=ze.createBuffer();return ze.bindBuffer(We,$e),ze.bufferData(We,Tt,mt),$e}var Ue=Z.create(),Oe=$.create();$.identity(Oe);var Ve=Q.create(),oe=Q.create();et.exports={createShaderProgram:function Pe(ze,We,mt,Tt,$e){var Et=de(ze,ze.VERTEX_SHADER,We),we=de(ze,ze.FRAGMENT_SHADER,mt),he=ze.createProgram();if(ze.attachShader(he,Et),ze.attachShader(he,we),ze.linkProgram(he),!ze.getProgramParameter(he,ze.LINK_STATUS))throw ze.getProgramInfoLog(he);for(var ae=0;ae<Tt.length;ae++){var vt=Tt[ae];if(he[vt]=ze.getAttribLocation(he,vt),-1===he[vt])throw new Error("Shader program has no "+vt+" attribute")}for(var Pt=0;Pt<$e.length;Pt++){var ei=$e[Pt];if(he[ei]=ze.getUniformLocation(he,ei),-1===he[ei])throw new Error("Shader program has no "+ei+" uniform")}return he},destroyShaderProgram:function ve(ze,We){for(var mt=ze.getAttachedShaders(We),Tt=0;Tt<mt.length;Tt++){var $e=mt[Tt];ze.detachShader(We,$e),ze.deleteShader($e)}ze.deleteProgram(We)},createConstantBuffers:function Te(ze,We,mt,Tt){return{vertexIndices:ne(ze,ze.ELEMENT_ARRAY_BUFFER,ze.STATIC_DRAW,new Uint16Array(We)),vertexPositions:ne(ze,ze.ARRAY_BUFFER,ze.STATIC_DRAW,new Float32Array(mt)),textureCoords:ne(ze,ze.ARRAY_BUFFER,ze.STATIC_DRAW,new Float32Array(Tt))}},destroyConstantBuffers:function De(ze,We){ze.deleteBuffer(We.vertexIndices),ze.deleteBuffer(We.vertexPositions),ze.deleteBuffer(We.textureCoords)},enableAttributes:function Ke(ze,We){for(var mt=ze.getProgramParameter(We,ze.ACTIVE_ATTRIBUTES),Tt=0;Tt<mt;Tt++)ze.enableVertexAttribArray(Tt)},disableAttributes:function Be(ze,We){for(var mt=ze.getProgramParameter(We,ze.ACTIVE_ATTRIBUTES),Tt=0;Tt<mt;Tt++)ze.disableVertexAttribArray(Tt)},setTexture:function ft(ze,We,mt){ze.activeTexture(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,mt._texture),ze.uniform1i(We.uSampler,0)},setDepth:function Ae(ze,We,mt,Tt){ze.uniform1f(We.uDepth,(256*(mt+1)-Tt)/65536)},setViewport:function Ye(ze,We,mt,Tt){if(0===mt.x&&1===mt.width&&0===mt.y&&1===mt.height)return ze.viewport(0,0,ze.drawingBufferWidth,ze.drawingBufferHeight),void $.identity(Tt);var $e=mt.x,Et=ue($e,0,1),we=Et-$e,ae=ue(mt.width-we,0,1-Et),vt=mt.width-ae,Pt=1-mt.height-mt.y,ei=ue(Pt,0,1),si=ei-Pt,Me=ue(mt.height-si,0,1-ei),_t=mt.height-Me;Q.set(oe,mt.width/ae,mt.height/Me,1),Q.set(Ve,(vt-we)/ae,(_t-si)/Me,0),$.identity(Tt),$.translate(Tt,Tt,Ve),$.scale(Tt,Tt,oe),ze.viewport(ze.drawingBufferWidth*Et,ze.drawingBufferHeight*ei,ze.drawingBufferWidth*ae,ze.drawingBufferHeight*Me)},setupPixelEffectUniforms:function Ee(ze,We,mt){var Tt=1;We&&null!=We.opacity&&(Tt=We.opacity),ze.uniform1f(mt.opacity,Tt);var $e=Ue;We&&We.colorOffset&&($e=We.colorOffset),ze.uniform4fv(mt.colorOffset,$e);var Et=Oe;We&&We.colorMatrix&&(Et=We.colorMatrix),ze.uniformMatrix4fv(mt.colorMatrix,!1,Et)}}},{"../util/clamp":75,"gl-matrix":3}],58:[function(Y,et,B){"use strict";var me=Y("./WebGlBase");function ue(){this.constructor.super_.apply(this,arguments)}Y("../util/inherits")(ue,me),et.exports=ue},{"../util/inherits":89,"./WebGlBase":56}],59:[function(Y,et,B){"use strict";var me=Y("gl-matrix").mat4,ie=Y("../util/clearOwnProperties"),ue=Y("./WebGlCommon"),Z=ue.createConstantBuffers,Q=ue.destroyConstantBuffers,$=ue.createShaderProgram,de=ue.destroyShaderProgram,Pe=ue.enableAttributes,ve=ue.disableAttributes,ne=ue.setViewport,Te=ue.setupPixelEffectUniforms,De=ue.setDepth,Ke=ue.setTexture,Be=Y("../shaders/vertexEquirect"),ft=Y("../shaders/fragmentEquirect"),Ae=[0,1,2,0,2,3],se=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],Ue=[0,0,1,0,1,1,0,1],Oe=["aVertexPosition"],Ee=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function Ve(oe){this.gl=oe,this.invProjMatrix=me.create(),this.viewportMatrix=me.create(),this.constantBuffers=Z(oe,Ae,se,Ue),this.shaderProgram=$(oe,Be,ft,Oe,Ee)}Ve.prototype.destroy=function(){Q(this.gl,this.constantBuffers),de(this.gl,this.shaderProgram),ie(this)},Ve.prototype.startLayer=function(oe,Ye){var ze=this.gl,We=this.shaderProgram,mt=this.constantBuffers,Tt=this.invProjMatrix,$e=this.viewportMatrix;ze.useProgram(We),Pe(ze,We),ne(ze,oe,Ye,$e),ze.uniformMatrix4fv(We.uViewportMatrix,!1,$e),ze.bindBuffer(ze.ARRAY_BUFFER,mt.vertexPositions),ze.vertexAttribPointer(We.aVertexPosition,3,ze.FLOAT,ze.FALSE,0,0),ze.bindBuffer(ze.ARRAY_BUFFER,mt.textureCoords),me.copy(Tt,oe.view().projection()),me.invert(Tt,Tt),ze.uniformMatrix4fv(We.uInvProjMatrix,!1,Tt);var Et=oe.effects().textureCrop||{},he=null!=Et.y?Et.y:0,ae=null!=Et.width?Et.width:1,vt=null!=Et.height?Et.height:1;ze.uniform1f(We.uTextureX,null!=Et.x?Et.x:0),ze.uniform1f(We.uTextureY,he),ze.uniform1f(We.uTextureWidth,ae),ze.uniform1f(We.uTextureHeight,vt),Te(ze,oe.effects(),{opacity:We.uOpacity,colorOffset:We.uColorOffset,colorMatrix:We.uColorMatrix})},Ve.prototype.endLayer=function(oe,Ye){ve(this.gl,this.shaderProgram)},Ve.prototype.renderTile=function(oe,Ye,ze,We){var mt=this.gl,Tt=this.shaderProgram,$e=this.constantBuffers;De(mt,Tt,We,oe.z),Ke(mt,Tt,Ye),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,$e.vertexIndices),mt.drawElements(mt.TRIANGLES,Ae.length,mt.UNSIGNED_SHORT,0)},et.exports=Ve},{"../shaders/fragmentEquirect":62,"../shaders/vertexEquirect":64,"../util/clearOwnProperties":76,"./WebGlCommon":57,"gl-matrix":3}],60:[function(Y,et,B){"use strict";var me=Y("./WebGlBase");function ue(){this.constructor.super_.apply(this,arguments)}Y("../util/inherits")(ue,me),et.exports=ue},{"../util/inherits":89,"./WebGlBase":56}],61:[function(Y,et,B){"use strict";var me=Y("./WebGlCube"),ie=Y("./WebGlFlat"),ue=Y("./WebGlEquirect");et.exports=function Z(Q){if("webgl"!==Q.type)throw new Error("Unknown stage type: "+Q.type);Q.registerRenderer("flat","flat",ie),Q.registerRenderer("cube","rectilinear",me),Q.registerRenderer("equirect","rectilinear",ue)}},{"./WebGlCube":58,"./WebGlEquirect":59,"./WebGlFlat":60}],62:[function(Y,et,B){"use strict";et.exports=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n")},{}],63:[function(Y,et,B){"use strict";et.exports=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n")},{}],64:[function(Y,et,B){"use strict";et.exports=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join("\n")},{}],65:[function(Y,et,B){"use strict";et.exports=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join("\n")},{}],66:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("../NetworkError"),ue=Y("../collections/WorkPool"),Z=Y("../util/chain"),Q=Y("../util/delay"),$=Y("../util/now"),de={x:"x",y:"y",z:"z",f:"face"};function Te(Ke,Be){this._loadPool=new ue({concurrency:(Be=Be||{}).concurrency||4}),this._retryDelay=Be.retryDelay||1e4,this._retryMap={},this._sourceFromTile=Ke}function De(Ke){return new RegExp("\\{("+Ke+")\\}","g")}me(Te),Te.prototype.loadAsset=function(Ke,Be,ft){var ze,Ae=this,se=this._retryDelay,Ue=this._retryMap,Oe=this._sourceFromTile(Be),Ee=Oe.url,oe=Ke.loadImage.bind(Ke,Ee,Oe.rect),We=Ue[Ee];if(null!=We){var Tt=$()-We;Tt<se?ze=se-Tt:(ze=0,delete Ue[Ee])}var $e=Q.bind(null,ze);return Z($e,function(Et){return Ae._loadPool.push(oe,function(we,he){we?(we instanceof ie&&(Ue[Ee]=$(),Ae.emit("networkError",we,Be)),Et(we,Be)):(delete Ue[Ee],Et(null,Be,he))})})(ft)},Te.fromString=function(Ke,Be){var ft=(Be=Be||{})&&Be.cubeMapPreviewFaceOrder||"bdflru";return new Te(Be.cubeMapPreviewUrl?function Ue(Ee){return 0===Ee.z?function Oe(Ee){var Ve=ft.indexOf(Ee.face)/6;return{url:Be.cubeMapPreviewUrl,rect:{x:0,y:Ve,width:1,height:1/6}}}(Ee):se(Ee)}:se,Be);function se(Ee){var Ve=Ke;for(var oe in de){var Ye=de[oe],ze=De(oe),We=Ee.hasOwnProperty(Ye)?Ee[Ye]:"";Ve=Ve.replace(ze,We)}return{url:Ve}}},et.exports=Te},{"../NetworkError":18,"../collections/WorkPool":32,"../util/chain":74,"../util/delay":84,"../util/now":93,"minimal-event-emitter":14}],67:[function(Y,et,B){"use strict";function me(ie){this._asset=ie}me.prototype.asset=function(){return this._asset},me.prototype.loadAsset=function(ie,ue,Z){var Q=this,$=setTimeout(function(){Z(null,ue,Q._asset)},0);return function de(){clearTimeout($),Z.apply(null,arguments)}},et.exports=me},{}],68:[function(Y,et,B){"use strict";function me(){this._renderers={}}me.prototype.set=function(ie,ue,Z){this._renderers[ie]||(this._renderers[ie]={}),this._renderers[ie][ue]=Z},me.prototype.get=function(ie,ue){return this._renderers[ie]&&this._renderers[ie][ue]||null},et.exports=me},{}],69:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("../collections/WorkQueue"),ue=Y("../util/calcRect"),Z=Y("../util/async"),Q=Y("../util/cancelize"),$=Y("../util/clearOwnProperties"),de=Y("./RendererRegistry");function Pe(Te,De){return Te.cmp(De)}function ve(Te,De){return-Te.cmp(De)}function ne(Te){this._progressive=!(!Te||!Te.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new ie,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new de}me(ne),ne.prototype.destroy=function(){this.removeAllLayers(),$(this)},ne.prototype.registerRenderer=function(Te,De,Ke){return this._rendererRegistry.set(Te,De,Ke)},ne.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},ne.prototype.width=function(){return this._width},ne.prototype.height=function(){return this._height},ne.prototype.size=function(Te){return(Te=Te||{}).width=this._width,Te.height=this._height,Te},ne.prototype.setSize=function(Te){this._width=Te.width,this._height=Te.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},ne.prototype.setSizeForType=function(Te){throw new Error("Stage implementation must override setSizeForType")},ne.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},ne.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},ne.prototype.validateLayer=function(Te){throw new Error("Stage implementation must override validateLayer")},ne.prototype.listLayers=function(){return[].concat(this._layers)},ne.prototype.hasLayer=function(Te){return this._layers.indexOf(Te)>=0},ne.prototype.addLayer=function(Te,De){if(this._layers.indexOf(Te)>=0)throw new Error("Layer already in stage");if(null==De&&(De=this._layers.length),De<0||De>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(Te);var Ke=Te.geometry().type,Be=Te.view().type,ft=this._rendererRegistry.get(Ke,Be);if(!ft)throw new Error("No "+this.type+" renderer avaiable for "+Ke+" geometry and "+Be+" view");var Ae=this.createRenderer(ft);this._layers.splice(De,0,Te),this._renderers.splice(De,0,Ae),Te.addEventListener("viewChange",this._emitRenderInvalid),Te.addEventListener("effectsChange",this._emitRenderInvalid),Te.addEventListener("fixedLevelChange",this._emitRenderInvalid),Te.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},ne.prototype.moveLayer=function(Te,De){var Ke=this._layers.indexOf(Te);if(Ke<0)throw new Error("No such layer in stage");if(De<0||De>=this._layers.length)throw new Error("Invalid layer position");Te=this._layers.splice(Ke,1)[0];var Be=this._renderers.splice(Ke,1)[0];this._layers.splice(De,0,Te),this._renderers.splice(De,0,Be),this._emitRenderInvalid()},ne.prototype.removeLayer=function(Te){var De=this._layers.indexOf(Te);if(De<0)throw new Error("No such layer in stage");var Ke=this._layers.splice(De,1)[0],Be=this._renderers.splice(De,1)[0];this.destroyRenderer(Be),Ke.removeEventListener("viewChange",this._emitRenderInvalid),Ke.removeEventListener("effectsChange",this._emitRenderInvalid),Ke.removeEventListener("fixedLevelChange",this._emitRenderInvalid),Ke.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},ne.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},ne.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},ne.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},ne.prototype.render=function(){var Te,De,Ae,Ke=this._tilesToLoad,Be=this._tilesToRender,ft=!0,se=this._width,Ue=this._height,Oe=this._tmpRect,Ee=this._tmpSize;if(!(se<=0||Ue<=0)){for(this.startFrame(),Te=0;Te<this._layers.length;Te++)this._layers[Te].textureStore().startFrame();for(Te=0;Te<this._layers.length;Te++){var Tt,$e,Ve=this._layers[Te],oe=Ve.effects(),Ye=Ve.view(),ze=Ve.textureStore(),We=this._renderers[Te],mt=this._layers.length-Te;if(ue(se,Ue,oe&&oe.rect,Oe),!(Oe.width<=0||Oe.height<=0)){for(Ee.width=Oe.width*this._width,Ee.height=Oe.height*this._height,Ye.setSize(Ee),We.startLayer(Ve,Oe),Ae=this._collectTiles(Ve,ze),De=0;De<Ke.length;De++)ze.markTile(Tt=Ke[De]);for(De=0;De<Be.length;De++)$e=ze.texture(Tt=Be[De]),We.renderTile(Tt,$e,Ve,mt);Ve.emit("renderComplete",Ae),Ae||(ft=!1),We.endLayer(Ve,Oe)}}for(Te=0;Te<this._layers.length;Te++)this._layers[Te].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",ft)}},ne.prototype._collectTiles=function(Te,De){var Ke=this._tilesToLoad,Be=this._tilesToRender,ft=this._tmpVisible;Ke.length=0,Be.length=0,ft.length=0,Te.visibleTiles(ft);for(var Ae=!0,se=0;se<ft.length;se++){var Oe,Ue=ft[se];this._collectTileToLoad(Ue),De.texture(Ue)?(Oe=!1,this._collectTileToRender(Ue)):(Oe=this._collectChildren(Ue,De),Ae=!1),this._collectParents(Ue,De,Oe)}return Ke.sort(Pe),Be.sort(ve),Ae},ne.prototype._collectChildren=function(Te,De){var Ke=this._tmpChildren,Be=!0;do{if(Ke.length=0,!Te.children(Ke))break;Be=!1;for(var ft=0;ft<Ke.length;ft++)De.texture(Te=Ke[ft])?(this._collectTileToLoad(Te),this._collectTileToRender(Te)):Be=!0}while(Be&&1===Ke.length);return Be},ne.prototype._collectParents=function(Te,De,Ke){for(var Be=this._progressive;(Be||Ke)&&null!=(Te=Te.parent());){if(Ke)if(De.texture(Te))this._collectTileToRender(Te),Ke=!1;else if(!this._progressive)continue;this._collectTileToLoad(Te)||(Be=!1)}return Ke},ne.prototype._collectTileToLoad=function(Te){return this._collectTileIntoList(Te,this._tilesToLoad)},ne.prototype._collectTileToRender=function(Te){return this._collectTileIntoList(Te,this._tilesToRender)},ne.prototype._collectTileIntoList=function(Te,De){for(var Ke=!1,Be=0;Be<De.length;Be++)if(Te.equals(De[Be])){Ke=!0;break}return Ke||De.push(Te),!Ke},ne.prototype.createTexture=function(Te,De,Ke){var Be=this,Ae=Q(Z(function ft(){return new Be.TextureClass(Be,Te,De)}));return this._createTextureWorkQueue.push(Ae,function(se,Ue){Ke(se,Te,De,Ue)})},et.exports=ne},{"../collections/WorkQueue":33,"../util/async":71,"../util/calcRect":72,"../util/cancelize":73,"../util/clearOwnProperties":76,"./RendererRegistry":68,"minimal-event-emitter":14}],70:[function(Y,et,B){"use strict";var me=Y("./Stage"),ie=Y("../loaders/HtmlImage"),ue=Y("bowser"),Z=Y("../util/inherits"),Q=Y("../util/pixelRatio"),$=Y("../util/ispot"),de=Y("../util/dom").setAbsolute,Pe=Y("../util/dom").setFullSize,ve=Y("../util/clearOwnProperties"),ne_videoUseTexImage2D=ue.chrome;function De(Be){var ft=this;this.constructor.super_.call(this,Be=Be||{}),this._generateMipmaps=null!=Be.generateMipmaps&&Be.generateMipmaps,this._loader=new ie(this),this._domElement=document.createElement("canvas"),de(this._domElement),Pe(this._domElement),this._gl=function Te(Be,ft){var Ae={alpha:!0,premultipliedAlpha:!0,antialias:!(!ft||!ft.antialias),preserveDrawingBuffer:!(!ft||!ft.preserveDrawingBuffer)},se=Be.getContext&&(Be.getContext("webgl",Ae)||Be.getContext("experimental-webgl",Ae));if(!se)throw new Error("Could not get WebGL context");return ft.wrapContext&&(se=ft.wrapContext(se)),se}(this._domElement,Be),this._handleContextLoss=function(){ft.emit("webglcontextlost"),ft._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}function Ke(Be,ft,Ae){this._stage=Be,this._gl=Be._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(ft,Ae)}Z(De,me),De.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},De.prototype.domElement=function(){return this._domElement},De.prototype.webGlContext=function(){return this._gl},De.prototype.setSizeForType=function(){var Be=Q();this._domElement.width=Be*this._width,this._domElement.height=Be*this._height},De.prototype.loadImage=function(Be,ft,Ae){return this._loader.loadImage(Be,ft,Ae)},De.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},De.prototype.validateLayer=function(Be){var ft=Be.geometry().maxTileSize(),Ae=this.maxTextureSize();if(ft>Ae)throw new Error("Layer has level with tile size larger than maximum texture size ("+ft+" vs. "+Ae+")")},De.prototype.createRenderer=function(Be){for(var ft=this._rendererInstances,Ae=0;Ae<ft.length;Ae++)if(ft[Ae]instanceof Be)return ft[Ae];var se=new Be(this._gl);return ft.push(se),se},De.prototype.destroyRenderer=function(Be){var ft=this._rendererInstances;if(this._renderers.indexOf(Be)<0){Be.destroy();var Ae=ft.indexOf(Be);Ae>=0&&ft.splice(Ae,1)}},De.prototype.startFrame=function(){var Be=this._gl;if(!Be)throw new Error("Bad WebGL context - maybe context was lost?");Be.viewport(0,0,Be.drawingBufferWidth,Be.drawingBufferHeight),Be.clearColor(0,0,0,0),Be.clear(Be.COLOR_BUFFER_BIT|Be.DEPTH_BUFFER_BIT),Be.enable(Be.DEPTH_TEST),Be.enable(Be.BLEND),Be.blendFunc(Be.ONE,Be.ONE_MINUS_SRC_ALPHA)},De.prototype.endFrame=function(){},De.prototype.takeSnapshot=function(Be){("object"!=typeof Be||null==Be)&&(Be={});var ft=Be.quality;if(typeof ft>"u"&&(ft=75),"number"!=typeof ft||ft<0||ft>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",ft/100)},De.type=De.prototype.type="webgl",Ke.prototype.refresh=function(Be,ft){var Ue,Ae=this._gl,se=this._stage,Oe=ft.timestamp();if(Oe!==this._timestamp){var Ee=ft.element(),Ve=ft.width(),oe=ft.height();if(Ve!==this._width||oe!==this._height){var Ye=se.maxTextureSize();if(Ve>Ye)throw new Error("Texture width larger than max size ("+Ve+" vs. "+Ye+")");if(oe>Ye)throw new Error("Texture height larger than max size ("+oe+" vs. "+Ye+")");this._texture&&Ae.deleteTexture(Ue),Ue=this._texture=Ae.createTexture(),Ae.bindTexture(Ae.TEXTURE_2D,Ue),Ae.pixelStorei(Ae.UNPACK_FLIP_Y_WEBGL,!0),Ae.pixelStorei(Ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,Ae.RGBA,Ae.UNSIGNED_BYTE,Ee)}else Ae.bindTexture(Ae.TEXTURE_2D,Ue=this._texture),Ae.pixelStorei(Ae.UNPACK_FLIP_Y_WEBGL,!0),Ae.pixelStorei(Ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),Ee instanceof HTMLVideoElement&&ne_videoUseTexImage2D?Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,Ae.RGBA,Ae.UNSIGNED_BYTE,Ee):Ae.texSubImage2D(Ae.TEXTURE_2D,0,0,0,Ae.RGBA,Ae.UNSIGNED_BYTE,Ee);se._generateMipmaps&&$(Ve)&&$(oe)?(Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR_MIPMAP_LINEAR),Ae.generateMipmap(Ae.TEXTURE_2D)):(Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR)),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.bindTexture(Ae.TEXTURE_2D,null),this._timestamp=Oe,this._width=Ve,this._height=oe}},Ke.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),ve(this)},De.TextureClass=De.prototype.TextureClass=Ke,et.exports=De},{"../loaders/HtmlImage":55,"../util/clearOwnProperties":76,"../util/dom":85,"../util/inherits":89,"../util/ispot":90,"../util/pixelRatio":95,"./Stage":69,bowser:1}],71:[function(Y,et,B){"use strict";et.exports=function me(ie){return function(Z){var Q,$;try{$=ie()}catch(de){Q=de}finally{Q?Z(Q):Z(null,$)}}}},{}],72:[function(Y,et,B){"use strict";et.exports=function me(ie,ue,Z,Q){var $,de,ve;return $=null!=Z&&null!=Z.absoluteWidth?Z.absoluteWidth/ie:null!=Z&&null!=Z.relativeWidth?Z.relativeWidth:1,de=Z&&null!=Z.absoluteHeight?Z.absoluteHeight/ue:null!=Z&&null!=Z.relativeHeight?Z.relativeHeight:1,ve=null!=Z&&null!=Z.absoluteY?Z.absoluteY/ue:null!=Z&&null!=Z.relativeY?Z.relativeY:0,(Q=Q||{}).x=null!=Z&&null!=Z.absoluteX?Z.absoluteX/ie:null!=Z&&null!=Z.relativeX?Z.relativeX:0,Q.y=ve,Q.width=$,Q.height=de,Q}},{}],73:[function(Y,et,B){"use strict";var me=Y("./once");et.exports=function ie(ue){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var Q=Array.prototype.slice.call(arguments,0),$=Q[Q.length-1]=me(Q[Q.length-1]);function de(){$.apply(null,arguments)}return ue.apply(null,Q),de}}},{"./once":94}],74:[function(Y,et,B){"use strict";var me=Y("./noop");et.exports=function ie(){var ue=Array.prototype.slice.call(arguments,0);return function(){var Q=ue.slice(0),$=null,de=null,Pe=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],ve=arguments.length?arguments[arguments.length-1]:me;function ne(){var De=arguments[0];if(De)return $=de=null,void ve.apply(null,arguments);if(!Q.length)return $=de=null,void ve.apply(null,arguments);var Ke=$=Q.shift(),Be=Array.prototype.slice.call(arguments,1);Be.push(ne);var ft=$.apply(null,Be);if(Ke===$){if("function"!=typeof ft)throw new Error("chain: chaining on non-cancellable function");de=ft}}function Te(){de&&de.apply(null,arguments)}return Pe.unshift(null),ne.apply(null,Pe),Te}}},{"./noop":92}],75:[function(Y,et,B){"use strict";et.exports=function me(ie,ue,Z){return Math.min(Math.max(ie,ue),Z)}},{}],76:[function(Y,et,B){"use strict";et.exports=function me(ie){for(var ue in ie)ie.hasOwnProperty(ue)&&(ie[ue]=void 0)}},{}],77:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){return ie<ue?-1:ie>ue?1:0}},{}],78:[function(Y,et,B){"use strict";et.exports=function me(){var ie=arguments;return function(Z){for(var Q=Z,$=0;$<ie.length;$++)Q=ie[$].call(null,Q);return Q}}},{}],79:[function(Y,et,B){"use strict";function me(Pe,ve,ne){return 2*Math.atan(ne*Math.tan(Pe/2)/ve)}et.exports={convert:me,htov:function ie(Pe,ve,ne){return me(Pe,ve,ne)},htod:function ue(Pe,ve,ne){return me(Pe,ve,Math.sqrt(ve*ve+ne*ne))},vtoh:function Z(Pe,ve,ne){return me(Pe,ne,ve)},vtod:function Q(Pe,ve,ne){return me(Pe,ne,Math.sqrt(ve*ve+ne*ne))},dtoh:function $(Pe,ve,ne){return me(Pe,Math.sqrt(ve*ve+ne*ne),ve)},dtov:function de(Pe,ve,ne){return me(Pe,Math.sqrt(ve*ve+ne*ne),ne)}}},{}],80:[function(Y,et,B){"use strict";et.exports=function me(ie){return ie.toPrecision(15)}},{}],81:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){for(var Z in ue)Z in ie||(ie[Z]=ue[Z]);return ie}},{}],82:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){setTimeout(function Z(){ue&&ue.length>0?ie.apply(null,ue):ie()},0)}},{}],83:[function(Y,et,B){"use strict";et.exports=function me(ie){return ie*Math.PI/180}},{}],84:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){var Z=null;return Z=setTimeout(function Q(){null!=Z&&(Z=null,ue(null))},ie),function $(){null!=Z&&(clearTimeout(Z),Z=null,ue.apply(null,arguments))}}},{}],85:[function(Y,et,B){"use strict";function me(Ae){for(var se=document.documentElement.style,Ue=["Moz","Webkit","Khtml","O","ms"],Oe=0;Oe<Ue.length;Oe++){var oe=Ue[Oe]+(Ae[0].toUpperCase()+Ae.slice(1));if(oe in se)return oe}return Ae}function ue(Ae){var se=me(Ae);return function(Oe,Ee){return Oe.style[se]=Ee}}var Z=ue("transform"),Q=ue("transformOrigin");et.exports={prefixProperty:me,getWithVendorPrefix:function ie(Ae){var se=me(Ae);return function(Oe){return Oe.style[se]}},setWithVendorPrefix:ue,setTransform:Z,setTransformOrigin:Q,setNullTransform:function $(Ae){Z(Ae,"translateZ(0)")},setNullTransformOrigin:function de(Ae){Q(Ae,"0 0 0")},setAbsolute:function Pe(Ae){Ae.style.position="absolute"},setPixelPosition:function ve(Ae,se,Ue){Ae.style.left=se+"px",Ae.style.top=Ue+"px"},setPixelSize:function ne(Ae,se,Ue){Ae.style.width=se+"px",Ae.style.height=Ue+"px"},setNullSize:function Te(Ae){Ae.style.width=Ae.style.height=0},setFullSize:function De(Ae){Ae.style.width=Ae.style.height="100%"},setOverflowHidden:function Ke(Ae){Ae.style.overflow="hidden"},setOverflowVisible:function Be(Ae){Ae.style.overflow="visible"},setNoPointerEvents:function ft(Ae){Ae.style.pointerEvents="none"}}},{}],86:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){for(var Z in ue)ie[Z]=ue[Z];return ie}},{}],87:[function(Y,et,B){(function(me){(function(){"use strict";var ie=typeof window<"u"?window:typeof self<"u"?self:typeof me<"u"?me:null;et.exports=ie}).call(this)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],88:[function(Y,et,B){"use strict";et.exports=function me(){for(var ie=0,ue=0;ue<arguments.length;ue++){var Z=arguments[ue];ie+=Z,ie+=Z<<10,ie^=Z>>6}return ie+=ie<<3,ie^=ie>>11,(ie+=ie<<15)>=0?ie:-ie}},{}],89:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){ie.super_=ue;var Z=function(){};Z.prototype=ue.prototype,ie.prototype=new Z,ie.prototype.constructor=ie}},{}],90:[function(Y,et,B){"use strict";et.exports=function me(ie){return 0==(ie&ie-1)}},{}],91:[function(Y,et,B){"use strict";et.exports=function me(ie,ue){return(+ie%(ue=+ue)+ue)%ue}},{}],92:[function(Y,et,B){"use strict";et.exports=function me(){}},{}],93:[function(Y,et,B){"use strict";et.exports=function me(){return typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return Date.now()}}()},{}],94:[function(Y,et,B){"use strict";et.exports=function me(ie){var Z,ue=!1;return function(){return ue||(ue=!0,Z=ie.apply(null,arguments)),Z}}},{}],95:[function(Y,et,B){"use strict";et.exports=function ie(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var ue=window.screen;if(ue&&ue.deviceXDPI&&ue.logicalXDPI)return ue.deviceXDPI/ue.logicalXDPI;if(ue&&ue.systemXDPI&&ue.logicalXDPI)return ue.systemXDPI/ue.logicalXDPI}return 1}},{}],96:[function(Y,et,B){"use strict";var me=Y("./dom").setTransform,ie=Y("./decimal");et.exports=function ue(Z,Q,$,de){de=de||"";var Pe="translateX("+ie(Q)+"px) translateY("+ie($)+"px) translateZ(0) "+de;me(Z,Pe)}},{"./decimal":80,"./dom":85}],97:[function(Y,et,B){"use strict";et.exports=function me(ie){return 180*ie/Math.PI}},{}],98:[function(Y,et,B){"use strict";et.exports=function me(ie){return"number"==typeof ie&&isFinite(ie)}},{}],99:[function(Y,et,B){"use strict";var me=Y("./noop");et.exports=function ie(ue){return function(){var Q=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],$=arguments.length?arguments[arguments.length-1]:me,de=null,Pe=!1;function ve(){var ne=arguments[0];!ne||Pe?$.apply(null,arguments):de=ue.apply(null,Q)}return Q.push(ve),ve(!0),function(){Pe=!0,de.apply(null,arguments)}}}},{"./noop":92}],100:[function(Y,et,B){"use strict";var me=Y("./now");et.exports=function ie(ue,Z,Q){var $=!1,de=me();return Z(0),requestAnimationFrame(function Pe(){if(!$){var ve=(me()-de)/ue;ve<1?(Z(ve),requestAnimationFrame(Pe)):(Z(1),Q())}}),function(){$=!0,Q.apply(null,arguments)}}},{"./now":93}],101:[function(Y,et,B){"use strict";et.exports=function me(ie){var ue=typeof ie;if("object"===ue){if(null===ie)return"null";if("[object Array]"===Object.prototype.toString.call(ie))return"array";if("[object RegExp]"===Object.prototype.toString.call(ie))return"regexp"}return ue}},{}],102:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("gl-matrix").mat4,ue=Y("gl-matrix").vec4,Z=Y("../util/pixelRatio"),Q=Y("../util/real"),$=Y("../util/clamp"),de=Y("../util/clearOwnProperties"),Ke=[1,0,1,0],Be=[-1,-1,1,1];function Ae(se,Ue){if(!se||null==se.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=se&&null!=se.x?se.x:.5,this._y=se&&null!=se.y?se.y:.5,this._zoom=se&&null!=se.zoom?se.zoom:1,this._mediaAspectRatio=se.mediaAspectRatio,this._width=se&&null!=se.width?se.width:0,this._height=se&&null!=se.height?se.height:0,this._limiter=Ue||null,this._projMatrix=ie.create(),this._invProjMatrix=ie.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=ue.create(),this._update()}me(Ae),Ae.prototype.destroy=function(){de(this)},Ae.prototype.x=function(){return this._x},Ae.prototype.y=function(){return this._y},Ae.prototype.zoom=function(){return this._zoom},Ae.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},Ae.prototype.width=function(){return this._width},Ae.prototype.height=function(){return this._height},Ae.prototype.size=function(se){return(se=se||{}).width=this._width,se.height=this._height,se},Ae.prototype.parameters=function(se){return(se=se||{}).x=this._x,se.y=this._y,se.zoom=this._zoom,se.mediaAspectRatio=this._mediaAspectRatio,se},Ae.prototype.limiter=function(){return this._limiter},Ae.prototype.setX=function(se){this._resetParams(),this._params.x=se,this._update(this._params)},Ae.prototype.setY=function(se){this._resetParams(),this._params.y=se,this._update(this._params)},Ae.prototype.setZoom=function(se){this._resetParams(),this._params.zoom=se,this._update(this._params)},Ae.prototype.offsetX=function(se){this.setX(this._x+se)},Ae.prototype.offsetY=function(se){this.setY(this._y+se)},Ae.prototype.offsetZoom=function(se){this.setZoom(this._zoom+se)},Ae.prototype.setMediaAspectRatio=function(se){this._resetParams(),this._params.mediaAspectRatio=se,this._update(this._params)},Ae.prototype.setSize=function(se){this._resetParams(),this._params.width=se.width,this._params.height=se.height,this._update(this._params)},Ae.prototype.setParameters=function(se){this._resetParams(),this._params.x=se.x,this._params.y=se.y,this._params.zoom=se.zoom,this._params.mediaAspectRatio=se.mediaAspectRatio,this._update(this._params)},Ae.prototype.setLimiter=function(se){this._limiter=se||null,this._update()},Ae.prototype._resetParams=function(){var se=this._params;se.x=null,se.y=null,se.zoom=null,se.mediaAspectRatio=null,se.width=null,se.height=null},Ae.prototype._update=function(se){null==se&&(this._resetParams(),se=this._params);var Ue=this._x,Oe=this._y,Ee=this._zoom,Ve=this._mediaAspectRatio,oe=this._width,Ye=this._height;if(se.x=null!=se.x?se.x:Ue,se.y=null!=se.y?se.y:Oe,se.zoom=null!=se.zoom?se.zoom:Ee,se.mediaAspectRatio=null!=se.mediaAspectRatio?se.mediaAspectRatio:Ve,se.width=null!=se.width?se.width:oe,se.height=null!=se.height?se.height:Ye,this._limiter&&!(se=this._limiter(se)))throw new Error("Bad view limiter");var ze=se.x,We=se.y,mt=se.zoom,Tt=se.mediaAspectRatio,$e=se.width,Et=se.height;if(!(Q(ze)&&Q(We)&&Q(mt)&&Q(Tt)&&Q($e)&&Q(Et)))throw new Error("Bad view - suspect a broken limiter");mt=$(mt,1e-6,1/0),this._x=ze,this._y=We,this._zoom=mt,this._mediaAspectRatio=Tt,this._width=$e,this._height=Et,(ze!==Ue||We!==Oe||mt!==Ee||Tt!==Ve||$e!==oe||Et!==Ye)&&(this._projectionChanged=!0,this.emit("change")),($e!==oe||Et!==Ye)&&this.emit("resize")},Ae.prototype._zoomX=function(){return this._zoom},Ae.prototype._zoomY=function(){var Oe=this._zoom,Ee=Oe*this._mediaAspectRatio/(this._width/this._height);return isNaN(Ee)&&(Ee=Oe),Ee},Ae.prototype.updateWithControlParameters=function(se){var Ue=this.zoom(),Oe=this._zoomX(),Ee=this._zoomY();this.offsetX(se.axisScaledX*Oe+se.x*Ue),this.offsetY(se.axisScaledY*Ee+se.y*Ue),this.offsetZoom(se.zoom*Ue)},Ae.prototype._updateProjection=function(){var se=this._projMatrix,Ue=this._invProjMatrix,Oe=this._frustum;if(this._projectionChanged){var Ee=this._x,Ve=this._y,oe=this._zoomX(),Ye=this._zoomY(),ze=Oe[0]=.5-Ve+.5*Ye,We=Oe[1]=Ee-.5+.5*oe,mt=Oe[2]=.5-Ve-.5*Ye,Tt=Oe[3]=Ee-.5-.5*oe;ie.ortho(se,Tt,We,mt,ze,-1,1),ie.invert(Ue,se),this._projectionChanged=!1}},Ae.prototype.projection=function(){return this._updateProjection(),this._projMatrix},Ae.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},Ae.prototype.intersects=function(se){this._updateProjection();for(var Ue=this._frustum,Oe=0;Oe<Ue.length;Oe++){for(var Ee=Ue[Oe],Ve=Ke[Oe],oe=Be[Oe],Ye=!1,ze=0;ze<se.length;ze++){var We=se[ze];if(oe<0&&We[Ve]<Ee||oe>0&&We[Ve]>Ee){Ye=!0;break}}if(!Ye)return!1}return!0},Ae.prototype.selectLevel=function(se){for(var Ue=Z()*this.width(),Oe=this._zoom,Ee=0;Ee<se.length;Ee++){var Ve=se[Ee];if(Oe*Ve.width()>=Ue)return Ve}return se[se.length-1]},Ae.prototype.coordinatesToScreen=function(se,Ue){var Oe=this._vec;Ue||(Ue={});var Ee=this._width,Ve=this._height;if(Ee<=0||Ve<=0)return Ue.x=null,Ue.y=null,null;ue.set(Oe,(se&&null!=se.x?se.x:.5)-.5,.5-(se&&null!=se.y?se.y:.5),-1,1),ue.transformMat4(Oe,Oe,this.projection());for(var ze=0;ze<3;ze++)Oe[ze]/=Oe[3];return Ue.x=Ee*(Oe[0]+1)/2,Ue.y=Ve*(1-Oe[1])/2,Ue},Ae.prototype.screenToCoordinates=function(se,Ue){var Oe=this._vec;return Ue||(Ue={}),ue.set(Oe,2*se.x/this._width-1,1-2*se.y/this._height,1,1),ue.transformMat4(Oe,Oe,this.inverseProjection()),Ue.x=.5+Oe[0],Ue.y=.5-Oe[1],Ue},Ae.limit={x:function(se,Ue){return function(Ee){return Ee.x=$(Ee.x,se,Ue),Ee}},y:function(se,Ue){return function(Ee){return Ee.y=$(Ee.y,se,Ue),Ee}},zoom:function(se,Ue){return function(Ee){return Ee.zoom=$(Ee.zoom,se,Ue),Ee}},resolution:function(se){return function(Oe){if(Oe.width<=0||Oe.height<=0)return Oe;var Ee=Oe.width,Ve=Z()*Ee/se;return Oe.zoom=$(Oe.zoom,Ve,1/0),Oe}},visibleX:function(se,Ue){return function(Ee){var Ve=Ue-se;return Ee.zoom>Ve&&(Ee.zoom=Ve),Ee.x=$(Ee.x,se+.5*Ee.zoom,Ue-.5*Ee.zoom),Ee}},visibleY:function(se,Ue){return function(Ee){if(Ee.width<=0||Ee.height<=0)return Ee;var oe=Ee.width/Ee.height/Ee.mediaAspectRatio,Ye=(Ue-se)*oe;return Ee.zoom>Ye&&(Ee.zoom=Ye),Ee.y=$(Ee.y,se+.5*Ee.zoom/oe,Ue-.5*Ee.zoom/oe),Ee}},letterbox:function(){return function(Ue){if(Ue.width<=0||Ue.height<=0)return Ue;var oe,Ye,ze,We,Oe=Ue.width/Ue.height,Ve=Oe/Ue.mediaAspectRatio;return Ue.mediaAspectRatio>=Oe&&(Ue.zoom=Math.min(Ue.zoom,1)),Ue.mediaAspectRatio<=Oe&&(Ue.zoom=Math.min(Ue.zoom,Ve)),Ue.zoom>1?oe=Ye=.5:(oe=0+.5*Ue.zoom/1,Ye=1-.5*Ue.zoom/1),Ue.zoom>Ve?ze=We=.5:(ze=0+.5*Ue.zoom/Ve,We=1-.5*Ue.zoom/Ve),Ue.x=$(Ue.x,oe,Ye),Ue.y=$(Ue.y,ze,We),Ue}}},Ae.type=Ae.prototype.type="flat",et.exports=Ae},{"../util/clamp":75,"../util/clearOwnProperties":76,"../util/pixelRatio":95,"../util/real":98,"gl-matrix":3,"minimal-event-emitter":14}],103:[function(Y,et,B){"use strict";var me=Y("minimal-event-emitter"),ie=Y("gl-matrix").mat4,ue=Y("gl-matrix").vec4,Z=Y("../util/pixelRatio"),Q=Y("../util/convertFov"),$=Y("../util/mod"),de=Y("../util/real"),Pe=Y("../util/clamp"),ve=Y("../util/decimal"),ne=Y("../util/compose"),Te=Y("../util/clearOwnProperties"),se=Math.PI/4;function Ve(oe,Ye){this._yaw=oe&&null!=oe.yaw?oe.yaw:0,this._pitch=oe&&null!=oe.pitch?oe.pitch:0,this._roll=oe&&null!=oe.roll?oe.roll:0,this._fov=oe&&null!=oe.fov?oe.fov:se,this._width=oe&&null!=oe.width?oe.width:0,this._height=oe&&null!=oe.height?oe.height:0,this._projectionCenterX=oe&&null!=oe.projectionCenterX?oe.projectionCenterX:0,this._projectionCenterY=oe&&null!=oe.projectionCenterY?oe.projectionCenterY:0,this._limiter=Ye||null,this._projMatrix=ie.create(),this._invProjMatrix=ie.create(),this._frustum=[ue.create(),ue.create(),ue.create(),ue.create(),ue.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=ue.create(),this._update()}me(Ve),Ve.prototype.destroy=function(){Te(this)},Ve.prototype.yaw=function(){return this._yaw},Ve.prototype.pitch=function(){return this._pitch},Ve.prototype.roll=function(){return this._roll},Ve.prototype.projectionCenterX=function(){return this._projectionCenterX},Ve.prototype.projectionCenterY=function(){return this._projectionCenterY},Ve.prototype.fov=function(){return this._fov},Ve.prototype.width=function(){return this._width},Ve.prototype.height=function(){return this._height},Ve.prototype.size=function(oe){return(oe=oe||{}).width=this._width,oe.height=this._height,oe},Ve.prototype.parameters=function(oe){return(oe=oe||{}).yaw=this._yaw,oe.pitch=this._pitch,oe.roll=this._roll,oe.fov=this._fov,oe},Ve.prototype.limiter=function(){return this._limiter},Ve.prototype.setYaw=function(oe){this._resetParams(),this._params.yaw=oe,this._update(this._params)},Ve.prototype.setPitch=function(oe){this._resetParams(),this._params.pitch=oe,this._update(this._params)},Ve.prototype.setRoll=function(oe){this._resetParams(),this._params.roll=oe,this._update(this._params)},Ve.prototype.setFov=function(oe){this._resetParams(),this._params.fov=oe,this._update(this._params)},Ve.prototype.setProjectionCenterX=function(oe){this._resetParams(),this._params.projectionCenterX=oe,this._update(this._params)},Ve.prototype.setProjectionCenterY=function(oe){this._resetParams(),this._params.projectionCenterY=oe,this._update(this._params)},Ve.prototype.offsetYaw=function(oe){this.setYaw(this._yaw+oe)},Ve.prototype.offsetPitch=function(oe){this.setPitch(this._pitch+oe)},Ve.prototype.offsetRoll=function(oe){this.setRoll(this._roll+oe)},Ve.prototype.offsetFov=function(oe){this.setFov(this._fov+oe)},Ve.prototype.setSize=function(oe){this._resetParams(),this._params.width=oe.width,this._params.height=oe.height,this._update(this._params)},Ve.prototype.setParameters=function(oe){this._resetParams(),this._params.yaw=oe.yaw,this._params.pitch=oe.pitch,this._params.roll=oe.roll,this._params.fov=oe.fov,this._params.projectionCenterX=oe.projectionCenterX,this._params.projectionCenterY=oe.projectionCenterY,this._update(this._params)},Ve.prototype.setLimiter=function(oe){this._limiter=oe||null,this._update()},Ve.prototype._resetParams=function(){var oe=this._params;oe.yaw=null,oe.pitch=null,oe.roll=null,oe.fov=null,oe.width=null,oe.height=null},Ve.prototype._update=function(oe){null==oe&&(this._resetParams(),oe=this._params);var Ye=this._yaw,ze=this._pitch,We=this._roll,mt=this._fov,Tt=this._projectionCenterX,$e=this._projectionCenterY,Et=this._width,we=this._height;if(oe.yaw=null!=oe.yaw?oe.yaw:Ye,oe.pitch=null!=oe.pitch?oe.pitch:ze,oe.roll=null!=oe.roll?oe.roll:We,oe.fov=null!=oe.fov?oe.fov:mt,oe.width=null!=oe.width?oe.width:Et,oe.height=null!=oe.height?oe.height:we,oe.projectionCenterX=null!=oe.projectionCenterX?oe.projectionCenterX:Tt,oe.projectionCenterY=null!=oe.projectionCenterY?oe.projectionCenterY:$e,this._limiter&&!(oe=this._limiter(oe)))throw new Error("Bad view limiter");var he=(oe=this._normalize(oe)).yaw,ae=oe.pitch,vt=oe.roll,Pt=oe.fov,ei=oe.width,si=oe.height,K=oe.projectionCenterX,Me=oe.projectionCenterY;if(!(de(he)&&de(ae)&&de(vt)&&de(Pt)&&de(ei)&&de(si)&&de(K)&&de(Me)))throw new Error("Bad view - suspect a broken limiter");this._yaw=he,this._pitch=ae,this._roll=vt,this._fov=Pt,this._width=ei,this._height=si,this._projectionCenterX=K,this._projectionCenterY=Me,(he!==Ye||ae!==ze||vt!==We||Pt!==mt||ei!==Et||si!==we||K!==Tt||Me!==$e)&&(this._projectionChanged=!0,this.emit("change")),(ei!==Et||si!==we)&&this.emit("resize")},Ve.prototype._normalize=function(oe){this._normalizeCoordinates(oe);var Ye=Q.htov(Math.PI,oe.width,oe.height),ze=isNaN(Ye)?Math.PI:Math.min(Math.PI,Ye);return oe.fov=Pe(oe.fov,1e-6,ze-1e-6),oe},Ve.prototype._normalizeCoordinates=function(oe){return"yaw"in oe&&(oe.yaw=$(oe.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in oe&&(oe.pitch=$(oe.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in oe&&(oe.roll=$(oe.roll-Math.PI,-2*Math.PI)+Math.PI),oe},Ve.prototype.normalizeToClosest=function(oe,Ye){var ze=this._yaw,We=this._pitch,mt=oe.yaw,Tt=oe.pitch,$e=mt-2*Math.PI,Et=mt+2*Math.PI;Math.abs($e-ze)<Math.abs(mt-ze)?mt=$e:Math.abs(Et-ze)<Math.abs(mt-ze)&&(mt=Et);var we=Tt-2*Math.PI,he=Tt+2*Math.PI;return Math.abs(we-We)<Math.abs(Tt-We)?Tt=we:Math.abs(we-We)<Math.abs(Tt-We)&&(Tt=he),(Ye=Ye||{}).yaw=mt,Ye.pitch=Tt,Ye},Ve.prototype.updateWithControlParameters=function(oe){var Ye=this._fov,ze=Q.vtoh(Ye,this._width,this._height);isNaN(ze)&&(ze=Ye),this.offsetYaw(oe.axisScaledX*ze+2*oe.x*ze+oe.yaw),this.offsetPitch(oe.axisScaledY*Ye+2*oe.y*ze+oe.pitch),this.offsetRoll(-oe.roll),this.offsetFov(oe.zoom*Ye)},Ve.prototype._updateProjection=function(){var oe=this._projMatrix,Ye=this._invProjMatrix,ze=this._frustum;if(this._projectionChanged){var We=this._width,mt=this._height,Tt=this._fov,$e=Q.vtoh(Tt,We,mt),Et=We/mt,we=this._projectionCenterX,he=this._projectionCenterY;if(0!==we||0!==he){var ae=Math.atan(2*we*Math.tan($e/2)),vt=Math.atan(2*he*Math.tan(Tt/2)),Pt=this._fovs;Pt.leftDegrees=180*($e/2+ae)/Math.PI,Pt.rightDegrees=180*($e/2-ae)/Math.PI,Pt.upDegrees=180*(Tt/2+vt)/Math.PI,Pt.downDegrees=180*(Tt/2-vt)/Math.PI,ie.perspectiveFromFieldOfView(oe,Pt,-1,1)}else ie.perspective(oe,Tt,Et,-1,1);ie.rotateZ(oe,oe,this._roll),ie.rotateX(oe,oe,this._pitch),ie.rotateY(oe,oe,this._yaw),ie.invert(Ye,oe),this._matrixToFrustum(oe,ze),this._projectionChanged=!1}},Ve.prototype._matrixToFrustum=function(oe,Ye){ue.set(Ye[0],oe[3]+oe[0],oe[7]+oe[4],oe[11]+oe[8],0),ue.set(Ye[1],oe[3]-oe[0],oe[7]-oe[4],oe[11]-oe[8],0),ue.set(Ye[2],oe[3]+oe[1],oe[7]+oe[5],oe[11]+oe[9],0),ue.set(Ye[3],oe[3]-oe[1],oe[7]-oe[5],oe[11]-oe[9],0),ue.set(Ye[4],oe[3]+oe[2],oe[7]+oe[6],oe[11]+oe[10],0)},Ve.prototype.projection=function(){return this._updateProjection(),this._projMatrix},Ve.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},Ve.prototype.intersects=function(oe){this._updateProjection();for(var Ye=this._frustum,ze=this._tmpVec,We=0;We<Ye.length;We++){for(var mt=Ye[We],Tt=!1,$e=0;$e<oe.length;$e++){var Et=oe[$e];ue.set(ze,Et[0],Et[1],Et[2],0),ue.dot(mt,ze)>=0&&(Tt=!0)}if(!Tt)return!1}return!0},Ve.prototype.selectLevel=function(oe){for(var Ye=Z()*this._height,ze=Math.tan(.5*this._fov),We=0;We<oe.length;We++){var mt=oe[We];if(ze*mt.height()>=Ye)return mt}return oe[oe.length-1]},Ve.prototype.coordinatesToScreen=function(oe,Ye){var ze=this._tmpVec;Ye||(Ye={});var We=this._width,mt=this._height;if(We<=0||mt<=0)return Ye.x=null,Ye.y=null,null;var Tt=oe.yaw,$e=oe.pitch,Et=Math.sin(Tt)*Math.cos($e),we=-Math.sin($e),he=-Math.cos(Tt)*Math.cos($e);return ue.set(ze,Et,we,he,1),ue.transformMat4(ze,ze,this.projection()),ze[3]>=0?(Ye.x=We*(ze[0]/ze[3]+1)/2,Ye.y=mt*(1-ze[1]/ze[3])/2,Ye):(Ye.x=null,Ye.y=null,null)},Ve.prototype.screenToCoordinates=function(oe,Ye){var ze=this._tmpVec;Ye||(Ye={}),ue.set(ze,2*oe.x/this._width-1,1-2*oe.y/this._height,1,1),ue.transformMat4(ze,ze,this.inverseProjection());var Et=Math.sqrt(ze[0]*ze[0]+ze[1]*ze[1]+ze[2]*ze[2]);return Ye.yaw=Math.atan2(ze[0],-ze[2]),Ye.pitch=Math.acos(ze[1]/Et)-Math.PI/2,this._normalizeCoordinates(Ye),Ye},Ve.prototype.coordinatesToPerspectiveTransform=function(oe,Ye,ze){ze=ze||"";var We=this._height,mt=this._width,$e=.5*We/Math.tan(this._fov/2),Et="";return Et+="translateX("+ve(mt/2)+"px) ",Et+="translateY("+ve(We/2)+"px) ",Et+="translateX(-50%) translateY(-50%) ",Et+="perspective("+ve($e)+"px) ",Et+="translateZ("+ve($e)+"px) ",Et+="rotateZ("+ve(-this._roll)+"rad) ",Et+="rotateX("+ve(-this._pitch)+"rad) ",Et+="rotateY("+ve(this._yaw)+"rad) ",Et+="rotateY("+ve(-oe.yaw)+"rad) ",Et+="rotateX("+ve(oe.pitch)+"rad) ",(Et+="translateZ("+ve(-Ye)+"px) ")+(ze+" ")},Ve.limit={yaw:function(oe,Ye){return function(We){return We.yaw=Pe(We.yaw,oe,Ye),We}},pitch:function(oe,Ye){return function(We){return We.pitch=Pe(We.pitch,oe,Ye),We}},roll:function(oe,Ye){return function(We){return We.roll=Pe(We.roll,oe,Ye),We}},hfov:function(oe,Ye){return function(We){var mt=We.width,Tt=We.height;if(mt>0&&Tt>0){var $e=Q.htov(oe,mt,Tt),Et=Q.htov(Ye,mt,Tt);We.fov=Pe(We.fov,$e,Et)}return We}},vfov:function(oe,Ye){return function(We){return We.fov=Pe(We.fov,oe,Ye),We}},resolution:function(oe){return function(ze){var We=ze.height;if(We){var mt=Z()*We,Tt=2*Math.atan(mt/oe);ze.fov=Pe(ze.fov,Tt,1/0)}return ze}},traditional:function(oe,Ye,ze){return ze=ze??Ye,ne(Ve.limit.resolution(oe),Ve.limit.vfov(0,Ye),Ve.limit.hfov(0,ze),Ve.limit.pitch(-Math.PI/2,Math.PI/2))}},Ve.type=Ve.prototype.type="rectilinear",et.exports=Ve},{"../util/clamp":75,"../util/clearOwnProperties":76,"../util/compose":78,"../util/convertFov":79,"../util/decimal":80,"../util/mod":91,"../util/pixelRatio":95,"../util/real":98,"gl-matrix":3,"minimal-event-emitter":14}]},{},[54])(54)}),Marzipano.dependencies.eventEmitter(VideoAsset),VideoAsset.prototype.setVideo=function(Nt){var Ni=this;this._videoElement&&this._videoElement.removeEventListener("timeupdate",this._emitChange),this._videoElement=Nt,this._videoElement&&(this._videoElement.addEventListener("timeupdate",this._emitChange),this._emitChangeIfPlayingLoop&&(cancelAnimationFrame(this._emitChangeIfPlayingLoop),this._emitChangeIfPlayingLoop=null),function Ri(){Ni._videoElement.paused||Ni.emit("change"),Ni._destroyed||(Ni._emitChangeIfPlayingLoop=requestAnimationFrame(Ri))}(),this.emit("change"))},VideoAsset.prototype.width=function(){return this._videoElement?this._videoElement.videoWidth:this._emptyCanvas.width},VideoAsset.prototype.height=function(){return this._videoElement?this._videoElement.videoHeight:this._emptyCanvas.height},VideoAsset.prototype.element=function(){return this._videoElement?this._videoElement:this._emptyCanvas},VideoAsset.prototype.isDynamic=function(){return!0},VideoAsset.prototype.timestamp=function(){return this._videoElement&&(this._lastTimestamp=this._videoElement.currentTime),this._lastTimestamp},VideoAsset.prototype.destroy=function(){this._destroyed=!0,this._videoElement&&this._videoElement.removeEventListener("timeupdate",this._emitChange),this._emitChangeIfPlayingLoop&&(cancelAnimationFrame(this._emitChangeIfPlayingLoop),this._emitChangeIfPlayingLoop=null)},function(Nt,Ni){"object"==typeof exports&&typeof module<"u"?module.exports=Ni():"function"==typeof define&&define.amd?define(Ni):(Nt=typeof globalThis<"u"?globalThis:Nt||self).videojs=Ni()}(this,function(){"use strict";for(var Z,Ni={},Ri=function(n,r){return Ni[n]=Ni[n]||[],r&&(Ni[n]=Ni[n].concat(r)),Ni[n]},et=function(n,r){var o=Ri(n).indexOf(r);return!(o<=-1||(Ni[n]=Ni[n].slice(),Ni[n].splice(o,1),0))},me={prefixed:!0},ie=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],ue=ie[0],Q=0;Q<ie.length;Q++)if(ie[Q][1]in document){Z=ie[Q];break}if(Z){for(var $=0;$<Z.length;$++)me[ue[$]]=Z[$];me.prefixed=Z[0]!==ue[0]}var de=[],ne=function ve(c){var r,n="info",o=function(){for(var s=arguments.length,u=new Array(s),d=0;d<s;d++)u[d]=arguments[d];r("log",n,u)};return r=function(n,r){return function(o,e,s){var u=r.levels[e],d=new RegExp("^("+u+")$");if("log"!==o&&s.unshift(o.toUpperCase()+":"),s.unshift(n+":"),de){de.push([].concat(s));var m=de.length-1e3;de.splice(0,m>0?m:0)}if(window.console){var g=window.console[o];!g&&"debug"===o&&(g=window.console.info||window.console.log),g&&u&&d.test(o)&&g[Array.isArray(s)?"apply":"call"](window.console,s)}}}(c,o),o.createLogger=function(e){return ve(c+": "+e)},o.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},o.level=function(e){if("string"==typeof e){if(!o.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');n=e}return n},(o.history=function(){return de?[].concat(de):[]}).filter=function(e){return(de||[]).filter(function(s){return new RegExp(".*"+e+".*").test(s[0])})},o.history.clear=function(){de&&(de.length=0)},o.history.disable=function(){null!==de&&(de.length=0,de=null)},o.history.enable=function(){null===de&&(de=[])},o.error=function(){for(var e=arguments.length,s=new Array(e),u=0;u<e;u++)s[u]=arguments[u];return r("error",n,s)},o.warn=function(){for(var e=arguments.length,s=new Array(e),u=0;u<e;u++)s[u]=arguments[u];return r("warn",n,s)},o.debug=function(){for(var e=arguments.length,s=new Array(e),u=0;u<e;u++)s[u]=arguments[u];return r("debug",n,s)},o}("VIDEOJS"),Te=ne.createLogger,De=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ke(c,n){return c(n={exports:{}},n.exports),n.exports}var Be=Ke(function(c){function n(){return c.exports=n=Object.assign||function(r){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},n.apply(this,arguments)}c.exports=n}),ft=Object.prototype.toString,Ae=function(n){return Ee(n)?Object.keys(n):[]};function se(c,n){Ae(c).forEach(function(r){return n(c[r],r)})}function Oe(c){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return Object.assign?Be.apply(void 0,[c].concat(r)):(r.forEach(function(e){!e||se(e,function(s,u){c[u]=s})}),c)}function Ee(c){return!!c&&"object"==typeof c}function Ve(c){return Ee(c)&&"[object Object]"===ft.call(c)&&c.constructor===Object}function oe(c,n){if(!c||!n)return"";if("function"==typeof window.getComputedStyle){var r;try{r=window.getComputedStyle(c)}catch{return""}return r?r.getPropertyValue(n)||r[n]:""}return""}var c,Ye=window.navigator&&window.navigator.userAgent||"",ze=/AppleWebKit\/([\d.]+)/i.exec(Ye),We=ze?parseFloat(ze.pop()):null,mt=/iPod/i.test(Ye),Tt=(c=Ye.match(/OS (\d+)_/i))&&c[1]?c[1]:null,$e=/Android/i.test(Ye),Et=function(){var c=Ye.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!c)return null;var n=c[1]&&parseFloat(c[1]),r=c[2]&&parseFloat(c[2]);return n&&r?parseFloat(c[1]+"."+c[2]):n||null}(),we=$e&&Et<5&&We<537,he=/Firefox/i.test(Ye),ae=/Edg/i.test(Ye),vt=!ae&&(/Chrome/i.test(Ye)||/CriOS/i.test(Ye)),Pt=function(){var c=Ye.match(/(Chrome|CriOS)\/(\d+)/);return c&&c[2]?parseFloat(c[2]):null}(),ei=function(){var c=/MSIE\s(\d+)\.\d/.exec(Ye),n=c&&parseFloat(c[1]);return!n&&/Trident\/7.0/i.test(Ye)&&/rv:11.0/.test(Ye)&&(n=11),n}(),si=/Safari/i.test(Ye)&&!vt&&!$e&&!ae,K=/Windows/i.test(Ye),Me=Boolean(F()&&("ontouchstart"in window||window.navigator.maxTouchPoints||window.DocumentTouch&&window.document instanceof window.DocumentTouch)),_t=/iPad/i.test(Ye)||si&&Me&&!/iPhone/i.test(Ye),Jt=/iPhone/i.test(Ye)&&!_t,ti=Jt||_t||mt,Ai=(si||ti)&&!vt,vi=Object.freeze({__proto__:null,IS_IPOD:mt,IOS_VERSION:Tt,IS_ANDROID:$e,ANDROID_VERSION:Et,IS_NATIVE_ANDROID:we,IS_FIREFOX:he,IS_EDGE:ae,IS_CHROME:vt,CHROME_VERSION:Pt,IE_VERSION:ei,IS_SAFARI:si,IS_WINDOWS:K,TOUCH_ENABLED:Me,IS_IPAD:_t,IS_IPHONE:Jt,IS_IOS:ti,IS_ANY_SAFARI:Ai});function Ci(c){return"string"==typeof c&&Boolean(c.trim())}function zi(c){if(c.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function F(){return document===window.document}function te(c){return Ee(c)&&1===c.nodeType}function Se(){try{return window.parent!==window.self}catch{return!0}}function j(c){return function(n,r){if(!Ci(n))return document[c](null);Ci(r)&&(r=document.querySelector(r));var o=te(r)?r:document;return o[c]&&o[c](n)}}function ee(c,n,r,o){void 0===c&&(c="div"),void 0===n&&(n={}),void 0===r&&(r={});var e=document.createElement(c);return Object.getOwnPropertyNames(n).forEach(function(s){var u=n[s];-1!==s.indexOf("aria-")||"role"===s||"type"===s?(ne.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+s+" to "+u+"."),e.setAttribute(s,u)):"textContent"===s?v(e,u):(e[s]!==u||"tabIndex"===s)&&(e[s]=u)}),Object.getOwnPropertyNames(r).forEach(function(s){e.setAttribute(s,r[s])}),o&&an(e,o),e}function v(c,n){return typeof c.textContent>"u"?c.innerText=n:c.textContent=n,c}function _(c,n){n.firstChild?n.insertBefore(c,n.firstChild):n.appendChild(c)}function O(c,n){return zi(n),c.classList?c.classList.contains(n):function N(c){return new RegExp("(^|\\s)"+c+"($|\\s)")}(n).test(c.className)}function G(c,n){return c.classList?c.classList.add(n):O(c,n)||(c.className=(c.className+" "+n).trim()),c}function fe(c,n){return c?(c.classList?c.classList.remove(n):(zi(n),c.className=c.className.split(/\s+/).filter(function(r){return r!==n}).join(" ")),c):(ne.warn("removeClass was called with an element that doesn't exist"),null)}function be(c,n,r){var o=O(c,n);if("function"==typeof r&&(r=r(c,n)),"boolean"!=typeof r&&(r=!o),r!==o)return r?G(c,n):fe(c,n),c}function He(c,n){Object.getOwnPropertyNames(n).forEach(function(r){var o=n[r];null===o||typeof o>"u"||!1===o?c.removeAttribute(r):c.setAttribute(r,!0===o?"":o)})}function nt(c){var n={};if(c&&c.attributes&&c.attributes.length>0)for(var o=c.attributes,e=o.length-1;e>=0;e--){var s=o[e].name,u=o[e].value;("boolean"==typeof c[s]||-1!==",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+s+","))&&(u=null!==u),n[s]=u}return n}function lt(c,n){return c.getAttribute(n)}function gt(c,n,r){c.setAttribute(n,r)}function wt(c,n){c.removeAttribute(n)}function St(){document.body.focus(),document.onselectstart=function(){return!1}}function Vt(){document.onselectstart=function(){return!0}}function Ut(c){if(c&&c.getBoundingClientRect&&c.parentNode){var n=c.getBoundingClientRect(),r={};return["bottom","height","left","right","top","width"].forEach(function(o){void 0!==n[o]&&(r[o]=n[o])}),r.height||(r.height=parseFloat(oe(c,"height"))),r.width||(r.width=parseFloat(oe(c,"width"))),r}}function mi(c){if(!c||c&&!c.offsetParent)return{left:0,top:0,width:0,height:0};for(var n=c.offsetWidth,r=c.offsetHeight,o=0,e=0;c.offsetParent&&c!==document[me.fullscreenElement];)o+=c.offsetLeft,e+=c.offsetTop,c=c.offsetParent;return{left:o,top:e,width:n,height:r}}function ui(c,n){var r={x:0,y:0};if(ti)for(var o=c;o&&"html"!==o.nodeName.toLowerCase();){var e=oe(o,"transform");if(/^matrix/.test(e)){var s=e.slice(7,-1).split(/,\s/).map(Number);r.x+=s[4],r.y+=s[5]}else if(/^matrix3d/.test(e)){var u=e.slice(9,-1).split(/,\s/).map(Number);r.x+=u[12],r.y+=u[13]}o=o.parentNode}var d={},m=mi(n.target),g=mi(c),T=g.width,P=n.offsetY-(g.top-m.top),q=n.offsetX-(g.left-m.left);return n.changedTouches&&(q=n.changedTouches[0].pageX-g.left,P=n.changedTouches[0].pageY+g.top,ti&&(q-=r.x,P-=r.y)),d.y=1-Math.max(0,Math.min(1,P/g.height)),d.x=Math.max(0,Math.min(1,q/T)),d}function kt(c){return Ee(c)&&3===c.nodeType}function Oi(c){for(;c.firstChild;)c.removeChild(c.firstChild);return c}function rn(c){return"function"==typeof c&&(c=c()),(Array.isArray(c)?c:[c]).map(function(n){return"function"==typeof n&&(n=n()),te(n)||kt(n)?n:"string"==typeof n&&/\S/.test(n)?document.createTextNode(n):void 0}).filter(function(n){return n})}function an(c,n){return rn(n).forEach(function(r){return c.appendChild(r)}),c}function Zi(c,n){return an(Oi(c),n)}function Fi(c){return void 0===c.button&&void 0===c.buttons||0===c.button&&void 0===c.buttons||"mouseup"===c.type&&0===c.button&&0===c.buttons||!(0!==c.button||1!==c.buttons)}var Vn,Xi=j("querySelector"),Dn=j("querySelectorAll"),On=Object.freeze({__proto__:null,isReal:F,isEl:te,isInFrame:Se,createEl:ee,textContent:v,prependTo:_,hasClass:O,addClass:G,removeClass:fe,toggleClass:be,setAttributes:He,getAttributes:nt,getAttribute:lt,setAttribute:gt,removeAttribute:wt,blockTextSelection:St,unblockTextSelection:Vt,getBoundingClientRect:Ut,findPosition:mi,getPointerPosition:ui,isTextNode:kt,emptyEl:Oi,normalizeContent:rn,appendContent:an,insertContent:Zi,isSingleLeftClick:Fi,$:Xi,$$:Dn}),Un=!1,qn=function(){if(!1!==Vn.options.autoSetup){var n=Array.prototype.slice.call(document.getElementsByTagName("video")),r=Array.prototype.slice.call(document.getElementsByTagName("audio")),o=Array.prototype.slice.call(document.getElementsByTagName("video-js")),e=n.concat(r,o);if(e&&e.length>0)for(var s=0,u=e.length;s<u;s++){var d=e[s];if(!d||!d.getAttribute){Zn(1);break}void 0===d.player&&null!==d.getAttribute("data-setup")&&Vn(d)}else Un||Zn(1)}};function Zn(c,n){!F()||(n&&(Vn=n),window.setTimeout(qn,c))}function Gn(){Un=!0,window.removeEventListener("load",Gn)}F()&&("complete"===document.readyState?Gn():window.addEventListener("load",Gn));var pa,_n=function(n){var r=document.createElement("style");return r.className=n,r},_r=function(n,r){n.styleSheet?n.styleSheet.cssText=r:n.textContent=r},Ma=3;function oa(){return Ma++}window.WeakMap||(pa=function(){function c(){this.vdata="vdata"+Math.floor(window.performance&&window.performance.now()||Date.now()),this.data={}}var n=c.prototype;return n.set=function(o,e){var s=o[this.vdata]||oa();return o[this.vdata]||(o[this.vdata]=s),this.data[s]=e,this},n.get=function(o){var e=o[this.vdata];if(e)return this.data[e];ne("We have no data for this element",o)},n.has=function(o){return o[this.vdata]in this.data},n.delete=function(o){var e=o[this.vdata];e&&(delete this.data[e],delete o[this.vdata])},c}());var Mr=window.WeakMap?new WeakMap:new pa;function Ca(c,n){if(Mr.has(c)){var r=Mr.get(c);0===r.handlers[n].length&&(delete r.handlers[n],c.removeEventListener?c.removeEventListener(n,r.dispatcher,!1):c.detachEvent&&c.detachEvent("on"+n,r.dispatcher)),Object.getOwnPropertyNames(r.handlers).length<=0&&(delete r.handlers,delete r.dispatcher,delete r.disabled),0===Object.getOwnPropertyNames(r).length&&Mr.delete(c)}}function Hr(c,n,r,o){r.forEach(function(e){c(n,e,o)})}function fo(c){if(c.fixed_)return c;function n(){return!0}function r(){return!1}if(!c||!c.isPropagationStopped||!c.isImmediatePropagationStopped){var o=c||window.event;for(var e in c={},o)"layerX"!==e&&"layerY"!==e&&"keyLocation"!==e&&"webkitMovementX"!==e&&"webkitMovementY"!==e&&"path"!==e&&("returnValue"===e&&o.preventDefault||(c[e]=o[e]));if(c.target||(c.target=c.srcElement||document),c.relatedTarget||(c.relatedTarget=c.fromElement===c.target?c.toElement:c.fromElement),c.preventDefault=function(){o.preventDefault&&o.preventDefault(),c.returnValue=!1,o.returnValue=!1,c.defaultPrevented=!0},c.defaultPrevented=!1,c.stopPropagation=function(){o.stopPropagation&&o.stopPropagation(),c.cancelBubble=!0,o.cancelBubble=!0,c.isPropagationStopped=n},c.isPropagationStopped=r,c.stopImmediatePropagation=function(){o.stopImmediatePropagation&&o.stopImmediatePropagation(),c.isImmediatePropagationStopped=n,c.stopPropagation()},c.isImmediatePropagationStopped=r,null!=c.clientX){var s=document.documentElement,u=document.body;c.pageX=c.clientX+(s&&s.scrollLeft||u&&u.scrollLeft||0)-(s&&s.clientLeft||u&&u.clientLeft||0),c.pageY=c.clientY+(s&&s.scrollTop||u&&u.scrollTop||0)-(s&&s.clientTop||u&&u.clientTop||0)}c.which=c.charCode||c.keyCode,null!=c.button&&(c.button=1&c.button?0:4&c.button?1:2&c.button?2:0)}return c.fixed_=!0,c}var Xs,Ha=["touchstart","touchmove"];function xr(c,n,r){if(Array.isArray(n))return Hr(xr,c,n,r);Mr.has(c)||Mr.set(c,{});var o=Mr.get(c);if(o.handlers||(o.handlers={}),o.handlers[n]||(o.handlers[n]=[]),r.guid||(r.guid=oa()),o.handlers[n].push(r),o.dispatcher||(o.disabled=!1,o.dispatcher=function(s,u){if(!o.disabled){s=fo(s);var d=o.handlers[s.type];if(d)for(var m=d.slice(0),g=0,T=m.length;g<T&&!s.isImmediatePropagationStopped();g++)try{m[g].call(c,s,u)}catch(L){ne.error(L)}}}),1===o.handlers[n].length)if(c.addEventListener){var e=!1;(function(){if("boolean"!=typeof Xs){Xs=!1;try{var n=Object.defineProperty({},"passive",{get:function(){Xs=!0}});window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch{}}return Xs})()&&Ha.indexOf(n)>-1&&(e={passive:!0}),c.addEventListener(n,o.dispatcher,e)}else c.attachEvent&&c.attachEvent("on"+n,o.dispatcher)}function mr(c,n,r){if(Mr.has(c)){var o=Mr.get(c);if(o.handlers){if(Array.isArray(n))return Hr(mr,c,n,r);var e=function(g,T){o.handlers[T]=[],Ca(g,T)};if(void 0===n){for(var s in o.handlers)Object.prototype.hasOwnProperty.call(o.handlers||{},s)&&e(c,s);return}var u=o.handlers[n];if(u){if(!r)return void e(c,n);if(r.guid)for(var d=0;d<u.length;d++)u[d].guid===r.guid&&u.splice(d--,1);Ca(c,n)}}}}function qs(c,n,r){var o=Mr.has(c)?Mr.get(c):{},e=c.parentNode||c.ownerDocument;if("string"==typeof n?n={type:n,target:c}:n.target||(n.target=c),n=fo(n),o.dispatcher&&o.dispatcher.call(c,n,r),e&&!n.isPropagationStopped()&&!0===n.bubbles)qs.call(null,e,n,r);else if(!e&&!n.defaultPrevented&&n.target&&n.target[n.type]){Mr.has(n.target)||Mr.set(n.target,{});var s=Mr.get(n.target);n.target[n.type]&&(s.disabled=!0,"function"==typeof n.target[n.type]&&n.target[n.type](),s.disabled=!1)}return!n.defaultPrevented}function As(c,n,r){if(Array.isArray(n))return Hr(As,c,n,r);var o=function e(){mr(c,n,e),r.apply(this,arguments)};o.guid=r.guid=r.guid||oa(),xr(c,n,o)}function Qr(c,n,r){var o=function e(){mr(c,n,e),r.apply(this,arguments)};o.guid=r.guid=r.guid||oa(),xr(c,n,o)}var Qs,Ys=Object.freeze({__proto__:null,fixEvent:fo,on:xr,off:mr,trigger:qs,one:As,any:Qr}),Cn=function(n,r,o){r.guid||(r.guid=oa());var e=r.bind(n);return e.guid=o?o+"_"+r.guid:r.guid,e},zr=function(n,r){var o=window.performance.now();return function(){var u=window.performance.now();u-o>=r&&(n.apply(void 0,arguments),o=u)}},Fn=function(){};Fn.prototype.allowedEvents_={},Fn.prototype.addEventListener=Fn.prototype.on=function(c,n){var r=this.addEventListener;this.addEventListener=function(){},xr(this,c,n),this.addEventListener=r},Fn.prototype.removeEventListener=Fn.prototype.off=function(c,n){mr(this,c,n)},Fn.prototype.one=function(c,n){var r=this.addEventListener;this.addEventListener=function(){},As(this,c,n),this.addEventListener=r},Fn.prototype.any=function(c,n){var r=this.addEventListener;this.addEventListener=function(){},Qr(this,c,n),this.addEventListener=r},Fn.prototype.dispatchEvent=Fn.prototype.trigger=function(c){var n=c.type||c;"string"==typeof c&&(c={type:n}),c=fo(c),this.allowedEvents_[n]&&this["on"+n]&&this["on"+n](c),qs(this,c)},Fn.prototype.queueTrigger=function(c){var n=this;Qs||(Qs=new Map);var r=c.type||c,o=Qs.get(this);o||Qs.set(this,o=new Map);var e=o.get(r);o.delete(r),window.clearTimeout(e);var s=window.setTimeout(function(){0===o.size&&(o=null,Qs.delete(n)),n.trigger(c)},0);o.set(r,s)};var Ks=function(n){return"function"==typeof n.name?n.name():"string"==typeof n.name?n.name:n.name_?n.name_:n.constructor&&n.constructor.name?n.constructor.name:typeof n},Kr=function(n){return n instanceof Fn||!!n.eventBusEl_&&["on","one","off","trigger"].every(function(r){return"function"==typeof n[r]})},ws=function(n){return"string"==typeof n&&/\S/.test(n)||Array.isArray(n)&&!!n.length},Ss=function(n,r,o){if(!n||!n.nodeName&&!Kr(n))throw new Error("Invalid target for "+Ks(r)+"#"+o+"; must be a DOM node or evented object.")},rl=function(n,r,o){if(!ws(n))throw new Error("Invalid event type for "+Ks(r)+"#"+o+"; must be a non-empty string or array.")},al=function(n,r,o){if("function"!=typeof n)throw new Error("Invalid listener for "+Ks(r)+"#"+o+"; must be a function.")},po=function(n,r,o){var s,u,d,e=r.length<3||r[0]===n||r[0]===n.eventBusEl_;return e?(s=n.eventBusEl_,r.length>=3&&r.shift(),u=r[0],d=r[1]):(s=r[0],u=r[1],d=r[2]),Ss(s,n,o),rl(u,n,o),al(d,n,o),{isTargetingSelf:e,target:s,type:u,listener:d=Cn(n,d)}},La=function(n,r,o,e){Ss(n,n,r),n.nodeName?Ys[r](n,o,e):n[r](o,e)},rs={on:function(){for(var n=this,r=arguments.length,o=new Array(r),e=0;e<r;e++)o[e]=arguments[e];var s=po(this,o,"on"),u=s.isTargetingSelf,d=s.target,m=s.type,g=s.listener;if(La(d,"on",m,g),!u){var T=function(){return n.off(d,m,g)};T.guid=g.guid;var L=function(){return n.off("dispose",T)};L.guid=g.guid,La(this,"on","dispose",T),La(d,"on","dispose",L)}},one:function(){for(var n=this,r=arguments.length,o=new Array(r),e=0;e<r;e++)o[e]=arguments[e];var s=po(this,o,"one"),u=s.isTargetingSelf,d=s.target,m=s.type,g=s.listener;if(u)La(d,"one",m,g);else{var T=function L(){n.off(d,m,L);for(var P=arguments.length,q=new Array(P),le=0;le<P;le++)q[le]=arguments[le];g.apply(null,q)};T.guid=g.guid,La(d,"one",m,T)}},any:function(){for(var n=this,r=arguments.length,o=new Array(r),e=0;e<r;e++)o[e]=arguments[e];var s=po(this,o,"any"),u=s.isTargetingSelf,d=s.target,m=s.type,g=s.listener;if(u)La(d,"any",m,g);else{var T=function L(){n.off(d,m,L);for(var P=arguments.length,q=new Array(P),le=0;le<P;le++)q[le]=arguments[le];g.apply(null,q)};T.guid=g.guid,La(d,"any",m,T)}},off:function(n,r,o){if(!n||ws(n))mr(this.eventBusEl_,n,r);else{var e=n,s=r;Ss(e,this,"off"),rl(s,this,"off"),al(o,this,"off"),o=Cn(this,o),this.off("dispose",o),e.nodeName?(mr(e,s,o),mr(e,"dispose",o)):Kr(e)&&(e.off(s,o),e.off("dispose",o))}},trigger:function(n,r){if(Ss(this.eventBusEl_,this,"trigger"),!ws(n&&"string"!=typeof n?n.type:n)){var e="Invalid event type for "+Ks(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!n)throw new Error(e);(this.log||ne).error(e)}return qs(this.eventBusEl_,n,r)}};function su(c,n){void 0===n&&(n={});var o=n.eventBusKey;if(o){if(!c[o].nodeName)throw new Error('The eventBusKey "'+o+'" does not refer to an element.');c.eventBusEl_=c[o]}else c.eventBusEl_=ee("span",{className:"vjs-event-bus"});return Oe(c,rs),c.eventedCallbacks&&c.eventedCallbacks.forEach(function(e){e()}),c.on("dispose",function(){c.off(),[c,c.el_,c.eventBusEl_].forEach(function(e){e&&Mr.has(e)&&Mr.delete(e)}),window.setTimeout(function(){c.eventBusEl_=null},0)}),c}var yc={state:{},setState:function(n){var o,r=this;return"function"==typeof n&&(n=n()),se(n,function(e,s){r.state[s]!==e&&((o=o||{})[s]={from:r.state[s],to:e}),r.state[s]=e}),o&&Kr(this)&&this.trigger({changes:o,type:"statechanged"}),o}};function sl(c,n){return Oe(c,yc),c.state=Oe({},c.state,n),"function"==typeof c.handleStateChanged&&Kr(c)&&c.on("statechanged",c.handleStateChanged),c}var mo=function(n){return"string"!=typeof n?n:n.replace(/./,function(r){return r.toLowerCase()})},rr=function(n){return"string"!=typeof n?n:n.replace(/./,function(r){return r.toUpperCase()})};function Le(){for(var c={},n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.forEach(function(e){!e||se(e,function(s,u){Ve(s)?(Ve(c[u])||(c[u]={}),c[u]=Le(c[u],s)):c[u]=s})}),c}var at=function(){function c(){this.map_={}}var n=c.prototype;return n.has=function(o){return o in this.map_},n.delete=function(o){var e=this.has(o);return delete this.map_[o],e},n.set=function(o,e){return this.map_[o]=e,this},n.forEach=function(o,e){for(var s in this.map_)o.call(e,this.map_[s],s,this)},c}(),Ht=window.Map?window.Map:at,bi=function(){function c(){this.set_={}}var n=c.prototype;return n.has=function(o){return o in this.set_},n.delete=function(o){var e=this.has(o);return delete this.set_[o],e},n.add=function(o){return this.set_[o]=1,this},n.forEach=function(o,e){for(var s in this.set_)o.call(e,s,s,this)},c}(),sn=window.Set?window.Set:bi,wi=Ke(function(c,n){function r(m){if(m&&"object"==typeof m){var g=m.which||m.keyCode||m.charCode;g&&(m=g)}if("number"==typeof m)return u[m];var L,T=String(m);return(L=o[T.toLowerCase()])?L:(L=e[T.toLowerCase()])||(1===T.length?T.charCodeAt(0):void 0)}r.isEventKey=function(g,T){if(g&&"object"==typeof g){var L=g.which||g.keyCode||g.charCode;if(null==L)return!1;if("string"==typeof T){var P;if(P=o[T.toLowerCase()])return P===L;if(P=e[T.toLowerCase()])return P===L}else if("number"==typeof T)return T===L;return!1}};var o=(n=c.exports=r).code=n.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},e=n.aliases={windows:91,"\u21e7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(s=97;s<123;s++)o[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)o[s-48]=s;for(s=1;s<13;s++)o["f"+s]=s+111;for(s=0;s<10;s++)o["numpad "+s]=s+96;var u=n.names=n.title={};for(s in o)u[o[s]]=s;for(var d in e)o[d]=e[d]}),Qt=function(){function c(r,o,e){var s=this;if(this.player_=!r&&this.play?r=this:r,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Le({},this.options_),o=this.options_=Le(this.options_,o),this.id_=o.id||o.el&&o.el.id,!this.id_){var u=r&&r.id&&r.id()||"no_player";this.id_=u+"_component_"+oa()}this.name_=o.name||null,o.el?this.el_=o.el:!1!==o.createEl&&(this.el_=this.createEl()),o.className&&this.el_&&o.className.split(" ").forEach(function(d){return s.addClass(d)}),!1!==o.evented&&(su(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),sl(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new sn,this.setIntervalIds_=new sn,this.rafIds_=new sn,this.namedRafs_=new Ht,this.clearingTimersOnDispose_=!1,!1!==o.initChildren&&this.initChildren(),this.ready(e),!1!==o.reportTouchActivity&&this.enableTouchActivity()}var n=c.prototype;return n.dispose=function(o){if(void 0===o&&(o={}),!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&(o.restoreEl?this.el_.parentNode.replaceChild(o.restoreEl,this.el_):this.el_.parentNode.removeChild(this.el_)),this.el_=null),this.player_=null}},n.isDisposed=function(){return Boolean(this.isDisposed_)},n.player=function(){return this.player_},n.options=function(o){return o?(this.options_=Le(this.options_,o),this.options_):this.options_},n.el=function(){return this.el_},n.createEl=function(o,e,s){return ee(o,e,s)},n.localize=function(o,e,s){void 0===s&&(s=o);var u=this.player_.language&&this.player_.language(),d=this.player_.languages&&this.player_.languages(),m=d&&d[u],g=u&&u.split("-")[0],T=d&&d[g],L=s;return m&&m[o]?L=m[o]:T&&T[o]&&(L=T[o]),e&&(L=L.replace(/\{(\d+)\}/g,function(P,q){var le=e[q-1],_e=le;return typeof le>"u"&&(_e=P),_e})),L},n.handleLanguagechange=function(){},n.contentEl=function(){return this.contentEl_||this.el_},n.id=function(){return this.id_},n.name=function(){return this.name_},n.children=function(){return this.children_},n.getChildById=function(o){return this.childIndex_[o]},n.getChild=function(o){if(o)return this.childNameIndex_[o]},n.getDescendant=function(){for(var o=arguments.length,e=new Array(o),s=0;s<o;s++)e[s]=arguments[s];e=e.reduce(function(m,g){return m.concat(g)},[]);for(var u=this,d=0;d<e.length;d++)if(!(u=u.getChild(e[d]))||!u.getChild)return;return u},n.addChild=function(o,e,s){var u,d;if(void 0===e&&(e={}),void 0===s&&(s=this.children_.length),"string"==typeof o){d=rr(o);var m=e.componentClass||d;e.name=d;var g=c.getComponent(m);if(!g)throw new Error("Component "+m+" does not exist");if("function"!=typeof g)return null;u=new g(this.player_||this,e)}else u=o;if(u.parentComponent_&&u.parentComponent_.removeChild(u),this.children_.splice(s,0,u),u.parentComponent_=this,"function"==typeof u.id&&(this.childIndex_[u.id()]=u),(d=d||u.name&&rr(u.name()))&&(this.childNameIndex_[d]=u,this.childNameIndex_[mo(d)]=u),"function"==typeof u.el&&u.el()){var T=null;this.children_[s+1]&&(this.children_[s+1].el_?T=this.children_[s+1].el_:te(this.children_[s+1])&&(T=this.children_[s+1])),this.contentEl().insertBefore(u.el(),T)}return u},n.removeChild=function(o){if("string"==typeof o&&(o=this.getChild(o)),o&&this.children_){for(var e=!1,s=this.children_.length-1;s>=0;s--)if(this.children_[s]===o){e=!0,this.children_.splice(s,1);break}if(e){o.parentComponent_=null,this.childIndex_[o.id()]=null,this.childNameIndex_[rr(o.name())]=null,this.childNameIndex_[mo(o.name())]=null;var u=o.el();u&&u.parentNode===this.contentEl()&&this.contentEl().removeChild(o.el())}}},n.initChildren=function(){var o=this,e=this.options_.children;if(e){var d,s=this.options_,m=c.getComponent("Tech");(d=Array.isArray(e)?e:Object.keys(e)).concat(Object.keys(this.options_).filter(function(g){return!d.some(function(T){return"string"==typeof T?g===T:g===T.name})})).map(function(g){var T,L;return"string"==typeof g?L=e[T=g]||o.options_[T]||{}:(T=g.name,L=g),{name:T,opts:L}}).filter(function(g){var T=c.getComponent(g.opts.componentClass||rr(g.name));return T&&!m.isTech(T)}).forEach(function(T){var L=T.name,P=T.opts;if(void 0!==s[L]&&(P=s[L]),!1!==P){!0===P&&(P={}),P.playerOptions=o.options_.playerOptions;var q=o.addChild(L,P);q&&(o[L]=q)}})}},n.buildCSSClass=function(){return""},n.ready=function(o,e){if(void 0===e&&(e=!1),o){if(!this.isReady_)return this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(o);e?o.call(this):this.setTimeout(o,1)}},n.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var o=this.readyQueue_;this.readyQueue_=[],o&&o.length>0&&o.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)},n.$=function(o,e){return Xi(o,e||this.contentEl())},n.$$=function(o,e){return Dn(o,e||this.contentEl())},n.hasClass=function(o){return O(this.el_,o)},n.addClass=function(o){G(this.el_,o)},n.removeClass=function(o){fe(this.el_,o)},n.toggleClass=function(o,e){be(this.el_,o,e)},n.show=function(){this.removeClass("vjs-hidden")},n.hide=function(){this.addClass("vjs-hidden")},n.lockShowing=function(){this.addClass("vjs-lock-showing")},n.unlockShowing=function(){this.removeClass("vjs-lock-showing")},n.getAttribute=function(o){return lt(this.el_,o)},n.setAttribute=function(o,e){gt(this.el_,o,e)},n.removeAttribute=function(o){wt(this.el_,o)},n.width=function(o,e){return this.dimension("width",o,e)},n.height=function(o,e){return this.dimension("height",o,e)},n.dimensions=function(o,e){this.width(o,!0),this.height(e)},n.dimension=function(o,e,s){if(void 0!==e)return(null===e||e!=e)&&(e=0),this.el_.style[o]=-1!==(""+e).indexOf("%")||-1!==(""+e).indexOf("px")?e:"auto"===e?"":e+"px",void(s||this.trigger("componentresize"));if(!this.el_)return 0;var u=this.el_.style[o],d=u.indexOf("px");return parseInt(-1!==d?u.slice(0,d):this.el_["offset"+rr(o)],10)},n.currentDimension=function(o){var e=0;if("width"!==o&&"height"!==o)throw new Error("currentDimension only accepts width or height value");if(e=oe(this.el_,o),0===(e=parseFloat(e))||isNaN(e)){var s="offset"+rr(o);e=this.el_[s]}return e},n.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},n.currentWidth=function(){return this.currentDimension("width")},n.currentHeight=function(){return this.currentDimension("height")},n.focus=function(){this.el_.focus()},n.blur=function(){this.el_.blur()},n.handleKeyDown=function(o){this.player_&&(wi.isEventKey(o,"Tab")||o.stopPropagation(),this.player_.handleKeyDown(o))},n.handleKeyPress=function(o){this.handleKeyDown(o)},n.emitTapEvents=function(){var d,o=0,e=null;this.on("touchstart",function(g){1===g.touches.length&&(e={pageX:g.touches[0].pageX,pageY:g.touches[0].pageY},o=window.performance.now(),d=!0)}),this.on("touchmove",function(g){if(g.touches.length>1)d=!1;else if(e){var T=g.touches[0].pageX-e.pageX,L=g.touches[0].pageY-e.pageY;Math.sqrt(T*T+L*L)>10&&(d=!1)}});var m=function(){d=!1};this.on("touchleave",m),this.on("touchcancel",m),this.on("touchend",function(g){e=null,!0===d&&window.performance.now()-o<200&&(g.preventDefault(),this.trigger("tap"))})},n.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,o=Cn(this.player(),this.player().reportUserActivity);this.on("touchstart",function(){o(),this.clearInterval(e),e=this.setInterval(o,250)});var s=function(d){o(),this.clearInterval(e)};this.on("touchmove",o),this.on("touchend",s),this.on("touchcancel",s)}},n.setTimeout=function(o,e){var u,s=this;return o=Cn(this,o),this.clearTimersOnDispose_(),u=window.setTimeout(function(){s.setTimeoutIds_.has(u)&&s.setTimeoutIds_.delete(u),o()},e),this.setTimeoutIds_.add(u),u},n.clearTimeout=function(o){return this.setTimeoutIds_.has(o)&&(this.setTimeoutIds_.delete(o),window.clearTimeout(o)),o},n.setInterval=function(o,e){o=Cn(this,o),this.clearTimersOnDispose_();var s=window.setInterval(o,e);return this.setIntervalIds_.add(s),s},n.clearInterval=function(o){return this.setIntervalIds_.has(o)&&(this.setIntervalIds_.delete(o),window.clearInterval(o)),o},n.requestAnimationFrame=function(o){var s,e=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),o=Cn(this,o),s=window.requestAnimationFrame(function(){e.rafIds_.has(s)&&e.rafIds_.delete(s),o()}),this.rafIds_.add(s),s):this.setTimeout(o,1e3/60)},n.requestNamedAnimationFrame=function(o,e){var s=this;if(!this.namedRafs_.has(o)){this.clearTimersOnDispose_(),e=Cn(this,e);var u=this.requestAnimationFrame(function(){e(),s.namedRafs_.has(o)&&s.namedRafs_.delete(o)});return this.namedRafs_.set(o,u),o}},n.cancelNamedAnimationFrame=function(o){!this.namedRafs_.has(o)||(this.cancelAnimationFrame(this.namedRafs_.get(o)),this.namedRafs_.delete(o))},n.cancelAnimationFrame=function(o){return this.supportsRaf_?(this.rafIds_.has(o)&&(this.rafIds_.delete(o),window.cancelAnimationFrame(o)),o):this.clearTimeout(o)},n.clearTimersOnDispose_=function(){var o=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(e){var u=e[1];o[e[0]].forEach(function(d,m){return o[u](m)})}),o.clearingTimersOnDispose_=!1}))},c.registerComponent=function(o,e){if("string"!=typeof o||!o)throw new Error('Illegal component name, "'+o+'"; must be a non-empty string.');var s=c.getComponent("Tech"),u=s&&s.isTech(e),d=c===e||c.prototype.isPrototypeOf(e.prototype);if(u||!d)throw new Error('Illegal component, "'+o+'"; '+(u?"techs must be registered using Tech.registerTech()":"must be a Component subclass")+".");o=rr(o),c.components_||(c.components_={});var g=c.getComponent("Player");if("Player"===o&&g&&g.players){var T=g.players,L=Object.keys(T);if(T&&L.length>0&&L.map(function(P){return T[P]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return c.components_[o]=e,c.components_[mo(o)]=e,e},c.getComponent=function(o){if(o&&c.components_)return c.components_[o]},c}();Qt.prototype.supportsRaf_="function"==typeof window.requestAnimationFrame&&"function"==typeof window.cancelAnimationFrame,Qt.registerComponent("Component",Qt);var qi=function Dr(c){if(void 0===c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c},Ti=function Zs(c,n){c.prototype=Object.create(n.prototype),c.prototype.constructor=c,c.__proto__=n};function Cf(c,n,r,o){return function Uv(c,n,r){if("number"!=typeof n||n<0||n>r)throw new Error("Failed to execute '"+c+"' on 'TimeRanges': The index provided ("+n+") is non-numeric or out of bounds (0-"+r+").")}(c,o,r.length-1),r[o][n]}function Gh(c){var n;return n=void 0===c||0===c.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:c.length,start:Cf.bind(null,"start",0,c),end:Cf.bind(null,"end",1,c)},window.Symbol&&window.Symbol.iterator&&(n[window.Symbol.iterator]=function(){return(c||[]).values()}),n}function vo(c,n){return Array.isArray(c)?Gh(c):void 0===c||void 0===n?Gh():Gh([[c,n]])}function Pf(c,n){var o,e,r=0;if(!n)return 0;(!c||!c.length)&&(c=vo(0,0));for(var s=0;s<c.length;s++)o=c.start(s),(e=c.end(s))>n&&(e=n),r+=e-o;return r/n}function Zr(c){if(c instanceof Zr)return c;"number"==typeof c?this.code=c:"string"==typeof c?this.message=c:Ee(c)&&("number"==typeof c.code&&(this.code=c.code),Oe(this,c)),this.message||(this.message=Zr.defaultMessages[this.code]||"")}Zr.prototype.code=0,Zr.prototype.message="",Zr.prototype.status=null,Zr.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Zr.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var ol=0;ol<Zr.errorTypes.length;ol++)Zr[Zr.errorTypes[ol]]=ol,Zr.prototype[Zr.errorTypes[ol]]=ol;function ou(c){return null!=c&&"function"==typeof c.then}function ga(c){ou(c)&&c.then(null,function(n){})}var ll=function(n){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(o,e,s){return n[e]&&(o[e]=n[e]),o},{cues:n.cues&&Array.prototype.map.call(n.cues,function(o){return{startTime:o.startTime,endTime:o.endTime,text:o.text,id:o.id}})})},cl="vjs-modal-dialog",$s=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).handleKeyDown_=function(u){return s.handleKeyDown(u)},s.close_=function(u){return s.close(u)},s.opened_=s.hasBeenOpened_=s.hasBeenFilled_=!1,s.closeable(!s.options_.uncloseable),s.content(s.options_.content),s.contentEl_=ee("div",{className:cl+"-content"},{role:"document"}),s.descEl_=ee("p",{className:cl+"-description vjs-control-text",id:s.el().getAttribute("aria-describedby")}),v(s.descEl_,s.description()),s.el_.appendChild(s.descEl_),s.el_.appendChild(s.contentEl_),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},r.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,c.prototype.dispose.call(this)},r.buildCSSClass=function(){return cl+" vjs-hidden "+c.prototype.buildCSSClass.call(this)},r.label=function(){return this.localize(this.options_.label||"Modal Window")},r.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},r.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},r.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},r.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},r.closeable=function(e){if("boolean"==typeof e){var s=this.closeable_=!!e,u=this.getChild("closeButton");if(s&&!u){var d=this.contentEl_;this.contentEl_=this.el_,u=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=d,this.on(u,"close",this.close_)}!s&&u&&(this.off(u,"close",this.close_),this.removeChild(u),u.dispose())}return this.closeable_},r.fill=function(){this.fillWith(this.content())},r.fillWith=function(e){var s=this.contentEl(),u=s.parentNode,d=s.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,u.removeChild(s),this.empty(),Zi(s,e),this.trigger("modalfill"),d?u.insertBefore(s,d):u.appendChild(s);var m=this.getChild("closeButton");m&&u.appendChild(m.el_)},r.empty=function(){this.trigger("beforemodalempty"),Oi(this.contentEl()),this.trigger("modalempty")},r.content=function(e){return typeof e<"u"&&(this.content_=e),this.content_},r.conditionalFocus_=function(){var e=document.activeElement,s=this.player_.el_;this.previouslyActiveEl_=null,(s.contains(e)||s===e)&&(this.previouslyActiveEl_=e,this.focus())},r.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},r.handleKeyDown=function(e){if(e.stopPropagation(),wi.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(wi.isEventKey(e,"Tab")){for(var d,s=this.focusableEls_(),u=this.el_.querySelector(":focus"),m=0;m<s.length;m++)if(u===s[m]){d=m;break}document.activeElement===this.el_&&(d=0),e.shiftKey&&0===d?(s[s.length-1].focus(),e.preventDefault()):!e.shiftKey&&d===s.length-1&&(s[0].focus(),e.preventDefault())}},r.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,function(s){return(s instanceof window.HTMLAnchorElement||s instanceof window.HTMLAreaElement)&&s.hasAttribute("href")||(s instanceof window.HTMLInputElement||s instanceof window.HTMLSelectElement||s instanceof window.HTMLTextAreaElement||s instanceof window.HTMLButtonElement)&&!s.hasAttribute("disabled")||s instanceof window.HTMLIFrameElement||s instanceof window.HTMLObjectElement||s instanceof window.HTMLEmbedElement||s.hasAttribute("tabindex")&&-1!==s.getAttribute("tabindex")||s.hasAttribute("contenteditable")})},n}(Qt);$s.prototype.options_={pauseOnOpen:!0,temporary:!0},Qt.registerComponent("ModalDialog",$s);var yo=function(c){function n(o){var e;void 0===o&&(o=[]),(e=c.call(this)||this).tracks_=[],Object.defineProperty(qi(e),"length",{get:function(){return this.tracks_.length}});for(var s=0;s<o.length;s++)e.addTrack(o[s]);return e}Ti(n,c);var r=n.prototype;return r.addTrack=function(e){var s=this,u=this.tracks_.length;""+u in this||Object.defineProperty(this,u,{get:function(){return this.tracks_[u]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){s.trigger({track:e,type:"labelchange",target:s})},Kr(e)&&e.addEventListener("labelchange",e.labelchange_)},r.removeTrack=function(e){for(var s,u=0,d=this.length;u<d;u++)if(this[u]===e){(s=this[u]).off&&s.off(),this.tracks_.splice(u,1);break}!s||this.trigger({track:s,type:"removetrack",target:this})},r.getTrackById=function(e){for(var s=null,u=0,d=this.length;u<d;u++){var m=this[u];if(m.id===e){s=m;break}}return s},n}(Fn);for(var Vv in yo.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},yo.prototype.allowedEvents_)yo.prototype["on"+Vv]=null;var _o=function(n,r){for(var o=0;o<n.length;o++)!Object.keys(n[o]).length||r.id===n[o].id||(n[o].enabled=!1)},Lf=function(c){function n(o){var e;void 0===o&&(o=[]);for(var s=o.length-1;s>=0;s--)if(o[s].enabled){_o(o,o[s]);break}return(e=c.call(this,o)||this).changing_=!1,e}Ti(n,c);var r=n.prototype;return r.addTrack=function(e){var s=this;e.enabled&&_o(this,e),c.prototype.addTrack.call(this,e),e.addEventListener&&(e.enabledChange_=function(){s.changing_||(s.changing_=!0,_o(s,e),s.changing_=!1,s.trigger("change"))},e.addEventListener("enabledchange",e.enabledChange_))},r.removeTrack=function(e){c.prototype.removeTrack.call(this,e),e.removeEventListener&&e.enabledChange_&&(e.removeEventListener("enabledchange",e.enabledChange_),e.enabledChange_=null)},n}(yo),jh=function(n,r){for(var o=0;o<n.length;o++)!Object.keys(n[o]).length||r.id===n[o].id||(n[o].selected=!1)},Gv=function(c){function n(o){var e;void 0===o&&(o=[]);for(var s=o.length-1;s>=0;s--)if(o[s].selected){jh(o,o[s]);break}return(e=c.call(this,o)||this).changing_=!1,Object.defineProperty(qi(e),"selectedIndex",{get:function(){for(var d=0;d<this.length;d++)if(this[d].selected)return d;return-1},set:function(){}}),e}Ti(n,c);var r=n.prototype;return r.addTrack=function(e){var s=this;e.selected&&jh(this,e),c.prototype.addTrack.call(this,e),e.addEventListener&&(e.selectedChange_=function(){s.changing_||(s.changing_=!0,jh(s,e),s.changing_=!1,s.trigger("change"))},e.addEventListener("selectedchange",e.selectedChange_))},r.removeTrack=function(e){c.prototype.removeTrack.call(this,e),e.removeEventListener&&e.selectedChange_&&(e.removeEventListener("selectedchange",e.selectedChange_),e.selectedChange_=null)},n}(yo),If=function(c){function n(){return c.apply(this,arguments)||this}Ti(n,c);var r=n.prototype;return r.addTrack=function(e){var s=this;c.prototype.addTrack.call(this,e),this.queueChange_||(this.queueChange_=function(){return s.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return s.trigger("selectedlanguagechange")}),e.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(e.kind)&&e.addEventListener("modechange",this.triggerSelectedlanguagechange_)},r.removeTrack=function(e){c.prototype.removeTrack.call(this,e),e.removeEventListener&&(this.queueChange_&&e.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&e.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},n}(yo),Wv=function(){function c(r){void 0===r&&(r=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var o=0,e=r.length;o<e;o++)this.addTrackElement_(r[o])}var n=c.prototype;return n.addTrackElement_=function(o){var e=this.trackElements_.length;""+e in this||Object.defineProperty(this,e,{get:function(){return this.trackElements_[e]}}),-1===this.trackElements_.indexOf(o)&&this.trackElements_.push(o)},n.getTrackElementByTrack_=function(o){for(var e,s=0,u=this.trackElements_.length;s<u;s++)if(o===this.trackElements_[s].track){e=this.trackElements_[s];break}return e},n.removeTrackElement_=function(o){for(var e=0,s=this.trackElements_.length;e<s;e++)if(o===this.trackElements_[e]){this.trackElements_[e].track&&"function"==typeof this.trackElements_[e].track.off&&this.trackElements_[e].track.off(),"function"==typeof this.trackElements_[e].off&&this.trackElements_[e].off(),this.trackElements_.splice(e,1);break}},c}(),Rf=function(){function c(r){c.prototype.setCues_.call(this,r),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var n=c.prototype;return n.setCues_=function(o){var e=this.length||0,s=0,u=o.length;this.cues_=o,this.length_=o.length;var d=function(g){""+g in this||Object.defineProperty(this,""+g,{get:function(){return this.cues_[g]}})};if(e<u)for(s=e;s<u;s++)d.call(this,s)},n.getCueById=function(o){for(var e=null,s=0,u=this.length;s<u;s++){var d=this[s];if(d.id===o){e=d;break}}return e},c}(),jv={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Xv={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},qv={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},xo={disabled:"disabled",hidden:"hidden",showing:"showing"},Xh=function(c){function n(r){var o;void 0===r&&(r={}),o=c.call(this)||this;var e={id:r.id||"vjs_track_"+oa(),kind:r.kind||"",language:r.language||""},s=r.label||"",u=function(g){Object.defineProperty(qi(o),g,{get:function(){return e[g]},set:function(){}})};for(var d in e)u(d);return Object.defineProperty(qi(o),"label",{get:function(){return s},set:function(g){g!==s&&(s=g,this.trigger("labelchange"))}}),o}return Ti(n,c),n}(Fn),lu=function(n){var r=["protocol","hostname","port","pathname","search","hash","host"],o=document.createElement("a");o.href=n;for(var e={},s=0;s<r.length;s++)e[r[s]]=o[r[s]];return"http:"===e.protocol&&(e.host=e.host.replace(/:80$/,"")),"https:"===e.protocol&&(e.host=e.host.replace(/:443$/,"")),e.protocol||(e.protocol=window.location.protocol),e.host||(e.host=window.location.host),e},Df=function(n){if(!n.match(/^https?:\/\//)){var r=document.createElement("a");r.href=n,n=r.href}return n},hl=function(n){if("string"==typeof n){var o=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(n);if(o)return o.pop().toLowerCase()}return""},Js=function(n,r){void 0===r&&(r=window.location);var o=lu(n);return(":"===o.protocol?r.protocol:o.protocol)+o.host!==r.protocol+r.host},Of=Object.freeze({__proto__:null,parseUrl:lu,getAbsoluteURL:Df,getFileExtension:hl,isCrossOrigin:Js}),Hn=typeof window<"u"?window:typeof De<"u"?De:typeof self<"u"?self:{},hn=Object.prototype.toString;Ge.httpHandler=function(n,r){return void 0===r&&(r=!1),function(o,e,s){if(o)n(o);else if(e.statusCode>=400&&e.statusCode<=599){var u=s;if(r)if(Hn.TextDecoder){var d=function dl(c){return void 0===c&&(c=""),c.toLowerCase().split(";").reduce(function(n,r){var o=r.split("="),s=o[1];return"charset"===o[0].trim()?s.trim():n},"utf-8")}(e.headers&&e.headers["content-type"]);try{u=new TextDecoder(d).decode(s)}catch{}}else u=String.fromCharCode.apply(null,new Uint8Array(s));n({cause:u})}else n(null,s)}};var zn=Ge,qh=Ge;function br(c,n,r){var o=c;return function Ct(c){if(!c)return!1;var n=hn.call(c);return"[object Function]"===n||"function"==typeof c&&"[object RegExp]"!==n||typeof window<"u"&&(c===window.setTimeout||c===window.alert||c===window.confirm||c===window.prompt)}(n)?(r=n,"string"==typeof c&&(o={uri:c})):o=Be({},n,{uri:c}),o.callback=r,o}function Ge(c,n,r){return xc(n=br(c,n,r))}function xc(c){if(typeof c.callback>"u")throw new Error("callback argument missing");var n=!1,r=function(ni,It,Bt){n||(n=!0,c.callback(ni,It,Bt))};function e(){var yt=void 0;if(yt=d.response?d.response:d.responseText||function Ff(c){try{if("document"===c.responseType)return c.responseXML;if(""===c.responseType&&(!c.responseXML||"parsererror"!==c.responseXML.documentElement.nodeName))return c.responseXML}catch{}return null}(d),_e)try{yt=JSON.parse(yt)}catch{}return yt}function s(yt){return clearTimeout(ge),yt instanceof Error||(yt=new Error(""+(yt||"Unknown XMLHttpRequest Error"))),yt.statusCode=0,r(yt,rt)}function u(){if(!g){var yt;clearTimeout(ge);var ni=rt,It=null;return 0!==(yt=c.useXDR&&void 0===d.status?200:1223===d.status?204:d.status)?(ni={body:e(),statusCode:yt,method:L,headers:{},url:T,rawRequest:d},d.getAllResponseHeaders&&(ni.headers=function(n){var r={};return n&&n.trim().split("\n").forEach(function(o){var e=o.indexOf(":"),s=o.slice(0,e).trim().toLowerCase(),u=o.slice(e+1).trim();typeof r[s]>"u"?r[s]=u:Array.isArray(r[s])?r[s].push(u):r[s]=[r[s],u]}),r}(d.getAllResponseHeaders()))):It=new Error("Internal XMLHttpRequest Error"),r(It,ni,ni.body)}}var d=c.xhr||null;d||(d=c.cors||c.useXDR?new Ge.XDomainRequest:new Ge.XMLHttpRequest);var m,g,ge,T=d.url=c.uri||c.url,L=d.method=c.method||"GET",P=c.body||c.data,q=d.headers=c.headers||{},le=!!c.sync,_e=!1,rt={body:void 0,headers:{},statusCode:0,method:L,url:T,rawRequest:d};if("json"in c&&!1!==c.json&&(_e=!0,q.accept||q.Accept||(q.Accept="application/json"),"GET"!==L&&"HEAD"!==L&&(q["content-type"]||q["Content-Type"]||(q["Content-Type"]="application/json"),P=JSON.stringify(!0===c.json?P:c.json))),d.onreadystatechange=function o(){4===d.readyState&&setTimeout(u,0)},d.onload=u,d.onerror=s,d.onprogress=function(){},d.onabort=function(){g=!0},d.ontimeout=s,d.open(L,T,!le,c.username,c.password),le||(d.withCredentials=!!c.withCredentials),!le&&c.timeout>0&&(ge=setTimeout(function(){if(!g){g=!0,d.abort("timeout");var yt=new Error("XMLHttpRequest timeout");yt.code="ETIMEDOUT",s(yt)}},c.timeout)),d.setRequestHeader)for(m in q)q.hasOwnProperty(m)&&d.setRequestHeader(m,q[m]);else if(c.headers&&!function uu(c){for(var n in c)if(c.hasOwnProperty(n))return!1;return!0}(c.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in c&&(d.responseType=c.responseType),"beforeSend"in c&&"function"==typeof c.beforeSend&&c.beforeSend(d),d.send(P||null),d}Ge.XMLHttpRequest=Hn.XMLHttpRequest||function bo(){},Ge.XDomainRequest="withCredentials"in new Ge.XMLHttpRequest?Ge.XMLHttpRequest:Hn.XDomainRequest,function Wn(c,n){for(var r=0;r<c.length;r++)n(c[r])}(["get","put","post","patch","head","delete"],function(c){Ge["delete"===c?"del":c]=function(n,r,o){return(r=br(n,r,o)).method=c.toUpperCase(),xc(r)}}),zn.default=qh;var bc=function(n,r){var o=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()),e=[];o.oncue=function(s){r.addCue(s)},o.onparsingerror=function(s){e.push(s)},o.onflush=function(){r.trigger({type:"loadeddata",target:r})},o.parse(n),e.length>0&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed("Text Track parsing errors for "+r.src),e.forEach(function(s){return ne.error(s)}),window.console&&window.console.groupEnd&&window.console.groupEnd()),o.flush()},as=function(n,r){var o={uri:n},e=Js(n);e&&(o.cors=e);var s="use-credentials"===r.tech_.crossOrigin();s&&(o.withCredentials=s),zn(o,Cn(this,function(u,d,m){if(u)return ne.error(u,d);r.loaded_=!0,"function"!=typeof window.WebVTT?r.tech_&&r.tech_.any(["vttjsloaded","vttjserror"],function(g){if("vttjserror"!==g.type)return bc(m,r);ne.error("vttjs failed to load, stopping trying to process "+r.src)}):bc(m,r)}))},Es=function(c){function n(o){var e;if(void 0===o&&(o={}),!o.tech)throw new Error("A tech was not provided.");var s=Le(o,{kind:qv[o.kind]||"subtitles",language:o.language||o.srclang||""}),u=xo[s.mode]||"disabled",d=s.default;("metadata"===s.kind||"chapters"===s.kind)&&(u="hidden"),(e=c.call(this,s)||this).tech_=s.tech,e.cues_=[],e.activeCues_=[],e.preload_=!1!==e.tech_.preloadTextTracks;var m=new Rf(e.cues_),g=new Rf(e.activeCues_),T=!1;return e.timeupdateHandler=Cn(qi(e),function(P){if(void 0===P&&(P={}),!this.tech_.isDisposed()){if(!this.tech_.isReady_)return void("timeupdate"!==P.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler)));this.activeCues=this.activeCues,T&&(this.trigger("cuechange"),T=!1),"timeupdate"!==P.type&&(this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler))}}),e.tech_.one("dispose",function(){e.stopTracking()}),"disabled"!==u&&e.startTracking(),Object.defineProperties(qi(e),{default:{get:function(){return d},set:function(){}},mode:{get:function(){return u},set:function(q){!xo[q]||u!==q&&(u=q,!this.preload_&&"disabled"!==u&&0===this.cues.length&&as(this.src,this),this.stopTracking(),"disabled"!==u&&this.startTracking(),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?m:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return g;for(var q=this.tech_.currentTime(),le=[],_e=0,ge=this.cues.length;_e<ge;_e++){var rt=this.cues[_e];(rt.startTime<=q&&rt.endTime>=q||rt.startTime===rt.endTime&&rt.startTime<=q&&rt.startTime+.5>=q)&&le.push(rt)}if(T=!1,le.length!==this.activeCues_.length)T=!0;else for(var yt=0;yt<le.length;yt++)-1===this.activeCues_.indexOf(le[yt])&&(T=!0);return this.activeCues_=le,g.setCues_(this.activeCues_),g},set:function(){}}}),s.src?(e.src=s.src,e.preload_||(e.loaded_=!0),(e.preload_||"subtitles"!==s.kind&&"captions"!==s.kind)&&as(e.src,qi(e))):e.loaded_=!0,e}Ti(n,c);var r=n.prototype;return r.startTracking=function(){this.rvf_=this.tech_.requestVideoFrameCallback(this.timeupdateHandler),this.tech_.on("timeupdate",this.timeupdateHandler)},r.stopTracking=function(){this.rvf_&&(this.tech_.cancelVideoFrameCallback(this.rvf_),this.rvf_=void 0),this.tech_.off("timeupdate",this.timeupdateHandler)},r.addCue=function(e){var s=e;if(window.vttjs&&!(e instanceof window.vttjs.VTTCue)){for(var u in s=new window.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)u in s||(s[u]=e[u]);s.id=e.id,s.originalCue_=e}for(var d=this.tech_.textTracks(),m=0;m<d.length;m++)d[m]!==this&&d[m].removeCue(s);this.cues_.push(s),this.cues.setCues_(this.cues_)},r.removeCue=function(e){for(var s=this.cues_.length;s--;){var u=this.cues_[s];if(u===e||u.originalCue_&&u.originalCue_===e){this.cues_.splice(s,1),this.cues.setCues_(this.cues_);break}}},n}(Xh);Es.prototype.allowedEvents_={cuechange:"cuechange"};var Tc=function(c){function n(r){var o;void 0===r&&(r={});var e=Le(r,{kind:Xv[r.kind]||""});o=c.call(this,e)||this;var s=!1;return Object.defineProperty(qi(o),"enabled",{get:function(){return s},set:function(d){"boolean"!=typeof d||d===s||(s=d,this.trigger("enabledchange"))}}),e.enabled&&(o.enabled=e.enabled),o.loaded_=!0,o}return Ti(n,c),n}(Xh),To=function(c){function n(r){var o;void 0===r&&(r={});var e=Le(r,{kind:jv[r.kind]||""});o=c.call(this,e)||this;var s=!1;return Object.defineProperty(qi(o),"selected",{get:function(){return s},set:function(d){"boolean"!=typeof d||d===s||(s=d,this.trigger("selectedchange"))}}),e.selected&&(o.selected=e.selected),o}return Ti(n,c),n}(Xh),Ia=function(c){function n(r){var o;void 0===r&&(r={}),o=c.call(this)||this;var e,s=new Es(r);return o.kind=s.kind,o.src=s.src,o.srclang=s.language,o.label=s.label,o.default=s.default,Object.defineProperties(qi(o),{readyState:{get:function(){return e}},track:{get:function(){return s}}}),e=0,s.addEventListener("loadeddata",function(){e=2,o.trigger({type:"load",target:qi(o)})}),o}return Ti(n,c),n}(Fn);Ia.prototype.allowedEvents_={load:"load"},Ia.NONE=0,Ia.LOADING=1,Ia.LOADED=2,Ia.ERROR=3;var Vr={audio:{ListClass:Lf,TrackClass:Tc,capitalName:"Audio"},video:{ListClass:Gv,TrackClass:To,capitalName:"Video"},text:{ListClass:If,TrackClass:Es,capitalName:"Text"}};Object.keys(Vr).forEach(function(c){Vr[c].getterName=c+"Tracks",Vr[c].privateName=c+"Tracks_"});var Cs={remoteText:{ListClass:If,TrackClass:Es,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:Wv,TrackClass:Ia,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Cr=Be({},Vr,Cs);Cs.names=Object.keys(Cs),Vr.names=Object.keys(Vr),Cr.names=[].concat(Cs.names).concat(Vr.names);var za,Nf=typeof De<"u"?De:typeof window<"u"?window:{};typeof document<"u"?za=document:(za=Nf["__GLOBAL_DOCUMENT_CACHE@4"])||(za=Nf["__GLOBAL_DOCUMENT_CACHE@4"]={});var ss=za,cu=Object.create||function(){function c(){}return function(n){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return c.prototype=n,new c}}();function Gr(c,n){this.name="ParsingError",this.code=c.code,this.message=n||c.message}function os(c){function n(o,e,s,u){return 3600*(0|o)+60*(0|e)+(0|s)+(0|u)/1e3}var r=c.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return r?r[3]?n(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?n(r[1],r[2],0,r[4]):n(0,r[1],r[2],r[4]):null}function So(){this.values=cu(null)}function to(c,n,r,o){var e=o?c.split(o):[c];for(var s in e)if("string"==typeof e[s]){var u=e[s].split(r);2===u.length&&n(u[0].trim(),u[1].trim())}}function Yh(c,n,r){var o=c;function e(){var d=os(c);if(null===d)throw new Gr(Gr.Errors.BadTimeStamp,"Malformed timestamp: "+o);return c=c.replace(/^[^\sa-zA-Z-]+/,""),d}function u(){c=c.replace(/^\s+/,"")}if(u(),n.startTime=e(),u(),"--\x3e"!==c.substr(0,3))throw new Gr(Gr.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);c=c.substr(3),u(),n.endTime=e(),u(),function s(d,m){var g=new So;to(d,function(T,L){switch(T){case"region":for(var P=r.length-1;P>=0;P--)if(r[P].id===L){g.set(T,r[P].region);break}break;case"vertical":g.alt(T,L,["rl","lr"]);break;case"line":var q=L.split(","),le=q[0];g.integer(T,le),g.percent(T,le)&&g.set("snapToLines",!1),g.alt(T,le,["auto"]),2===q.length&&g.alt("lineAlign",q[1],["start","center","end"]);break;case"position":q=L.split(","),g.percent(T,q[0]),2===q.length&&g.alt("positionAlign",q[1],["start","center","end"]);break;case"size":g.percent(T,L);break;case"align":g.alt(T,L,["start","center","end","left","right"])}},/:/,/\s/),m.region=g.get("region",null),m.vertical=g.get("vertical","");try{m.line=g.get("line","auto")}catch{}m.lineAlign=g.get("lineAlign","start"),m.snapToLines=g.get("snapToLines",!0),m.size=g.get("size",100);try{m.align=g.get("align","center")}catch{m.align=g.get("align","middle")}try{m.position=g.get("position","auto")}catch{m.position=g.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},m.align)}m.positionAlign=g.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},m.align)}(c,n)}(Gr.prototype=cu(Error.prototype)).constructor=Gr,Gr.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},So.prototype={set:function(n,r){!this.get(n)&&""!==r&&(this.values[n]=r)},get:function(n,r,o){return o?this.has(n)?this.values[n]:r[o]:this.has(n)?this.values[n]:r},has:function(n){return n in this.values},alt:function(n,r,o){for(var e=0;e<o.length;++e)if(r===o[e]){this.set(n,r);break}},integer:function(n,r){/^-?\d+$/.test(r)&&this.set(n,parseInt(r,10))},percent:function(n,r){return!!(r.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(r=parseFloat(r),r>=0&&r<=100))&&(this.set(n,r),!0)}};var Eo=ss.createElement&&ss.createElement("textarea"),xn={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Mo={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},Va={v:"title",lang:"lang"},kf={rt:"ruby"};function Bf(c,n){function r(){if(!n)return null;var _e=n.match(/^([^<]*)(<[^>]*>?)?/);return function le(ge){return n=n.substr(ge.length),ge}(_e[1]?_e[1]:_e[2])}function o(le){return Eo.innerHTML=le,le=Eo.textContent,Eo.textContent="",le}function s(le,_e){var ge=xn[le];if(!ge)return null;var rt=c.document.createElement(ge),yt=Va[le];return yt&&_e&&(rt[yt]=_e.trim()),rt}for(var m,u=c.document.createElement("div"),d=u,g=[];null!==(m=r());)if("<"!==m[0])d.appendChild(c.document.createTextNode(o(m)));else{if("/"===m[1]){g.length&&g[g.length-1]===m.substr(2).replace(">","")&&(g.pop(),d=d.parentNode);continue}var L,T=os(m.substr(1,m.length-2));if(T){L=c.document.createProcessingInstruction("timestamp",T),d.appendChild(L);continue}var P=m.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!P||!(L=s(P[1],P[3]))||kf[(_e=L).localName]&&kf[_e.localName]!==d.localName)continue;if(P[2]){var q=P[2].split(".");q.forEach(function(le){var _e=/^bg_/.test(le),ge=_e?le.slice(3):le;Mo.hasOwnProperty(ge)&&(L.style[_e?"background-color":"color"]=Mo[ge])}),L.className=q.join(" ")}g.push(P[1]),d.appendChild(L),d=L}var _e;return u}var Ps=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Ac(c){for(var n=0;n<Ps.length;n++){var r=Ps[n];if(c>=r[0]&&c<=r[1])return!0}return!1}function _a(c){var n=[],r="";if(!c||!c.childNodes)return"ltr";function e(d,m){for(var g=m.childNodes.length-1;g>=0;g--)d.push(m.childNodes[g])}function s(d){if(!d||!d.length)return null;var m=d.pop(),g=m.textContent||m.innerText;if(g){var T=g.match(/^.*(\n|\r)/);return T?(d.length=0,T[0]):g}return"ruby"===m.tagName?s(d):m.childNodes?(e(d,m),s(d)):void 0}for(e(n,c);r=s(n);)for(var u=0;u<r.length;u++)if(Ac(r.charCodeAt(u)))return"rtl";return"ltr"}function hu(){}function du(c,n,r){hu.call(this),this.cue=n,this.cueDiv=Bf(c,n.text);var o={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===n.vertical?"horizontal-tb":"lr"===n.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(o,this.cueDiv),this.div=c.document.createElement("div"),o={direction:_a(this.cueDiv),writingMode:""===n.vertical?"horizontal-tb":"lr"===n.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===n.align?"center":n.align,font:r.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(o),this.div.appendChild(this.cueDiv);var e=0;switch(n.positionAlign){case"start":e=n.position;break;case"center":e=n.position-n.size/2;break;case"end":e=n.position-n.size}this.applyStyles(""===n.vertical?{left:this.formatStyle(e,"%"),width:this.formatStyle(n.size,"%")}:{top:this.formatStyle(e,"%"),height:this.formatStyle(n.size,"%")}),this.move=function(s){this.applyStyles({top:this.formatStyle(s.top,"px"),bottom:this.formatStyle(s.bottom,"px"),left:this.formatStyle(s.left,"px"),right:this.formatStyle(s.right,"px"),height:this.formatStyle(s.height,"px"),width:this.formatStyle(s.width,"px")})}}function Wr(c){var n,r,o,e;if(c.div){r=c.div.offsetHeight,o=c.div.offsetWidth,e=c.div.offsetTop;var s=(s=c.div.childNodes)&&(s=s[0])&&s.getClientRects&&s.getClientRects();c=c.div.getBoundingClientRect(),n=s?Math.max(s[0]&&s[0].height||0,c.height/s.length):0}this.left=c.left,this.right=c.right,this.top=c.top||e,this.height=c.height||r,this.bottom=c.bottom||e+(c.height||r),this.width=c.width||o,this.lineHeight=void 0!==n?n:c.lineHeight}function Qv(c,n,r,o){var s=new Wr(n),u=n.cue,d=function ml(c){if("number"==typeof c.line&&(c.snapToLines||c.line>=0&&c.line<=100))return c.line;if(!c.track||!c.track.textTrackList||!c.track.textTrackList.mediaElement)return-1;for(var n=c.track,r=n.textTrackList,o=0,e=0;e<r.length&&r[e]!==n;e++)"showing"===r[e].mode&&o++;return-1*++o}(u),m=[];if(u.snapToLines){var g;switch(u.vertical){case"":m=["+y","-y"],g="height";break;case"rl":m=["+x","-x"],g="width";break;case"lr":m=["-x","+x"],g="width"}var T=s.lineHeight,L=T*Math.round(d),P=r[g]+T,q=m[0];Math.abs(L)>P&&(L=L<0?-1:1,L*=Math.ceil(P/T)*T),d<0&&(L+=""===u.vertical?r.height:r.width,m=m.reverse()),s.move(q,L)}else{var le=s.lineHeight/r.height*100;switch(u.lineAlign){case"center":d-=le/2;break;case"end":d-=le}switch(u.vertical){case"":n.applyStyles({top:n.formatStyle(d,"%")});break;case"rl":n.applyStyles({left:n.formatStyle(d,"%")});break;case"lr":n.applyStyles({right:n.formatStyle(d,"%")})}m=["+y","-x","+x","-y"],s=new Wr(n)}var _e=function e(ge,rt){for(var yt,ni=new Wr(ge),It=1,Bt=0;Bt<rt.length;Bt++){for(;ge.overlapsOppositeAxis(r,rt[Bt])||ge.within(r)&&ge.overlapsAny(o);)ge.move(rt[Bt]);if(ge.within(r))return ge;var ci=ge.intersectPercentage(r);It>ci&&(yt=new Wr(ge),It=ci),ge=new Wr(ni)}return yt||ni}(s,m);n.move(_e.toCSSCompatValues(r))}function Co(){}hu.prototype.applyStyles=function(c,n){for(var r in n=n||this.div,c)c.hasOwnProperty(r)&&(n.style[r]=c[r])},hu.prototype.formatStyle=function(c,n){return 0===c?0:c+n},(du.prototype=cu(hu.prototype)).constructor=du,Wr.prototype.move=function(c,n){switch(n=void 0!==n?n:this.lineHeight,c){case"+x":this.left+=n,this.right+=n;break;case"-x":this.left-=n,this.right-=n;break;case"+y":this.top+=n,this.bottom+=n;break;case"-y":this.top-=n,this.bottom-=n}},Wr.prototype.overlaps=function(c){return this.left<c.right&&this.right>c.left&&this.top<c.bottom&&this.bottom>c.top},Wr.prototype.overlapsAny=function(c){for(var n=0;n<c.length;n++)if(this.overlaps(c[n]))return!0;return!1},Wr.prototype.within=function(c){return this.top>=c.top&&this.bottom<=c.bottom&&this.left>=c.left&&this.right<=c.right},Wr.prototype.overlapsOppositeAxis=function(c,n){switch(n){case"+x":return this.left<c.left;case"-x":return this.right>c.right;case"+y":return this.top<c.top;case"-y":return this.bottom>c.bottom}},Wr.prototype.intersectPercentage=function(c){return Math.max(0,Math.min(this.right,c.right)-Math.max(this.left,c.left))*Math.max(0,Math.min(this.bottom,c.bottom)-Math.max(this.top,c.top))/(this.height*this.width)},Wr.prototype.toCSSCompatValues=function(c){return{top:this.top-c.top,bottom:c.bottom-this.bottom,left:this.left-c.left,right:c.right-this.right,height:this.height,width:this.width}},Wr.getSimpleBoxPosition=function(c){var n=c.div?c.div.offsetHeight:c.tagName?c.offsetHeight:0,r=c.div?c.div.offsetWidth:c.tagName?c.offsetWidth:0,o=c.div?c.div.offsetTop:c.tagName?c.offsetTop:0;return{left:(c=c.div?c.div.getBoundingClientRect():c.tagName?c.getBoundingClientRect():c).left,right:c.right,top:c.top||o,height:c.height||n,bottom:c.bottom||o+(c.height||n),width:c.width||r}},Co.StringDecoder=function(){return{decode:function(n){if(!n)return"";if("string"!=typeof n)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))}}},Co.convertCueToDOMTree=function(c,n){return c&&n?Bf(c,n):null},Co.processCues=function(c,n,r){if(!c||!n||!r)return null;for(;r.firstChild;)r.removeChild(r.firstChild);var o=c.document.createElement("div");if(o.style.position="absolute",o.style.left="0",o.style.right="0",o.style.top="0",o.style.bottom="0",o.style.margin="1.5%",r.appendChild(o),function e(T){for(var L=0;L<T.length;L++)if(T[L].hasBeenReset||!T[L].displayState)return!0;return!1}(n)){var u=[],d=Wr.getSimpleBoxPosition(o),g={font:Math.round(.05*d.height*100)/100+"px sans-serif"};!function(){for(var T,L,P=0;P<n.length;P++)T=new du(c,L=n[P],g),o.appendChild(T.div),Qv(0,T,d,u),L.displayState=T.div,u.push(Wr.getSimpleBoxPosition(T))}()}else for(var s=0;s<n.length;s++)o.appendChild(n[s].displayState)},(Co.Parser=function(c,n,r){r||(r=n,n={}),n||(n={}),this.window=c,this.vttjs=n,this.state="INITIAL",this.buffer="",this.decoder=r||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(n){if(!(n instanceof Gr))throw n;this.onparsingerror&&this.onparsingerror(n)},parse:function(n){var L,r=this;function o(){for(var L=r.buffer,P=0;P<L.length&&"\r"!==L[P]&&"\n"!==L[P];)++P;var q=L.substr(0,P);return"\r"===L[P]&&++P,"\n"===L[P]&&++P,r.buffer=L.substr(P),q}n&&(r.buffer+=r.decoder.decode(n,{stream:!0}));try{var d;if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;var m=(d=o()).match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Gr(Gr.Errors.BadSignature);r.state="HEADER"}for(var g=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(g?g=!1:d=o(),r.state){case"HEADER":/:/.test(d)?(L=d).match(/X-TIMESTAMP-MAP/)?to(L,function(P,q){"X-TIMESTAMP-MAP"===P&&function s(L){var P=new So;to(L,function(q,le){switch(q){case"MPEGT":P.integer(q+"S",le);break;case"LOCA":P.set(q+"L",os(le))}},/[^\d]:/,/,/),r.ontimestampmap&&r.ontimestampmap({MPEGTS:P.get("MPEGTS"),LOCAL:P.get("LOCAL")})}(q)},/=/):to(L,function(P,q){"Region"===P&&function e(L){var P=new So;if(to(L,function(le,_e){switch(le){case"id":P.set(le,_e);break;case"width":P.percent(le,_e);break;case"lines":P.integer(le,_e);break;case"regionanchor":case"viewportanchor":var ge=_e.split(",");if(2!==ge.length)break;var rt=new So;if(rt.percent("x",ge[0]),rt.percent("y",ge[1]),!rt.has("x")||!rt.has("y"))break;P.set(le+"X",rt.get("x")),P.set(le+"Y",rt.get("y"));break;case"scroll":P.alt(le,_e,["up"])}},/=/,/\s/),P.has("id")){var q=new(r.vttjs.VTTRegion||r.window.VTTRegion);q.width=P.get("width",100),q.lines=P.get("lines",3),q.regionAnchorX=P.get("regionanchorX",0),q.regionAnchorY=P.get("regionanchorY",100),q.viewportAnchorX=P.get("viewportanchorX",0),q.viewportAnchorY=P.get("viewportanchorY",100),q.scroll=P.get("scroll",""),r.onregion&&r.onregion(q),r.regionList.push({id:P.get("id"),region:q})}}(q)},/:/):d||(r.state="ID");continue;case"NOTE":d||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){r.state="NOTE";break}if(!d)continue;r.cue=new(r.vttjs.VTTCue||r.window.VTTCue)(0,0,"");try{r.cue.align="center"}catch{r.cue.align="middle"}if(r.state="CUE",-1===d.indexOf("--\x3e")){r.cue.id=d;continue}case"CUE":try{Yh(d,r.cue,r.regionList)}catch(L){r.reportOrThrowError(L),r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var T=-1!==d.indexOf("--\x3e");if(!d||T&&(g=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}r.cue.text&&(r.cue.text+="\n"),r.cue.text+=d.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":d||(r.state="ID");continue}}}catch(L){r.reportOrThrowError(L),"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var n=this;try{if(n.buffer+=n.decoder.decode(),(n.cue||"HEADER"===n.state)&&(n.buffer+="\n\n",n.parse()),"INITIAL"===n.state)throw new Gr(Gr.Errors.BadSignature)}catch(r){n.reportOrThrowError(r)}return n.onflush&&n.onflush(),this}};var fu=Co,Zv={"":1,lr:1,rl:1},Uf={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Sc(c){return"string"==typeof c&&!!Uf[c.toLowerCase()]&&c.toLowerCase()}function zf(c,n,r){this.hasBeenReset=!1;var o="",e=!1,s=c,u=n,d=r,m=null,g="",T=!0,L="auto",P="start",q="auto",le="auto",_e=100,ge="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return o},set:function(yt){o=""+yt}},pauseOnExit:{enumerable:!0,get:function(){return e},set:function(yt){e=!!yt}},startTime:{enumerable:!0,get:function(){return s},set:function(yt){if("number"!=typeof yt)throw new TypeError("Start time must be set to a number.");s=yt,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return u},set:function(yt){if("number"!=typeof yt)throw new TypeError("End time must be set to a number.");u=yt,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return d},set:function(yt){d=""+yt,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return m},set:function(yt){m=yt,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return g},set:function(yt){var ni=function Hf(c){return"string"==typeof c&&!!Zv[c.toLowerCase()]&&c.toLowerCase()}(yt);if(!1===ni)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");g=ni,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return T},set:function(yt){T=!!yt,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return L},set:function(yt){if("number"!=typeof yt&&"auto"!==yt)throw new SyntaxError("Line: an invalid number or illegal string was specified.");L=yt,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return P},set:function(yt){var ni=Sc(yt);ni?(P=ni,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return q},set:function(yt){if(yt<0||yt>100)throw new Error("Position must be between 0 and 100.");q=yt,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return le},set:function(yt){var ni=Sc(yt);ni?(le=ni,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return _e},set:function(yt){if(yt<0||yt>100)throw new Error("Size must be between 0 and 100.");_e=yt,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return ge},set:function(yt){var ni=Sc(yt);if(!ni)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");ge=ni,this.hasBeenReset=!0}}}),this.displayState=void 0}zf.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var Vf=zf,on={"":!0,up:!0};function pu(c){return"number"==typeof c&&c>=0&&c<=100}var Is=function $v(){var c=100,n=3,r=0,o=100,e=0,s=100,u="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return c},set:function(m){if(!pu(m))throw new Error("Width must be between 0 and 100.");c=m}},lines:{enumerable:!0,get:function(){return n},set:function(m){if("number"!=typeof m)throw new TypeError("Lines must be set to a number.");n=m}},regionAnchorY:{enumerable:!0,get:function(){return o},set:function(m){if(!pu(m))throw new Error("RegionAnchorX must be between 0 and 100.");o=m}},regionAnchorX:{enumerable:!0,get:function(){return r},set:function(m){if(!pu(m))throw new Error("RegionAnchorY must be between 0 and 100.");r=m}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(m){if(!pu(m))throw new Error("ViewportAnchorY must be between 0 and 100.");s=m}},viewportAnchorX:{enumerable:!0,get:function(){return e},set:function(m){if(!pu(m))throw new Error("ViewportAnchorX must be between 0 and 100.");e=m}},scroll:{enumerable:!0,get:function(){return u},set:function(m){var g=function Qh(c){return"string"==typeof c&&!!on[c.toLowerCase()]&&c.toLowerCase()}(m);!1===g?console.warn("Scroll: an invalid or illegal string was specified."):u=g}}})},$r=Ke(function(c){var n=c.exports={WebVTT:fu,VTTCue:Vf,VTTRegion:Is};Hn.vttjs=n,Hn.WebVTT=n.WebVTT;var r=n.VTTCue,o=n.VTTRegion,e=Hn.VTTCue,s=Hn.VTTRegion;n.shim=function(){Hn.VTTCue=r,Hn.VTTRegion=o},n.restore=function(){Hn.VTTCue=e,Hn.VTTRegion=s},Hn.VTTCue||n.shim()}),Nn=function(c){function n(o,e){var s;return void 0===o&&(o={}),void 0===e&&(e=function(){}),o.reportTouchActivity=!1,(s=c.call(this,null,o,e)||this).onDurationChange_=function(u){return s.onDurationChange(u)},s.trackProgress_=function(u){return s.trackProgress(u)},s.trackCurrentTime_=function(u){return s.trackCurrentTime(u)},s.stopTrackingCurrentTime_=function(u){return s.stopTrackingCurrentTime(u)},s.disposeSourceHandler_=function(u){return s.disposeSourceHandler(u)},s.queuedHanders_=new Set,s.hasStarted_=!1,s.on("playing",function(){this.hasStarted_=!0}),s.on("loadstart",function(){this.hasStarted_=!1}),Cr.names.forEach(function(u){var d=Cr[u];o&&o[d.getterName]&&(s[d.privateName]=o[d.getterName])}),s.featuresProgressEvents||s.manualProgressOn(),s.featuresTimeupdateEvents||s.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(u){!1===o["native"+u+"Tracks"]&&(s["featuresNative"+u+"Tracks"]=!1)}),!1===o.nativeCaptions||!1===o.nativeTextTracks?s.featuresNativeTextTracks=!1:(!0===o.nativeCaptions||!0===o.nativeTextTracks)&&(s.featuresNativeTextTracks=!0),s.featuresNativeTextTracks||s.emulateTextTracks(),s.preloadTextTracks=!1!==o.preloadTextTracks,s.autoRemoteTextTracks_=new Cr.text.ListClass,s.initTrackListeners(),o.nativeControlsForTouch||s.emitTapEvents(),s.constructor&&(s.name_=s.constructor.name||"Unknown Tech"),s}Ti(n,c);var r=n.prototype;return r.triggerSourceset=function(e){var s=this;this.isReady_||this.one("ready",function(){return s.setTimeout(function(){return s.triggerSourceset(e)},1)}),this.trigger({src:e,type:"sourceset"})},r.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},r.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},r.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Cn(this,function(){var s=this.bufferedPercent();this.bufferedPercent_!==s&&this.trigger("progress"),this.bufferedPercent_=s,1===s&&this.stopTrackingProgress()}),500)},r.onDurationChange=function(e){this.duration_=this.duration()},r.buffered=function(){return vo(0,0)},r.bufferedPercent=function(){return Pf(this.buffered(),this.duration_)},r.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},r.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},r.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},r.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},r.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},r.dispose=function(){this.clearTracks(Vr.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),c.prototype.dispose.call(this)},r.clearTracks=function(e){var s=this;(e=[].concat(e)).forEach(function(u){for(var d=s[u+"Tracks"]()||[],m=d.length;m--;){var g=d[m];"text"===u&&s.removeRemoteTextTrack(g),d.removeTrack(g)}})},r.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],s=e.length;s--;)this.removeRemoteTextTrack(e[s])},r.reset=function(){},r.crossOrigin=function(){},r.setCrossOrigin=function(){},r.error=function(e){return void 0!==e&&(this.error_=new Zr(e),this.trigger("error")),this.error_},r.played=function(){return this.hasStarted_?vo(0,0):vo()},r.play=function(){},r.setScrubbing=function(){},r.scrubbing=function(){},r.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},r.initTrackListeners=function(){var e=this;Vr.names.forEach(function(s){var d=function(){e.trigger(s+"trackchange")},m=e[Vr[s].getterName]();m.addEventListener("removetrack",d),m.addEventListener("addtrack",d),e.on("dispose",function(){m.removeEventListener("removetrack",d),m.removeEventListener("addtrack",d)})})},r.addWebVttScript_=function(){var e=this;if(!window.WebVTT)if(document.body.contains(this.el())){if(!this.options_["vtt.js"]&&Ve($r)&&Object.keys($r).length>0)return void this.trigger("vttjsloaded");var s=document.createElement("script");s.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",s.onload=function(){e.trigger("vttjsloaded")},s.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){s.onload=null,s.onerror=null}),window.WebVTT=!0,this.el().parentNode.appendChild(s)}else this.ready(this.addWebVttScript_)},r.emulateTextTracks=function(){var e=this,s=this.textTracks(),u=this.remoteTextTracks(),d=function(P){return s.addTrack(P.track)},m=function(P){return s.removeTrack(P.track)};u.on("addtrack",d),u.on("removetrack",m),this.addWebVttScript_();var g=function(){return e.trigger("texttrackchange")},T=function(){g();for(var P=0;P<s.length;P++){var q=s[P];q.removeEventListener("cuechange",g),"showing"===q.mode&&q.addEventListener("cuechange",g)}};T(),s.addEventListener("change",T),s.addEventListener("addtrack",T),s.addEventListener("removetrack",T),this.on("dispose",function(){u.off("addtrack",d),u.off("removetrack",m),s.removeEventListener("change",T),s.removeEventListener("addtrack",T),s.removeEventListener("removetrack",T);for(var L=0;L<s.length;L++)s[L].removeEventListener("cuechange",g)})},r.addTextTrack=function(e,s,u){if(!e)throw new Error("TextTrack kind is required but was not provided");return function Rs(c,n,r,o,e){void 0===e&&(e={});var s=c.textTracks();e.kind=n,r&&(e.label=r),o&&(e.language=o),e.tech=c;var u=new Cr.text.TrackClass(e);return s.addTrack(u),u}(this,e,s,u)},r.createRemoteTextTrack=function(e){var s=Le(e,{tech:this});return new Cs.remoteTextEl.TrackClass(s)},r.addRemoteTextTrack=function(e,s){var u=this;void 0===e&&(e={});var d=this.createRemoteTextTrack(e);return!0!==s&&!1!==s&&(ne.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),s=!0),this.remoteTextTrackEls().addTrackElement_(d),this.remoteTextTracks().addTrack(d.track),!0!==s&&this.ready(function(){return u.autoRemoteTextTracks_.addTrack(d.track)}),d},r.removeRemoteTextTrack=function(e){var s=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(s),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},r.getVideoPlaybackQuality=function(){return{}},r.requestPictureInPicture=function(){var e=this.options_.Promise||window.Promise;if(e)return e.reject()},r.disablePictureInPicture=function(){return!0},r.setDisablePictureInPicture=function(){},r.requestVideoFrameCallback=function(e){var s=this,u=oa();return!this.isReady_||this.paused()?(this.queuedHanders_.add(u),this.one("playing",function(){s.queuedHanders_.has(u)&&(s.queuedHanders_.delete(u),e())})):this.requestNamedAnimationFrame(u,e),u},r.cancelVideoFrameCallback=function(e){this.queuedHanders_.has(e)?this.queuedHanders_.delete(e):this.cancelNamedAnimationFrame(e)},r.setPoster=function(){},r.playsinline=function(){},r.setPlaysinline=function(){},r.overrideNativeAudioTracks=function(){},r.overrideNativeVideoTracks=function(){},r.canPlayType=function(){return""},n.canPlayType=function(){return""},n.canPlaySource=function(e,s){return n.canPlayType(e.type)},n.isTech=function(e){return e.prototype instanceof n||e instanceof n||e===n},n.registerTech=function(e,s){if(n.techs_||(n.techs_={}),!n.isTech(s))throw new Error("Tech "+e+" must be a Tech");if(!n.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!n.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=rr(e),n.techs_[e]=s,n.techs_[mo(e)]=s,"Tech"!==e&&n.defaultTechOrder_.push(e),s},n.getTech=function(e){if(e){if(n.techs_&&n.techs_[e])return n.techs_[e];if(e=rr(e),window&&window.videojs&&window.videojs[e])return ne.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),window.videojs[e]}},n}(Qt);Cr.names.forEach(function(c){var n=Cr[c];Nn.prototype[n.getterName]=function(){return this[n.privateName]=this[n.privateName]||new n.ListClass,this[n.privateName]}}),Nn.prototype.featuresVolumeControl=!0,Nn.prototype.featuresMuteControl=!0,Nn.prototype.featuresFullscreenResize=!1,Nn.prototype.featuresPlaybackRate=!1,Nn.prototype.featuresProgressEvents=!1,Nn.prototype.featuresSourceset=!1,Nn.prototype.featuresTimeupdateEvents=!1,Nn.prototype.featuresNativeTextTracks=!1,Nn.prototype.featuresVideoFrameCallback=!1,Nn.withSourceHandlers=function(c){c.registerSourceHandler=function(r,o){var e=c.sourceHandlers;e||(e=c.sourceHandlers=[]),void 0===o&&(o=e.length),e.splice(o,0,r)},c.canPlayType=function(r){for(var e,o=c.sourceHandlers||[],s=0;s<o.length;s++)if(e=o[s].canPlayType(r))return e;return""},c.selectSourceHandler=function(r,o){for(var e=c.sourceHandlers||[],u=0;u<e.length;u++)if(e[u].canHandleSource(r,o))return e[u];return null},c.canPlaySource=function(r,o){var e=c.selectSourceHandler(r,o);return e?e.canHandleSource(r,o):""},["seekable","seeking","duration"].forEach(function(r){var o=this[r];"function"==typeof o&&(this[r]=function(){return this.sourceHandler_&&this.sourceHandler_[r]?this.sourceHandler_[r].apply(this.sourceHandler_,arguments):o.apply(this,arguments)})},c.prototype),c.prototype.setSource=function(r){var o=c.selectSourceHandler(r,this.options_);o||(c.nativeSourceHandler?o=c.nativeSourceHandler:ne.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),o!==c.nativeSourceHandler&&(this.currentSource_=r),this.sourceHandler_=o.handleSource(r,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},c.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},Qt.registerComponent("Tech",Nn),Nn.registerTech("Tech",Nn),Nn.defaultTechOrder_=[];var Jr={},io={},Ds={};function Kh(c,n,r){c.setTimeout(function(){return Po(n,Jr[n.type],r,c)},1)}function Jh(c,n,r,o){void 0===o&&(o=null);var e="call"+rr(r),s=c.reduce(mu(e),o),u=s===Ds,d=u?null:n[r](s);return function ed(c,n,r,o){for(var e=c.length-1;e>=0;e--){var s=c[e];s[n]&&s[n](o,r)}}(c,r,d,u),d}var Ga={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Ec={setCurrentTime:1,setMuted:1,setVolume:1},Mc={play:1,pause:1};function mu(c){return function(n,r){return n===Ds?Ds:r[c]?r[c](n):n}}function Po(c,n,r,o,e,s){void 0===c&&(c={}),void 0===n&&(n=[]),void 0===e&&(e=[]),void 0===s&&(s=!1);var d=n[0],m=n.slice(1);if("string"==typeof d)Po(c,Jr[d],r,o,e,s);else if(d){var g=function Jv(c,n){var r=io[c.id()],o=null;if(null==r)return o=n(c),io[c.id()]=[[n,o]],o;for(var e=0;e<r.length;e++){var s=r[e];s[0]===n&&(o=s[1])}return null===o&&(o=n(c),r.push([n,o])),o}(o,d);if(!g.setSource)return e.push(g),Po(c,m,r,o,e,s);g.setSource(Oe({},c),function(T,L){if(T)return Po(c,m,r,o,e,s);e.push(g),Po(L,c.type===L.type?m:Jr[L.type],r,o,e,s)})}else m.length?Po(c,m,r,o,e,s):s?r(c,e):Po(c,Jr["*"],r,o,e,!0)}var dn={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},Fr=function(n){void 0===n&&(n="");var r=hl(n);return dn[r.toLowerCase()]||""},Cc=function c(n){if(Array.isArray(n)){var r=[];n.forEach(function(o){o=c(o),Array.isArray(o)?r=r.concat(o):Ee(o)&&r.push(o)}),n=r}else n="string"==typeof n&&n.trim()?[wn({src:n})]:Ee(n)&&"string"==typeof n.src&&n.src&&n.src.trim()?[wn(n)]:[];return n};function wn(c){if(!c.type){var n=Fr(c.src);n&&(c.type=n)}return c}var td=function(c){function n(r,o,e){var s,u=Le({createEl:!1},o);if(s=c.call(this,r,u,e)||this,o.playerOptions.sources&&0!==o.playerOptions.sources.length)r.src(o.playerOptions.sources);else for(var d=0,m=o.playerOptions.techOrder;d<m.length;d++){var g=rr(m[d]),T=Nn.getTech(g);if(g||(T=Qt.getComponent(g)),T&&T.isSupported()){r.loadTech_(g);break}}return s}return Ti(n,c),n}(Qt);Qt.registerComponent("MediaLoader",td);var gl=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).options_.controlText&&s.controlText(s.options_.controlText),s.handleMouseOver_=function(u){return s.handleMouseOver(u)},s.handleMouseOut_=function(u){return s.handleMouseOut(u)},s.handleClick_=function(u){return s.handleClick(u)},s.handleKeyDown_=function(u){return s.handleKeyDown(u)},s.emitTapEvents(),s.enable(),s}Ti(n,c);var r=n.prototype;return r.createEl=function(e,s,u){void 0===e&&(e="div"),void 0===s&&(s={}),void 0===u&&(u={}),s=Oe({className:this.buildCSSClass(),tabIndex:0},s),"button"===e&&ne.error("Creating a ClickableComponent with an HTML element of "+e+" is not supported; use a Button instead."),u=Oe({role:"button"},u),this.tabIndex_=s.tabIndex;var d=ee(e,s,u);return d.appendChild(ee("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(d),d},r.dispose=function(){this.controlTextEl_=null,c.prototype.dispose.call(this)},r.createControlTextEl=function(e){return this.controlTextEl_=ee("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},r.controlText=function(e,s){if(void 0===s&&(s=this.el()),void 0===e)return this.controlText_||"Need Text";var u=this.localize(e);this.controlText_=e,v(this.controlTextEl_,u),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&s.setAttribute("title",u)},r.buildCSSClass=function(){return"vjs-control vjs-button "+c.prototype.buildCSSClass.call(this)},r.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),typeof this.tabIndex_<"u"&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},r.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),typeof this.tabIndex_<"u"&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},r.handleLanguagechange=function(){this.controlText(this.controlText_)},r.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},r.handleKeyDown=function(e){wi.isEventKey(e,"Space")||wi.isEventKey(e,"Enter")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):c.prototype.handleKeyDown.call(this,e)},n}(Qt);Qt.registerComponent("ClickableComponent",gl);var id=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update(),s.update_=function(u){return s.update(u)},o.on("posterchange",s.update_),s}Ti(n,c);var r=n.prototype;return r.dispose=function(){this.player().off("posterchange",this.update_),c.prototype.dispose.call(this)},r.createEl=function(){return ee("div",{className:"vjs-poster",tabIndex:-1})},r.update=function(e){var s=this.player().poster();this.setSrc(s),s?this.show():this.hide()},r.setSrc=function(e){var s="";e&&(s='url("'+e+'")'),this.el_.style.backgroundImage=s},r.handleClick=function(e){if(this.player_.controls()){var s=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((ei||ae)&&s)&&this.player_.tech(!0).focus(),this.player_.paused()?ga(this.player_.play()):this.player_.pause()}},n}(gl);Qt.registerComponent("PosterImage",id);var la="#222",nd={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function Lo(c,n){var r;if(4===c.length)r=c[1]+c[1]+c[2]+c[2]+c[3]+c[3];else{if(7!==c.length)throw new Error("Invalid color code provided, "+c+"; must be formatted as e.g. #f0e or #f604e2.");r=c.slice(1)}return"rgba("+parseInt(r.slice(0,2),16)+","+parseInt(r.slice(2,4),16)+","+parseInt(r.slice(4,6),16)+","+n+")"}function _l(c,n,r){try{c.style[n]=r}catch{return}}var jn=function(c){function n(o,e,s){var u;u=c.call(this,o,e,s)||this;var d=function(g){return u.updateDisplay(g)};return o.on("loadstart",function(m){return u.toggleDisplay(m)}),o.on("texttrackchange",d),o.on("loadedmetadata",function(m){return u.preselectTrack(m)}),o.ready(Cn(qi(u),function(){if(o.tech_&&o.tech_.featuresNativeTextTracks)this.hide();else{o.on("fullscreenchange",d),o.on("playerresize",d),window.addEventListener("orientationchange",d),o.on("dispose",function(){return window.removeEventListener("orientationchange",d)});for(var m=this.options_.playerOptions.tracks||[],g=0;g<m.length;g++)this.player_.addRemoteTextTrack(m[g],!0);this.preselectTrack()}})),u}Ti(n,c);var r=n.prototype;return r.preselectTrack=function(){for(var d,m,g,e={captions:1,subtitles:1},s=this.player_.textTracks(),u=this.player_.cache_.selectedLanguage,T=0;T<s.length;T++){var L=s[T];u&&u.enabled&&u.language&&u.language===L.language&&L.kind in e?L.kind===u.kind?g=L:g||(g=L):u&&!u.enabled?(g=null,d=null,m=null):L.default&&("descriptions"!==L.kind||d?L.kind in e&&!m&&(m=L):d=L)}g?g.mode="showing":m?m.mode="showing":d&&(d.mode="showing")},r.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},r.clearDisplay=function(){"function"==typeof window.WebVTT&&window.WebVTT.processCues(window,[],this.el_)},r.updateDisplay=function(){var e=this.player_.textTracks(),s=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),s){for(var u=[],d=0;d<e.length;++d){var m=e[d];"showing"===m.mode&&u.push(m)}this.updateForTrack(u)}else{for(var g=null,T=null,L=e.length;L--;){var P=e[L];"showing"===P.mode&&("descriptions"===P.kind?g=P:T=P)}T?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(T)):g&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(g))}},r.updateDisplayState=function(e){for(var s=this.player_.textTrackSettings.getValues(),u=e.activeCues,d=u.length;d--;){var m=u[d];if(m){var g=m.displayState;if(s.color&&(g.firstChild.style.color=s.color),s.textOpacity&&_l(g.firstChild,"color",Lo(s.color||"#fff",s.textOpacity)),s.backgroundColor&&(g.firstChild.style.backgroundColor=s.backgroundColor),s.backgroundOpacity&&_l(g.firstChild,"backgroundColor",Lo(s.backgroundColor||"#000",s.backgroundOpacity)),s.windowColor&&(s.windowOpacity?_l(g,"backgroundColor",Lo(s.windowColor,s.windowOpacity)):g.style.backgroundColor=s.windowColor),s.edgeStyle&&("dropshadow"===s.edgeStyle?g.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+la:"raised"===s.edgeStyle?g.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+la:"depressed"===s.edgeStyle?g.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+la:"uniform"===s.edgeStyle&&(g.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+la)),s.fontPercent&&1!==s.fontPercent){var T=window.parseFloat(g.style.fontSize);g.style.fontSize=T*s.fontPercent+"px",g.style.height="auto",g.style.top="auto"}s.fontFamily&&"default"!==s.fontFamily&&("small-caps"===s.fontFamily?g.firstChild.style.fontVariant="small-caps":g.firstChild.style.fontFamily=nd[s.fontFamily])}}},r.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),"function"==typeof window.WebVTT&&!e.every(function(q){return!q.activeCues})){for(var s=[],u=0;u<e.length;++u)for(var d=e[u],m=0;m<d.activeCues.length;++m)s.push(d.activeCues[m]);window.WebVTT.processCues(window,s,this.el_);for(var g=0;g<e.length;++g){for(var T=e[g],L=0;L<T.activeCues.length;++L){var P=T.activeCues[L].displayState;G(P,"vjs-text-track-cue"),G(P,"vjs-text-track-cue-"+(T.language?T.language:g)),T.language&&gt(P,"lang",T.language)}this.player_.textTrackSettings&&this.updateDisplayState(T)}}},n}(Qt);Qt.registerComponent("TextTrackDisplay",jn);var rd=function(c){function n(){return c.apply(this,arguments)||this}return Ti(n,c),n.prototype.createEl=function(){var e=this.player_.isAudio(),s=this.localize(e?"Audio Player":"Video Player"),u=ee("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[s])}),d=c.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return d.appendChild(u),d},n}(Qt);Qt.registerComponent("LoadingSpinner",rd);var Ra=function(c){function n(){return c.apply(this,arguments)||this}Ti(n,c);var r=n.prototype;return r.createEl=function(e,s,u){void 0===s&&(s={}),void 0===u&&(u={});var d=ee("button",s=Oe({className:this.buildCSSClass()},s),u=Oe({type:"button"},u));return d.appendChild(ee("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(d),d},r.addChild=function(e,s){return void 0===s&&(s={}),ne.warn("Adding an actionable (user controllable) child to a Button ("+this.constructor.name+") is not supported; use a ClickableComponent instead."),Qt.prototype.addChild.call(this,e,s)},r.enable=function(){c.prototype.enable.call(this),this.el_.removeAttribute("disabled")},r.disable=function(){c.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},r.handleKeyDown=function(e){wi.isEventKey(e,"Space")||wi.isEventKey(e,"Enter")?e.stopPropagation():c.prototype.handleKeyDown.call(this,e)},n}(gl);Qt.registerComponent("Button",Ra);var Wf=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).mouseused_=!1,s.on("mousedown",function(u){return s.handleMouseDown(u)}),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-big-play-button"},r.handleClick=function(e){var s=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var u=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;return ga(s),void(this.player_.tech(!0)&&(!ei&&!ae||!u)&&this.player_.tech(!0).focus())}var d=this.player_.getChild("controlBar"),m=d&&d.getChild("playToggle");if(m){var g=function(){return m.focus()};ou(s)?s.then(g,function(){}):this.setTimeout(g,1)}else this.player_.tech(!0).focus()},r.handleKeyDown=function(e){this.mouseused_=!1,c.prototype.handleKeyDown.call(this,e)},r.handleMouseDown=function(e){this.mouseused_=!0},n}(Ra);Wf.prototype.controlText_="Play Video",Qt.registerComponent("BigPlayButton",Wf);var Pc=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).controlText(e&&e.controlText||s.localize("Close")),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-close-button "+c.prototype.buildCSSClass.call(this)},r.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},r.handleKeyDown=function(e){wi.isEventKey(e,"Esc")?(e.preventDefault(),e.stopPropagation(),this.trigger("click")):c.prototype.handleKeyDown.call(this,e)},n}(Ra);Qt.registerComponent("CloseButton",Pc);var jf=function(c){function n(o,e){var s;return void 0===e&&(e={}),s=c.call(this,o,e)||this,e.replay=void 0===e.replay||e.replay,s.on(o,"play",function(u){return s.handlePlay(u)}),s.on(o,"pause",function(u){return s.handlePause(u)}),e.replay&&s.on(o,"ended",function(u){return s.handleEnded(u)}),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-play-control "+c.prototype.buildCSSClass.call(this)},r.handleClick=function(e){this.player_.paused()?ga(this.player_.play()):this.player_.pause()},r.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},r.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},r.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},r.handleEnded=function(e){var s=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",function(u){return s.handleSeeked(u)})},n}(Ra);jf.prototype.controlText_="Play",Qt.registerComponent("PlayToggle",jf);var Wa=function(n,r){n=n<0?0:n;var o=Math.floor(n%60),e=Math.floor(n/60%60),s=Math.floor(n/3600),u=Math.floor(r/60%60),d=Math.floor(r/3600);return(isNaN(n)||n===1/0)&&(s=e=o="-"),(s=s>0||d>0?s+":":"")+(e=((s||u>=10)&&e<10?"0"+e:e)+":")+(o<10?"0"+o:o)},vu=Wa;function ls(c,n){return void 0===n&&(n=c),vu(c,n)}var ar=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on(o,["timeupdate","ended"],function(u){return s.updateContent(u)}),s.updateTextNode_(),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e=this.buildCSSClass(),s=c.prototype.createEl.call(this,"div",{className:e+" vjs-time-control vjs-control"}),u=ee("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xa0"},{role:"presentation"});return s.appendChild(u),this.contentEl_=ee("span",{className:e+"-display"},{"aria-live":"off",role:"presentation"}),s.appendChild(this.contentEl_),s},r.dispose=function(){this.contentEl_=null,this.textNode_=null,c.prototype.dispose.call(this)},r.updateTextNode_=function(e){var s=this;void 0===e&&(e=0),e=ls(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){if(s.contentEl_){var u=s.textNode_;u&&s.contentEl_.firstChild!==u&&(u=null,ne.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),s.textNode_=document.createTextNode(s.formattedTime_),s.textNode_&&(u?s.contentEl_.replaceChild(s.textNode_,u):s.contentEl_.appendChild(s.textNode_))}}))},r.updateContent=function(e){},n}(Qt);ar.prototype.labelText_="Time",ar.prototype.controlText_="Time",Qt.registerComponent("TimeDisplay",ar);var Ln=function(c){function n(){return c.apply(this,arguments)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-current-time"},r.updateContent=function(e){var s;s=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(s)},n}(ar);Ln.prototype.labelText_="Current Time",Ln.prototype.controlText_="Current Time",Qt.registerComponent("CurrentTimeDisplay",Ln);var Lc=function(c){function n(o,e){var s,u=function(m){return s.updateContent(m)};return(s=c.call(this,o,e)||this).on(o,"durationchange",u),s.on(o,"loadstart",u),s.on(o,"loadedmetadata",u),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-duration"},r.updateContent=function(e){var s=this.player_.duration();this.updateTextNode_(s)},n}(ar);Lc.prototype.labelText_="Duration",Lc.prototype.controlText_="Duration",Qt.registerComponent("DurationDisplay",Lc);var bl=function(c){function n(){return c.apply(this,arguments)||this}return Ti(n,c),n.prototype.createEl=function(){var e=c.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),s=c.prototype.createEl.call(this,"div"),u=c.prototype.createEl.call(this,"span",{textContent:"/"});return s.appendChild(u),e.appendChild(s),e},n}(Qt);Qt.registerComponent("TimeDivider",bl);var gu=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on(o,"durationchange",function(u){return s.updateContent(u)}),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-remaining-time"},r.createEl=function(){var e=c.prototype.createEl.call(this);return!1!==this.options_.displayNegative&&e.insertBefore(ee("span",{},{"aria-hidden":!0},"-"),this.contentEl_),e},r.updateContent=function(e){var s;"number"==typeof this.player_.duration()&&(s=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(s))},n}(ar);gu.prototype.labelText_="Remaining Time",gu.prototype.controlText_="Remaining Time",Qt.registerComponent("RemainingTimeDisplay",gu);var no=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).updateShowing(),s.on(s.player(),"durationchange",function(u){return s.updateShowing(u)}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e=c.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=ee("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(ee("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xa0"})),this.contentEl_.appendChild(document.createTextNode(this.localize("LIVE"))),e.appendChild(this.contentEl_),e},r.dispose=function(){this.contentEl_=null,c.prototype.dispose.call(this)},r.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},n}(Qt);Qt.registerComponent("LiveDisplay",no);var Os=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).updateLiveEdgeStatus(),s.player_.liveTracker&&(s.updateLiveEdgeStatusHandler_=function(u){return s.updateLiveEdgeStatus(u)},s.on(s.player_.liveTracker,"liveedgechange",s.updateLiveEdgeStatusHandler_)),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e=c.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=ee("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),e.appendChild(this.textEl_),e},r.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},r.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},r.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,c.prototype.dispose.call(this)},n}(Ra);Os.prototype.controlText_="Seek to live, currently playing live",Qt.registerComponent("SeekToLive",Os);var ja=function(n,r,o){return n=Number(n),Math.min(o,Math.max(r,isNaN(n)?r:n))},yu=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).handleMouseDown_=function(u){return s.handleMouseDown(u)},s.handleMouseUp_=function(u){return s.handleMouseUp(u)},s.handleKeyDown_=function(u){return s.handleKeyDown(u)},s.handleClick_=function(u){return s.handleClick(u)},s.handleMouseMove_=function(u){return s.handleMouseMove(u)},s.update_=function(u){return s.update(u)},s.bar=s.getChild(s.options_.barName),s.vertical(!!s.options_.vertical),s.enable(),s}Ti(n,c);var r=n.prototype;return r.enabled=function(){return this.enabled_},r.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},r.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},r.createEl=function(e,s,u){return void 0===s&&(s={}),void 0===u&&(u={}),s.className=s.className+" vjs-slider",s=Oe({tabIndex:0},s),u=Oe({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},u),c.prototype.createEl.call(this,e,s,u)},r.handleMouseDown=function(e){var s=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"===e.type&&!vt&&e.preventDefault(),St(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(s,"mousemove",this.handleMouseMove_),this.on(s,"mouseup",this.handleMouseUp_),this.on(s,"touchmove",this.handleMouseMove_),this.on(s,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)},r.handleMouseMove=function(e){},r.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;Vt(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},r.update=function(){var e=this;if(this.el_&&this.bar){var s=this.getProgress();return s===this.progress_||(this.progress_=s,this.requestNamedAnimationFrame("Slider#update",function(){var u=e.vertical()?"height":"width";e.bar.el().style[u]=(100*s).toFixed(2)+"%"})),s}},r.getProgress=function(){return Number(ja(this.getPercent(),0,1).toFixed(4))},r.calculateDistance=function(e){var s=ui(this.el_,e);return this.vertical()?s.y:s.x},r.handleKeyDown=function(e){wi.isEventKey(e,"Left")||wi.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepBack()):wi.isEventKey(e,"Right")||wi.isEventKey(e,"Up")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):c.prototype.handleKeyDown.call(this,e)},r.handleClick=function(e){e.stopPropagation(),e.preventDefault()},r.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.addClass(this.vertical_?"vjs-slider-vertical":"vjs-slider-horizontal")},n}(Qt);Qt.registerComponent("Slider",yu);var _u=function(n,r){return ja(n/r*100,0,100).toFixed(2)+"%"},ad=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).partEls_=[],s.on(o,"progress",function(u){return s.update(u)}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e=c.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),s=ee("span",{className:"vjs-control-text"}),u=ee("span",{textContent:this.localize("Loaded")}),d=document.createTextNode(": ");return this.percentageEl_=ee("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),e.appendChild(s),s.appendChild(u),s.appendChild(d),s.appendChild(this.percentageEl_),e},r.dispose=function(){this.partEls_=null,this.percentageEl_=null,c.prototype.dispose.call(this)},r.update=function(e){var s=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var u=s.player_.liveTracker,d=s.player_.buffered(),m=u&&u.isLive()?u.seekableEnd():s.player_.duration(),g=s.player_.bufferedEnd(),T=s.partEls_,L=_u(g,m);s.percent_!==L&&(s.el_.style.width=L,v(s.percentageEl_,L),s.percent_=L);for(var P=0;P<d.length;P++){var q=d.start(P),le=d.end(P),_e=T[P];_e||(_e=s.el_.appendChild(ee()),T[P]=_e),(_e.dataset.start!==q||_e.dataset.end!==le)&&(_e.dataset.start=q,_e.dataset.end=le,_e.style.left=_u(q,g),_e.style.width=_u(le-q,g))}for(var ge=T.length;ge>d.length;ge--)s.el_.removeChild(T[ge-1]);T.length=d.length})},n}(Qt);Qt.registerComponent("LoadProgressBar",ad);var Ic=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update=zr(Cn(qi(s),s.update),30),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},r.update=function(e,s,u){var d=mi(this.el_),m=Ut(this.player_.el()),g=e.width*s;if(m&&d){var T=e.left-m.left+g,L=e.width-g+(m.right-e.right),P=d.width/2;T<P?P+=P-T:L<P&&(P=L),P<0?P=0:P>d.width&&(P=d.width),P=Math.round(P),this.el_.style.right="-"+P+"px",this.write(u)}},r.write=function(e){v(this.el_,e)},r.updateTime=function(e,s,u,d){var m=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var g,T=m.player_.duration();if(m.player_.liveTracker&&m.player_.liveTracker.isLive()){var L=m.player_.liveTracker.liveWindow(),P=L-s*L;g=(P<1?"":"-")+ls(P,L)}else g=ls(u,T);m.update(e,s,g),d&&d()})},n}(Qt);Qt.registerComponent("TimeTooltip",Ic);var Tl=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update=zr(Cn(qi(s),s.update),30),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},r.update=function(e,s){var u=this.getChild("timeTooltip");if(u){var d=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();u.updateTime(e,s,d)}},n}(Qt);Tl.prototype.options_={children:[]},!ti&&!$e&&Tl.prototype.options_.children.push("timeTooltip"),Qt.registerComponent("PlayProgressBar",Tl);var xu=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update=zr(Cn(qi(s),s.update),30),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},r.update=function(e,s){var u=this,d=s*this.player_.duration();this.getChild("timeTooltip").updateTime(e,s,d,function(){u.el_.style.left=e.width*s+"px"})},n}(Qt);xu.prototype.options_={children:["timeTooltip"]},Qt.registerComponent("MouseTimeDisplay",xu);var Al=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).setEventHandlers_(),s}Ti(n,c);var r=n.prototype;return r.setEventHandlers_=function(){var e=this;this.update_=Cn(this,this.update),this.update=zr(this.update_,30),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(s){return e.enableInterval_(s)},this.disableIntervalHandler_=function(s){return e.disableInterval_(s)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)},r.toggleVisibility_=function(e){"hidden"===document.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},r.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,30))},r.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||!this.updateInterval||(this.clearInterval(this.updateInterval),this.updateInterval=null)},r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},r.update=function(e){var s=this;if("hidden"!==document.visibilityState){var u=c.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var d=s.player_.ended()?s.player_.duration():s.getCurrentTime_(),m=s.player_.liveTracker,g=s.player_.duration();m&&m.isLive()&&(g=s.player_.liveTracker.liveCurrentTime()),s.percent_!==u&&(s.el_.setAttribute("aria-valuenow",(100*u).toFixed(2)),s.percent_=u),(s.currentTime_!==d||s.duration_!==g)&&(s.el_.setAttribute("aria-valuetext",s.localize("progress bar timing: currentTime={1} duration={2}",[ls(d,g),ls(g,g)],"{1} of {2}")),s.currentTime_=d,s.duration_=g),s.bar&&s.bar.update(Ut(s.el()),s.getProgress())}),u}},r.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},r.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},r.getPercent=function(){var s,e=this.getCurrentTime_(),u=this.player_.liveTracker;return u&&u.isLive()?(s=(e-u.seekableStart())/u.liveWindow(),u.atLiveEdge()&&(s=1)):s=e/this.player_.duration(),s},r.handleMouseDown=function(e){!Fi(e)||(e.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),c.prototype.handleMouseDown.call(this,e))},r.handleMouseMove=function(e,s){if(void 0===s&&(s=!1),Fi(e)){!s&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var u,d=this.calculateDistance(e),m=this.player_.liveTracker;if(m&&m.isLive()){if(d>=.99)return void m.seekToLiveEdge();var g=m.seekableStart(),T=m.liveCurrentTime();if((u=g+d*m.liveWindow())>=T&&(u=T),u<=g&&(u=g+.1),u===1/0)return}else(u=d*this.player_.duration())===this.player_.duration()&&(u-=.1);this.userSeek_(u)}},r.enable=function(){c.prototype.enable.call(this);var e=this.getChild("mouseTimeDisplay");!e||e.show()},r.disable=function(){c.prototype.disable.call(this);var e=this.getChild("mouseTimeDisplay");!e||e.hide()},r.handleMouseUp=function(e){c.prototype.handleMouseUp.call(this,e),e&&e.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?ga(this.player_.play()):this.update_()},r.stepForward=function(){this.userSeek_(this.player_.currentTime()+5)},r.stepBack=function(){this.userSeek_(this.player_.currentTime()-5)},r.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},r.handleKeyDown=function(e){var s=this.player_.liveTracker;if(wi.isEventKey(e,"Space")||wi.isEventKey(e,"Enter"))e.preventDefault(),e.stopPropagation(),this.handleAction(e);else if(wi.isEventKey(e,"Home"))e.preventDefault(),e.stopPropagation(),this.userSeek_(0);else if(wi.isEventKey(e,"End"))e.preventDefault(),e.stopPropagation(),s&&s.isLive()?this.userSeek_(s.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(wi(e))){e.preventDefault(),e.stopPropagation();var u=10*(wi.codes[wi(e)]-wi.codes[0])/100;s&&s.isLive()?this.userSeek_(s.seekableStart()+s.liveWindow()*u):this.userSeek_(this.player_.duration()*u)}else wi.isEventKey(e,"PgDn")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()-60)):wi.isEventKey(e,"PgUp")?(e.preventDefault(),e.stopPropagation(),this.userSeek_(this.player_.currentTime()+60)):c.prototype.handleKeyDown.call(this,e)},r.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.off(document,"visibilitychange",this.toggleVisibility_),c.prototype.dispose.call(this)},n}(yu);Al.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!ti&&!$e&&Al.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),Qt.registerComponent("SeekBar",Al);var Rc=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).handleMouseMove=zr(Cn(qi(s),s.handleMouseMove),30),s.throttledHandleMouseSeek=zr(Cn(qi(s),s.handleMouseSeek),30),s.handleMouseUpHandler_=function(u){return s.handleMouseUp(u)},s.handleMouseDownHandler_=function(u){return s.handleMouseDown(u)},s.enable(),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},r.handleMouseMove=function(e){var s=this.getChild("seekBar");if(s){var u=s.getChild("playProgressBar"),d=s.getChild("mouseTimeDisplay");if(u||d){var m=s.el(),g=mi(m),T=ui(m,e).x;T=ja(T,0,1),d&&d.update(g,T),u&&u.update(g,s.getProgress())}}},r.handleMouseSeek=function(e){var s=this.getChild("seekBar");s&&s.handleMouseMove(e)},r.enabled=function(){return this.enabled_},r.disable=function(){if(this.children().forEach(function(s){return s.disable&&s.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&ga(this.player_.play())}},r.enable=function(){this.children().forEach(function(e){return e.enable&&e.enable()}),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},r.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},r.handleMouseDown=function(e){var s=this.el_.ownerDocument,u=this.getChild("seekBar");u&&u.handleMouseDown(e),this.on(s,"mousemove",this.throttledHandleMouseSeek),this.on(s,"touchmove",this.throttledHandleMouseSeek),this.on(s,"mouseup",this.handleMouseUpHandler_),this.on(s,"touchend",this.handleMouseUpHandler_)},r.handleMouseUp=function(e){var s=this.getChild("seekBar");s&&s.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},n}(Qt);Rc.prototype.options_={children:["seekBar"]},Qt.registerComponent("ProgressControl",Rc);var Tu=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on(o,["enterpictureinpicture","leavepictureinpicture"],function(u){return s.handlePictureInPictureChange(u)}),s.on(o,["disablepictureinpicturechanged","loadedmetadata"],function(u){return s.handlePictureInPictureEnabledChange(u)}),s.on(o,["loadedmetadata","audioonlymodechange","audiopostermodechange"],function(){"audio"===o.currentType().substring(0,5)||o.audioPosterMode()||o.audioOnlyMode()?(o.isInPictureInPicture()&&o.exitPictureInPicture(),s.hide()):s.show()}),s.disable(),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-picture-in-picture-control "+c.prototype.buildCSSClass.call(this)},r.handlePictureInPictureEnabledChange=function(){document.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},r.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},r.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},n}(Ra);Tu.prototype.controlText_="Picture-in-Picture",Qt.registerComponent("PictureInPictureToggle",Tu);var $n=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on(o,"fullscreenchange",function(u){return s.handleFullscreenChange(u)}),!1===document[o.fsApi_.fullscreenEnabled]&&s.disable(),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-fullscreen-control "+c.prototype.buildCSSClass.call(this)},r.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},r.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},n}(Ra);$n.prototype.controlText_="Fullscreen",Qt.registerComponent("FullscreenToggle",$n);var Dc=function(c){function n(){return c.apply(this,arguments)||this}return Ti(n,c),n.prototype.createEl=function(){var e=c.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return e.appendChild(c.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),e},n}(Qt);Qt.registerComponent("VolumeLevel",Dc);var Au=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update=zr(Cn(qi(s),s.update),30),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},r.update=function(e,s,u,d){if(!u){var m=Ut(this.el_),g=Ut(this.player_.el()),T=e.width*s;if(!g||!m)return;var L=e.left-g.left+T,P=e.width-T+(g.right-e.right),q=m.width/2;L<q?q+=q-L:P<q&&(q=P),q<0?q=0:q>m.width&&(q=m.width),this.el_.style.right="-"+q+"px"}this.write(d+"%")},r.write=function(e){v(this.el_,e)},r.updateVolume=function(e,s,u,d,m){var g=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",function(){g.update(e,s,u,d.toFixed(0)),m&&m()})},n}(Qt);Qt.registerComponent("VolumeLevelTooltip",Au);var Ro=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).update=zr(Cn(qi(s),s.update),30),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},r.update=function(e,s,u){var d=this,m=100*s;this.getChild("volumeLevelTooltip").updateVolume(e,s,u,m,function(){u?d.el_.style.bottom=e.height*s+"px":d.el_.style.left=e.width*s+"px"})},n}(Qt);Ro.prototype.options_={children:["volumeLevelTooltip"]},Qt.registerComponent("MouseVolumeLevelDisplay",Ro);var Tr=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on("slideractive",function(u){return s.updateLastVolume_(u)}),s.on(o,"volumechange",function(u){return s.updateARIAAttributes(u)}),o.ready(function(){return s.updateARIAAttributes()}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},r.handleMouseDown=function(e){!Fi(e)||c.prototype.handleMouseDown.call(this,e)},r.handleMouseMove=function(e){var s=this.getChild("mouseVolumeLevelDisplay");if(s){var u=this.el(),d=Ut(u),m=this.vertical(),g=ui(u,e);g=ja(g=m?g.y:g.x,0,1),s.update(d,g,m)}!Fi(e)||(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},r.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},r.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},r.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},r.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},r.updateARIAAttributes=function(e){var s=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",s),this.el_.setAttribute("aria-valuetext",s+"%")},r.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},r.updateLastVolume_=function(){var e=this,s=this.player_.volume();this.one("sliderinactive",function(){0===e.player_.volume()&&e.player_.lastVolume_(s)})},n}(yu);Tr.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!ti&&!$e&&Tr.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),Tr.prototype.playerEvent="volumechange",Qt.registerComponent("VolumeBar",Tr);var Xf=function(c){function n(o,e){var s;return void 0===e&&(e={}),e.vertical=e.vertical||!1,(typeof e.volumeBar>"u"||Ve(e.volumeBar))&&(e.volumeBar=e.volumeBar||{},e.volumeBar.vertical=e.vertical),s=c.call(this,o,e)||this,function(n,r){r.tech_&&!r.tech_.featuresVolumeControl&&n.addClass("vjs-hidden"),n.on(r,"loadstart",function(){r.tech_.featuresVolumeControl?n.removeClass("vjs-hidden"):n.addClass("vjs-hidden")})}(qi(s),o),s.throttledHandleMouseMove=zr(Cn(qi(s),s.handleMouseMove),30),s.handleMouseUpHandler_=function(u){return s.handleMouseUp(u)},s.on("mousedown",function(u){return s.handleMouseDown(u)}),s.on("touchstart",function(u){return s.handleMouseDown(u)}),s.on("mousemove",function(u){return s.handleMouseMove(u)}),s.on(s.volumeBar,["focus","slideractive"],function(){s.volumeBar.addClass("vjs-slider-active"),s.addClass("vjs-slider-active"),s.trigger("slideractive")}),s.on(s.volumeBar,["blur","sliderinactive"],function(){s.volumeBar.removeClass("vjs-slider-active"),s.removeClass("vjs-slider-active"),s.trigger("sliderinactive")}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e="vjs-volume-horizontal";return this.options_.vertical&&(e="vjs-volume-vertical"),c.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+e})},r.handleMouseDown=function(e){var s=this.el_.ownerDocument;this.on(s,"mousemove",this.throttledHandleMouseMove),this.on(s,"touchmove",this.throttledHandleMouseMove),this.on(s,"mouseup",this.handleMouseUpHandler_),this.on(s,"touchend",this.handleMouseUpHandler_)},r.handleMouseUp=function(e){var s=this.el_.ownerDocument;this.off(s,"mousemove",this.throttledHandleMouseMove),this.off(s,"touchmove",this.throttledHandleMouseMove),this.off(s,"mouseup",this.handleMouseUpHandler_),this.off(s,"touchend",this.handleMouseUpHandler_)},r.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},n}(Qt);Xf.prototype.options_={children:["volumeBar"]},Qt.registerComponent("VolumeControl",Xf);var qf=function(c){function n(o,e){var s;return s=c.call(this,o,e)||this,function(n,r){r.tech_&&!r.tech_.featuresMuteControl&&n.addClass("vjs-hidden"),n.on(r,"loadstart",function(){r.tech_.featuresMuteControl?n.removeClass("vjs-hidden"):n.addClass("vjs-hidden")})}(qi(s),o),s.on(o,["loadstart","volumechange"],function(u){return s.update(u)}),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-mute-control "+c.prototype.buildCSSClass.call(this)},r.handleClick=function(e){var s=this.player_.volume(),u=this.player_.lastVolume_();0===s?(this.player_.volume(u<.1?.1:u),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},r.update=function(e){this.updateIcon_(),this.updateControlText_()},r.updateIcon_=function(){var e=this.player_.volume(),s=3;ti&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?s=0:e<.33?s=1:e<.67&&(s=2);for(var u=0;u<4;u++)fe(this.el_,"vjs-vol-"+u);G(this.el_,"vjs-vol-"+s)},r.updateControlText_=function(){var s=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==s&&this.controlText(s)},n}(Ra);qf.prototype.controlText_="Mute",Qt.registerComponent("MuteToggle",qf);var jr=function(c){function n(o,e){var s;return void 0===e&&(e={}),e.inline=!(typeof e.inline<"u")||e.inline,(typeof e.volumeControl>"u"||Ve(e.volumeControl))&&(e.volumeControl=e.volumeControl||{},e.volumeControl.vertical=!e.inline),(s=c.call(this,o,e)||this).handleKeyPressHandler_=function(u){return s.handleKeyPress(u)},s.on(o,["loadstart"],function(u){return s.volumePanelState_(u)}),s.on(s.muteToggle,"keyup",function(u){return s.handleKeyPress(u)}),s.on(s.volumeControl,"keyup",function(u){return s.handleVolumeControlKeyUp(u)}),s.on("keydown",function(u){return s.handleKeyPress(u)}),s.on("mouseover",function(u){return s.handleMouseOver(u)}),s.on("mouseout",function(u){return s.handleMouseOut(u)}),s.on(s.volumeControl,["slideractive"],s.sliderActive_),s.on(s.volumeControl,["sliderinactive"],s.sliderInactive_),s}Ti(n,c);var r=n.prototype;return r.sliderActive_=function(){this.addClass("vjs-slider-active")},r.sliderInactive_=function(){this.removeClass("vjs-slider-active")},r.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},r.createEl=function(){var e="vjs-volume-panel-horizontal";return this.options_.inline||(e="vjs-volume-panel-vertical"),c.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+e})},r.dispose=function(){this.handleMouseOut(),c.prototype.dispose.call(this)},r.handleVolumeControlKeyUp=function(e){wi.isEventKey(e,"Esc")&&this.muteToggle.focus()},r.handleMouseOver=function(e){this.addClass("vjs-hover"),xr(document,"keyup",this.handleKeyPressHandler_)},r.handleMouseOut=function(e){this.removeClass("vjs-hover"),mr(document,"keyup",this.handleKeyPressHandler_)},r.handleKeyPress=function(e){wi.isEventKey(e,"Esc")&&this.handleMouseOut()},n}(Qt);jr.prototype.options_={children:["muteToggle","volumeControl"]},Qt.registerComponent("VolumePanel",jr);var Fs=function(c){function n(o,e){var s;return s=c.call(this,o,e)||this,e&&(s.menuButton_=e.menuButton),s.focusedChild_=-1,s.on("keydown",function(u){return s.handleKeyDown(u)}),s.boundHandleBlur_=function(u){return s.handleBlur(u)},s.boundHandleTapClick_=function(u){return s.handleTapClick(u)},s}Ti(n,c);var r=n.prototype;return r.addEventListenerForItem=function(e){e instanceof Qt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},r.removeEventListenerForItem=function(e){e instanceof Qt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},r.removeChild=function(e){"string"==typeof e&&(e=this.getChild(e)),this.removeEventListenerForItem(e),c.prototype.removeChild.call(this,e)},r.addItem=function(e){var s=this.addChild(e);s&&this.addEventListenerForItem(s)},r.createEl=function(){this.contentEl_=ee(this.options_.contentElType||"ul",{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var s=c.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return s.appendChild(this.contentEl_),xr(s,"click",function(u){u.preventDefault(),u.stopImmediatePropagation()}),s},r.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,c.prototype.dispose.call(this)},r.handleBlur=function(e){var s=e.relatedTarget||document.activeElement;if(!this.children().some(function(d){return d.el()===s})){var u=this.menuButton_;u&&u.buttonPressed_&&s!==u.el().firstChild&&u.unpressButton()}},r.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var s=this.children();if(!Array.isArray(s))return;var u=s.filter(function(d){return d.el()===e.target})[0];if(!u)return;"CaptionSettingsMenuItem"!==u.name()&&this.menuButton_.focus()}},r.handleKeyDown=function(e){wi.isEventKey(e,"Left")||wi.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(wi.isEventKey(e,"Right")||wi.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},r.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},r.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},r.focus=function(e){void 0===e&&(e=0);var s=this.children().slice();s.length&&s[0].hasClass("vjs-menu-title")&&s.shift(),s.length>0&&(e<0?e=0:e>=s.length&&(e=s.length-1),this.focusedChild_=e,s[e].el_.focus())},n}(Qt);Qt.registerComponent("Menu",Fs);var ur=function(c){function n(o,e){var s;void 0===e&&(e={}),(s=c.call(this,o,e)||this).menuButton_=new Ra(o,e),s.menuButton_.controlText(s.controlText_),s.menuButton_.el_.setAttribute("aria-haspopup","true");var u=Ra.prototype.buildCSSClass();s.menuButton_.el_.className=s.buildCSSClass()+" "+u,s.menuButton_.removeClass("vjs-control"),s.addChild(s.menuButton_),s.update(),s.enabled_=!0;var d=function(g){return s.handleClick(g)};return s.handleMenuKeyUp_=function(m){return s.handleMenuKeyUp(m)},s.on(s.menuButton_,"tap",d),s.on(s.menuButton_,"click",d),s.on(s.menuButton_,"keydown",function(m){return s.handleKeyDown(m)}),s.on(s.menuButton_,"mouseenter",function(){s.addClass("vjs-hover"),s.menu.show(),xr(document,"keyup",s.handleMenuKeyUp_)}),s.on("mouseleave",function(m){return s.handleMouseLeave(m)}),s.on("keydown",function(m){return s.handleSubmenuKeyDown(m)}),s}Ti(n,c);var r=n.prototype;return r.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?(this.hide(),this.menu.contentEl_.removeAttribute("role")):(this.show(),this.menu.contentEl_.setAttribute("role","menu"))},r.createMenu=function(){var e=new Fs(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var s=ee("li",{className:"vjs-menu-title",textContent:rr(this.options_.title),tabIndex:-1}),u=new Qt(this.player_,{el:s});e.addItem(u)}if(this.items=this.createItems(),this.items)for(var d=0;d<this.items.length;d++)e.addItem(this.items[d]);return e},r.createItems=function(){},r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},r.buildWrapperCSSClass=function(){var e="vjs-menu-button";return"vjs-menu-button "+(e+=!0===this.options_.inline?"-inline":"-popup")+" "+Ra.prototype.buildCSSClass()+" "+c.prototype.buildCSSClass.call(this)},r.buildCSSClass=function(){var e="vjs-menu-button";return"vjs-menu-button "+(e+=!0===this.options_.inline?"-inline":"-popup")+" "+c.prototype.buildCSSClass.call(this)},r.controlText=function(e,s){return void 0===s&&(s=this.menuButton_.el()),this.menuButton_.controlText(e,s)},r.dispose=function(){this.handleMouseLeave(),c.prototype.dispose.call(this)},r.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},r.handleMouseLeave=function(e){this.removeClass("vjs-hover"),mr(document,"keyup",this.handleMenuKeyUp_)},r.focus=function(){this.menuButton_.focus()},r.blur=function(){this.menuButton_.blur()},r.handleKeyDown=function(e){wi.isEventKey(e,"Esc")||wi.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),wi.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(wi.isEventKey(e,"Up")||wi.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},r.handleMenuKeyUp=function(e){(wi.isEventKey(e,"Esc")||wi.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},r.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},r.handleSubmenuKeyDown=function(e){(wi.isEventKey(e,"Esc")||wi.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),wi.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},r.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),ti&&Se())return;this.menu.focus()}},r.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},r.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},r.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},n}(Qt);Qt.registerComponent("MenuButton",ur);var ro=function(c){function n(r,o){var e,s=o.tracks;if((e=c.call(this,r,o)||this).items.length<=1&&e.hide(),!s)return qi(e);var u=Cn(qi(e),e.update);return s.addEventListener("removetrack",u),s.addEventListener("addtrack",u),s.addEventListener("labelchange",u),e.player_.on("ready",u),e.player_.on("dispose",function(){s.removeEventListener("removetrack",u),s.removeEventListener("addtrack",u),s.removeEventListener("labelchange",u)}),e}return Ti(n,c),n}(ur);Qt.registerComponent("TrackButton",ro);var wl=["Tab","Esc","Up","Down","Right","Left"],us=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).selectable=e.selectable,s.isSelected_=e.selected||!1,s.multiSelectable=e.multiSelectable,s.selected(s.isSelected_),s.el_.setAttribute("role",s.selectable?s.multiSelectable?"menuitemcheckbox":"menuitemradio":"menuitem"),s}Ti(n,c);var r=n.prototype;return r.createEl=function(e,s,u){this.nonIconControl=!0;var d=c.prototype.createEl.call(this,"li",Oe({className:"vjs-menu-item",tabIndex:-1},s),u);return d.replaceChild(ee("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),d.querySelector(".vjs-icon-placeholder")),d},r.handleKeyDown=function(e){wl.some(function(s){return wi.isEventKey(e,s)})||c.prototype.handleKeyDown.call(this,e)},r.handleClick=function(e){this.selected(!0)},r.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},n}(gl);Qt.registerComponent("MenuItem",us);var Da=function(c){function n(o,e){var s,u=e.track,d=o.textTracks();e.label=u.label||u.language||"Unknown",e.selected="showing"===u.mode,(s=c.call(this,o,e)||this).track=u,s.kinds=(e.kinds||[e.kind||s.track.kind]).filter(Boolean);var T,m=function(){for(var P=arguments.length,q=new Array(P),le=0;le<P;le++)q[le]=arguments[le];s.handleTracksChange.apply(qi(s),q)},g=function(){for(var P=arguments.length,q=new Array(P),le=0;le<P;le++)q[le]=arguments[le];s.handleSelectedLanguageChange.apply(qi(s),q)};return o.on(["loadstart","texttrackchange"],m),d.addEventListener("change",m),d.addEventListener("selectedlanguagechange",g),s.on("dispose",function(){o.off(["loadstart","texttrackchange"],m),d.removeEventListener("change",m),d.removeEventListener("selectedlanguagechange",g)}),void 0===d.onchange&&s.on(["tap","click"],function(){if("object"!=typeof window.Event)try{T=new window.Event("change")}catch{}T||(T=document.createEvent("Event")).initEvent("change",!0,!0),d.dispatchEvent(T)}),s.handleTracksChange(),s}Ti(n,c);var r=n.prototype;return r.handleClick=function(e){var s=this.track,u=this.player_.textTracks();if(c.prototype.handleClick.call(this,e),u)for(var d=0;d<u.length;d++){var m=u[d];-1!==this.kinds.indexOf(m.kind)&&(m===s?"showing"!==m.mode&&(m.mode="showing"):"disabled"!==m.mode&&(m.mode="disabled"))}},r.handleTracksChange=function(e){var s="showing"===this.track.mode;s!==this.isSelected_&&this.selected(s)},r.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var s=this.player_.cache_.selectedLanguage;if(s&&s.enabled&&s.language===this.track.language&&s.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},r.dispose=function(){this.track=null,c.prototype.dispose.call(this)},n}(us);Qt.registerComponent("TextTrackMenuItem",Da);var Yf=function(c){function n(o,e){return e.track={player:o,kind:e.kind,kinds:e.kinds,default:!1,mode:"disabled"},e.kinds||(e.kinds=[e.kind]),e.track.label=e.label?e.label:e.kinds.join(" and ")+" off",e.selectable=!0,e.multiSelectable=!1,c.call(this,o,e)||this}Ti(n,c);var r=n.prototype;return r.handleTracksChange=function(e){for(var s=this.player().textTracks(),u=!0,d=0,m=s.length;d<m;d++){var g=s[d];if(this.options_.kinds.indexOf(g.kind)>-1&&"showing"===g.mode){u=!1;break}}u!==this.isSelected_&&this.selected(u)},r.handleSelectedLanguageChange=function(e){for(var s=this.player().textTracks(),u=!0,d=0,m=s.length;d<m;d++){var g=s[d];if(["captions","descriptions","subtitles"].indexOf(g.kind)>-1&&"showing"===g.mode){u=!1;break}}u&&(this.player_.cache_.selectedLanguage={enabled:!1})},n}(Da);Qt.registerComponent("OffTextTrackMenuItem",Yf);var Xa=function(c){function n(o,e){return void 0===e&&(e={}),e.tracks=o.textTracks(),c.call(this,o,e)||this}return Ti(n,c),n.prototype.createItems=function(e,s){var u;void 0===e&&(e=[]),void 0===s&&(s=Da),this.label_&&(u=this.label_+" off"),e.push(new Yf(this.player_,{kinds:this.kinds_,kind:this.kind_,label:u})),this.hideThreshold_+=1;var d=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var m=0;m<d.length;m++){var g=d[m];if(this.kinds_.indexOf(g.kind)>-1){var T=new s(this.player_,{track:g,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});T.addClass("vjs-"+g.kind+"-menu-item"),e.push(T)}}return e},n}(ro);Qt.registerComponent("TextTrackButton",Xa);var Do=function(c){function n(o,e){var s,u=e.track,d=e.cue,m=o.currentTime();return e.selectable=!0,e.multiSelectable=!1,e.label=d.text,e.selected=d.startTime<=m&&m<d.endTime,(s=c.call(this,o,e)||this).track=u,s.cue=d,s}return Ti(n,c),n.prototype.handleClick=function(e){c.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime)},n}(us);Qt.registerComponent("ChaptersTrackMenuItem",Do);var Sl=function(c){function n(o,e,s){var u;return(u=c.call(this,o,e,s)||this).selectCurrentItem_=function(){u.items.forEach(function(d){d.selected(u.track_.activeCues[0]===d.cue)})},u}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-chapters-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-chapters-button "+c.prototype.buildWrapperCSSClass.call(this)},r.update=function(e){if(!e||!e.track||"chapters"===e.track.kind){var s=this.findChaptersTrack();s!==this.track_?(this.setTrack(s),c.prototype.update.call(this)):(!this.items||s&&s.cues&&s.cues.length!==this.items.length)&&c.prototype.update.call(this)}},r.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var s=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);s&&s.removeEventListener("load",this.updateHandler_),this.track_.removeEventListener("cuechange",this.selectCurrentItem_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var u=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);u&&u.addEventListener("load",this.updateHandler_),this.track_.addEventListener("cuechange",this.selectCurrentItem_)}}},r.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],s=e.length-1;s>=0;s--){var u=e[s];if(u.kind===this.kind_)return u}},r.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(rr(this.kind_))},r.createMenu=function(){return this.options_.title=this.getMenuCaption(),c.prototype.createMenu.call(this)},r.createItems=function(){var e=[];if(!this.track_)return e;var s=this.track_.cues;if(!s)return e;for(var u=0,d=s.length;u<d;u++){var g=new Do(this.player_,{track:this.track_,cue:s[u]});e.push(g)}return e},n}(Xa);Sl.prototype.kind_="chapters",Sl.prototype.controlText_="Chapters",Qt.registerComponent("ChaptersButton",Sl);var El=function(c){function n(o,e,s){var u;u=c.call(this,o,e,s)||this;var d=o.textTracks(),m=Cn(qi(u),u.handleTracksChange);return d.addEventListener("change",m),u.on("dispose",function(){d.removeEventListener("change",m)}),u}Ti(n,c);var r=n.prototype;return r.handleTracksChange=function(e){for(var s=this.player().textTracks(),u=!1,d=0,m=s.length;d<m;d++){var g=s[d];if(g.kind!==this.kind_&&"showing"===g.mode){u=!0;break}}u?this.disable():this.enable()},r.buildCSSClass=function(){return"vjs-descriptions-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+c.prototype.buildWrapperCSSClass.call(this)},n}(Xa);El.prototype.kind_="descriptions",El.prototype.controlText_="Descriptions",Qt.registerComponent("DescriptionsButton",El);var Oc=function(c){function n(o,e,s){return c.call(this,o,e,s)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-subtitles-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+c.prototype.buildWrapperCSSClass.call(this)},n}(Xa);Oc.prototype.kind_="subtitles",Oc.prototype.controlText_="Subtitles",Qt.registerComponent("SubtitlesButton",Oc);var sd=function(c){function n(o,e){var s;return e.track={player:o,kind:e.kind,label:e.kind+" settings",selectable:!1,default:!1,mode:"disabled"},e.selectable=!1,e.name="CaptionSettingsMenuItem",(s=c.call(this,o,e)||this).addClass("vjs-texttrack-settings"),s.controlText(", opens "+e.kind+" settings dialog"),s}return Ti(n,c),n.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},n}(Da);Qt.registerComponent("CaptionSettingsMenuItem",sd);var od=function(c){function n(o,e,s){return c.call(this,o,e,s)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-captions-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-captions-button "+c.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new sd(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),c.prototype.createItems.call(this,e)},n}(Xa);od.prototype.kind_="captions",od.prototype.controlText_="Captions",Qt.registerComponent("CaptionsButton",od);var Qf=function(c){function n(){return c.apply(this,arguments)||this}return Ti(n,c),n.prototype.createEl=function(e,s,u){var d=c.prototype.createEl.call(this,e,s,u),m=d.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(m.appendChild(ee("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),m.appendChild(ee("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),d},n}(Da);Qt.registerComponent("SubsCapsMenuItem",Qf);var ld=function(c){function n(o,e){var s;return void 0===e&&(e={}),(s=c.call(this,o,e)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(s.player_.language_)>-1&&(s.label_="captions"),s.menuButton_.controlText(rr(s.label_)),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-subs-caps-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+c.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){var e=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(e.push(new sd(this.player_,{kind:this.label_})),this.hideThreshold_+=1),c.prototype.createItems.call(this,e,Qf)},n}(Xa);ld.prototype.kinds_=["captions","subtitles"],ld.prototype.controlText_="Subtitles",Qt.registerComponent("SubsCapsButton",ld);var Kf=function(c){function n(o,e){var s,u=e.track,d=o.audioTracks();e.label=u.label||u.language||"Unknown",e.selected=u.enabled,(s=c.call(this,o,e)||this).track=u,s.addClass("vjs-"+u.kind+"-menu-item");var m=function(){for(var T=arguments.length,L=new Array(T),P=0;P<T;P++)L[P]=arguments[P];s.handleTracksChange.apply(qi(s),L)};return d.addEventListener("change",m),s.on("dispose",function(){d.removeEventListener("change",m)}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(e,s,u){var d=c.prototype.createEl.call(this,e,s,u),m=d.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(m.appendChild(ee("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),m.appendChild(ee("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),d},r.handleClick=function(e){if(c.prototype.handleClick.call(this,e),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var s=this.player_.audioTracks(),u=0;u<s.length;u++){var d=s[u];d!==this.track&&(d.enabled=d===this.track)}},r.handleTracksChange=function(e){this.selected(this.track.enabled)},n}(us);Qt.registerComponent("AudioTrackMenuItem",Kf);var Zf=function(c){function n(o,e){return void 0===e&&(e={}),e.tracks=o.audioTracks(),c.call(this,o,e)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-audio-button "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-audio-button "+c.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var s=this.player_.audioTracks(),u=0;u<s.length;u++)e.push(new Kf(this.player_,{track:s[u],selectable:!0,multiSelectable:!1}));return e},n}(ro);Zf.prototype.controlText_="Audio Track",Qt.registerComponent("AudioTrackButton",Zf);var ud=function(c){function n(o,e){var s,u=e.rate,d=parseFloat(u,10);return e.label=u,e.selected=d===o.playbackRate(),e.selectable=!0,e.multiSelectable=!1,(s=c.call(this,o,e)||this).label=u,s.rate=d,s.on(o,"ratechange",function(m){return s.update(m)}),s}Ti(n,c);var r=n.prototype;return r.handleClick=function(e){c.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},r.update=function(e){this.selected(this.player().playbackRate()===this.rate)},n}(us);ud.prototype.contentElType="button",Qt.registerComponent("PlaybackRateMenuItem",ud);var $f=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).menuButton_.el_.setAttribute("aria-describedby",s.labelElId_),s.updateVisibility(),s.updateLabel(),s.on(o,"loadstart",function(u){return s.updateVisibility(u)}),s.on(o,"ratechange",function(u){return s.updateLabel(u)}),s.on(o,"playbackrateschange",function(u){return s.handlePlaybackRateschange(u)}),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){var e=c.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=ee("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),e.appendChild(this.labelEl_),e},r.dispose=function(){this.labelEl_=null,c.prototype.dispose.call(this)},r.buildCSSClass=function(){return"vjs-playback-rate "+c.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-playback-rate "+c.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){for(var e=this.playbackRates(),s=[],u=e.length-1;u>=0;u--)s.push(new ud(this.player(),{rate:e[u]+"x"}));return s},r.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},r.handleClick=function(e){var s=this.player().playbackRate(),u=this.playbackRates(),m=(u.indexOf(s)+1)%u.length;this.player().playbackRate(u[m])},r.handlePlaybackRateschange=function(e){this.update()},r.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},r.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},r.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},r.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},n}(ur);$f.prototype.controlText_="Playback Rate",Qt.registerComponent("PlaybackRateMenuButton",$f);var Jf=function(c){function n(){return c.apply(this,arguments)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-spacer "+c.prototype.buildCSSClass.call(this)},r.createEl=function(e,s,u){return void 0===e&&(e="div"),void 0===s&&(s={}),void 0===u&&(u={}),s.className||(s.className=this.buildCSSClass()),c.prototype.createEl.call(this,e,s,u)},n}(Qt);Qt.registerComponent("Spacer",Jf);var ig=function(c){function n(){return c.apply(this,arguments)||this}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-custom-control-spacer "+c.prototype.buildCSSClass.call(this)},r.createEl=function(){return c.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xa0"})},n}(Jf);Qt.registerComponent("CustomControlSpacer",ig);var Fc=function(c){function n(){return c.apply(this,arguments)||this}return Ti(n,c),n.prototype.createEl=function(){return c.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},n}(Qt);Fc.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in document&&Fc.prototype.options_.children.splice(Fc.prototype.options_.children.length-1,0,"pictureInPictureToggle"),Qt.registerComponent("ControlBar",Fc);var ep=function(c){function n(o,e){var s;return(s=c.call(this,o,e)||this).on(o,"error",function(u){return s.open(u)}),s}Ti(n,c);var r=n.prototype;return r.buildCSSClass=function(){return"vjs-error-display "+c.prototype.buildCSSClass.call(this)},r.content=function(){var e=this.player().error();return e?this.localize(e.message):""},n}($s);ep.prototype.options_=Be({},$s.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),Qt.registerComponent("ErrorDisplay",ep);var cd="vjs-text-track-settings",tp=["#000","Black"],ip=["#00F","Blue"],np=["#0FF","Cyan"],rp=["#0F0","Green"],ap=["#F0F","Magenta"],sp=["#F00","Red"],op=["#FFF","White"],lp=["#FF0","Yellow"],hd=["1","Opaque"],dd=["0.5","Semi-Transparent"],up=["0","Transparent"],Oo={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[tp,op,sp,rp,ip,lp,ap,np]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[hd,dd,up]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[op,tp,sp,rp,ip,lp,ap,np]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(n){return"1.00"===n?null:Number(n)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[hd,dd]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[up,dd,hd]}};function cp(c,n){if(n&&(c=n(c)),c&&"none"!==c)return c}Oo.windowColor.options=Oo.backgroundColor.options;var ag=function(c){function n(o,e){var s;return e.temporary=!1,(s=c.call(this,o,e)||this).updateDisplay=s.updateDisplay.bind(qi(s)),s.fill(),s.hasBeenOpened_=s.hasBeenFilled_=!0,s.endDialog=ee("p",{className:"vjs-control-text",textContent:s.localize("End of dialog window.")}),s.el().appendChild(s.endDialog),s.setDefaults(),void 0===e.persistTextTrackSettings&&(s.options_.persistTextTrackSettings=s.options_.playerOptions.persistTextTrackSettings),s.on(s.$(".vjs-done-button"),"click",function(){s.saveSettings(),s.close()}),s.on(s.$(".vjs-default-button"),"click",function(){s.setDefaults(),s.updateDisplay()}),se(Oo,function(u){s.on(s.$(u.selector),"change",s.updateDisplay)}),s.options_.persistTextTrackSettings&&s.restoreSettings(),s}Ti(n,c);var r=n.prototype;return r.dispose=function(){this.endDialog=null,c.prototype.dispose.call(this)},r.createElSelect_=function(e,s,u){var d=this;void 0===s&&(s=""),void 0===u&&(u="label");var m=Oo[e],g=m.id.replace("%s",this.id_),T=[s,g].join(" ").trim();return["<"+u+' id="'+g+'" class="'+("label"===u?"vjs-label":"")+'">',this.localize(m.label),"</"+u+">",'<select aria-labelledby="'+T+'">'].concat(m.options.map(function(L){var P=g+"-"+L[1].replace(/\W+/g,"");return['<option id="'+P+'" value="'+L[0]+'" ','aria-labelledby="'+T+" "+P+'">',d.localize(L[1]),"</option>"].join("")})).concat("</select>").join("")},r.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},r.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},r.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},r.createElColors_=function(){return ee("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},r.createElFont_=function(){return ee("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},r.createElControls_=function(){var e=this.localize("restore all settings to the default values");return ee("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},r.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},r.label=function(){return this.localize("Caption Settings Dialog")},r.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},r.buildCSSClass=function(){return c.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},r.getValues=function(){var e=this;return function Ue(c,n,r){return void 0===r&&(r=0),Ae(c).reduce(function(o,e){return n(o,c[e],e)},r)}(Oo,function(s,u,d){var m=function ng(c,n){return cp(c.options[c.options.selectedIndex].value,n)}(e.$(u.selector),u.parser);return void 0!==m&&(s[d]=m),s},{})},r.setValues=function(e){var s=this;se(Oo,function(u,d){!function rg(c,n,r){if(n)for(var o=0;o<c.options.length;o++)if(cp(c.options[o].value,r)===n){c.selectedIndex=o;break}}(s.$(u.selector),e[d],u.parser)})},r.setDefaults=function(){var e=this;se(Oo,function(s){var u=s.hasOwnProperty("default")?s.default:0;e.$(s.selector).selectedIndex=u})},r.restoreSettings=function(){var e;try{e=JSON.parse(window.localStorage.getItem(cd))}catch(s){ne.warn(s)}e&&this.setValues(e)},r.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?window.localStorage.setItem(cd,JSON.stringify(e)):window.localStorage.removeItem(cd)}catch(s){ne.warn(s)}}},r.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},r.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,s=e&&e.subsCapsButton,u=e&&e.captionsButton;s?s.focus():u&&u.focus()},n}($s);Qt.registerComponent("TextTrackSettings",ag);var sg=function(c){function n(o,e){var s,u=e.ResizeObserver||window.ResizeObserver;null===e.ResizeObserver&&(u=!1);var d=Le({createEl:!u,reportTouchActivity:!1},e);return(s=c.call(this,o,d)||this).ResizeObserver=e.ResizeObserver||window.ResizeObserver,s.loadListener_=null,s.resizeObserver_=null,s.debouncedHandler_=function(n,r,o,e){void 0===e&&(e=window);var s,d=function(){var g=this,T=arguments,L=function(){s=null,L=null,n.apply(g,T)};e.clearTimeout(s),s=e.setTimeout(L,100)};return d.cancel=function(){e.clearTimeout(s),s=null},d}(function(){s.resizeHandler()},0,0,qi(s)),u?(s.resizeObserver_=new s.ResizeObserver(s.debouncedHandler_),s.resizeObserver_.observe(o.el())):(s.loadListener_=function(){if(s.el_&&s.el_.contentWindow){var m=s.debouncedHandler_,g=s.unloadListener_=function(){mr(this,"resize",m),mr(this,"unload",g),g=null};xr(s.el_.contentWindow,"unload",g),xr(s.el_.contentWindow,"resize",m)}},s.one("load",s.loadListener_)),s}Ti(n,c);var r=n.prototype;return r.createEl=function(){return c.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1,title:this.localize("No content")},{"aria-hidden":"true"})},r.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},r.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,c.prototype.dispose.call(this)},n}(Qt);Qt.registerComponent("ResizeManager",sg);var og={trackingThreshold:20,liveTolerance:15},lg=function(c){function n(o,e){var s,u=Le(og,e,{createEl:!1});return(s=c.call(this,o,u)||this).handleVisibilityChange_=function(d){return s.handleVisibilityChange(d)},s.trackLiveHandler_=function(){return s.trackLive_()},s.handlePlay_=function(d){return s.handlePlay(d)},s.handleFirstTimeupdate_=function(d){return s.handleFirstTimeupdate(d)},s.handleSeeked_=function(d){return s.handleSeeked(d)},s.seekToLiveEdge_=function(d){return s.seekToLiveEdge(d)},s.reset_(),s.on(s.player_,"durationchange",function(d){return s.handleDurationchange(d)}),s.on(s.player_,"canplay",function(){return s.toggleTracking()}),ei&&"hidden"in document&&"visibilityState"in document&&s.on(document,"visibilitychange",s.handleVisibilityChange_),s}Ti(n,c);var r=n.prototype;return r.handleVisibilityChange=function(){this.player_.duration()===1/0&&(document.hidden?this.stopTracking():this.startTracking())},r.trackLive_=function(){var e=this.player_.seekable();if(e&&e.length){var s=Number(window.performance.now().toFixed(4)),u=-1===this.lastTime_?0:(s-this.lastTime_)/1e3;this.lastTime_=s,this.pastSeekEnd_=this.pastSeekEnd()+u;var d=this.liveCurrentTime(),m=this.player_.currentTime(),g=this.player_.paused()||this.seekedBehindLive_||Math.abs(d-m)>this.options_.liveTolerance;(!this.timeupdateSeen_||d===1/0)&&(g=!1),g!==this.behindLiveEdge_&&(this.behindLiveEdge_=g,this.trigger("liveedgechange"))}},r.handleDurationchange=function(){this.toggleTracking()},r.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},r.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,30),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},r.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},r.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},r.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},r.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},r.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},r.stopTracking=function(){!this.isTracking()||(this.reset_(),this.trigger("liveedgechange"))},r.seekableEnd=function(){for(var e=this.player_.seekable(),s=[],u=e?e.length:0;u--;)s.push(e.end(u));return s.length?s.sort()[s.length-1]:1/0},r.seekableStart=function(){for(var e=this.player_.seekable(),s=[],u=e?e.length:0;u--;)s.push(e.start(u));return s.length?s.sort()[0]:0},r.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},r.isLive=function(){return this.isTracking()},r.atLiveEdge=function(){return!this.behindLiveEdge()},r.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},r.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},r.behindLiveEdge=function(){return this.behindLiveEdge_},r.isTracking=function(){return"number"==typeof this.trackingInterval_},r.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},r.dispose=function(){this.off(document,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),c.prototype.dispose.call(this)},n}(Qt);Qt.registerComponent("LiveTracker",lg);var Nc,fd=function(n){var r=n.el();if(r.hasAttribute("src"))return n.triggerSourceset(r.src),!0;var o=n.$$("source"),e=[],s="";if(!o.length)return!1;for(var u=0;u<o.length;u++){var d=o[u].src;d&&-1===e.indexOf(d)&&e.push(d)}return!!e.length&&(1===e.length&&(s=e[0]),n.triggerSourceset(s),!0)},ug=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(n){var r=document.createElement(this.nodeName.toLowerCase());r.innerHTML=n;for(var o=document.createDocumentFragment();r.childNodes.length;)o.appendChild(r.childNodes[0]);return this.innerText="",window.Element.prototype.appendChild.call(this,o),this.innerHTML}}),hp=function(n,r){for(var o={},e=0;e<n.length&&!((o=Object.getOwnPropertyDescriptor(n[e],r))&&o.set&&o.get);e++);return o.enumerable=!0,o.configurable=!0,o},dp=function(n){var r=n.el();if(!r.resetSourceWatch_){var o={},e=function(n){return hp([n.el(),window.HTMLMediaElement.prototype,window.Element.prototype,ug],"innerHTML")}(n),s=function(d){return function(){for(var m=arguments.length,g=new Array(m),T=0;T<m;T++)g[T]=arguments[T];var L=d.apply(r,g);return fd(n),L}};["append","appendChild","insertAdjacentHTML"].forEach(function(u){!r[u]||(o[u]=r[u],r[u]=s(o[u]))}),Object.defineProperty(r,"innerHTML",Le(e,{set:s(e.set)})),r.resetSourceWatch_=function(){r.resetSourceWatch_=null,Object.keys(o).forEach(function(u){r[u]=o[u]}),Object.defineProperty(r,"innerHTML",e)},n.one("sourceset",r.resetSourceWatch_)}},hg=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Df(window.Element.prototype.getAttribute.call(this,"src")):""},set:function(n){return window.Element.prototype.setAttribute.call(this,"src",n),n}}),pd=function(n,r,o,e){void 0===e&&(e=!0);var s=function(m){return Object.defineProperty(n,r,{value:m,enumerable:!0,writable:!0})},u={configurable:!0,enumerable:!0,get:function(){var m=o();return s(m),m}};return e&&(u.set=s),Object.defineProperty(n,r,u)},Li=function(c){function n(o,e){var s;s=c.call(this,o,e)||this;var u=o.source,d=!1;if(s.featuresVideoFrameCallback=s.featuresVideoFrameCallback&&"VIDEO"===s.el_.tagName,u&&(s.el_.currentSrc!==u.src||o.tag&&3===o.tag.initNetworkState_)?s.setSource(u):s.handleLateInit_(s.el_),o.enableSourceset&&s.setupSourcesetHandling_(),s.isScrubbing_=!1,s.el_.hasChildNodes()){for(var m=s.el_.childNodes,g=m.length,T=[];g--;){var L=m[g];"track"===L.nodeName.toLowerCase()&&(s.featuresNativeTextTracks?(s.remoteTextTrackEls().addTrackElement_(L),s.remoteTextTracks().addTrack(L.track),s.textTracks().addTrack(L.track),!d&&!s.el_.hasAttribute("crossorigin")&&Js(L.src)&&(d=!0)):T.push(L))}for(var q=0;q<T.length;q++)s.el_.removeChild(T[q])}return s.proxyNativeTracks_(),s.featuresNativeTextTracks&&d&&ne.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),s.restoreMetadataTracksInIOSNativePlayer_(),(Me||Jt||we)&&!0===o.nativeControlsForTouch&&s.setControls(!0),s.proxyWebkitFullscreen_(),s.triggerReady(),s}Ti(n,c);var r=n.prototype;return r.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),n.disposeMediaElement(this.el_),this.options_=null,c.prototype.dispose.call(this)},r.setupSourcesetHandling_=function(){!function(n){if(n.featuresSourceset){var r=n.el();if(!r.resetSourceset_){var o=function(n){return hp([n.el(),window.HTMLMediaElement.prototype,hg],"src")}(n),e=r.setAttribute,s=r.load;Object.defineProperty(r,"src",Le(o,{set:function(d){var m=o.set.call(r,d);return n.triggerSourceset(r.src),m}})),r.setAttribute=function(u,d){var m=e.call(r,u,d);return/src/i.test(u)&&n.triggerSourceset(r.src),m},r.load=function(){var u=s.call(r);return fd(n)||(n.triggerSourceset(""),dp(n)),u},r.currentSrc?n.triggerSourceset(r.currentSrc):fd(n)||dp(n),r.resetSourceset_=function(){r.resetSourceset_=null,r.load=s,r.setAttribute=e,Object.defineProperty(r,"src",o),r.resetSourceWatch_&&r.resetSourceWatch_()}}}}(this)},r.restoreMetadataTracksInIOSNativePlayer_=function(){var s,e=this.textTracks(),u=function(){s=[];for(var g=0;g<e.length;g++){var T=e[g];"metadata"===T.kind&&s.push({track:T,storedMode:T.mode})}};u(),e.addEventListener("change",u),this.on("dispose",function(){return e.removeEventListener("change",u)});var d=function m(){for(var g=0;g<s.length;g++){var T=s[g];"disabled"===T.track.mode&&T.track.mode!==T.storedMode&&(T.track.mode=T.storedMode)}e.removeEventListener("change",m)};this.on("webkitbeginfullscreen",function(){e.removeEventListener("change",u),e.removeEventListener("change",d),e.addEventListener("change",d)}),this.on("webkitendfullscreen",function(){e.removeEventListener("change",u),e.addEventListener("change",u),e.removeEventListener("change",d)})},r.overrideNative_=function(e,s){var u=this;if(s===this["featuresNative"+e+"Tracks"]){var d=e.toLowerCase();this[d+"TracksListeners_"]&&Object.keys(this[d+"TracksListeners_"]).forEach(function(m){u.el()[d+"Tracks"].removeEventListener(m,u[d+"TracksListeners_"][m])}),this["featuresNative"+e+"Tracks"]=!s,this[d+"TracksListeners_"]=null,this.proxyNativeTracksForType_(d)}},r.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},r.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},r.proxyNativeTracksForType_=function(e){var s=this,u=Vr[e],d=this.el()[u.getterName],m=this[u.getterName]();if(this["featuresNative"+u.capitalName+"Tracks"]&&d&&d.addEventListener){var g={change:function(P){var q={type:"change",target:m,currentTarget:m,srcElement:m};m.trigger(q),"text"===e&&s[Cs.remoteText.getterName]().trigger(q)},addtrack:function(P){m.addTrack(P.track)},removetrack:function(P){m.removeTrack(P.track)}},T=function(){for(var P=[],q=0;q<m.length;q++){for(var le=!1,_e=0;_e<d.length;_e++)if(d[_e]===m[q]){le=!0;break}le||P.push(m[q])}for(;P.length;)m.removeTrack(P.shift())};this[u.getterName+"Listeners_"]=g,Object.keys(g).forEach(function(L){var P=g[L];d.addEventListener(L,P),s.on("dispose",function(q){return d.removeEventListener(L,P)})}),this.on("loadstart",T),this.on("dispose",function(L){return s.off("loadstart",T)})}},r.proxyNativeTracks_=function(){var e=this;Vr.names.forEach(function(s){e.proxyNativeTracksForType_(s)})},r.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var s=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(s,e),n.disposeMediaElement(e),e=s}else{e=document.createElement("video");var d=Le({},this.options_.tag&&nt(this.options_.tag));(!Me||!0!==this.options_.nativeControlsForTouch)&&delete d.controls,He(e,Oe(d,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}typeof this.options_.preload<"u"&&gt(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var m=["loop","muted","playsinline","autoplay"],g=0;g<m.length;g++){var T=m[g],L=this.options_[T];typeof L<"u"&&(L?gt(e,T,T):wt(e,T),e[T]=L)}return e},r.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var s=!1,u=function(){s=!0};this.on("loadstart",u);var d=function(){s||this.trigger("loadstart")};return this.on("loadedmetadata",d),void this.ready(function(){this.off("loadstart",u),this.off("loadedmetadata",d),s||this.trigger("loadstart")})}var m=["loadstart"];m.push("loadedmetadata"),e.readyState>=2&&m.push("loadeddata"),e.readyState>=3&&m.push("canplay"),e.readyState>=4&&m.push("canplaythrough"),this.ready(function(){m.forEach(function(g){this.trigger(g)},this)})}},r.setScrubbing=function(e){this.isScrubbing_=e},r.scrubbing=function(){return this.isScrubbing_},r.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&Ai?this.el_.fastSeek(e):this.el_.currentTime=e}catch(s){ne(s,"Video is not ready. (Video.js)")}},r.duration=function(){var e=this;return this.el_.duration===1/0&&$e&&vt&&0===this.el_.currentTime?(this.on("timeupdate",function u(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",u))}),NaN):this.el_.duration||NaN},r.width=function(){return this.el_.offsetWidth},r.height=function(){return this.el_.offsetHeight},r.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var s=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},u=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",s),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",u),this.on("dispose",function(){e.off("webkitbeginfullscreen",u),e.off("webkitendfullscreen",s)})}},r.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=window.navigator&&window.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},r.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)ga(this.el_.play()),this.setTimeout(function(){e.pause();try{e.webkitEnterFullScreen()}catch(s){this.trigger("fullscreenerror",s)}},0);else try{e.webkitEnterFullScreen()}catch(s){this.trigger("fullscreenerror",s)}},r.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},r.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},r.requestVideoFrameCallback=function(e){return this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.requestVideoFrameCallback(e):c.prototype.requestVideoFrameCallback.call(this,e)},r.cancelVideoFrameCallback=function(e){this.featuresVideoFrameCallback&&!this.el_.webkitKeys?this.el_.cancelVideoFrameCallback(e):c.prototype.cancelVideoFrameCallback.call(this,e)},r.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},r.reset=function(){n.resetMediaElement(this.el_)},r.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},r.setControls=function(e){this.el_.controls=!!e},r.addTextTrack=function(e,s,u){return this.featuresNativeTextTracks?this.el_.addTextTrack(e,s,u):c.prototype.addTextTrack.call(this,e,s,u)},r.createRemoteTextTrack=function(e){if(!this.featuresNativeTextTracks)return c.prototype.createRemoteTextTrack.call(this,e);var s=document.createElement("track");return e.kind&&(s.kind=e.kind),e.label&&(s.label=e.label),(e.language||e.srclang)&&(s.srclang=e.language||e.srclang),e.default&&(s.default=e.default),e.id&&(s.id=e.id),e.src&&(s.src=e.src),s},r.addRemoteTextTrack=function(e,s){var u=c.prototype.addRemoteTextTrack.call(this,e,s);return this.featuresNativeTextTracks&&this.el().appendChild(u),u},r.removeRemoteTextTrack=function(e){if(c.prototype.removeRemoteTextTrack.call(this,e),this.featuresNativeTextTracks)for(var s=this.$$("track"),u=s.length;u--;)(e===s[u]||e===s[u].track)&&this.el().removeChild(s[u])},r.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return typeof this.el().webkitDroppedFrameCount<"u"&&typeof this.el().webkitDecodedFrameCount<"u"&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),window.performance&&"function"==typeof window.performance.now?e.creationTime=window.performance.now():window.performance&&window.performance.timing&&"number"==typeof window.performance.timing.navigationStart&&(e.creationTime=window.Date.now()-window.performance.timing.navigationStart),e},n}(Nn);pd(Li,"TEST_VID",function(){if(F()){var c=document.createElement("video"),n=document.createElement("track");return n.kind="captions",n.srclang="en",n.label="English",c.appendChild(n),c}}),Li.isSupported=function(){try{Li.TEST_VID.volume=.5}catch{return!1}return!(!Li.TEST_VID||!Li.TEST_VID.canPlayType)},Li.canPlayType=function(c){return Li.TEST_VID.canPlayType(c)},Li.canPlaySource=function(c,n){return Li.canPlayType(c.type)},Li.canControlVolume=function(){try{var c=Li.TEST_VID.volume;Li.TEST_VID.volume=c/2+.1;var n=c!==Li.TEST_VID.volume;return n&&ti?(window.setTimeout(function(){Li&&Li.prototype&&(Li.prototype.featuresVolumeControl=c!==Li.TEST_VID.volume)}),!1):n}catch{return!1}},Li.canMuteVolume=function(){try{var c=Li.TEST_VID.muted;return Li.TEST_VID.muted=!c,Li.TEST_VID.muted?gt(Li.TEST_VID,"muted","muted"):wt(Li.TEST_VID,"muted"),c!==Li.TEST_VID.muted}catch{return!1}},Li.canControlPlaybackRate=function(){if($e&&vt&&Pt<58)return!1;try{var c=Li.TEST_VID.playbackRate;return Li.TEST_VID.playbackRate=c/2+.1,c!==Li.TEST_VID.playbackRate}catch{return!1}},Li.canOverrideAttributes=function(){try{var c=function(){};Object.defineProperty(document.createElement("video"),"src",{get:c,set:c}),Object.defineProperty(document.createElement("audio"),"src",{get:c,set:c}),Object.defineProperty(document.createElement("video"),"innerHTML",{get:c,set:c}),Object.defineProperty(document.createElement("audio"),"innerHTML",{get:c,set:c})}catch{return!1}return!0},Li.supportsNativeTextTracks=function(){return Ai||ti&&vt},Li.supportsNativeVideoTracks=function(){return!(!Li.TEST_VID||!Li.TEST_VID.videoTracks)},Li.supportsNativeAudioTracks=function(){return!(!Li.TEST_VID||!Li.TEST_VID.audioTracks)},Li.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(c){var r=c[1];pd(Li.prototype,c[0],function(){return Li[r]()},!0)}),Li.prototype.featuresVolumeControl=Li.canControlVolume(),Li.prototype.movingMediaElementInDOM=!ti,Li.prototype.featuresFullscreenResize=!0,Li.prototype.featuresProgressEvents=!0,Li.prototype.featuresTimeupdateEvents=!0,Li.prototype.featuresVideoFrameCallback=!(!Li.TEST_VID||!Li.TEST_VID.requestVideoFrameCallback),Li.patchCanPlayType=function(){Et>=4&&!he&&!vt&&(Nc=Li.TEST_VID&&Li.TEST_VID.constructor.prototype.canPlayType,Li.TEST_VID.constructor.prototype.canPlayType=function(c){return c&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(c)?"maybe":Nc.call(this,c)})},Li.unpatchCanPlayType=function(){var c=Li.TEST_VID.constructor.prototype.canPlayType;return Nc&&(Li.TEST_VID.constructor.prototype.canPlayType=Nc),c},Li.patchCanPlayType(),Li.disposeMediaElement=function(c){if(c){for(c.parentNode&&c.parentNode.removeChild(c);c.hasChildNodes();)c.removeChild(c.firstChild);c.removeAttribute("src"),"function"==typeof c.load&&function(){try{c.load()}catch{}}()}},Li.resetMediaElement=function(c){if(c){for(var n=c.querySelectorAll("source"),r=n.length;r--;)c.removeChild(n[r]);c.removeAttribute("src"),"function"==typeof c.load&&function(){try{c.load()}catch{}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(c){Li.prototype[c]=function(){return this.el_[c]||this.el_.hasAttribute(c)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(c){Li.prototype["set"+rr(c)]=function(n){this.el_[c]=n,n?this.el_.setAttribute(c,c):this.el_.removeAttribute(c)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(c){Li.prototype[c]=function(){return this.el_[c]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(c){Li.prototype["set"+rr(c)]=function(n){this.el_[c]=n}}),["pause","load","play"].forEach(function(c){Li.prototype[c]=function(){return this.el_[c]()}}),Nn.withSourceHandlers(Li),Li.nativeSourceHandler={},Li.nativeSourceHandler.canPlayType=function(c){try{return Li.TEST_VID.canPlayType(c)}catch{return""}},Li.nativeSourceHandler.canHandleSource=function(c,n){if(c.type)return Li.nativeSourceHandler.canPlayType(c.type);if(c.src){var r=hl(c.src);return Li.nativeSourceHandler.canPlayType("video/"+r)}return""},Li.nativeSourceHandler.handleSource=function(c,n,r){n.setSrc(c.src)},Li.nativeSourceHandler.dispose=function(){},Li.registerSourceHandler(Li.nativeSourceHandler),Nn.registerTech("Html5",Li);var fp=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],md={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},vd=["tiny","xsmall","small","medium","large","xlarge","huge"],kc={};vd.forEach(function(c){var n="x"===c.charAt(0)?"x-"+c.substring(1):c;kc[c]="vjs-layout-"+n});var pg={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},vr=function(c){function n(o,e,s){var u;if(o.id=o.id||e.id||"vjs_video_"+oa(),(e=Oe(n.getTagSettings(o),e)).initChildren=!1,e.createEl=!1,e.evented=!1,e.reportTouchActivity=!1,!e.language)if("function"==typeof o.closest){var d=o.closest("[lang]");d&&d.getAttribute&&(e.language=d.getAttribute("lang"))}else for(var m=o;m&&1===m.nodeType;){if(nt(m).hasOwnProperty("lang")){e.language=m.getAttribute("lang");break}m=m.parentNode}if((u=c.call(this,null,e,s)||this).boundDocumentFullscreenChange_=function(P){return u.documentFullscreenChange_(P)},u.boundFullWindowOnEscKey_=function(P){return u.fullWindowOnEscKey(P)},u.boundUpdateStyleEl_=function(P){return u.updateStyleEl_(P)},u.boundApplyInitTime_=function(P){return u.applyInitTime_(P)},u.boundUpdateCurrentBreakpoint_=function(P){return u.updateCurrentBreakpoint_(P)},u.boundHandleTechClick_=function(P){return u.handleTechClick_(P)},u.boundHandleTechDoubleClick_=function(P){return u.handleTechDoubleClick_(P)},u.boundHandleTechTouchStart_=function(P){return u.handleTechTouchStart_(P)},u.boundHandleTechTouchMove_=function(P){return u.handleTechTouchMove_(P)},u.boundHandleTechTouchEnd_=function(P){return u.handleTechTouchEnd_(P)},u.boundHandleTechTap_=function(P){return u.handleTechTap_(P)},u.isFullscreen_=!1,u.log=Te(u.id_),u.fsApi_=me,u.isPosterFromTech_=!1,u.queuedCallbacks_=[],u.isReady_=!1,u.hasStarted_=!1,u.userActive_=!1,u.debugEnabled_=!1,u.audioOnlyMode_=!1,u.audioPosterMode_=!1,u.audioOnlyCache_={playerHeight:null,hiddenChildren:[]},!u.options_||!u.options_.techOrder||!u.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(u.tag=o,u.tagAttributes=o&&nt(o),u.language(u.options_.language),e.languages){var g={};Object.getOwnPropertyNames(e.languages).forEach(function(P){g[P.toLowerCase()]=e.languages[P]}),u.languages_=g}else u.languages_=n.prototype.options_.languages;u.resetCache_(),u.poster_=e.poster||"",u.controls_=!!e.controls,o.controls=!1,o.removeAttribute("controls"),u.changingSrc_=!1,u.playCallbacks_=[],u.playTerminatedQueue_=[],o.hasAttribute("autoplay")?u.autoplay(!0):u.autoplay(u.options_.autoplay),e.plugins&&Object.keys(e.plugins).forEach(function(P){if("function"!=typeof u[P])throw new Error('plugin "'+P+'" does not exist')}),u.scrubbing_=!1,u.el_=u.createEl(),su(qi(u),{eventBusKey:"el_"}),u.fsApi_.requestFullscreen&&(xr(document,u.fsApi_.fullscreenchange,u.boundDocumentFullscreenChange_),u.on(u.fsApi_.fullscreenchange,u.boundDocumentFullscreenChange_)),u.fluid_&&u.on(["playerreset","resize"],u.boundUpdateStyleEl_);var T=Le(u.options_);e.plugins&&Object.keys(e.plugins).forEach(function(P){u[P](e.plugins[P])}),e.debug&&u.debug(!0),u.options_.playerOptions=T,u.middleware_=[],u.playbackRates(e.playbackRates),u.initChildren(),u.isAudio("audio"===o.nodeName.toLowerCase()),u.controls()?u.addClass("vjs-controls-enabled"):u.addClass("vjs-controls-disabled"),u.el_.setAttribute("role","region"),u.isAudio()?u.el_.setAttribute("aria-label",u.localize("Audio Player")):u.el_.setAttribute("aria-label",u.localize("Video Player")),u.isAudio()&&u.addClass("vjs-audio"),u.flexNotSupported_()&&u.addClass("vjs-no-flex"),Me&&u.addClass("vjs-touch-enabled"),ti||u.addClass("vjs-workinghover"),n.players[u.id_]=qi(u);var L="7.20.3".split(".")[0];return u.addClass("vjs-v"+L),u.userActive(!0),u.reportUserActivity(),u.one("play",function(P){return u.listenForUserActivity_(P)}),u.on("stageclick",function(P){return u.handleStageClick_(P)}),u.on("keydown",function(P){return u.handleKeyDown(P)}),u.on("languagechange",function(P){return u.handleLanguagechange(P)}),u.breakpoints(u.options_.breakpoints),u.responsive(u.options_.responsive),u.on("ready",function(){u.audioPosterMode(u.options_.audioPosterMode),u.audioOnlyMode(u.options_.audioOnlyMode)}),u}Ti(n,c);var r=n.prototype;return r.dispose=function(){var e=this;this.trigger("dispose"),this.off("dispose"),mr(document,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),mr(document,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),n.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),function $i(c){io[c.id()]=null}(this),Cr.names.forEach(function(s){var d=e[Cr[s].getterName]();d&&d.off&&d.off()}),c.prototype.dispose.call(this,{restoreEl:this.options_.restoreEl})},r.createEl=function(){var s,e=this.tag,u=this.playerElIngest_=e.parentNode&&e.parentNode.hasAttribute&&e.parentNode.hasAttribute("data-vjs-player"),d="video-js"===this.tag.tagName.toLowerCase();u?s=this.el_=e.parentNode:d||(s=this.el_=c.prototype.createEl.call(this,"div"));var m=nt(e);if(d){for(s=this.el_=e,e=this.tag=document.createElement("video");s.children.length;)e.appendChild(s.firstChild);O(s,"video-js")||G(s,"video-js"),s.appendChild(e),u=this.playerElIngest_=s,Object.keys(s).forEach(function(le){try{e[le]=s[le]}catch{}})}if(e.setAttribute("tabindex","-1"),m.tabindex="-1",(ei||vt&&K)&&(e.setAttribute("role","application"),m.role="application"),e.removeAttribute("width"),e.removeAttribute("height"),"width"in m&&delete m.width,"height"in m&&delete m.height,Object.getOwnPropertyNames(m).forEach(function(le){d&&"class"===le||s.setAttribute(le,m[le]),d&&e.setAttribute(le,m[le])}),e.playerId=e.id,e.id+="_html5_api",e.className="vjs-tech",e.player=s.player=this,this.addClass("vjs-paused"),!0!==window.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=_n("vjs-styles-dimensions");var g=Xi(".vjs-styles-defaults"),T=Xi("head");T.insertBefore(this.styleEl_,g?g.nextSibling:T.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var L=e.getElementsByTagName("a"),P=0;P<L.length;P++){var q=L.item(P);G(q,"vjs-hidden"),q.setAttribute("hidden","hidden")}return e.initNetworkState_=e.networkState,e.parentNode&&!u&&e.parentNode.insertBefore(s,e),_(e,s),this.children_.unshift(e),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=s,s},r.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");"anonymous"===e||"use-credentials"===e?this.techCall_("setCrossOrigin",e):ne.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"')},r.width=function(e){return this.dimension("width",e)},r.height=function(e){return this.dimension("height",e)},r.dimension=function(e,s){var u=e+"_";if(void 0===s)return this[u]||0;if(""===s||"auto"===s)return this[u]=void 0,void this.updateStyleEl_();var d=parseFloat(s);isNaN(d)?ne.error('Improper value "'+s+'" supplied for for '+e):(this[u]=d,this.updateStyleEl_())},r.fluid=function(e){var s=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,Kr(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),function(n,r){Kr(n)?r():(n.eventedCallbacks||(n.eventedCallbacks=[]),n.eventedCallbacks.push(r))}(this,function(){s.on(["playerreset","resize"],s.boundUpdateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()},r.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},r.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},r.updateStyleEl_=function(){if(!0!==window.VIDEOJS_NO_DYNAMIC_STYLE){var d,m,T,L=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),P=L[1]/L[0];d=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/P:this.videoWidth()||300,m=void 0!==this.height_?this.height_:d*P,T=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(T),_r(this.styleEl_,"\n      ."+T+" {\n        width: "+d+"px;\n        height: "+m+"px;\n      }\n\n      ."+T+".vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: "+100*P+"%;\n      }\n    ")}else{var e="number"==typeof this.width_?this.width_:this.options_.width,s="number"==typeof this.height_?this.height_:this.options_.height,u=this.tech_&&this.tech_.el();u&&(e>=0&&(u.width=e),s>=0&&(u.height=s))}},r.loadTech_=function(e,s){var u=this;this.tech_&&this.unloadTech_();var d=rr(e),m=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==d&&this.tag&&(Nn.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=d,this.isReady_=!1;var g=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(g=!1);var T={source:s,autoplay:g,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+m+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Cr.names.forEach(function(P){var q=Cr[P];T[q.getterName]=u[q.privateName]}),Oe(T,this.options_[d]),Oe(T,this.options_[m]),Oe(T,this.options_[e.toLowerCase()]),this.tag&&(T.tag=this.tag),s&&s.src===this.cache_.src&&this.cache_.currentTime>0&&(T.startTime=this.cache_.currentTime);var L=Nn.getTech(e);if(!L)throw new Error("No Tech named '"+d+"' exists! '"+d+"' should be registered using videojs.registerTech()'");this.tech_=new L(T),this.tech_.ready(Cn(this,this.handleTechReady_),!0),function(n,r){n.forEach(function(o){var e=r.addRemoteTextTrack(o).track;!o.src&&o.cues&&o.cues.forEach(function(s){return e.addCue(s)})}),r.textTracks()}(this.textTracksJson_||[],this.tech_),fp.forEach(function(P){u.on(u.tech_,P,function(q){return u["handleTech"+rr(P)+"_"](q)})}),Object.keys(md).forEach(function(P){u.on(u.tech_,P,function(q){0===u.tech_.playbackRate()&&u.tech_.seeking()?u.queuedCallbacks_.push({callback:u["handleTech"+md[P]+"_"].bind(u),event:q}):u["handleTech"+md[P]+"_"](q)})}),this.on(this.tech_,"loadstart",function(P){return u.handleTechLoadStart_(P)}),this.on(this.tech_,"sourceset",function(P){return u.handleTechSourceset_(P)}),this.on(this.tech_,"waiting",function(P){return u.handleTechWaiting_(P)}),this.on(this.tech_,"ended",function(P){return u.handleTechEnded_(P)}),this.on(this.tech_,"seeking",function(P){return u.handleTechSeeking_(P)}),this.on(this.tech_,"play",function(P){return u.handleTechPlay_(P)}),this.on(this.tech_,"firstplay",function(P){return u.handleTechFirstPlay_(P)}),this.on(this.tech_,"pause",function(P){return u.handleTechPause_(P)}),this.on(this.tech_,"durationchange",function(P){return u.handleTechDurationChange_(P)}),this.on(this.tech_,"fullscreenchange",function(P,q){return u.handleTechFullscreenChange_(P,q)}),this.on(this.tech_,"fullscreenerror",function(P,q){return u.handleTechFullscreenError_(P,q)}),this.on(this.tech_,"enterpictureinpicture",function(P){return u.handleTechEnterPictureInPicture_(P)}),this.on(this.tech_,"leavepictureinpicture",function(P){return u.handleTechLeavePictureInPicture_(P)}),this.on(this.tech_,"error",function(P){return u.handleTechError_(P)}),this.on(this.tech_,"posterchange",function(P){return u.handleTechPosterChange_(P)}),this.on(this.tech_,"textdata",function(P){return u.handleTechTextData_(P)}),this.on(this.tech_,"ratechange",function(P){return u.handleTechRateChange_(P)}),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&("Html5"!==d||!this.tag)&&_(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},r.unloadTech_=function(){var e=this;Cr.names.forEach(function(s){var u=Cr[s];e[u.privateName]=e[u.getterName]()}),this.textTracksJson_=function(n){var r=n.$$("track"),o=Array.prototype.map.call(r,function(s){return s.track});return Array.prototype.map.call(r,function(s){var u=ll(s.track);return s.src&&(u.src=s.src),u}).concat(Array.prototype.filter.call(n.textTracks(),function(s){return-1===o.indexOf(s)}).map(ll))}(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},r.tech=function(e){return void 0===e&&ne.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},r.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},r.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},r.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},r.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},r.manualAutoplay_=function(e){var s=this;if(this.tech_&&"string"==typeof e){var d,u=function(){var g=s.muted();s.muted(!0);var T=function(){s.muted(g)};s.playTerminatedQueue_.push(T);var L=s.play();if(ou(L))return L.catch(function(P){throw T(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(P||""))})};if("any"!==e||this.muted()?d="muted"!==e||this.muted()?this.play():u():ou(d=this.play())&&(d=d.catch(u)),ou(d))return d.then(function(){s.trigger({type:"autoplay-success",autoplay:e})}).catch(function(){s.trigger({type:"autoplay-failure",autoplay:e})})}},r.updateSourceCaches_=function(e){void 0===e&&(e="");var s=e,u="";"string"!=typeof s&&(s=e.src,u=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],s&&!u&&(u=function(n,r){if(!r)return"";if(n.cache_.source.src===r&&n.cache_.source.type)return n.cache_.source.type;var o=n.cache_.sources.filter(function(d){return d.src===r});if(o.length)return o[0].type;for(var e=n.$$("source"),s=0;s<e.length;s++){var u=e[s];if(u.type&&u.src&&u.src===r)return u.type}return Fr(r)}(this,s)),this.cache_.source=Le({},e,{src:s,type:u});for(var d=this.cache_.sources.filter(function(q){return q.src&&q.src===s}),m=[],g=this.$$("source"),T=[],L=0;L<g.length;L++){var P=nt(g[L]);m.push(P),P.src&&P.src===s&&T.push(P.src)}T.length&&!d.length?this.cache_.sources=m:d.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=s},r.handleTechSourceset_=function(e){var s=this;if(!this.changingSrc_){var u=function(T){return s.updateSourceCaches_(T)},d=this.currentSource().src,m=e.src;d&&!/^blob:/.test(d)&&/^blob:/.test(m)&&(!this.lastSource_||this.lastSource_.tech!==m&&this.lastSource_.player!==d)&&(u=function(){}),u(m),e.src||this.tech_.any(["sourceset","loadstart"],function(g){if("sourceset"!==g.type){var T=s.techGet("currentSrc");s.lastSource_.tech=T,s.updateSourceCaches_(T)}})}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},r.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},r.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},r.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(e){return e.callback(e.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},r.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var s=this.currentTime();this.on("timeupdate",function d(){s!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",d))})},r.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},r.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},r.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},r.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},r.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},r.handleTechFirstPlay_=function(){this.options_.starttime&&(ne.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},r.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},r.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},r.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},r.handleTechClick_=function(e){!this.controls_||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.click||!1!==this.options_.userActions.click)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?ga(this.play()):this.pause())},r.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(u){return u.contains(e.target)})||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.doubleClick||!1!==this.options_.userActions.doubleClick)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},r.handleTechTap_=function(){this.userActive(!this.userActive())},r.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},r.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},r.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},r.handleStageClick_=function(){this.reportUserActivity()},r.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},r.documentFullscreenChange_=function(e){var s=e.target.player;if(!s||s===this){var u=this.el(),d=document[this.fsApi_.fullscreenElement]===u;!d&&u.matches?d=u.matches(":"+this.fsApi_.fullscreen):!d&&u.msMatchesSelector&&(d=u.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(d)}},r.handleTechFullscreenChange_=function(e,s){var u=this;s&&(s.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",function(){u.removeClass("vjs-ios-native-fs")})),this.isFullscreen(s.isFullscreen))},r.handleTechFullscreenError_=function(e,s){this.trigger("fullscreenerror",s)},r.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},r.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},r.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},r.handleTechError_=function(){var e=this.tech_.error();this.error(e)},r.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},r.getCache=function(){return this.cache_},r.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},r.techCall_=function(e,s){this.ready(function(){if(e in Ec)return function ea(c,n,r,o){return n[r](c.reduce(mu(r),o))}(this.middleware_,this.tech_,e,s);if(e in Mc)return Jh(this.middleware_,this.tech_,e,s);try{this.tech_&&this.tech_[e](s)}catch(u){throw ne(u),u}},!0)},r.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Ga)return function $h(c,n,r){return c.reduceRight(mu(r),n[r]())}(this.middleware_,this.tech_,e);if(e in Mc)return Jh(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(s){throw void 0===this.tech_[e]?(ne("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",s),s):"TypeError"===s.name?(ne("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",s),this.tech_.isReady_=!1,s):(ne(s),s)}}},r.play=function(){var e=this,s=this.options_.Promise||window.Promise;return s?new s(function(u){e.play_(u)}):this.play_()},r.play_=function(e){var s=this;void 0===e&&(e=ga),this.playCallbacks_.push(e);var u=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!u)return this.waitToPlay_=function(m){s.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!u&&(Ai||ti)&&this.load());var d=this.techGet_("play");null===d?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(d)},r.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach(function(s){s()})},r.runPlayCallbacks_=function(e){var s=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],s.forEach(function(u){u(e)})},r.pause=function(){this.techCall_("pause")},r.paused=function(){return!1!==this.techGet_("paused")},r.played=function(){return this.techGet_("played")||vo(0,0)},r.scrubbing=function(e){if(typeof e>"u")return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},r.currentTime=function(e){return typeof e<"u"?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},r.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},r.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},r.remainingTime=function(){return this.duration()-this.currentTime()},r.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},r.buffered=function(){var e=this.techGet_("buffered");return(!e||!e.length)&&(e=vo(0,0)),e},r.bufferedPercent=function(){return Pf(this.buffered(),this.duration())},r.bufferedEnd=function(){var e=this.buffered(),s=this.duration(),u=e.end(e.length-1);return u>s&&(u=s),u},r.volume=function(e){var s;return void 0!==e?(s=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=s,this.techCall_("setVolume",s),void(s>0&&this.lastVolume_(s))):(s=parseFloat(this.techGet_("volume")),isNaN(s)?1:s)},r.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},r.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},r.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},r.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},r.isFullscreen=function(e){if(void 0!==e){var s=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==s&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_},r.requestFullscreen=function(e){var s=this.options_.Promise||window.Promise;if(s){var u=this;return new s(function(d,m){function g(){u.off("fullscreenerror",L),u.off("fullscreenchange",T)}function T(){g(),d()}function L(q,le){g(),m(le)}u.one("fullscreenchange",T),u.one("fullscreenerror",L);var P=u.requestFullscreenHelper_(e);P&&(P.then(g,g),P.then(d,m))})}return this.requestFullscreenHelper_()},r.requestFullscreenHelper_=function(e){var u,s=this;if(this.fsApi_.prefixed||(u=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(u=e)),this.fsApi_.requestFullscreen){var d=this.el_[this.fsApi_.requestFullscreen](u);return d&&d.then(function(){return s.isFullscreen(!0)},function(){return s.isFullscreen(!1)}),d}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},r.exitFullscreen=function(){var e=this.options_.Promise||window.Promise;if(e){var s=this;return new e(function(u,d){function m(){s.off("fullscreenerror",T),s.off("fullscreenchange",g)}function g(){m(),u()}function T(P,q){m(),d(q)}s.one("fullscreenchange",g),s.one("fullscreenerror",T);var L=s.exitFullscreenHelper_();L&&(L.then(m,m),L.then(u,d))})}return this.exitFullscreenHelper_()},r.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var s=document[this.fsApi_.exitFullscreen]();return s&&ga(s.then(function(){return e.isFullscreen(!1)})),s}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},r.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,xr(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow="hidden",G(document.body,"vjs-full-window"),this.trigger("enterFullWindow")},r.fullWindowOnEscKey=function(e){wi.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},r.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,mr(document,"keydown",this.boundFullWindowOnEscKey_),document.documentElement.style.overflow=this.docOrigOverflow,fe(document.body,"vjs-full-window"),this.trigger("exitFullWindow")},r.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},r.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},r.requestPictureInPicture=function(){if("pictureInPictureEnabled"in document&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},r.exitPictureInPicture=function(){if("pictureInPictureEnabled"in document)return document.exitPictureInPicture()},r.handleKeyDown=function(e){var m,g,s=this.options_.userActions;s&&s.hotkeys&&(g=(m=this.el_.ownerDocument.activeElement).tagName.toLowerCase(),m.isContentEditable||("input"===g?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(m.type):-1!==["textarea"].indexOf(g))||("function"==typeof s.hotkeys?s.hotkeys.call(this,e):this.handleHotkeys(e)))},r.handleHotkeys=function(e){var s=this.options_.userActions?this.options_.userActions.hotkeys:{},u=s.fullscreenKey,m=s.muteKey,g=void 0===m?function(_e){return wi.isEventKey(_e,"m")}:m,T=s.playPauseKey,L=void 0===T?function(_e){return wi.isEventKey(_e,"k")||wi.isEventKey(_e,"Space")}:T;if((void 0===u?function(_e){return wi.isEventKey(_e,"f")}:u).call(this,e)){e.preventDefault(),e.stopPropagation();var P=Qt.getComponent("FullscreenToggle");!1!==document[this.fsApi_.fullscreenEnabled]&&P.prototype.handleClick.call(this,e)}else g.call(this,e)?(e.preventDefault(),e.stopPropagation(),Qt.getComponent("MuteToggle").prototype.handleClick.call(this,e)):L.call(this,e)&&(e.preventDefault(),e.stopPropagation(),Qt.getComponent("PlayToggle").prototype.handleClick.call(this,e))},r.canPlayType=function(e){for(var s,u=0,d=this.options_.techOrder;u<d.length;u++){var m=d[u],g=Nn.getTech(m);if(g||(g=Qt.getComponent(m)),g){if(g.isSupported()&&(s=g.canPlayType(e)))return s}else ne.error('The "'+m+'" tech is undefined. Skipped browser support check for that tech.')}return""},r.selectSource=function(e){var P,s=this,u=this.options_.techOrder.map(function(L){return[L,Nn.getTech(L)]}).filter(function(L){var P=L[0],q=L[1];return q?q.isSupported():(ne.error('The "'+P+'" tech is undefined. Skipped browser support check for that tech.'),!1)}),d=function(P,q,le){var _e;return P.some(function(ge){return q.some(function(rt){if(_e=le(ge,rt))return!0})}),_e},T=function(P,q){var le=P[0];if(P[1].canPlaySource(q,s.options_[le.toLowerCase()]))return{source:q,tech:le}};return(this.options_.sourceOrder?d(e,u,(P=T,function(q,le){return P(le,q)})):d(u,e,T))||!1},r.handleSrc_=function(e,s){var u=this;if(typeof e>"u")return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var d=Cc(e);if(d.length){if(this.changingSrc_=!0,s||(this.cache_.sources=d),this.updateSourceCaches_(d[0]),Kh(this,d[0],function(T,L){if(u.middleware_=L,s||(u.cache_.sources=d),u.updateSourceCaches_(T),u.src_(T))return d.length>1?u.handleSrc_(d.slice(1)):(u.changingSrc_=!1,u.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0),void u.triggerReady());!function Zh(c,n){c.forEach(function(r){return r.setTech&&r.setTech(n)})}(L,u.tech_)}),this.options_.retryOnError&&d.length>1){var m=function(){u.error(null),u.handleSrc_(d.slice(1),!0)},g=function(){u.off("error",m)};this.one("error",m),this.one("playing",g),this.resetRetryOnError_=function(){u.off("error",m),u.off("playing",g)}}}else this.setTimeout(function(){this.error({code:4,message:this.options_.notSupportedMessage})},0)},r.src=function(e){return this.handleSrc_(e,!1)},r.src_=function(e){var s=this,u=this.selectSource([e]);return!u||(function(n,r){return rr(n)===rr(r)}(u.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(u.tech,u.source),this.tech_.ready(function(){s.changingSrc_=!1}),!1))},r.load=function(){this.techCall_("load")},r.reset=function(){var e=this,s=this.options_.Promise||window.Promise;this.paused()||!s?this.doReset_():ga(this.play().then(function(){return e.doReset_()}))},r.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),Kr(this)&&this.trigger("playerreset")},r.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},r.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar||{},s=e.durationDisplay,u=e.remainingTimeDisplay;s&&s.updateContent(),u&&u.updateContent()},r.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},r.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},r.currentSources=function(){var e=this.currentSource(),s=[];return 0!==Object.keys(e).length&&s.push(e),this.cache_.sources||s},r.currentSource=function(){return this.cache_.source||{}},r.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},r.currentType=function(){return this.currentSource()&&this.currentSource().type||""},r.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},r.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var s;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),s=!1):this.options_.autoplay=!!e,s=typeof s>"u"?this.options_.autoplay:s,this.tech_&&this.techCall_("setAutoplay",s)},r.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},r.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},r.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},r.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},r.controls=function(e){if(void 0===e)return!!this.controls_;this.controls_!==(e=!!e)&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},r.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;this.usingNativeControls_!==(e=!!e)&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},r.error=function(e){var s=this;if(void 0===e)return this.error_||null;if(Ri("beforeerror").forEach(function(d){var m=d(s,e);Ee(m)&&!Array.isArray(m)||"string"==typeof m||"number"==typeof m||null===m?e=m:s.log.error("please return a value that MediaError expects in beforeerror hooks")}),this.options_.suppressNotSupportedError&&e&&4===e.code){var u=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],u),void this.one("loadstart",function(){this.off(["click","touchstart"],u)})}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Zr(e),this.addClass("vjs-error"),ne.error("(CODE:"+this.error_.code+" "+Zr.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),Ri("error").forEach(function(d){return d(s,s.error_)})},r.reportUserActivity=function(e){this.userActivity_=!0},r.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(s){s.stopPropagation(),s.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},r.listenForUserActivity_=function(){var e,s,u,d=Cn(this,this.reportUserActivity),T=function(le){d(),this.clearInterval(e)};this.on("mousedown",function(){d(),this.clearInterval(e),e=this.setInterval(d,250)}),this.on("mousemove",function(le){(le.screenX!==s||le.screenY!==u)&&(s=le.screenX,u=le.screenY,d())}),this.on("mouseup",T),this.on("mouseleave",T);var P,L=this.getChild("controlBar");L&&!ti&&!$e&&(L.on("mouseenter",function(q){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0}),L.on("mouseleave",function(q){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",d),this.on("keyup",d),this.setInterval(function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(P);var q=this.options_.inactivityTimeout;q<=0||(P=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},q))}},250)},r.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},r.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},r.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},r.enableAudioOnlyUI_=function(){var e=this;this.addClass("vjs-audio-only-mode");var s=this.children(),u=this.getChild("ControlBar"),d=u&&u.currentHeight();s.forEach(function(m){m!==u&&m.el_&&!m.hasClass("vjs-hidden")&&(m.hide(),e.audioOnlyCache_.hiddenChildren.push(m))}),this.audioOnlyCache_.playerHeight=this.currentHeight(),this.height(d),this.trigger("audioonlymodechange")},r.disableAudioOnlyUI_=function(){this.removeClass("vjs-audio-only-mode"),this.audioOnlyCache_.hiddenChildren.forEach(function(e){return e.show()}),this.height(this.audioOnlyCache_.playerHeight),this.trigger("audioonlymodechange")},r.audioOnlyMode=function(e){var s=this;if("boolean"!=typeof e||e===this.audioOnlyMode_)return this.audioOnlyMode_;this.audioOnlyMode_=e;var u=this.options_.Promise||window.Promise;if(u){if(e){var d=[];return this.isInPictureInPicture()&&d.push(this.exitPictureInPicture()),this.isFullscreen()&&d.push(this.exitFullscreen()),this.audioPosterMode()&&d.push(this.audioPosterMode(!1)),u.all(d).then(function(){return s.enableAudioOnlyUI_()})}return u.resolve().then(function(){return s.disableAudioOnlyUI_()})}e?(this.isInPictureInPicture()&&this.exitPictureInPicture(),this.isFullscreen()&&this.exitFullscreen(),this.enableAudioOnlyUI_()):this.disableAudioOnlyUI_()},r.enablePosterModeUI_=function(){(this.tech_&&this.tech_).hide(),this.addClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},r.disablePosterModeUI_=function(){(this.tech_&&this.tech_).show(),this.removeClass("vjs-audio-poster-mode"),this.trigger("audiopostermodechange")},r.audioPosterMode=function(e){var s=this;if("boolean"!=typeof e||e===this.audioPosterMode_)return this.audioPosterMode_;this.audioPosterMode_=e;var u=this.options_.Promise||window.Promise;return u?e?this.audioOnlyMode()?this.audioOnlyMode(!1).then(function(){s.enablePosterModeUI_()}):u.resolve().then(function(){s.enablePosterModeUI_()}):u.resolve().then(function(){s.disablePosterModeUI_()}):e?(this.audioOnlyMode()&&this.audioOnlyMode(!1),void this.enablePosterModeUI_()):void this.disablePosterModeUI_()},r.addTextTrack=function(e,s,u){if(this.tech_)return this.tech_.addTextTrack(e,s,u)},r.addRemoteTextTrack=function(e,s){if(this.tech_)return this.tech_.addRemoteTextTrack(e,s)},r.removeRemoteTextTrack=function(e){void 0===e&&(e={});var u=e.track;if(u||(u=e),this.tech_)return this.tech_.removeRemoteTextTrack(u)},r.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},r.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},r.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},r.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),Kr(this)&&this.trigger("languagechange"))},r.languages=function(){return Le(n.prototype.options_.languages,this.languages_)},r.toJSON=function(){var e=Le(this.options_),s=e.tracks;e.tracks=[];for(var u=0;u<s.length;u++){var d=s[u];(d=Le(d)).player=void 0,e.tracks[u]=d}return e},r.createModal=function(e,s){var u=this;(s=s||{}).content=e||"";var d=new $s(this,s);return this.addChild(d),d.on("dispose",function(){u.removeChild(d)}),d.open(),d},r.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),s=this.currentWidth(),u=0;u<vd.length;u++){var d=vd[u];if(s<=this.breakpoints_[d]){if(e===d)return;e&&this.removeClass(kc[e]),this.addClass(kc[d]),this.breakpoint_=d;break}}},r.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},r.breakpoints=function(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=Oe({},pg,e),this.updateCurrentBreakpoint_()),Oe(this.breakpoints_)},r.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},r.currentBreakpoint=function(){return this.breakpoint_},r.currentBreakpointClass=function(){return kc[this.breakpoint_]||""},r.loadMedia=function(e,s){var u=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=Le(e);var d=this.cache_.media,g=d.poster,T=d.src,L=d.textTracks;!d.artwork&&g&&(this.cache_.media.artwork=[{src:g,type:Fr(g)}]),T&&this.src(T),g&&this.poster(g),Array.isArray(L)&&L.forEach(function(P){return u.addRemoteTextTrack(P,!1)}),this.ready(s)}},r.getMedia=function(){if(!this.cache_.media){var e=this.poster(),d={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(m){return{kind:m.kind,label:m.label,language:m.language,src:m.src}})};return e&&(d.poster=e,d.artwork=[{src:d.poster,type:Fr(d.poster)}]),d}return Le(this.cache_.media)},n.getTagSettings=function(e){var s={sources:[],tracks:[]},u=nt(e),d=u["data-setup"];if(O(e,"vjs-fill")&&(u.fill=!0),O(e,"vjs-fluid")&&(u.fluid=!0),null!==d){var m=function zv(c,n){var r,o=null;try{r=JSON.parse(c,n)}catch(e){o=e}return[o,r]}(d||"{}"),g=m[0],T=m[1];g&&ne.error(g),Oe(u,T)}if(Oe(s,u),e.hasChildNodes())for(var L=e.childNodes,P=0,q=L.length;P<q;P++){var le=L[P],_e=le.nodeName.toLowerCase();"source"===_e?s.sources.push(nt(le)):"track"===_e&&s.tracks.push(nt(le))}return s},r.flexNotSupported_=function(){var e=document.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},r.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},r.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;!Array.isArray(e)||!e.every(function(s){return"number"==typeof s})||(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},n}(Qt);Cr.names.forEach(function(c){var n=Cr[c];vr.prototype[n.getterName]=function(){return this.tech_?this.tech_[n.getterName]():(this[n.privateName]=this[n.privateName]||new n.ListClass,this[n.privateName])}}),vr.prototype.crossorigin=vr.prototype.crossOrigin,vr.players={};var wu=window.navigator;vr.prototype.options_={techOrder:Nn.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:wu&&(wu.languages&&wu.languages[0]||wu.userLanguage||wu.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1,audioOnlyMode:!1,audioPosterMode:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(c){vr.prototype[c]=function(){return this.techGet_(c)}}),fp.forEach(function(c){vr.prototype["handleTech"+rr(c)+"_"]=function(){return this.trigger(c)}}),Qt.registerComponent("Player",vr);var pp=Ke(function(c){function n(r,o){return c.exports=n=Object.setPrototypeOf||function(s,u){return s.__proto__=u,s},n(r,o)}c.exports=n}),vg=function mg(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}},gg=Ke(function(c){function n(r,o,e){return c.exports=n=vg()?Reflect.construct:function(u,d,m){var g=[null];g.push.apply(g,d);var L=new(Function.bind.apply(u,g));return m&&pp(L,m.prototype),L},n.apply(null,arguments)}c.exports=n}),Bc="plugin",Ml="activePlugins_",Cl={},Uc=function(n){return Cl.hasOwnProperty(n)},Hc=function(n){return Uc(n)?Cl[n]:void 0},mp=function(n,r){n[Ml]=n[Ml]||{},n[Ml][r]=!0},zc=function(n,r,o){var e=(o?"before":"")+"pluginsetup";n.trigger(e,r),n.trigger(e+":"+r.name,r)},vp=function(n,r){return r.prototype.name=n,function(){zc(this,{name:n,plugin:r,instance:null},!0);for(var o=arguments.length,e=new Array(o),s=0;s<o;s++)e[s]=arguments[s];var u=gg(r,[this].concat(e));return this[n]=function(){return u},zc(this,u.getEventHash()),u}},cs=function(){function c(r){if(this.constructor===c)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=r,this.log||(this.log=this.player.log.createLogger(this.name)),su(this),delete this.trigger,sl(this,this.constructor.defaultState),mp(r,this.name),this.dispose=this.dispose.bind(this),r.on("dispose",this.dispose)}var n=c.prototype;return n.version=function(){return this.constructor.VERSION},n.getEventHash=function(o){return void 0===o&&(o={}),o.name=this.name,o.plugin=this.constructor,o.instance=this,o},n.trigger=function(o,e){return void 0===e&&(e={}),qs(this.eventBusEl_,o,this.getEventHash(e))},n.handleStateChanged=function(o){},n.dispose=function(){var o=this.name,e=this.player;this.trigger("dispose"),this.off(),e.off("dispose",this.dispose),e[Ml][o]=!1,this.player=this.state=null,e[o]=vp(o,Cl[o])},c.isBasic=function(o){var e="string"==typeof o?Hc(o):o;return"function"==typeof e&&!c.prototype.isPrototypeOf(e.prototype)},c.registerPlugin=function(o,e){if("string"!=typeof o)throw new Error('Illegal plugin name, "'+o+'", must be a string, was '+typeof o+".");if(Uc(o))ne.warn('A plugin named "'+o+'" already exists. You may want to avoid re-registering plugins!');else if(vr.prototype.hasOwnProperty(o))throw new Error('Illegal plugin name, "'+o+'", cannot share a name with an existing player method!');if("function"!=typeof e)throw new Error('Illegal plugin for "'+o+'", must be a function, was '+typeof e+".");return Cl[o]=e,o!==Bc&&(vr.prototype[o]=c.isBasic(e)?function(n,r){var o=function(){zc(this,{name:n,plugin:r,instance:null},!0);var s=r.apply(this,arguments);return mp(this,n),zc(this,{name:n,plugin:r,instance:s}),s};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o}(o,e):vp(o,e)),e},c.deregisterPlugin=function(o){if(o===Bc)throw new Error("Cannot de-register base plugin.");Uc(o)&&(delete Cl[o],delete vr.prototype[o])},c.getPlugins=function(o){var e;return void 0===o&&(o=Object.keys(Cl)),o.forEach(function(s){var u=Hc(s);u&&((e=e||{})[s]=u)}),e},c.getPluginVersion=function(o){var e=Hc(o);return e&&e.VERSION||""},c}();cs.getPlugin=Hc,cs.BASE_PLUGIN_NAME=Bc,cs.registerPlugin(Bc,cs),vr.prototype.usingPlugin=function(c){return!!this[Ml]&&!0===this[Ml][c]},vr.prototype.hasPlugin=function(c){return!!Uc(c)};var gp=function(n){return 0===n.indexOf("#")?n.slice(1):n};function ct(c,n,r){var o=ct.getPlayer(c);if(o)return n&&ne.warn('Player "'+c+'" is already initialised. Options will not be applied.'),r&&o.ready(r),o;var e="string"==typeof c?Xi("#"+gp(c)):c;if(!te(e))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!e.ownerDocument.defaultView||!e.ownerDocument.body.contains(e))&&ne.warn("The element supplied is not included in the DOM"),!0===(n=n||{}).restoreEl&&(n.restoreEl=(e.parentNode&&e.parentNode.hasAttribute("data-vjs-player")?e.parentNode:e).cloneNode(!0)),Ri("beforesetup").forEach(function(u){var d=u(e,Le(n));Ee(d)&&!Array.isArray(d)?n=Le(n,d):ne.error("please return an object in beforesetup hooks")});var s=Qt.getComponent("Player");return o=new s(e,n,r),Ri("setup").forEach(function(u){return u(o)}),o}if(ct.hooks_=Ni,ct.hooks=Ri,ct.hook=function(n,r){Ri(n,r)},ct.hookOnce=function(n,r){Ri(n,[].concat(r).map(function(o){return function s(){return et(n,s),o.apply(void 0,arguments)}}))},ct.removeHook=et,!0!==window.VIDEOJS_NO_DYNAMIC_STYLE&&F()){var Vc=Xi(".vjs-styles-defaults");if(!Vc){Vc=_n("vjs-styles-defaults");var gd=Xi("head");gd&&gd.insertBefore(Vc,gd.firstChild),_r(Vc,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid:not(.vjs-audio-only-mode) {\n        padding-top: 56.25%\n      }\n    ")}}Zn(1,ct),ct.VERSION="7.20.3",ct.options=vr.prototype.options_,ct.getPlayers=function(){return vr.players},ct.getPlayer=function(c){var r,n=vr.players;if("string"==typeof c){var o=gp(c),e=n[o];if(e)return e;r=Xi("#"+o)}else r=c;if(te(r)){var u=r.player,d=r.playerId;if(u||n[d])return u||n[d]}},ct.getAllPlayers=function(){return Object.keys(vr.players).map(function(c){return vr.players[c]}).filter(Boolean)},ct.players=vr.players,ct.getComponent=Qt.getComponent,ct.registerComponent=function(c,n){Nn.isTech(n)&&ne.warn("The "+c+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),Qt.registerComponent.call(Qt,c,n)},ct.getTech=Nn.getTech,ct.registerTech=Nn.registerTech,ct.use=function Gf(c,n){Jr[c]=Jr[c]||[],Jr[c].push(n)},Object.defineProperty(ct,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(ct.middleware,"TERMINATOR",{value:Ds,writeable:!1,enumerable:!0}),ct.browser=vi,ct.TOUCH_ENABLED=Me,ct.extend=function(n,r){void 0===r&&(r={});var o=function(){n.apply(this,arguments)},e={};for(var s in"object"==typeof r?(r.constructor!==Object.prototype.constructor&&(o=r.constructor),e=r):"function"==typeof r&&(o=r),function _g(c,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(n&&n.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),n&&pp(c,n)}(o,n),n&&(o.super_=n),e)e.hasOwnProperty(s)&&(o.prototype[s]=e[s]);return o},ct.mergeOptions=Le,ct.bind=Cn,ct.registerPlugin=cs.registerPlugin,ct.deregisterPlugin=cs.deregisterPlugin,ct.plugin=function(c,n){return ne.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),cs.registerPlugin(c,n)},ct.getPlugins=cs.getPlugins,ct.getPlugin=cs.getPlugin,ct.getPluginVersion=cs.getPluginVersion,ct.addLanguage=function(c,n){var r;return c=(""+c).toLowerCase(),(ct.options.languages=Le(ct.options.languages,((r={})[c]=n,r)))[c]},ct.log=ne,ct.createLogger=Te,ct.createTimeRange=ct.createTimeRanges=vo,ct.formatTime=ls,ct.setFormatTime=function xl(c){vu=c},ct.resetFormatTime=function xa(){vu=Wa},ct.parseUrl=lu,ct.isCrossOrigin=Js,ct.EventTarget=Fn,ct.on=xr,ct.one=As,ct.off=mr,ct.trigger=qs,ct.xhr=zn,ct.TextTrack=Es,ct.AudioTrack=Tc,ct.VideoTrack=To,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(c){ct[c]=function(){return ne.warn("videojs."+c+"() is deprecated; use videojs.dom."+c+"() instead"),On[c].apply(null,arguments)}}),ct.computedStyle=oe,ct.dom=On,ct.url=Of,ct.defineLazyProperty=pd,ct.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"});var Gc=Ke(function(c,n){var o,e,s,u,d;o=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,e=/^([^\/?#]*)([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,u=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c.exports=d={buildAbsoluteURL:function(g,T,L){if(L=L||{},g=g.trim(),!(T=T.trim())){if(!L.alwaysNormalize)return g;var P=d.parseURL(g);if(!P)throw new Error("Error trying to parse base URL.");return P.path=d.normalizePath(P.path),d.buildURLFromParts(P)}var q=d.parseURL(T);if(!q)throw new Error("Error trying to parse relative URL.");if(q.scheme)return L.alwaysNormalize?(q.path=d.normalizePath(q.path),d.buildURLFromParts(q)):T;var le=d.parseURL(g);if(!le)throw new Error("Error trying to parse base URL.");if(!le.netLoc&&le.path&&"/"!==le.path[0]){var _e=e.exec(le.path);le.netLoc=_e[1],le.path=_e[2]}le.netLoc&&!le.path&&(le.path="/");var ge={scheme:le.scheme,netLoc:q.netLoc,path:null,params:q.params,query:q.query,fragment:q.fragment};if(!q.netLoc&&(ge.netLoc=le.netLoc,"/"!==q.path[0]))if(q.path){var rt=le.path,yt=rt.substring(0,rt.lastIndexOf("/")+1)+q.path;ge.path=d.normalizePath(yt)}else ge.path=le.path,q.params||(ge.params=le.params,q.query||(ge.query=le.query));return null===ge.path&&(ge.path=L.alwaysNormalize?d.normalizePath(q.path):q.path),d.buildURLFromParts(ge)},parseURL:function(g){var T=o.exec(g);return T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(g){for(g=g.split("").reverse().join("").replace(s,"");g.length!==(g=g.replace(u,"")).length;);return g.split("").reverse().join("")},buildURLFromParts:function(g){return g.scheme+g.netLoc+g.path+g.params+g.query+g.fragment}}}),yp="http://example.com",yd=function(){function c(){this.listeners={}}var n=c.prototype;return n.on=function(o,e){this.listeners[o]||(this.listeners[o]=[]),this.listeners[o].push(e)},n.off=function(o,e){if(!this.listeners[o])return!1;var s=this.listeners[o].indexOf(e);return this.listeners[o]=this.listeners[o].slice(0),this.listeners[o].splice(s,1),s>-1},n.trigger=function(o){var e=this.listeners[o];if(e)if(2===arguments.length)for(var s=e.length,u=0;u<s;++u)e[u].call(this,arguments[1]);else for(var d=Array.prototype.slice.call(arguments,1),m=e.length,g=0;g<m;++g)e[g].apply(this,d)},n.dispose=function(){this.listeners={}},n.pipe=function(o){this.on("data",function(e){o.push(e)})},c}();function wg(c){for(var n=function(n){return window.atob?window.atob(n):Buffer.from(n,"base64").toString("binary")}(c),r=new Uint8Array(n.length),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}var Sg=function(c){function n(){var o;return(o=c.call(this)||this).buffer="",o}return Ti(n,c),n.prototype.push=function(e){var s;for(this.buffer+=e,s=this.buffer.indexOf("\n");s>-1;s=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,s)),this.buffer=this.buffer.substring(s+1)},n}(yd),Eg=String.fromCharCode(9),_d=function(n){var r=/([0-9.]*)?@?([0-9.]*)?/.exec(n||""),o={};return r[1]&&(o.length=parseInt(r[1],10)),r[2]&&(o.offset=parseInt(r[2],10)),o},qa=function(n){for(var s,r=n.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),o={},e=r.length;e--;)""!==r[e]&&((s=/([^=]*)=(.*)/.exec(r[e]).slice(1))[0]=s[0].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^\s+|\s+$/g,""),s[1]=s[1].replace(/^['"](.*)['"]$/g,"$1"),o[s[0]]=s[1]);return o},Cg=function(c){function n(){var o;return(o=c.call(this)||this).customParsers=[],o.tagMappers=[],o}Ti(n,c);var r=n.prototype;return r.push=function(e){var u,d,s=this;if(0!==(e=e.trim()).length){if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce(function(g,T){var L=T(e);return L===e?g:g.concat([L])},[e]).forEach(function(g){for(var T=0;T<s.customParsers.length;T++)if(s.customParsers[T].call(s,g))return;if(0===g.indexOf("#EXT"))if(g=g.replace("\r",""),u=/^#EXTM3U/.exec(g))s.trigger("data",{type:"tag",tagType:"m3u"});else{if(u=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(g))return d={type:"tag",tagType:"inf"},u[1]&&(d.duration=parseFloat(u[1])),u[2]&&(d.title=u[2]),void s.trigger("data",d);if(u=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(g))return d={type:"tag",tagType:"targetduration"},u[1]&&(d.duration=parseInt(u[1],10)),void s.trigger("data",d);if(u=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(g))return d={type:"tag",tagType:"version"},u[1]&&(d.version=parseInt(u[1],10)),void s.trigger("data",d);if(u=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(g))return d={type:"tag",tagType:"media-sequence"},u[1]&&(d.number=parseInt(u[1],10)),void s.trigger("data",d);if(u=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(g))return d={type:"tag",tagType:"discontinuity-sequence"},u[1]&&(d.number=parseInt(u[1],10)),void s.trigger("data",d);if(u=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(g))return d={type:"tag",tagType:"playlist-type"},u[1]&&(d.playlistType=u[1]),void s.trigger("data",d);if(u=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(g))return d=Be(_d(u[1]),{type:"tag",tagType:"byterange"}),void s.trigger("data",d);if(u=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(g))return d={type:"tag",tagType:"allow-cache"},u[1]&&(d.allowed=!/NO/.test(u[1])),void s.trigger("data",d);if(u=/^#EXT-X-MAP:?(.*)$/.exec(g)){if(d={type:"tag",tagType:"map"},u[1]){var L=qa(u[1]);L.URI&&(d.uri=L.URI),L.BYTERANGE&&(d.byterange=_d(L.BYTERANGE))}s.trigger("data",d)}else if(u=/^#EXT-X-STREAM-INF:?(.*)$/.exec(g)){if(d={type:"tag",tagType:"stream-inf"},u[1]){if(d.attributes=qa(u[1]),d.attributes.RESOLUTION){var P=d.attributes.RESOLUTION.split("x"),q={};P[0]&&(q.width=parseInt(P[0],10)),P[1]&&(q.height=parseInt(P[1],10)),d.attributes.RESOLUTION=q}d.attributes.BANDWIDTH&&(d.attributes.BANDWIDTH=parseInt(d.attributes.BANDWIDTH,10)),d.attributes["PROGRAM-ID"]&&(d.attributes["PROGRAM-ID"]=parseInt(d.attributes["PROGRAM-ID"],10))}s.trigger("data",d)}else{if(u=/^#EXT-X-MEDIA:?(.*)$/.exec(g))return d={type:"tag",tagType:"media"},u[1]&&(d.attributes=qa(u[1])),void s.trigger("data",d);if(u=/^#EXT-X-ENDLIST/.exec(g))s.trigger("data",{type:"tag",tagType:"endlist"});else{if(!(u=/^#EXT-X-DISCONTINUITY/.exec(g)))return(u=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(g))?(d={type:"tag",tagType:"program-date-time"},u[1]&&(d.dateTimeString=u[1],d.dateTimeObject=new Date(u[1])),void s.trigger("data",d)):(u=/^#EXT-X-KEY:?(.*)$/.exec(g))?(d={type:"tag",tagType:"key"},u[1]&&(d.attributes=qa(u[1]),d.attributes.IV&&("0x"===d.attributes.IV.substring(0,2).toLowerCase()&&(d.attributes.IV=d.attributes.IV.substring(2)),d.attributes.IV=d.attributes.IV.match(/.{8}/g),d.attributes.IV[0]=parseInt(d.attributes.IV[0],16),d.attributes.IV[1]=parseInt(d.attributes.IV[1],16),d.attributes.IV[2]=parseInt(d.attributes.IV[2],16),d.attributes.IV[3]=parseInt(d.attributes.IV[3],16),d.attributes.IV=new Uint32Array(d.attributes.IV))),void s.trigger("data",d)):(u=/^#EXT-X-START:?(.*)$/.exec(g))?(d={type:"tag",tagType:"start"},u[1]&&(d.attributes=qa(u[1]),d.attributes["TIME-OFFSET"]=parseFloat(d.attributes["TIME-OFFSET"]),d.attributes.PRECISE=/YES/.test(d.attributes.PRECISE)),void s.trigger("data",d)):(u=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(g))?((d={type:"tag",tagType:"cue-out-cont"}).data=u[1]?u[1]:"",void s.trigger("data",d)):(u=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(g))?((d={type:"tag",tagType:"cue-out"}).data=u[1]?u[1]:"",void s.trigger("data",d)):(u=/^#EXT-X-CUE-IN:?(.*)?$/.exec(g))?((d={type:"tag",tagType:"cue-in"}).data=u[1]?u[1]:"",void s.trigger("data",d)):(u=/^#EXT-X-SKIP:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"skip"}).attributes=qa(u[1]),d.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(d.attributes["SKIPPED-SEGMENTS"]=parseInt(d.attributes["SKIPPED-SEGMENTS"],10)),d.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(d.attributes["RECENTLY-REMOVED-DATERANGES"]=d.attributes["RECENTLY-REMOVED-DATERANGES"].split(Eg)),void s.trigger("data",d)):(u=/^#EXT-X-PART:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"part"}).attributes=qa(u[1]),["DURATION"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=parseFloat(d.attributes[le]))}),["INDEPENDENT","GAP"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=/YES/.test(d.attributes[le]))}),d.attributes.hasOwnProperty("BYTERANGE")&&(d.attributes.byterange=_d(d.attributes.BYTERANGE)),void s.trigger("data",d)):(u=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"server-control"}).attributes=qa(u[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=parseFloat(d.attributes[le]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=/YES/.test(d.attributes[le]))}),void s.trigger("data",d)):(u=/^#EXT-X-PART-INF:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"part-inf"}).attributes=qa(u[1]),["PART-TARGET"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=parseFloat(d.attributes[le]))}),void s.trigger("data",d)):(u=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"preload-hint"}).attributes=qa(u[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(le){if(d.attributes.hasOwnProperty(le)){d.attributes[le]=parseInt(d.attributes[le],10);var _e="BYTERANGE-LENGTH"===le?"length":"offset";d.attributes.byterange=d.attributes.byterange||{},d.attributes.byterange[_e]=d.attributes[le],delete d.attributes[le]}}),void s.trigger("data",d)):(u=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(g))&&u[1]?((d={type:"tag",tagType:"rendition-report"}).attributes=qa(u[1]),["LAST-MSN","LAST-PART"].forEach(function(le){d.attributes.hasOwnProperty(le)&&(d.attributes[le]=parseInt(d.attributes[le],10))}),void s.trigger("data",d)):void s.trigger("data",{type:"tag",data:g.slice(4)});s.trigger("data",{type:"tag",tagType:"discontinuity"})}}}else s.trigger("data",{type:"comment",text:g.slice(1)})})}},r.addParser=function(e){var s=this,u=e.expression,d=e.customType,m=e.dataParser,g=e.segment;"function"!=typeof m&&(m=function(L){return L}),this.customParsers.push(function(T){if(u.exec(T))return s.trigger("data",{type:"custom",data:m(T),customType:d,segment:g}),!0})},r.addTagMapper=function(e){var s=e.expression,u=e.map;this.tagMappers.push(function(g){return s.test(g)?u(g):g})},n}(yd),Pl=function(n){var r={};return Object.keys(n).forEach(function(o){r[function(n){return n.toLowerCase().replace(/-(\w)/g,function(r){return r[1].toUpperCase()})}(o)]=n[o]}),r},xd=function(n){var r=n.serverControl,o=n.targetDuration,e=n.partTargetDuration;if(r){var s="#EXT-X-SERVER-CONTROL",u="holdBack",d="partHoldBack",m=o&&3*o,g=e&&2*e;o&&!r.hasOwnProperty(u)&&(r[u]=m,this.trigger("info",{message:s+" defaulting HOLD-BACK to targetDuration * 3 ("+m+")."})),m&&r[u]<m&&(this.trigger("warn",{message:s+" clamping HOLD-BACK ("+r[u]+") to targetDuration * 3 ("+m+")"}),r[u]=m),e&&!r.hasOwnProperty(d)&&(r[d]=3*e,this.trigger("info",{message:s+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+r[d]+")."})),e&&r[d]<g&&(this.trigger("warn",{message:s+" clamping PART-HOLD-BACK ("+r[d]+") to partTargetDuration * 2 ("+g+")."}),r[d]=g)}},Lg=function(c){function n(){var o;(o=c.call(this)||this).lineStream=new Sg,o.parseStream=new Cg,o.lineStream.pipe(o.parseStream);var d,m,e=qi(o),s=[],u={},g=!1,T=function(){},L={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},q=0;o.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var le=0,_e=0;return o.on("end",function(){u.uri||!u.parts&&!u.preloadHints||(!u.map&&d&&(u.map=d),!u.key&&m&&(u.key=m),!u.timeline&&"number"==typeof q&&(u.timeline=q),o.manifest.preloadSegment=u)}),o.parseStream.on("data",function(ge){var rt,yt;({tag:function(){({version:function(){ge.version&&(this.manifest.version=ge.version)},"allow-cache":function(){this.manifest.allowCache=ge.allowed,"allowed"in ge||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var Bt={};"length"in ge&&(u.byterange=Bt,Bt.length=ge.length,"offset"in ge||(ge.offset=le)),"offset"in ge&&(u.byterange=Bt,Bt.offset=ge.offset),le=Bt.offset+Bt.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),ge.duration>0&&(u.duration=ge.duration),0===ge.duration&&(u.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key:function(){if(ge.attributes)if("NONE"!==ge.attributes.METHOD)if(ge.attributes.URI){if("com.apple.streamingkeydelivery"===ge.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:ge.attributes});if("com.microsoft.playready"===ge.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:ge.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===ge.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(ge.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===ge.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==ge.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):ge.attributes.KEYID&&"0x"===ge.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:ge.attributes.KEYFORMAT,keyId:ge.attributes.KEYID.substring(2)},pssh:wg(ge.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));ge.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),m={method:ge.attributes.METHOD||"AES-128",uri:ge.attributes.URI},typeof ge.attributes.IV<"u"&&(m.iv=ge.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else m=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(ge.number)?this.manifest.mediaSequence=ge.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+ge.number})},"discontinuity-sequence":function(){isFinite(ge.number)?(this.manifest.discontinuitySequence=ge.number,q=ge.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+ge.number})},"playlist-type":function(){/VOD|EVENT/.test(ge.playlistType)?this.manifest.playlistType=ge.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+ge.playlist})},map:function(){d={},ge.uri&&(d.uri=ge.uri),ge.byterange&&(d.byterange=ge.byterange),m&&(d.key=m)},"stream-inf":function(){this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||L,ge.attributes?(u.attributes||(u.attributes={}),Be(u.attributes,ge.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||L,ge.attributes&&ge.attributes.TYPE&&ge.attributes["GROUP-ID"]&&ge.attributes.NAME){var Bt=this.manifest.mediaGroups[ge.attributes.TYPE];Bt[ge.attributes["GROUP-ID"]]=Bt[ge.attributes["GROUP-ID"]]||{},rt=Bt[ge.attributes["GROUP-ID"]],(yt={default:/yes/i.test(ge.attributes.DEFAULT)}).autoselect=!!yt.default||/yes/i.test(ge.attributes.AUTOSELECT),ge.attributes.LANGUAGE&&(yt.language=ge.attributes.LANGUAGE),ge.attributes.URI&&(yt.uri=ge.attributes.URI),ge.attributes["INSTREAM-ID"]&&(yt.instreamId=ge.attributes["INSTREAM-ID"]),ge.attributes.CHARACTERISTICS&&(yt.characteristics=ge.attributes.CHARACTERISTICS),ge.attributes.FORCED&&(yt.forced=/yes/i.test(ge.attributes.FORCED)),rt[ge.attributes.NAME]=yt}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){q+=1,u.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=ge.dateTimeString,this.manifest.dateTimeObject=ge.dateTimeObject),u.dateTimeString=ge.dateTimeString,u.dateTimeObject=ge.dateTimeObject},targetduration:function(){!isFinite(ge.duration)||ge.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+ge.duration}):(this.manifest.targetDuration=ge.duration,xd.call(this,this.manifest))},start:function(){ge.attributes&&!isNaN(ge.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:ge.attributes["TIME-OFFSET"],precise:ge.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){u.cueOut=ge.data},"cue-out-cont":function(){u.cueOutCont=ge.data},"cue-in":function(){u.cueIn=ge.data},skip:function(){this.manifest.skip=Pl(ge.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",ge.attributes,["SKIPPED-SEGMENTS"])},part:function(){var Bt=this;g=!0;var ci=this.manifest.segments.length,Zt=Pl(ge.attributes);u.parts=u.parts||[],u.parts.push(Zt),Zt.byterange&&(Zt.byterange.hasOwnProperty("offset")||(Zt.byterange.offset=_e),_e=Zt.byterange.offset+Zt.byterange.length),this.warnOnMissingAttributes_("#EXT-X-PART #"+(u.parts.length-1)+" for segment #"+ci,ge.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(ai,qt){ai.hasOwnProperty("lastPart")||Bt.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+qt+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var Bt=this.manifest.serverControl=Pl(ge.attributes);Bt.hasOwnProperty("canBlockReload")||(Bt.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),xd.call(this,this.manifest),Bt.canSkipDateranges&&!Bt.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var Bt=this.manifest.segments.length,ci=Pl(ge.attributes),Zt=ci.type&&"PART"===ci.type;u.preloadHints=u.preloadHints||[],u.preloadHints.push(ci),ci.byterange&&(ci.byterange.hasOwnProperty("offset")||(ci.byterange.offset=Zt?_e:0,Zt&&(_e=ci.byterange.offset+ci.byterange.length)));var Mt=u.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+Mt+" for segment #"+Bt,ge.attributes,["TYPE","URI"]),ci.type)for(var ai=0;ai<u.preloadHints.length-1;ai++){var qt=u.preloadHints[ai];!qt.type||qt.type===ci.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+Mt+" for segment #"+Bt+" has the same TYPE "+ci.type+" as preload hint #"+ai})}},"rendition-report":function(){var Bt=Pl(ge.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(Bt);var ci=this.manifest.renditionReports.length-1,Zt=["LAST-MSN","URI"];g&&Zt.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+ci,ge.attributes,Zt)},"part-inf":function(){this.manifest.partInf=Pl(ge.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",ge.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),xd.call(this,this.manifest)}}[ge.tagType]||T).call(e)},uri:function(){u.uri=ge.uri,s.push(u),this.manifest.targetDuration&&!("duration"in u)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),u.duration=this.manifest.targetDuration),m&&(u.key=m),u.timeline=q,d&&(u.map=d),_e=0,u={}},comment:function(){},custom:function(){ge.segment?(u.custom=u.custom||{},u.custom[ge.customType]=ge.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[ge.customType]=ge.data)}})[ge.type].call(e)}),o}Ti(n,c);var r=n.prototype;return r.warnOnMissingAttributes_=function(e,s,u){var d=[];u.forEach(function(m){s.hasOwnProperty(m)||d.push(m)}),d.length&&this.trigger("warn",{message:e+" lacks required attribute(s): "+d.join(", ")})},r.push=function(e){this.lineStream.push(e)},r.end=function(){this.lineStream.push("\n"),this.trigger("end")},r.addParser=function(e){this.parseStream.addParser(e)},r.addTagMapper=function(e){this.parseStream.addTagMapper(e)},n}(yd),Fo={mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/},Ig=["video","audio","text"],_p=["Video","Audio","Text"],xp=function(n){return n&&n.replace(/avc1\.(\d+)\.(\d+)/i,function(r,o,e){return"avc1."+("00"+Number(o).toString(16)).slice(-2)+"00"+("00"+Number(e).toString(16)).slice(-2)})},hs=function(n){void 0===n&&(n="");var r=n.split(","),o=[];return r.forEach(function(e){var s;e=e.trim(),Ig.forEach(function(u){var d=Fo[u].exec(e.toLowerCase());if(d&&!(d.length<=1)){s=u;var m=e.substring(0,d[1].length),g=e.replace(m,"");o.push({type:m,details:g,mediaType:u})}}),s||o.push({type:e,details:"",mediaType:"unknown"})}),o},bp=function(n){return void 0===n&&(n=""),Fo.audio.test(n.trim().toLowerCase())},Su=function(n){if(n&&"string"==typeof n){var r=n.toLowerCase().split(",").map(function(s){return xp(s.trim())}),o="video";1===r.length&&bp(r[0])?o="audio":1===r.length&&function(n){return void 0===n&&(n=""),Fo.text.test(n.trim().toLowerCase())}(r[0])&&(o="application");var e="mp4";return r.every(function(s){return Fo.mp4.test(s)})?e="mp4":r.every(function(s){return Fo.webm.test(s)})?e="webm":r.every(function(s){return Fo.ogg.test(s)})&&(e="ogg"),o+"/"+e+';codecs="'+n+'"'}},Wc=function(n){return void 0===n&&(n=""),window.MediaSource&&window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported(Su(n))||!1},bd=function(n){return void 0===n&&(n=""),n.toLowerCase().split(",").every(function(r){r=r.trim();for(var o=0;o<_p.length;o++)if(Fo["muxer"+_p[o]].test(r))return!0;return!1})},Tp="mp4a.40.2",Fg=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,Ng=/^application\/dash\+xml/i,Ap=function(n){return Fg.test(n)?"hls":Ng.test(n)?"dash":"application/vnd.videojs.vhs+json"===n?"vhs-json":null},wp=function(n){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer},en=function(n){return n instanceof Uint8Array?n:(!Array.isArray(n)&&!function(n){return wp(n)}(n)&&!(n instanceof ArrayBuffer)&&(n="number"!=typeof n||"number"==typeof n&&n!=n?0:[n]),new Uint8Array(n&&n.buffer||n,n&&n.byteOffset||0,n&&n.byteLength||0))},Nr=window.BigInt||Number,Td=[Nr("0x1"),Nr("0x100"),Nr("0x10000"),Nr("0x1000000"),Nr("0x100000000"),Nr("0x10000000000"),Nr("0x1000000000000"),Nr("0x100000000000000"),Nr("0x10000000000000000")],Hg=function(n,r){var o=void 0===r?{}:r,e=o.signed,s=void 0!==e&&e,u=o.le,d=void 0!==u&&u;n=en(n);var m=d?"reduce":"reduceRight",T=(n[m]?n[m]:Array.prototype[m]).call(n,function(P,q,le){var _e=d?le:Math.abs(le+1-n.length);return P+Nr(q)*Td[_e]},Nr(0));if(s){var L=Td[n.length]/Nr(2)-Nr(1);(T=Nr(T))>L&&(T-=L,T-=L,T-=Nr(2))}return Number(T)},Sp=function(n,r){if("string"!=typeof n&&n&&"function"==typeof n.toString&&(n=n.toString()),"string"!=typeof n)return new Uint8Array;r||(n=unescape(encodeURIComponent(n)));for(var o=new Uint8Array(n.length),e=0;e<n.length;e++)o[e]=n.charCodeAt(e);return o},ir=function(n,r,o){var e=void 0===o?{}:o,s=e.offset,u=void 0===s?0:s,d=e.mask,m=void 0===d?[]:d;return n=en(n),(r=en(r)).length&&n.length-u>=r.length&&(r.every?r.every:Array.prototype.every).call(r,function(T,L){return T===(m[L]?m[L]&n[u+L]:n[u+L])})},Ep="http://example.com",Ad=function(n,r){if(/^[a-z]+:/i.test(r))return r;/^data:/.test(n)&&(n=window.location&&window.location.href||"");var o="function"==typeof window.URL,e=/^\/\//.test(n),s=!window.location&&!/\/\//i.test(n);if(o?n=new window.URL(n,window.location||Ep):/\/\//i.test(n)||(n=Gc.buildAbsoluteURL(window.location&&window.location.href||"",n)),o){var u=new URL(r,n);return s?u.href.slice(Ep.length):e?u.href.slice(u.protocol.length):u.href}return Gc.buildAbsoluteURL(n,r)};function wd(c,n){return void 0===n&&(n=Object),n&&"function"==typeof n.freeze?n.freeze(c):c}var Mp=wd({HTML:"text/html",isHTML:function(n){return n===Mp.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Cp=wd({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(n){return n===Cp.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}),jc={freeze:wd,MIME_TYPE:Mp,NAMESPACE:Cp},Eu=jc.NAMESPACE;function Qg(c){return""!==c}function Zg(c,n){return c.hasOwnProperty(n)||(c[n]=!0),c}function En(c){if(!c)return[];var n=function Kg(c){return c?c.split(/[\t\n\f\r ]+/).filter(Qg):[]}(c);return Object.keys(n.reduce(Zg,{}))}function ua(c,n){for(var r in c)n[r]=c[r]}function ca(c,n){var r=c.prototype;if(!(r instanceof n)){var o=function(){};o.prototype=n.prototype,ua(r,o=new o),c.prototype=r=o}r.constructor!=c&&("function"!=typeof c&&console.error("unknown Class:"+c),r.constructor=c)}var ha={},Ya=ha.ELEMENT_NODE=1,Ll=ha.ATTRIBUTE_NODE=2,Xc=ha.TEXT_NODE=3,Pp=ha.CDATA_SECTION_NODE=4,Lp=ha.ENTITY_REFERENCE_NODE=5,$g=ha.ENTITY_NODE=6,Ip=ha.PROCESSING_INSTRUCTION_NODE=7,Rp=ha.COMMENT_NODE=8,Dp=ha.DOCUMENT_NODE=9,Op=ha.DOCUMENT_TYPE_NODE=10,Ns=ha.DOCUMENT_FRAGMENT_NODE=11,Jg=ha.NOTATION_NODE=12,gr={},cr={};gr.INDEX_SIZE_ERR=(cr[1]="Index size error",1),gr.DOMSTRING_SIZE_ERR=(cr[2]="DOMString size error",2);var Fp=gr.HIERARCHY_REQUEST_ERR=(cr[3]="Hierarchy request error",3);gr.WRONG_DOCUMENT_ERR=(cr[4]="Wrong document",4),gr.INVALID_CHARACTER_ERR=(cr[5]="Invalid character",5),gr.NO_DATA_ALLOWED_ERR=(cr[6]="No data allowed",6),gr.NO_MODIFICATION_ALLOWED_ERR=(cr[7]="No modification allowed",7);var e0=gr.NOT_FOUND_ERR=(cr[8]="Not found",8);gr.NOT_SUPPORTED_ERR=(cr[9]="Not supported",9);var Np=gr.INUSE_ATTRIBUTE_ERR=(cr[10]="Attribute in use",10);function ao(c,n){if(n instanceof Error)var r=n;else r=this,Error.call(this,cr[c]),this.message=cr[c],Error.captureStackTrace&&Error.captureStackTrace(this,ao);return r.code=c,n&&(this.message=this.message+": "+n),r}function ds(){}function No(c,n){this._node=c,this._refresh=n,qc(this)}function qc(c){var n=c._node._inc||c._node.ownerDocument._inc;if(c._inc!=n){var r=c._refresh(c._node);qp(c,"length",r.length),ua(r,c),c._inc=n}}function Mu(){}function Sd(c,n){for(var r=c.length;r--;)if(c[r]===n)return r}function ko(c,n,r,o){if(o?n[Sd(n,o)]=r:n[n.length++]=r,c){r.ownerElement=c;var e=c.ownerDocument;e&&(o&&Bp(e,c,o),function t0(c,n,r){c&&c._inc++,r.namespaceURI===Eu.XMLNS&&(n._nsMap[r.prefix?r.localName:""]=r.value)}(e,c,r))}}function ba(c,n,r){var o=Sd(n,r);if(!(o>=0))throw ao(e0,new Error(c.tagName+"@"+r));for(var e=n.length-1;o<e;)n[o]=n[++o];if(n.length=e,c){var s=c.ownerDocument;s&&(Bp(s,c,r),r.ownerElement=null)}}function da(){}function kr(){}function kp(c){return("<"==c?"&lt;":">"==c&&"&gt;")||"&"==c&&"&amp;"||'"'==c&&"&quot;"||"&#"+c.charCodeAt()+";"}function Cu(c,n){if(n(c))return!0;if(c=c.firstChild)do{if(Cu(c,n))return!0}while(c=c.nextSibling)}function Pu(){}function Bp(c,n,r,o){c&&c._inc++,r.namespaceURI===Eu.XMLNS&&delete n._nsMap[r.prefix?r.localName:""]}function Ed(c,n,r){if(c&&c._inc){c._inc++;var o=n.childNodes;if(r)o[o.length++]=r;else{for(var e=n.firstChild,s=0;e;)o[s++]=e,e=e.nextSibling;o.length=s}}}function Up(c,n){var r=n.previousSibling,o=n.nextSibling;return r?r.nextSibling=o:c.firstChild=o,o?o.previousSibling=r:c.lastChild=r,Ed(c.ownerDocument,c),n}function Hp(c,n,r){var o=n.parentNode;if(o&&o.removeChild(n),n.nodeType===Ns){var e=n.firstChild;if(null==e)return n;var s=n.lastChild}else e=s=n;var u=r?r.previousSibling:c.lastChild;e.previousSibling=u,s.nextSibling=r,u?u.nextSibling=e:c.firstChild=e,null==r?c.lastChild=s:r.previousSibling=s;do{e.parentNode=c}while(e!==s&&(e=e.nextSibling));return Ed(c.ownerDocument||c,c),n.nodeType==Ns&&(n.firstChild=n.lastChild=null),n}function Bo(){this._nsMap={}}function Yc(){}function Lu(){}function Md(){}function Cd(){}function Pd(){}function Qc(){}function zp(){}function Vp(){}function Ld(){}function Kc(){}function Id(){}function Gp(){}function Wp(c,n){var r=[],o=9==this.nodeType&&this.documentElement||this,e=o.prefix,s=o.namespaceURI;if(s&&null==e&&null==(e=o.lookupPrefix(s)))var u=[{namespace:s,prefix:null}];return Il(this,r,c,n,u),r.join("")}function jp(c,n,r){var o=c.prefix||"",e=c.namespaceURI;if(!e||"xml"===o&&e===Eu.XML||e===Eu.XMLNS)return!1;for(var s=r.length;s--;){var u=r[s];if(u.prefix===o)return u.namespace!==e}return!0}function Rd(c,n,r){c.push(" ",n,'="',r.replace(/[<&"]/g,kp),'"')}function Il(c,n,r,o,e){if(e||(e=[]),o){if(!(c=o(c)))return;if("string"==typeof c)return void n.push(c)}switch(c.nodeType){case Ya:var s=c.attributes,u=s.length,rt=c.firstChild,d=c.tagName,m=d;if(!(r=Eu.isHTML(c.namespaceURI)||r)&&!c.prefix&&c.namespaceURI){for(var g,T=0;T<s.length;T++)if("xmlns"===s.item(T).name){g=s.item(T).value;break}if(!g)for(var L=e.length-1;L>=0;L--)if(""===(P=e[L]).prefix&&P.namespace===c.namespaceURI){g=P.namespace;break}if(g!==c.namespaceURI)for(L=e.length-1;L>=0;L--){var P;if((P=e[L]).namespace===c.namespaceURI){P.prefix&&(m=P.prefix+":"+d);break}}}n.push("<",m);for(var q=0;q<u;q++)"xmlns"==(le=s.item(q)).prefix?e.push({prefix:le.localName,namespace:le.value}):"xmlns"==le.nodeName&&e.push({prefix:"",namespace:le.value});for(q=0;q<u;q++){var le,_e,ge;jp(le=s.item(q),0,e)&&(Rd(n,(_e=le.prefix||"")?"xmlns:"+_e:"xmlns",ge=le.namespaceURI),e.push({prefix:_e,namespace:ge})),Il(le,n,r,o,e)}if(d===m&&jp(c,0,e)&&(Rd(n,(_e=c.prefix||"")?"xmlns:"+_e:"xmlns",ge=c.namespaceURI),e.push({prefix:_e,namespace:ge})),rt||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(d)){if(n.push(">"),r&&/^script$/i.test(d))for(;rt;)rt.data?n.push(rt.data):Il(rt,n,r,o,e.slice()),rt=rt.nextSibling;else for(;rt;)Il(rt,n,r,o,e.slice()),rt=rt.nextSibling;n.push("</",m,">")}else n.push("/>");return;case Dp:case Ns:for(rt=c.firstChild;rt;)Il(rt,n,r,o,e.slice()),rt=rt.nextSibling;return;case Ll:return Rd(n,c.name,c.value);case Xc:return n.push(c.data.replace(/[<&]/g,kp).replace(/]]>/g,"]]&gt;"));case Pp:return n.push("<![CDATA[",c.data,"]]>");case Rp:return n.push("\x3c!--",c.data,"--\x3e");case Op:var yt=c.publicId,ni=c.systemId;if(n.push("<!DOCTYPE ",c.name),yt)n.push(" PUBLIC ",yt),ni&&"."!=ni&&n.push(" ",ni),n.push(">");else if(ni&&"."!=ni)n.push(" SYSTEM ",ni,">");else{var It=c.internalSubset;It&&n.push(" [",It,"]"),n.push(">")}return;case Ip:return n.push("<?",c.target," ",c.data,"?>");case Lp:return n.push("&",c.nodeName,";");default:n.push("??",c.nodeName)}}function Xp(c,n,r){var o;switch(n.nodeType){case Ya:(o=n.cloneNode(!1)).ownerDocument=c;case Ns:break;case Ll:r=!0}if(o||(o=n.cloneNode(!1)),o.ownerDocument=c,o.parentNode=null,r)for(var e=n.firstChild;e;)o.appendChild(Xp(c,e,r)),e=e.nextSibling;return o}function Dd(c,n,r){var o=new n.constructor;for(var e in n){var s=n[e];"object"!=typeof s&&s!=o[e]&&(o[e]=s)}switch(n.childNodes&&(o.childNodes=new ds),o.ownerDocument=c,o.nodeType){case Ya:var u=n.attributes,d=o.attributes=new Mu,m=u.length;d._ownerElement=o;for(var g=0;g<m;g++)o.setAttributeNode(Dd(c,u.item(g),!0));break;case Ll:r=!0}if(r)for(var T=n.firstChild;T;)o.appendChild(Dd(c,T,r)),T=T.nextSibling;return o}function qp(c,n,r){c[n]=r}gr.INVALID_STATE_ERR=(cr[11]="Invalid state",11),gr.SYNTAX_ERR=(cr[12]="Syntax error",12),gr.INVALID_MODIFICATION_ERR=(cr[13]="Invalid modification",13),gr.NAMESPACE_ERR=(cr[14]="Invalid namespace",14),gr.INVALID_ACCESS_ERR=(cr[15]="Invalid access",15),ao.prototype=Error.prototype,ua(gr,ao),ds.prototype={length:0,item:function(n){return this[n]||null},toString:function(n,r){for(var o=[],e=0;e<this.length;e++)Il(this[e],o,n,r);return o.join("")}},No.prototype.item=function(c){return qc(this),this[c]},ca(No,ds),Mu.prototype={length:0,item:ds.prototype.item,getNamedItem:function(n){for(var r=this.length;r--;){var o=this[r];if(o.nodeName==n)return o}},setNamedItem:function(n){var r=n.ownerElement;if(r&&r!=this._ownerElement)throw new ao(Np);var o=this.getNamedItem(n.nodeName);return ko(this._ownerElement,this,n,o),o},setNamedItemNS:function(n){var o,r=n.ownerElement;if(r&&r!=this._ownerElement)throw new ao(Np);return o=this.getNamedItemNS(n.namespaceURI,n.localName),ko(this._ownerElement,this,n,o),o},removeNamedItem:function(n){var r=this.getNamedItem(n);return ba(this._ownerElement,this,r),r},removeNamedItemNS:function(n,r){var o=this.getNamedItemNS(n,r);return ba(this._ownerElement,this,o),o},getNamedItemNS:function(n,r){for(var o=this.length;o--;){var e=this[o];if(e.localName==r&&e.namespaceURI==n)return e}return null}},da.prototype={hasFeature:function(n,r){return!0},createDocument:function(n,r,o){var e=new Pu;if(e.implementation=this,e.childNodes=new ds,e.doctype=o||null,o&&e.appendChild(o),r){var s=e.createElementNS(n,r);e.appendChild(s)}return e},createDocumentType:function(n,r,o){var e=new Qc;return e.name=n,e.nodeName=n,e.publicId=r||"",e.systemId=o||"",e}},kr.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(n,r){return Hp(this,n,r)},replaceChild:function(n,r){this.insertBefore(n,r),r&&this.removeChild(r)},removeChild:function(n){return Up(this,n)},appendChild:function(n){return this.insertBefore(n,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(n){return Dd(this.ownerDocument||this,this,n)},normalize:function(){for(var n=this.firstChild;n;){var r=n.nextSibling;r&&r.nodeType==Xc&&n.nodeType==Xc?(this.removeChild(r),n.appendData(r.data)):(n.normalize(),n=r)}},isSupported:function(n,r){return this.ownerDocument.implementation.hasFeature(n,r)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(n){for(var r=this;r;){var o=r._nsMap;if(o)for(var e in o)if(o[e]==n)return e;r=r.nodeType==Ll?r.ownerDocument:r.parentNode}return null},lookupNamespaceURI:function(n){for(var r=this;r;){var o=r._nsMap;if(o&&n in o)return o[n];r=r.nodeType==Ll?r.ownerDocument:r.parentNode}return null},isDefaultNamespace:function(n){return null==this.lookupPrefix(n)}},ua(ha,kr),ua(ha,kr.prototype),Pu.prototype={nodeName:"#document",nodeType:Dp,doctype:null,documentElement:null,_inc:1,insertBefore:function(n,r){if(n.nodeType==Ns){for(var o=n.firstChild;o;){var e=o.nextSibling;this.insertBefore(o,r),o=e}return n}return null==this.documentElement&&n.nodeType==Ya&&(this.documentElement=n),Hp(this,n,r),n.ownerDocument=this,n},removeChild:function(n){return this.documentElement==n&&(this.documentElement=null),Up(this,n)},importNode:function(n,r){return Xp(this,n,r)},getElementById:function(n){var r=null;return Cu(this.documentElement,function(o){if(o.nodeType==Ya&&o.getAttribute("id")==n)return r=o,!0}),r},getElementsByClassName:function(n){var r=En(n);return new No(this,function(o){var e=[];return r.length>0&&Cu(o.documentElement,function(s){if(s!==o&&s.nodeType===Ya){var u=s.getAttribute("class");if(u){var d=n===u;if(!d){var m=En(u);d=r.every(function Ii(c){return function(n){return c&&-1!==c.indexOf(n)}}(m))}d&&e.push(s)}}}),e})},createElement:function(n){var r=new Bo;return r.ownerDocument=this,r.nodeName=n,r.tagName=n,r.localName=n,r.childNodes=new ds,(r.attributes=new Mu)._ownerElement=r,r},createDocumentFragment:function(){var n=new Kc;return n.ownerDocument=this,n.childNodes=new ds,n},createTextNode:function(n){var r=new Md;return r.ownerDocument=this,r.appendData(n),r},createComment:function(n){var r=new Cd;return r.ownerDocument=this,r.appendData(n),r},createCDATASection:function(n){var r=new Pd;return r.ownerDocument=this,r.appendData(n),r},createProcessingInstruction:function(n,r){var o=new Id;return o.ownerDocument=this,o.tagName=o.target=n,o.nodeValue=o.data=r,o},createAttribute:function(n){var r=new Yc;return r.ownerDocument=this,r.name=n,r.nodeName=n,r.localName=n,r.specified=!0,r},createEntityReference:function(n){var r=new Ld;return r.ownerDocument=this,r.nodeName=n,r},createElementNS:function(n,r){var o=new Bo,e=r.split(":"),s=o.attributes=new Mu;return o.childNodes=new ds,o.ownerDocument=this,o.nodeName=r,o.tagName=r,o.namespaceURI=n,2==e.length?(o.prefix=e[0],o.localName=e[1]):o.localName=r,s._ownerElement=o,o},createAttributeNS:function(n,r){var o=new Yc,e=r.split(":");return o.ownerDocument=this,o.nodeName=r,o.name=r,o.namespaceURI=n,o.specified=!0,2==e.length?(o.prefix=e[0],o.localName=e[1]):o.localName=r,o}},ca(Pu,kr),Pu.prototype.getElementsByTagName=(Bo.prototype={nodeType:Ya,hasAttribute:function(n){return null!=this.getAttributeNode(n)},getAttribute:function(n){var r=this.getAttributeNode(n);return r&&r.value||""},getAttributeNode:function(n){return this.attributes.getNamedItem(n)},setAttribute:function(n,r){var o=this.ownerDocument.createAttribute(n);o.value=o.nodeValue=""+r,this.setAttributeNode(o)},removeAttribute:function(n){var r=this.getAttributeNode(n);r&&this.removeAttributeNode(r)},appendChild:function(n){return n.nodeType===Ns?this.insertBefore(n,null):function i0(c,n){var r=n.parentNode;if(r){var o=c.lastChild;r.removeChild(n),o=c.lastChild}return o=c.lastChild,n.parentNode=c,n.previousSibling=o,n.nextSibling=null,o?o.nextSibling=n:c.firstChild=n,c.lastChild=n,Ed(c.ownerDocument,c,n),n}(this,n)},setAttributeNode:function(n){return this.attributes.setNamedItem(n)},setAttributeNodeNS:function(n){return this.attributes.setNamedItemNS(n)},removeAttributeNode:function(n){return this.attributes.removeNamedItem(n.nodeName)},removeAttributeNS:function(n,r){var o=this.getAttributeNodeNS(n,r);o&&this.removeAttributeNode(o)},hasAttributeNS:function(n,r){return null!=this.getAttributeNodeNS(n,r)},getAttributeNS:function(n,r){var o=this.getAttributeNodeNS(n,r);return o&&o.value||""},setAttributeNS:function(n,r,o){var e=this.ownerDocument.createAttributeNS(n,r);e.value=e.nodeValue=""+o,this.setAttributeNode(e)},getAttributeNodeNS:function(n,r){return this.attributes.getNamedItemNS(n,r)},getElementsByTagName:function(n){return new No(this,function(r){var o=[];return Cu(r,function(e){e!==r&&e.nodeType==Ya&&("*"===n||e.tagName==n)&&o.push(e)}),o})},getElementsByTagNameNS:function(n,r){return new No(this,function(o){var e=[];return Cu(o,function(s){s!==o&&s.nodeType===Ya&&("*"===n||s.namespaceURI===n)&&("*"===r||s.localName==r)&&e.push(s)}),e})}}).getElementsByTagName,Pu.prototype.getElementsByTagNameNS=Bo.prototype.getElementsByTagNameNS,ca(Bo,kr),Yc.prototype.nodeType=Ll,ca(Yc,kr),Lu.prototype={data:"",substringData:function(n,r){return this.data.substring(n,n+r)},appendData:function(n){this.nodeValue=this.data=n=this.data+n,this.length=n.length},insertData:function(n,r){this.replaceData(n,0,r)},appendChild:function(n){throw new Error(cr[Fp])},deleteData:function(n,r){this.replaceData(n,r,"")},replaceData:function(n,r,o){var e=this.data.substring(0,n),s=this.data.substring(n+r);this.nodeValue=this.data=o=e+o+s,this.length=o.length}},ca(Lu,kr),Md.prototype={nodeName:"#text",nodeType:Xc,splitText:function(n){var r=this.data,o=r.substring(n);r=r.substring(0,n),this.data=this.nodeValue=r,this.length=r.length;var e=this.ownerDocument.createTextNode(o);return this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling),e}},ca(Md,Lu),Cd.prototype={nodeName:"#comment",nodeType:Rp},ca(Cd,Lu),Pd.prototype={nodeName:"#cdata-section",nodeType:Pp},ca(Pd,Lu),Qc.prototype.nodeType=Op,ca(Qc,kr),zp.prototype.nodeType=Jg,ca(zp,kr),Vp.prototype.nodeType=$g,ca(Vp,kr),Ld.prototype.nodeType=Lp,ca(Ld,kr),Kc.prototype.nodeName="#document-fragment",Kc.prototype.nodeType=Ns,ca(Kc,kr),Id.prototype.nodeType=Ip,ca(Id,kr),Gp.prototype.serializeToString=function(c,n,r){return Wp.call(c,n,r)},kr.prototype.toString=Wp;try{if(Object.defineProperty){var n0=function c(n){switch(n.nodeType){case Ya:case Ns:var r=[];for(n=n.firstChild;n;)7!==n.nodeType&&8!==n.nodeType&&r.push(c(n)),n=n.nextSibling;return r.join("");default:return n.nodeValue}};Object.defineProperty(No.prototype,"length",{get:function(){return qc(this),this.$$length}}),Object.defineProperty(kr.prototype,"textContent",{get:function(){return n0(this)},set:function(n){switch(this.nodeType){case Ya:case Ns:for(;this.firstChild;)this.removeChild(this.firstChild);(n||String(n))&&this.appendChild(this.ownerDocument.createTextNode(n));break;default:this.data=n,this.value=n,this.nodeValue=n}}}),qp=function(n,r,o){n["$$"+r]=o}}}catch{}var fs_DOMImplementation=da,fs_XMLSerializer=Gp,Rl=Ke(function(c,n){var r=jc.freeze;n.XML_ENTITIES=r({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),n.HTML_ENTITIES=r({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",times:"\xd7",divide:"\xf7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",euro:"\u20ac",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),n.entityMap=n.HTML_ENTITIES}),Iu=jc.NAMESPACE,Fd=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,Nd=new RegExp("[\\-\\.0-9"+Fd.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),kd=new RegExp("^"+Fd.source+Nd.source+"*(?::"+Fd.source+Nd.source+"*)?$");function Uo(c,n){this.message=c,this.locator=n,Error.captureStackTrace&&Error.captureStackTrace(this,Uo)}function Zp(){}function $p(c,n){return n.lineNumber=c.lineNumber,n.columnNumber=c.columnNumber,n}function o0(c,n,r,o,e,s){function u(P,q,le){r.attributeNames.hasOwnProperty(P)&&s.fatalError("Attribute "+P+" redefined"),r.addValue(P,q,le)}for(var d,g=++n,T=0;;){var L=c.charAt(g);switch(L){case"=":if(1===T)d=c.slice(n,g),T=3;else{if(2!==T)throw new Error("attribute equal must after attrName");T=3}break;case"'":case'"':if(3===T||1===T){if(1===T&&(s.warning('attribute value must after "="'),d=c.slice(n,g)),!((g=c.indexOf(L,n=g+1))>0))throw new Error("attribute value no end '"+L+"' match");u(d,m=c.slice(n,g).replace(/&#?\w+;/g,e),n-1),T=5}else{if(4!=T)throw new Error('attribute value must after "="');u(d,m=c.slice(n,g).replace(/&#?\w+;/g,e),n),s.warning('attribute "'+d+'" missed start quot('+L+")!!"),n=g+1,T=5}break;case"/":switch(T){case 0:r.setTagName(c.slice(n,g));case 5:case 6:case 7:T=7,r.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==T&&r.setTagName(c.slice(n,g)),g;case">":switch(T){case 0:r.setTagName(c.slice(n,g));case 5:case 6:case 7:break;case 4:case 1:"/"===(m=c.slice(n,g)).slice(-1)&&(r.closed=!0,m=m.slice(0,-1));case 2:2===T&&(m=d),4==T?(s.warning('attribute "'+m+'" missed quot(")!'),u(d,m.replace(/&#?\w+;/g,e),n)):((!Iu.isHTML(o[""])||!m.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+m+'" missed value!! "'+m+'" instead!!'),u(m,m,n));break;case 3:throw new Error("attribute value missed!!")}return g;case"\x80":L=" ";default:if(L<=" ")switch(T){case 0:r.setTagName(c.slice(n,g)),T=6;break;case 1:d=c.slice(n,g),T=2;break;case 4:var m=c.slice(n,g).replace(/&#?\w+;/g,e);s.warning('attribute "'+m+'" missed quot(")!!'),u(d,m,n);case 5:T=6}else switch(T){case 2:(!Iu.isHTML(o[""])||!d.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+d+'" missed value!! "'+d+'" instead2!!'),u(d,d,n),n=g,T=1;break;case 5:s.warning('attribute space is required"'+d+'"!!');case 6:T=1,n=g;break;case 3:T=4,n=g;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}g++}}function Jp(c,n,r){for(var o=c.tagName,e=null,L=c.length;L--;){var s=c[L],u=s.qName,d=s.value;if((P=u.indexOf(":"))>0)var m=s.prefix=u.slice(0,P),g=u.slice(P+1),T="xmlns"===m&&g;else g=u,m=null,T="xmlns"===u&&"";s.localName=g,!1!==T&&(null==e&&(e={},Ud(r,r={})),r[T]=e[T]=d,s.uri=Iu.XMLNS,n.startPrefixMapping(T,d))}for(L=c.length;L--;)(m=(s=c[L]).prefix)&&("xml"===m&&(s.uri=Iu.XML),"xmlns"!==m&&(s.uri=r[m||""]));var P;(P=o.indexOf(":"))>0?(m=c.prefix=o.slice(0,P),g=c.localName=o.slice(P+1)):(m=null,g=c.localName=o);var q=c.uri=r[m||""];if(n.startElement(q,g,o,c),!c.closed)return c.currentNSMap=r,c.localNSMap=e,!0;if(n.endElement(q,g,o),e)for(m in e)n.endPrefixMapping(m)}function em(c,n,r,o,e){if(/^(?:script|textarea)$/i.test(r)){var s=c.indexOf("</"+r+">",n),u=c.substring(n+1,s);if(/[&<]/.test(u))return/^script$/i.test(r)?(e.characters(u,0,u.length),s):(u=u.replace(/&#?\w+;/g,o),e.characters(u,0,u.length),s)}return n+1}function l0(c,n,r,o){var e=o[r];return null==e&&((e=c.lastIndexOf("</"+r+">"))<n&&(e=c.lastIndexOf("</"+r)),o[r]=e),e<n}function Ud(c,n){for(var r in c)n[r]=c[r]}function tm(c,n,r,o){if("-"===c.charAt(n+2))return"-"===c.charAt(n+3)?(s=c.indexOf("--\x3e",n+4))>n?(r.comment(c,n+4,s-n-4),s+3):(o.error("Unclosed comment"),-1):-1;if("CDATA["==c.substr(n+3,6)){var s=c.indexOf("]]>",n+9);return r.startCDATA(),r.characters(c,n+9,s-n-9),r.endCDATA(),s+3}var u=function c0(c,n){var r,o=[],e=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(e.lastIndex=n,e.exec(c);r=e.exec(c);)if(o.push(r),r[1])return o}(c,n),d=u.length;if(d>1&&/!doctype/i.test(u[0][0])){var m=u[1][0],g=!1,T=!1;d>3&&(/^public$/i.test(u[2][0])?(g=u[3][0],T=d>4&&u[4][0]):/^system$/i.test(u[2][0])&&(T=u[3][0]));var L=u[d-1];return r.startDTD(m,g,T),r.endDTD(),L.index+L[0].length}return-1}function u0(c,n,r){var o=c.indexOf("?>",n);if(o){var e=c.substring(n,o).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return e?(r.processingInstruction(e[1],e[2]),o+2):-1}return-1}function im(){this.attributeNames={}}(Uo.prototype=new Error).name=Uo.name,Zp.prototype={parse:function(n,r,o){var e=this.domBuilder;e.startDocument(),Ud(r,r={}),function Bd(c,n,r,o,e){function u(xe){var Xe=xe.slice(1,-1);return Xe in r?r[Xe]:"#"===Xe.charAt(0)?function s(xe){return xe>65535?(xe-=65536,String.fromCharCode(55296+(xe>>10),56320+(1023&xe))):String.fromCharCode(xe)}(parseInt(Xe.substr(1).replace("x","0x"))):(e.error("entity not found:"+xe),xe)}function d(xe){if(xe>_e){var Xe=c.substring(_e,xe).replace(/&#?\w+;/g,u);P&&m(_e),o.characters(Xe,0,xe-_e),_e=xe}}function m(xe,Xe){for(;xe>=T&&(Xe=L.exec(c));)T=(g=Xe.index)+Xe[0].length,P.lineNumber++;P.columnNumber=xe-g+1}for(var g=0,T=0,L=/.*(?:\r\n?|\n)|.*$/g,P=o.locator,q=[{currentNSMap:n}],le={},_e=0;;){try{var ge=c.indexOf("<",_e);if(ge<0){if(!c.substr(_e).match(/^\s*$/)){var rt=o.doc,yt=rt.createTextNode(c.substr(_e));rt.appendChild(yt),o.currentElement=yt}return}switch(ge>_e&&d(ge),c.charAt(ge+1)){case"/":var gi=c.indexOf(">",ge+3),ni=c.substring(ge+2,gi).replace(/[ \t\n\r]+$/g,""),It=q.pop();gi<0?(ni=c.substring(ge+2).replace(/[\s<].*/,""),e.error("end tag name: "+ni+" is not complete:"+It.tagName),gi=ge+1+ni.length):ni.match(/\s</)&&(ni=ni.replace(/[\s<].*/,""),e.error("end tag name: "+ni+" maybe not complete"),gi=ge+1+ni.length);var Bt=It.localNSMap,ci=It.tagName==ni;if(ci||It.tagName&&It.tagName.toLowerCase()==ni.toLowerCase()){if(o.endElement(It.uri,It.localName,ni),Bt)for(var Mt in Bt)o.endPrefixMapping(Mt);ci||e.fatalError("end tag name: "+ni+" is not match the current start tagName:"+It.tagName)}else q.push(It);gi++;break;case"?":P&&m(ge),gi=u0(c,ge,o);break;case"!":P&&m(ge),gi=tm(c,ge,o,e);break;default:P&&m(ge);var ai=new im,qt=q[q.length-1].currentNSMap,E=(gi=o0(c,ge,ai,qt,u,e),ai.length);if(!ai.closed&&l0(c,gi,ai.tagName,le)&&(ai.closed=!0,r.nbsp||e.warning("unclosed xml attribute")),P&&E){for(var D=$p(P,{}),X=0;X<E;X++){var J=ai[X];m(J.offset),J.locator=$p(P,{})}o.locator=D,Jp(ai,o,qt)&&q.push(ai),o.locator=P}else Jp(ai,o,qt)&&q.push(ai);Iu.isHTML(ai.uri)&&!ai.closed?gi=em(c,gi,ai.tagName,u,o):gi++}}catch(xe){if(xe instanceof Uo)throw xe;e.error("element parse error: "+xe),gi=-1}gi>_e?_e=gi:d(Math.max(ge,_e)+1)}}(n,r,o,e,this.errorHandler),e.endDocument()}},im.prototype={setTagName:function(n){if(!kd.test(n))throw new Error("invalid tagName:"+n);this.tagName=n},addValue:function(n,r,o){if(!kd.test(n))throw new Error("invalid attribute:"+n);this.attributeNames[n]=this.length,this[this.length++]={qName:n,value:r,offset:o}},length:0,getLocalName:function(n){return this[n].localName},getLocator:function(n){return this[n].locator},getQName:function(n){return this[n].qName},getURI:function(n){return this[n].uri},getValue:function(n){return this[n].value}};var f0=fs_DOMImplementation,rm=jc.NAMESPACE,p0=Uo,am=Zp;function sm(c){this.options=c||{locator:{}}}function Ou(){this.cdata=!1}function Nl(c,n){n.lineNumber=c.lineNumber,n.columnNumber=c.columnNumber}function Hd(c){if(c)return"\n@"+(c.systemId||"")+"#[line:"+c.lineNumber+",col:"+c.columnNumber+"]"}function om(c,n,r){return"string"==typeof c?c.substr(n,r):c.length>=n+r||n?new java.lang.String(c,n,r)+"":c}function Fu(c,n){c.currentElement?c.currentElement.appendChild(n):c.doc.appendChild(n)}sm.prototype.parseFromString=function(c,n){var r=this.options,o=new am,e=r.domBuilder||new Ou,s=r.errorHandler,u=r.locator,d=r.xmlns||{},m=/\/x?html?$/.test(n),g=m?Rl.HTML_ENTITIES:Rl.XML_ENTITIES;return u&&e.setDocumentLocator(u),o.errorHandler=function m0(c,n,r){if(!c){if(n instanceof Ou)return n;c=n}var o={},e=c instanceof Function;function s(u){var d=c[u];!d&&e&&(d=2==c.length?function(m){c(u,m)}:c),o[u]=d&&function(m){d("[xmldom "+u+"]\t"+m+Hd(r))}||function(){}}return r=r||{},s("warning"),s("error"),s("fatalError"),o}(s,e,u),o.domBuilder=r.domBuilder||e,m&&(d[""]=rm.HTML),d.xml=d.xml||rm.XML,c&&"string"==typeof c?o.parse(c,d,g):o.errorHandler.error("invalid doc source"),e.doc},Ou.prototype={startDocument:function(){this.doc=(new f0).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(n,r,o,e){var s=this.doc,u=s.createElementNS(n,o||r),d=e.length;Fu(this,u),this.currentElement=u,this.locator&&Nl(this.locator,u);for(var m=0;m<d;m++){n=e.getURI(m);var g=e.getValue(m),T=(o=e.getQName(m),s.createAttributeNS(n,o));this.locator&&Nl(e.getLocator(m),T),T.value=T.nodeValue=g,u.setAttributeNode(T)}},endElement:function(n,r,o){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(n,r){},endPrefixMapping:function(n){},processingInstruction:function(n,r){var o=this.doc.createProcessingInstruction(n,r);this.locator&&Nl(this.locator,o),Fu(this,o)},ignorableWhitespace:function(n,r,o){},characters:function(n,r,o){if(n=om.apply(this,arguments)){if(this.cdata)var e=this.doc.createCDATASection(n);else e=this.doc.createTextNode(n);this.currentElement?this.currentElement.appendChild(e):/^\s*$/.test(n)&&this.doc.appendChild(e),this.locator&&Nl(this.locator,e)}},skippedEntity:function(n){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(n){(this.locator=n)&&(n.lineNumber=0)},comment:function(n,r,o){n=om.apply(this,arguments);var e=this.doc.createComment(n);this.locator&&Nl(this.locator,e),Fu(this,e)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(n,r,o){var e=this.doc.implementation;if(e&&e.createDocumentType){var s=e.createDocumentType(n,r,o);this.locator&&Nl(this.locator,s),Fu(this,s),this.doc.doctype=s}},warning:function(n){console.warn("[xmldom warning]\t"+n,Hd(this.locator))},error:function(n){console.error("[xmldom error]\t"+n,Hd(this.locator))},fatalError:function(n){throw new p0(n,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(c){Ou.prototype[c]=function(){return null}});var lm={__DOMHandler:Ou,DOMParser:sm,DOMImplementation:fs_DOMImplementation,XMLSerializer:fs_XMLSerializer}.DOMParser,um=function(n){return!!n&&"object"==typeof n},ta=function c(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.reduce(function(e,s){return"object"!=typeof s||Object.keys(s).forEach(function(u){e[u]=Array.isArray(e[u])&&Array.isArray(s[u])?e[u].concat(s[u]):um(e[u])&&um(s[u])?c(e[u],s[u]):s[u]}),e},{})},cm=function(n){return Object.keys(n).map(function(r){return n[r]})},Us=function(n){return n.reduce(function(r,o){return r.concat(o)},[])},kl=function(n){if(!n.length)return[];for(var r=[],o=0;o<n.length;o++)r.push(n[o]);return r},Vd=function(n,r){for(var o=0;o<n.length;o++)if(r(n[o]))return o;return-1},Bl=function(n){var r=n.baseUrl,e=n.source,s=void 0===e?"":e,u=n.range,d=void 0===u?"":u,m=n.indexRange,g=void 0===m?"":m,T={uri:s,resolvedUri:Ad((void 0===r?"":r)||"",s)};if(d||g){var _e,P=(d||g).split("-"),q=window.BigInt?window.BigInt(P[0]):parseInt(P[0],10),le=window.BigInt?window.BigInt(P[1]):parseInt(P[1],10);q<Number.MAX_SAFE_INTEGER&&"bigint"==typeof q&&(q=Number(q)),le<Number.MAX_SAFE_INTEGER&&"bigint"==typeof le&&(le=Number(le)),"bigint"==typeof(_e="bigint"==typeof le||"bigint"==typeof q?window.BigInt(le)-window.BigInt(q)+window.BigInt(1):le-q+1)&&_e<Number.MAX_SAFE_INTEGER&&(_e=Number(_e)),T.byterange={length:_e,offset:q}}return T},Ta=function(n){return n&&"number"!=typeof n&&(n=parseInt(n,10)),isNaN(n)?null:n},Vo={static:function(n){var r=n.duration,o=n.timescale,e=void 0===o?1:o,s=n.sourceDuration,u=n.periodDuration,d=Ta(n.endNumber),m=r/e;return"number"==typeof d?{start:0,end:d}:"number"==typeof u?{start:0,end:u/m}:{start:0,end:s/m}},dynamic:function(n){var r=n.NOW,o=n.clientOffset,e=n.availabilityStartTime,s=n.timescale,u=void 0===s?1:s,d=n.duration,m=n.periodStart,g=void 0===m?0:m,T=n.minimumUpdatePeriod,L=void 0===T?0:T,P=n.timeShiftBufferDepth,q=void 0===P?1/0:P,le=Ta(n.endNumber),_e=(r+o)/1e3,ge=e+g,ni=Math.ceil((_e+L-ge)*u/d),It=Math.floor((_e-ge-q)*u/d),Bt=Math.floor((_e-ge)*u/d);return{start:Math.max(0,It),end:"number"==typeof le?le:Math.min(ni,Bt)}}},Hs=function(n){var r=n.type,o=n.duration,e=n.timescale,s=void 0===e?1:e,u=n.periodDuration,d=n.sourceDuration,m=Vo[r](n),L=function(n,r){for(var o=[],e=n;e<r;e++)o.push(e);return o}(m.start,m.end).map(function(n){return function(r){var o=n.duration,e=n.timescale,d=n.startNumber;return{number:(void 0===d?1:d)+r,duration:o/(void 0===e?1:e),timeline:n.periodStart,time:r*o}}}(n));if("static"===r){var P=L.length-1;L[P].duration=("number"==typeof u?u:d)-o/s*P}return L},Wo=function(n){var r=n.baseUrl,o=n.initialization,e=void 0===o?{}:o,s=n.sourceDuration,u=n.indexRange,d=void 0===u?"":u,m=n.periodStart,g=n.presentationTime,T=n.number,L=void 0===T?0:T,P=n.duration;if(!r)throw new Error("NO_BASE_URL");var q=Bl({baseUrl:r,source:e.sourceURL,range:e.range}),le=Bl({baseUrl:r,source:r,indexRange:d});if(le.map=q,P){var _e=Hs(n);_e.length&&(le.duration=_e[0].duration,le.timeline=_e[0].timeline)}else s&&(le.duration=s,le.timeline=m);return le.presentationTime=g||m,le.number=L,[le]},jo=function(n,r,o){var ge,e=n.sidx.map?n.sidx.map:null,s=n.sidx.duration,u=n.timeline||0,d=n.sidx.byterange,m=d.offset+d.length,g=r.timescale,T=r.references.filter(function(ai){return 1!==ai.referenceType}),L=[],P=n.endList?"static":"dynamic",q=n.sidx.timeline,le=q,_e=n.mediaSequence||0;ge="bigint"==typeof r.firstOffset?window.BigInt(m)+r.firstOffset:m+r.firstOffset;for(var rt=0;rt<T.length;rt++){var Bt,yt=r.references[rt],ni=yt.referencedSize,It=yt.subsegmentDuration;Bt="bigint"==typeof ge?ge+window.BigInt(ni)-window.BigInt(1):ge+ni-1;var Mt=Wo({baseUrl:o,timescale:g,timeline:u,periodStart:q,presentationTime:le,number:_e,duration:It,sourceDuration:s,indexRange:ge+"-"+Bt,type:P})[0];e&&(Mt.map=e),L.push(Mt),ge+="bigint"==typeof ge?window.BigInt(ni):ni,le+=It/g,_e++}return n.segments=L,n},Ul=["AUDIO","SUBTITLES"],Xo=function(n){return function(n,r){return cm(n.reduce(function(o,e){return e.forEach(function(s){o[function(r){return r.timeline}(s)]=s}),o},{}))}(n).sort(function(r,o){return r.timeline>o.timeline?1:-1})},Gd=function(n){var r=[];return function(n,r,o){r.forEach(function(e){for(var s in n.mediaGroups[e])for(var u in n.mediaGroups[e][s])o(n.mediaGroups[e][s][u])})}(n,Ul,function(o,e,s,u){r=r.concat(o.playlists||[])}),r},ku=function(n){var r=n.playlist;r.mediaSequence=n.mediaSequence,r.segments.forEach(function(e,s){e.number=r.mediaSequence+s})},Uu=function(n){return n&&n.uri+"-"+function(n){var r;return r="bigint"==typeof n.offset||"bigint"==typeof n.length?window.BigInt(n.offset)+window.BigInt(n.length)-window.BigInt(1):n.offset+n.length-1,n.offset+"-"+r}(n.byterange)},Hu=function(n){return cm(n.reduce(function(o,e){var u,s=e.attributes.id+(e.attributes.lang||"");o[s]?(e.segments&&(e.segments[0]&&(e.segments[0].discontinuity=!0),(u=o[s].segments).push.apply(u,e.segments)),e.attributes.contentProtection&&(o[s].attributes.contentProtection=e.attributes.contentProtection)):(o[s]=e,o[s].attributes.timelineStarts=[]);return o[s].attributes.timelineStarts.push({start:e.attributes.periodStart,timeline:e.attributes.periodStart}),o},{})).map(function(o){return o.discontinuityStarts=function(n,r){return n.reduce(function(o,e,s){return e.discontinuity&&o.push(s),o},[])}(o.segments||[]),o})},$c=function(n,r){var o=Uu(n.sidx),e=o&&r[o]&&r[o].sidx;return e&&jo(n,e,n.sidx.resolvedUri),n},fm=function(n,r){if(void 0===r&&(r={}),!Object.keys(r).length)return n;for(var o in n)n[o]=$c(n[o],r);return n},vm=function(n){var r,o=n.attributes,e=n.segments,s=n.sidx,u=n.discontinuityStarts,d={attributes:(r={NAME:o.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:o.width,height:o.height},CODECS:o.codecs,BANDWIDTH:o.bandwidth},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===o.type,timeline:o.periodStart,resolvedUri:"",targetDuration:o.duration,discontinuityStarts:u,timelineStarts:o.timelineStarts,segments:e};return o.contentProtection&&(d.contentProtection=o.contentProtection),s&&(d.sidx=s),d},gm=function(n){var r=n.attributes;return"video/mp4"===r.mimeType||"video/webm"===r.mimeType||"video"===r.contentType},x0=function(n){var r=n.attributes;return"audio/mp4"===r.mimeType||"audio/webm"===r.mimeType||"audio"===r.contentType},ym=function(n){var r=n.attributes;return"text/vtt"===r.mimeType||"text"===r.contentType},th=function(n){return n?Object.keys(n).reduce(function(r,o){return r.concat(n[o].playlists)},[]):[]},_m=function(n){var r,o=n.dashPlaylists,e=n.locations,s=n.sidxMapping,u=void 0===s?{}:s,d=n.previousManifest;if(!o.length)return{};var m=o[0].attributes,g=m.sourceDuration,T=m.type,L=m.suggestedPresentationDelay,P=m.minimumUpdatePeriod,q=Hu(o.filter(gm)).map(vm),le=Hu(o.filter(x0)),_e=Hu(o.filter(ym)),ge=o.map(function(Zt){return Zt.attributes.captionServices}).filter(Boolean),rt={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(r={AUDIO:{},VIDEO:{}},r["CLOSED-CAPTIONS"]={},r.SUBTITLES={},r),uri:"",duration:g,playlists:fm(q,u)};P>=0&&(rt.minimumUpdatePeriod=1e3*P),e&&(rt.locations=e),"dynamic"===T&&(rt.suggestedPresentationDelay=L);var ni=le.length?function(n,r,o){void 0===r&&(r={}),void 0===o&&(o=!1);var e,s=n.reduce(function(d,m){var g=m.attributes.role&&m.attributes.role.value||"",T=m.attributes.lang||"",L=m.attributes.label||"main";T&&!m.attributes.label&&(L=m.attributes.lang+(g?" ("+g+")":"")),d[L]||(d[L]={language:T,autoselect:!0,default:"main"===g,playlists:[],uri:""});var q=$c(function(n,r){var o,e=n.attributes,s=n.segments,u=n.sidx,d=n.mediaSequence,m=n.discontinuitySequence,g=n.discontinuityStarts,T={attributes:(o={NAME:e.id,BANDWIDTH:e.bandwidth,CODECS:e.codecs},o["PROGRAM-ID"]=1,o),uri:"",endList:"static"===e.type,timeline:e.periodStart,resolvedUri:"",targetDuration:e.duration,discontinuitySequence:m,discontinuityStarts:g,timelineStarts:e.timelineStarts,mediaSequence:d,segments:s};return e.contentProtection&&(T.contentProtection=e.contentProtection),u&&(T.sidx=u),r&&(T.attributes.AUDIO="audio",T.attributes.SUBTITLES="subs"),T}(m,o),r);return d[L].playlists.push(q),typeof e>"u"&&"main"===g&&((e=m).default=!0),d},{});return e||(s[Object.keys(s)[0]].default=!0),s}(le,u,0===rt.playlists.length):null,It=_e.length?function(n,r){return void 0===r&&(r={}),n.reduce(function(o,e){var s=e.attributes.lang||"text";return o[s]||(o[s]={language:s,default:!1,autoselect:!1,playlists:[],uri:""}),o[s].playlists.push($c(function(n){var r,o=n.attributes,e=n.segments,s=n.mediaSequence,u=n.discontinuityStarts,d=n.discontinuitySequence;typeof e>"u"&&(e=[{uri:o.baseUrl,timeline:o.periodStart,resolvedUri:o.baseUrl||"",duration:o.sourceDuration,number:0}],o.duration=o.sourceDuration);var m=((r={NAME:o.id,BANDWIDTH:o.bandwidth})["PROGRAM-ID"]=1,r);return o.codecs&&(m.CODECS=o.codecs),{attributes:m,uri:"",endList:"static"===o.type,timeline:o.periodStart,resolvedUri:o.baseUrl||"",targetDuration:o.duration,timelineStarts:o.timelineStarts,discontinuityStarts:u,discontinuitySequence:d,mediaSequence:s,segments:e}}(e),r)),o},{})}(_e,u):null,Bt=q.concat(th(ni),th(It)),ci=Bt.map(function(Zt){return Zt.timelineStarts});return rt.timelineStarts=Xo(ci),function(n,r){n.forEach(function(o){o.mediaSequence=0,o.discontinuitySequence=Vd(r,function(e){return e.timeline===o.timeline}),o.segments&&o.segments.forEach(function(e,s){e.number=s})})}(Bt,rt.timelineStarts),ni&&(rt.mediaGroups.AUDIO.audio=ni),It&&(rt.mediaGroups.SUBTITLES.subs=It),ge.length&&(rt.mediaGroups["CLOSED-CAPTIONS"].cc=function(n){return n.reduce(function(r,o){return o&&o.forEach(function(e){var u=e.language;r[u]={autoselect:!1,default:!1,instreamId:e.channel,language:u},e.hasOwnProperty("aspectRatio")&&(r[u].aspectRatio=e.aspectRatio),e.hasOwnProperty("easyReader")&&(r[u].easyReader=e.easyReader),e.hasOwnProperty("3D")&&(r[u]["3D"]=e["3D"])}),r},{})}(ge)),d?function(n){var r=n.oldManifest,o=n.newManifest,e=r.playlists.concat(Gd(r)),s=o.playlists.concat(Gd(o));return o.timelineStarts=Xo([r.timelineStarts,o.timelineStarts]),function(n){var r=n.oldPlaylists,e=n.timelineStarts;n.newPlaylists.forEach(function(s){s.discontinuitySequence=Vd(e,function(T){return T.timeline===s.timeline});var u=function(n,r){for(var o=0;o<n.length;o++)if(n[o].attributes.NAME===r)return n[o];return null}(r,s.attributes.NAME);if(u&&!s.sidx){var d=s.segments[0],m=Vd(u.segments,function(T){return Math.abs(T.presentationTime-d.presentationTime)<.016666666666666666});if(-1===m)return ku({playlist:s,mediaSequence:u.mediaSequence+u.segments.length}),s.segments[0].discontinuity=!0,s.discontinuityStarts.unshift(0),void((!u.segments.length&&s.timeline>u.timeline||u.segments.length&&s.timeline>u.segments[u.segments.length-1].timeline)&&s.discontinuitySequence--);u.segments[m].discontinuity&&!d.discontinuity&&(d.discontinuity=!0,s.discontinuityStarts.unshift(0),s.discontinuitySequence--),ku({playlist:s,mediaSequence:u.segments[m].number})}})}({oldPlaylists:e,newPlaylists:s,timelineStarts:o.timelineStarts}),o}({oldManifest:d,newManifest:rt}):rt},b0=function(n,r,o){var d=n.timescale,g=n.periodStart,L=n.minimumUpdatePeriod;return Math.ceil((((n.NOW+n.clientOffset)/1e3+(void 0===L?0:L)-(n.availabilityStartTime+(void 0===g?0:g)))*(void 0===d?1:d)-r)/o)},ih=function(n,r){for(var o=n.type,e=n.minimumUpdatePeriod,s=void 0===e?0:e,u=n.media,d=void 0===u?"":u,m=n.sourceDuration,g=n.timescale,T=void 0===g?1:g,L=n.startNumber,P=void 0===L?1:L,q=n.periodStart,le=[],_e=-1,ge=0;ge<r.length;ge++){var rt=r[ge],yt=rt.d,ni=rt.r||0,It=rt.t||0;_e<0&&(_e=It),It&&It>_e&&(_e=It);var Bt=void 0;if(ni<0){var ci=ge+1;Bt=ci===r.length?"dynamic"===o&&s>0&&d.indexOf("$Number$")>0?b0(n,_e,yt):(m*T-_e)/yt:(r[ci].t-_e)/yt}else Bt=ni+1;for(var Zt=P+le.length+Bt,Mt=P+le.length;Mt<Zt;)le.push({number:Mt,duration:yt/T,time:_e,timeline:q}),_e+=yt,Mt++}return le},xm=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,zu=function(n,r){return n.replace(xm,function(n){return function(r,o,e,s){if("$$"===r)return"$";if(typeof n[o]>"u")return r;var u=""+n[o];return"RepresentationID"===o||(s=e?parseInt(s,10):1,u.length>=s)?u:""+new Array(s-u.length+1).join("0")+u}}(r))},Tm=function(n,r){var o={RepresentationID:n.id,Bandwidth:n.bandwidth||0},e=n.initialization,s=void 0===e?{sourceURL:"",range:""}:e,u=Bl({baseUrl:n.baseUrl,source:zu(s.sourceURL,o),range:s.range}),d=function(n,r){return n.duration||r?n.duration?Hs(n):ih(n,r):[{number:n.startNumber||1,duration:n.sourceDuration,time:0,timeline:n.periodStart}]}(n,r);return d.map(function(m){o.Number=m.number,o.Time=m.time;var g=zu(n.media||"",o),P=n.periodStart+(m.time-(n.presentationTimeOffset||0))/(n.timescale||1);return{uri:g,timeline:m.timeline,duration:m.duration,resolvedUri:Ad(n.baseUrl||"",g),map:u,number:m.number,presentationTime:P}})},Am=function(n,r){var o=n.duration,e=n.segmentUrls,s=void 0===e?[]:e,u=n.periodStart;if(!o&&!r||o&&r)throw new Error("SEGMENT_TIME_UNSPECIFIED");var m,d=s.map(function(T){return function(n,r){var o=n.baseUrl,e=n.initialization,s=void 0===e?{}:e,u=Bl({baseUrl:o,source:s.sourceURL,range:s.range}),d=Bl({baseUrl:o,source:r.media,range:r.mediaRange});return d.map=u,d}(n,T)});return o&&(m=Hs(n)),r&&(m=ih(n,r)),m.map(function(T,L){if(d[L]){var P=d[L],q=n.timescale||1,le=n.presentationTimeOffset||0;return P.timeline=T.timeline,P.duration=T.duration,P.number=T.number,P.presentationTime=u+(T.time-le)/q,P}}).filter(function(T){return T})},wm=function(n){var e,s,r=n.attributes,o=n.segmentInfo;o.template?(s=Tm,e=ta(r,o.template)):o.base?(s=Wo,e=ta(r,o.base)):o.list&&(s=Am,e=ta(r,o.list));var u={attributes:r};if(!s)return u;var d=s(e,o.segmentTimeline);if(e.duration){var T=e.timescale;e.duration=e.duration/(void 0===T?1:T)}else e.duration=d.length?d.reduce(function(P,q){return Math.max(P,Math.ceil(q.duration))},0):0;return u.attributes=e,u.segments=d,o.base&&e.indexRange&&(u.sidx=d[0],u.segments=[]),u},sr=function(n,r){return kl(n.childNodes).filter(function(o){return o.tagName===r})},zl=function(n){return n.textContent.trim()},Qa=function(n){var m=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(n);if(!m)return 0;var g=m.slice(1),L=g[1],P=g[2],q=g[3],le=g[4],_e=g[5];return 31536e3*parseFloat(g[0]||0)+2592e3*parseFloat(L||0)+86400*parseFloat(P||0)+3600*parseFloat(q||0)+60*parseFloat(le||0)+parseFloat(_e||0)},Xd={mediaPresentationDuration:function(n){return Qa(n)},availabilityStartTime:function(n){return function(n){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(n)&&(n+="Z"),Date.parse(n)}(n)/1e3},minimumUpdatePeriod:function(n){return Qa(n)},suggestedPresentationDelay:function(n){return Qa(n)},type:function(n){return n},timeShiftBufferDepth:function(n){return Qa(n)},start:function(n){return Qa(n)},width:function(n){return parseInt(n,10)},height:function(n){return parseInt(n,10)},bandwidth:function(n){return parseInt(n,10)},startNumber:function(n){return parseInt(n,10)},timescale:function(n){return parseInt(n,10)},presentationTimeOffset:function(n){return parseInt(n,10)},duration:function(n){var r=parseInt(n,10);return isNaN(r)?Qa(n):r},d:function(n){return parseInt(n,10)},t:function(n){return parseInt(n,10)},r:function(n){return parseInt(n,10)},DEFAULT:function(n){return n}},Ar=function(n){return n&&n.attributes?kl(n.attributes).reduce(function(r,o){return r[o.name]=(Xd[o.name]||Xd.DEFAULT)(o.value),r},{}):{}},Mm={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},ms=function(n,r){return r.length?Us(n.map(function(o){return r.map(function(e){return Ad(o,zl(e))})})):n},nh=function(n){var r=sr(n,"SegmentTemplate")[0],o=sr(n,"SegmentList")[0],e=o&&sr(o,"SegmentURL").map(function(P){return ta({tag:"SegmentURL"},Ar(P))}),s=sr(n,"SegmentBase")[0],u=o||r,d=u&&sr(u,"SegmentTimeline")[0],m=o||s||r,g=m&&sr(m,"Initialization")[0],T=r&&Ar(r);T&&g?T.initialization=g&&Ar(g):T&&T.initialization&&(T.initialization={sourceURL:T.initialization});var L={template:T,segmentTimeline:d&&sr(d,"S").map(function(P){return Ar(P)}),list:o&&ta(Ar(o),{segmentUrls:e,initialization:Ar(g)}),base:s&&ta(Ar(s),{initialization:Ar(g)})};return Object.keys(L).forEach(function(P){L[P]||delete L[P]}),L},Cm=function(n,r,o){return function(e){var s=Ar(e),u=ms(r,sr(e,"BaseURL")),d=sr(e,"Role")[0],m={role:Ar(d)},g=ta(n,s,m),T=sr(e,"Accessibility")[0],L=function(n){return"urn:scte:dash:cc:cea-608:2015"===n.schemeIdUri?("string"!=typeof n.value?[]:n.value.split(";")).map(function(e){var s,u;if(u=e,/^CC\d=/.test(e)){var d=e.split("=");s=d[0],u=d[1]}else/^CC\d$/.test(e)&&(s=e);return{channel:s,language:u}}):"urn:scte:dash:cc:cea-708:2015"===n.schemeIdUri?("string"!=typeof n.value?[]:n.value.split(";")).map(function(e){var s={channel:void 0,language:void 0,aspectRatio:1,easyReader:0,"3D":0};if(/=/.test(e)){var u=e.split("="),m=u[1],g=void 0===m?"":m;s.channel=u[0],s.language=e,g.split(",").forEach(function(T){var L=T.split(":"),P=L[0],q=L[1];"lang"===P?s.language=q:"er"===P?s.easyReader=Number(q):"war"===P?s.aspectRatio=Number(q):"3D"===P&&(s["3D"]=Number(q))})}else s.language=e;return s.channel&&(s.channel="SERVICE"+s.channel),s}):void 0}(Ar(T));L&&(g=ta(g,{captionServices:L}));var P=sr(e,"Label")[0];if(P&&P.childNodes.length){var q=P.childNodes[0].nodeValue.trim();g=ta(g,{label:q})}var le=function(n){return n.reduce(function(r,o){var e=Ar(o);e.schemeIdUri&&(e.schemeIdUri=e.schemeIdUri.toLowerCase());var s=Mm[e.schemeIdUri];if(s){r[s]={attributes:e};var u=sr(o,"cenc:pssh")[0];if(u){var d=zl(u);r[s].pssh=d&&function jg(c){for(var n=function(n){return window.atob?window.atob(n):Buffer.from(n,"base64").toString("binary")}(c),r=new Uint8Array(n.length),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}(d)}}return r},{})}(sr(e,"ContentProtection"));Object.keys(le).length&&(g=ta(g,{contentProtection:le}));var _e=nh(e),ge=sr(e,"Representation"),rt=ta(o,_e);return Us(ge.map(function(n,r,o){return function(e){var s=sr(e,"BaseURL"),u=ms(r,s),d=ta(n,Ar(e)),m=nh(e);return u.map(function(g){return{segmentInfo:ta(o,m),attributes:ta(d,{baseUrl:g})}})}}(g,u,rt)))}},Pm=function(n,r){return function(o,e){var s=ms(r,sr(o.node,"BaseURL")),u=ta(n,{periodStart:o.attributes.start});"number"==typeof o.attributes.duration&&(u.periodDuration=o.attributes.duration);var d=sr(o.node,"AdaptationSet"),m=nh(o.node);return Us(d.map(Cm(u,s,m)))}},Wu=function(n){if(""===n)throw new Error("DASH_EMPTY_MANIFEST");var o,e,r=new lm;try{e=(o=r.parseFromString(n,"application/xml"))&&"MPD"===o.documentElement.tagName?o.documentElement:null}catch{}if(!e||e&&e.getElementsByTagName("parsererror").length>0)throw new Error("DASH_INVALID_XML");return e},T0=Math.pow(2,32),Qd=function(n){var o,r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getBigUint64?(o=r.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(o):o:r.getUint32(0)*T0+r.getUint32(4)},w0=en([73,68,51]),Xu=function c(n,r){return void 0===r&&(r=0),(n=en(n)).length-r<10||!ir(n,w0,{offset:r})?r:(r+=function(n,r){void 0===r&&(r=0);var e=(n=en(n))[r+6]<<21|n[r+7]<<14|n[r+8]<<7|n[r+9];return(16&n[r+5])>>4?e+20:e+10}(n,r),c(n,r))},Lm=function(n){return"string"==typeof n?Sp(n):n},M0=function c(n,r,o){void 0===o&&(o=!1),r=function(n){return Array.isArray(n)?n.map(function(r){return Lm(r)}):[Lm(n)]}(r),n=en(n);var e=[];if(!r.length)return e;for(var s=0;s<n.length;){var u=(n[s]<<24|n[s+1]<<16|n[s+2]<<8|n[s+3])>>>0,d=n.subarray(s+4,s+8);if(0===u)break;var m=s+u;if(m>n.length){if(o)break;m=n.length}var g=n.subarray(s+8,m);ir(d,r[0])&&(1===r.length?e.push(g):e.push.apply(e,c(g,r.slice(1),o))),s=m}return e},oh={EBML:en([26,69,223,163]),DocType:en([66,130]),Segment:en([24,83,128,103]),SegmentInfo:en([21,73,169,102]),Tracks:en([22,84,174,107]),Track:en([174]),TrackNumber:en([215]),DefaultDuration:en([35,227,131]),TrackEntry:en([174]),TrackType:en([131]),FlagDefault:en([136]),CodecID:en([134]),CodecPrivate:en([99,162]),VideoTrack:en([224]),AudioTrack:en([225]),Cluster:en([31,67,182,117]),Timestamp:en([231]),TimestampScale:en([42,215,177]),BlockGroup:en([160]),BlockDuration:en([155]),Block:en([161]),SimpleBlock:en([163])},Kd=[128,64,32,16,8,4,2,1],lh=function(n,r,o,e){void 0===o&&(o=!0),void 0===e&&(e=!1);var s=function(n){for(var r=1,o=0;o<Kd.length&&!(n&Kd[o]);o++)r++;return r}(n[r]),u=n.subarray(r,r+s);return o&&((u=Array.prototype.slice.call(n,r,r+s))[0]^=Kd[s-1]),{length:s,value:Hg(u,{signed:e}),bytes:u}},Im=function c(n){return"string"==typeof n?n.match(/.{1,2}/g).map(function(r){return c(r)}):"number"==typeof n?function(n,r){var e=(void 0===r?{}:r).le,s=void 0!==e&&e;("bigint"!=typeof n&&"number"!=typeof n||"number"==typeof n&&n!=n)&&(n=0);for(var u=function(n){return Math.ceil(function(n){return n.toString(2).length}(n)/8)}(n=Nr(n)),d=new Uint8Array(new ArrayBuffer(u)),m=0;m<u;m++){var g=s?m:Math.abs(m+1-d.length);d[g]=Number(n/Td[m]&Nr(255)),n<0&&(d[g]=Math.abs(~d[g]),d[g]-=0===m?1:2)}return d}(n):n},P0=function c(n,r,o){if(o>=r.length)return r.length;var e=lh(r,o,!1);if(ir(n.bytes,e.bytes))return o;var s=lh(r,o+e.length);return c(n,r,o+s.length+s.value+e.length)},qo=function c(n,r){r=function(n){return Array.isArray(n)?n.map(function(r){return Im(r)}):[Im(n)]}(r),n=en(n);var o=[];if(!r.length)return o;for(var e=0;e<n.length;){var s=lh(n,e,!1),u=lh(n,e+s.length),d=e+s.length+u.length;127===u.value&&(u.value=P0(s,n,d),u.value!==n.length&&(u.value-=d));var g=n.subarray(d,d+u.value>n.length?n.length:d+u.value);ir(r[0],s.bytes)&&(1===r.length?o.push(g):o=o.concat(c(g,r.slice(1)))),e+=s.length+u.length+g.length}return o},L0=en([0,0,0,1]),or=en([0,0,1]),uh=en([0,0,3]),Rm=function(n){for(var r=[],o=1;o<n.length-2;)ir(n.subarray(o,o+3),uh)&&(r.push(o+2),o++),o++;if(0===r.length)return n;var e=n.length-r.length,s=new Uint8Array(e),u=0;for(o=0;o<e;u++,o++)u===r[0]&&(u++,r.shift()),s[o]=n[u];return s},qu=function(n,r,o,e){void 0===e&&(e=1/0),n=en(n),o=[].concat(o);for(var u,s=0,d=0;s<n.length&&(d<e||u);){var m=void 0;if(ir(n.subarray(s),L0)?m=4:ir(n.subarray(s),or)&&(m=3),m){if(d++,u)return Rm(n.subarray(u,s));var g=void 0;"h264"===r?g=31&n[s+m]:"h265"===r&&(g=n[s+m]>>1&63),-1!==o.indexOf(g)&&(u=s+m),s+=m+("h264"===r?1:2)}else s++}return n.subarray(0,0)},wr={webm:en([119,101,98,109]),matroska:en([109,97,116,114,111,115,107,97]),flac:en([102,76,97,67]),ogg:en([79,103,103,83]),ac3:en([11,119]),riff:en([82,73,70,70]),avi:en([65,86,73]),wav:en([87,65,86,69]),"3gp":en([102,116,121,112,51,103]),mp4:en([102,116,121,112]),fmp4:en([115,116,121,112]),mov:en([102,116,121,112,113,116]),moov:en([109,111,111,118]),moof:en([109,111,111,102])},Vl={aac:function(n){var r=Xu(n);return ir(n,[255,16],{offset:r,mask:[255,22]})},mp3:function(n){var r=Xu(n);return ir(n,[255,2],{offset:r,mask:[255,6]})},webm:function(n){var r=qo(n,[oh.EBML,oh.DocType])[0];return ir(r,wr.webm)},mkv:function(n){var r=qo(n,[oh.EBML,oh.DocType])[0];return ir(r,wr.matroska)},mp4:function(n){return!Vl["3gp"](n)&&!Vl.mov(n)&&(!!(ir(n,wr.mp4,{offset:4})||ir(n,wr.fmp4,{offset:4})||ir(n,wr.moof,{offset:4})||ir(n,wr.moov,{offset:4}))||void 0)},mov:function(n){return ir(n,wr.mov,{offset:4})},"3gp":function(n){return ir(n,wr["3gp"],{offset:4})},ac3:function(n){var r=Xu(n);return ir(n,wr.ac3,{offset:r})},ts:function(n){if(n.length<189&&n.length>=1)return 71===n[0];for(var r=0;r+188<n.length&&r<188;){if(71===n[r]&&71===n[r+188])return!0;r+=1}return!1},flac:function(n){var r=Xu(n);return ir(n,wr.flac,{offset:r})},ogg:function(n){return ir(n,wr.ogg)},avi:function(n){return ir(n,wr.riff)&&ir(n,wr.avi,{offset:8})},wav:function(n){return ir(n,wr.riff)&&ir(n,wr.wav,{offset:8})},h264:function(n){return function(n,r,o){return qu(n,"h264",7,3)}(n).length},h265:function(n){return function(n,r,o){return qu(n,"h265",[32,33],3)}(n).length}},hh=Object.keys(Vl).filter(function(c){return"ts"!==c&&"h264"!==c&&"h265"!==c}).concat(["ts","h264","h265"]);hh.forEach(function(c){var n=Vl[c];Vl[c]=function(r){return n(en(r))}});var Dm=Vl,Yo=function(n){n=en(n);for(var r=0;r<hh.length;r++){var o=hh[r];if(Dm[o](n))return o}return""};var mh=9e4,ia=function(n,r){if(/^[a-z]+:/i.test(r))return r;/^data:/.test(n)&&(n=window.location&&window.location.href||"");var o="function"==typeof window.URL,e=/^\/\//.test(n),s=!window.location&&!/\/\//i.test(n);if(o?n=new window.URL(n,window.location||yp):/\/\//i.test(n)||(n=Gc.buildAbsoluteURL(window.location&&window.location.href||"",n)),o){var u=new URL(r,n);return s?u.href.slice(yp.length):e?u.href.slice(u.protocol.length):u.href}return Gc.buildAbsoluteURL(n,r)},zs=function(n,r,o){return n&&o&&o.responseURL&&r!==o.responseURL?o.responseURL:r},na=function(n){return ct.log.debug?ct.log.debug.bind(ct,"VHS:",n+" >"):function(){}},Xr=1/30,qr=.1,lo=function(n,r){var e,o=[];if(n&&n.length)for(e=0;e<n.length;e++)r(n.start(e),n.end(e))&&o.push([n.start(e),n.end(e)]);return ct.createTimeRanges(o)},Ka=function(n,r){return lo(n,function(o,e){return o-qr<=r&&e+qr>=r})},Vs=function(n,r){return lo(n,function(o){return o-Xr>=r})},Qo=function(n){var r=[];if(!n||!n.length)return"";for(var o=0;o<n.length;o++)r.push(n.start(o)+" => "+n.end(o));return r.join(", ")},Rn=function(n){for(var r=[],o=0;o<n.length;o++)r.push({start:n.start(o),end:n.end(o)});return r},vh=function(n){if(n&&n.length&&n.end)return n.end(n.length-1)},jl=function(n,r){var o=0;if(!n||!n.length)return o;for(var e=0;e<n.length;e++){var s=n.start(e),u=n.end(e);if(!(r>u)){if(r>s&&r<=u){o+=u-r;continue}o+=u-s}}return o},gh=ct.createTimeRange,Pr=function(n,r){if(!r.preload)return r.duration;var o=0;return(r.parts||[]).forEach(function(e){o+=e.duration}),(r.preloadHints||[]).forEach(function(e){"PART"===e.type&&(o+=n.partTargetDuration)}),o},Qu=function(n){return(n.segments||[]).reduce(function(r,o,e){return o.parts?o.parts.forEach(function(s,u){r.push({duration:s.duration,segmentIndex:e,partIndex:u,part:s,segment:o})}):r.push({duration:o.duration,segmentIndex:e,partIndex:null,segment:o,part:null}),r},[])},yh=function(n){var r=n.segments&&n.segments.length&&n.segments[n.segments.length-1];return r&&r.parts||[]},Xl=function(n){var r=n.preloadSegment;if(r){var o=r.parts;return(r.preloadHints||[]).reduce(function(u,d){return u+("PART"===d.type?1:0)},0)+(o&&o.length?o.length:0)}},_h=function(n,r){if(r.endList)return 0;if(n&&n.suggestedPresentationDelay)return n.suggestedPresentationDelay;var o=yh(r).length>0;return o&&r.serverControl&&r.serverControl.partHoldBack?r.serverControl.partHoldBack:o&&r.partTargetDuration?3*r.partTargetDuration:r.serverControl&&r.serverControl.holdBack?r.serverControl.holdBack:r.targetDuration?3*r.targetDuration:0},ql=function(n,r,o){if(typeof r>"u"&&(r=n.mediaSequence+n.segments.length),r<n.mediaSequence)return 0;var e=function(n,r){var o=0,e=r-n.mediaSequence,s=n.segments[e];if(s){if(typeof s.start<"u")return{result:s.start,precise:!0};if(typeof s.end<"u")return{result:s.end-s.duration,precise:!0}}for(;e--;){if(typeof(s=n.segments[e]).end<"u")return{result:o+s.end,precise:!0};if(o+=Pr(n,s),typeof s.start<"u")return{result:o+s.start,precise:!0}}return{result:o,precise:!1}}(n,r);if(e.precise)return e.result;var s=function(n,r){for(var e,o=0,s=r-n.mediaSequence;s<n.segments.length;s++){if(typeof(e=n.segments[s]).start<"u")return{result:e.start-o,precise:!0};if(o+=Pr(n,e),typeof e.end<"u")return{result:e.end-o,precise:!0}}return{result:-1,precise:!1}}(n,r);return s.precise?s.result:e.result+o},Na=function(n,r,o){if(!n)return 0;if("number"!=typeof o&&(o=0),typeof r>"u"){if(n.totalDuration)return n.totalDuration;if(!n.endList)return window.Infinity}return ql(n,r,o)},Ku=function(n){var r=n.defaultDuration,o=n.durationList,e=n.startIndex,s=n.endIndex,u=0;if(e>s){var d=[s,e];e=d[0],s=d[1]}if(e<0){for(var m=e;m<Math.min(0,s);m++)u+=r;e=0}for(var g=e;g<s;g++)u+=o[g].duration;return u},Nm=function(n,r,o,e){if(!n||!n.segments)return null;if(n.endList)return Na(n);if(null===r)return null;var s=ql(n,n.mediaSequence+n.segments.length,r=r||0);return o&&(s-=e="number"==typeof e?e:_h(null,n)),Math.max(0,s)},km=function(n){return n.excludeUntil&&n.excludeUntil>Date.now()},kn=function(n){return n.excludeUntil&&n.excludeUntil===1/0},fa=function(n){var r=km(n);return!n.disabled&&!r},tf=function(n,r){return r.attributes&&r.attributes[n]},Zu=function(n,r){if(1===n.playlists.length)return!0;var o=r.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===n.playlists.filter(function(e){return!!fa(e)&&(e.attributes.BANDWIDTH||0)<o}).length},Th=function(n,r){return!(!n&&!r||!n&&r||n&&!r||!(n===r||n.id&&r.id&&n.id===r.id||n.resolvedUri&&r.resolvedUri&&n.resolvedUri===r.resolvedUri||n.uri&&r.uri&&n.uri===r.uri))},Ah=function(n,r){var o=n&&n.mediaGroups&&n.mediaGroups.AUDIO||{},e=!1;for(var s in o){for(var u in o[s])if(e=r(o[s][u]))break;if(e)break}return!!e},Wi=function(n){if(!n||!n.playlists||!n.playlists.length)return Ah(n,function(u){return u.playlists&&u.playlists.length||u.uri});for(var o=function(d){var m=n.playlists[d],g=m.attributes&&m.attributes.CODECS;return g&&g.split(",").every(function(L){return bp(L)})||Ah(n,function(L){return Th(m,L)})?"continue":{v:!1}},e=0;e<n.playlists.length;e++){var s=o(e);if("continue"!==s&&"object"==typeof s)return s.v}return!0},Jn={liveEdgeDelay:_h,duration:Na,seekable:function(n,r,o){var s=r||0,u=Nm(n,r,!0,o);return null===u?gh():gh(s,u)},getMediaInfoForTime:function(n){for(var r=n.playlist,o=n.currentTime,e=n.startingSegmentIndex,s=n.startingPartIndex,u=n.startTime,d=n.experimentalExactManifestTimings,m=o-u,g=Qu(r),T=0,L=0;L<g.length;L++){var P=g[L];if(e===P.segmentIndex&&("number"!=typeof s||"number"!=typeof P.partIndex||s===P.partIndex)){T=L;break}}if(m<0){if(T>0)for(var q=T-1;q>=0;q--){var le=g[q];if(m+=le.duration,d){if(m<0)continue}else if(m+Xr<=0)continue;return{partIndex:le.partIndex,segmentIndex:le.segmentIndex,startTime:u-Ku({defaultDuration:r.targetDuration,durationList:g,startIndex:T,endIndex:q})}}return{partIndex:g[0]&&g[0].partIndex||null,segmentIndex:g[0]&&g[0].segmentIndex||0,startTime:o}}if(T<0){for(var _e=T;_e<0;_e++)if((m-=r.targetDuration)<0)return{partIndex:g[0]&&g[0].partIndex||null,segmentIndex:g[0]&&g[0].segmentIndex||0,startTime:o};T=0}for(var ge=T;ge<g.length;ge++){var rt=g[ge];if(m-=rt.duration,d){if(m>0)continue}else if(m-Xr>=0)continue;return{partIndex:rt.partIndex,segmentIndex:rt.segmentIndex,startTime:u+Ku({defaultDuration:r.targetDuration,durationList:g,startIndex:T,endIndex:ge})}}return{segmentIndex:g[g.length-1].segmentIndex,partIndex:g[g.length-1].partIndex,startTime:o}},isEnabled:fa,isDisabled:function(n){return n.disabled},isBlacklisted:km,isIncompatible:kn,playlistEnd:Nm,isAes:function(n){for(var r=0;r<n.segments.length;r++)if(n.segments[r].key)return!0;return!1},hasAttribute:tf,estimateSegmentRequestTime:function(n,r,o,e){return void 0===e&&(e=0),tf("BANDWIDTH",o)?(n*o.attributes.BANDWIDTH-8*e)/r:NaN},isLowestEnabledRendition:Zu,isAudioOnly:Wi,playlistMatch:Th,segmentDurationWithParts:Pr},Ql=ct.log,$u=function(n,r){return n+"-"+r},Ko=function(n,r){!n.mediaGroups||["AUDIO","SUBTITLES"].forEach(function(o){if(n.mediaGroups[o])for(var e in n.mediaGroups[o])for(var s in n.mediaGroups[o][e])r(n.mediaGroups[o][e][s],o,e,s)})},Sh=function(n){var r=n.playlist,o=n.uri;r.id=n.id,r.playlistErrors_=0,o&&(r.uri=o),r.attributes=r.attributes||{}},Hm=function(n,r){n.uri=r;for(var o=0;o<n.playlists.length;o++)n.playlists[o].uri||(n.playlists[o].uri="placeholder-uri-"+o);var s=Wi(n);Ko(n,function(u,d,m,g){var T="placeholder-uri-"+d+"-"+m+"-"+g;if(!u.playlists||!u.playlists.length){if(s&&"AUDIO"===d&&!u.uri)for(var L=0;L<n.playlists.length;L++){var P=n.playlists[L];if(P.attributes&&P.attributes.AUDIO&&P.attributes.AUDIO===m)return}u.playlists=[Be({},u)]}u.playlists.forEach(function(q,le){var _e=$u(le,T);q.uri?q.resolvedUri=q.resolvedUri||ia(n.uri,q.uri):(q.uri=0===le?T:_e,q.resolvedUri=q.uri),q.id=q.id||_e,q.attributes=q.attributes||{},n.playlists[q.id]=q,n.playlists[q.uri]=q})}),function(n){for(var r=n.playlists.length;r--;){var o=n.playlists[r];Sh({playlist:o,id:$u(r,o.uri)}),o.resolvedUri=ia(n.uri,o.uri),n.playlists[o.id]=o,n.playlists[o.uri]=o,o.attributes.BANDWIDTH||Ql.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}(n),function(n){Ko(n,function(r){r.uri&&(r.resolvedUri=ia(n.uri,r.uri))})}(n)},Eh=ct.mergeOptions,N0=function(n,r){if(!n)return r;var o=Eh(n,r);if(n.preloadHints&&!r.preloadHints&&delete o.preloadHints,n.parts&&!r.parts)delete o.parts;else if(n.parts&&r.parts)for(var e=0;e<r.parts.length;e++)n.parts&&n.parts[e]&&(o.parts[e]=Eh(n.parts[e],r.parts[e]));return!n.skipped&&r.skipped&&(o.skipped=!1),n.preload&&!r.preload&&(o.preload=!1),o},zm=function(n,r){!n.resolvedUri&&n.uri&&(n.resolvedUri=ia(r,n.uri)),n.key&&!n.key.resolvedUri&&(n.key.resolvedUri=ia(r,n.key.uri)),n.map&&!n.map.resolvedUri&&(n.map.resolvedUri=ia(r,n.map.uri)),n.map&&n.map.key&&!n.map.key.resolvedUri&&(n.map.key.resolvedUri=ia(r,n.map.key.uri)),n.parts&&n.parts.length&&n.parts.forEach(function(o){o.resolvedUri||(o.resolvedUri=ia(r,o.uri))}),n.preloadHints&&n.preloadHints.length&&n.preloadHints.forEach(function(o){o.resolvedUri||(o.resolvedUri=ia(r,o.uri))})},Vm=function(n){var r=n.segments||[],o=n.preloadSegment;if(o&&o.parts&&o.parts.length){if(o.preloadHints)for(var e=0;e<o.preloadHints.length;e++)if("MAP"===o.preloadHints[e].type)return r;o.duration=n.targetDuration,o.preload=!0,r.push(o)}return r},Kl=function(n,r){return n===r||n.segments&&r.segments&&n.segments.length===r.segments.length&&n.endList===r.endList&&n.mediaSequence===r.mediaSequence&&n.preloadSegment===r.preloadSegment},ka=function(n,r,o){void 0===o&&(o=Kl);var e=Eh(n,{}),s=e.playlists[r.id];if(!s||o(s,r))return null;r.segments=Vm(r);var u=Eh(s,r);if(u.preloadSegment&&!r.preloadSegment&&delete u.preloadSegment,s.segments){if(r.skip){r.segments=r.segments||[];for(var d=0;d<r.skip.skippedSegments;d++)r.segments.unshift({skipped:!0})}u.segments=function(n,r,o){var e=n.slice(),s=r.slice();o=o||0;for(var d,u=[],m=0;m<s.length;m++){var g=e[m+o],T=s[m];g?(d=g.map||d,u.push(N0(g,T))):(d&&!T.map&&(T.map=d),u.push(T))}return u}(s.segments,r.segments,r.mediaSequence-s.mediaSequence)}u.segments.forEach(function(g){zm(g,u.resolvedUri)});for(var m=0;m<e.playlists.length;m++)e.playlists[m].id===r.id&&(e.playlists[m]=u);return e.playlists[r.id]=u,e.playlists[r.uri]=u,Ko(n,function(g,T,L,P){if(g.playlists)for(var q=0;q<g.playlists.length;q++)r.id===g.playlists[q].id&&(g.playlists[q]=u)}),e},$a=function(n,r){var o=n.segments||[],e=o[o.length-1],s=e&&e.parts&&e.parts[e.parts.length-1],u=s&&s.duration||e&&e.duration;return r&&u?1e3*u:500*(n.partTargetDuration||n.targetDuration||10)},Lr=function(c){function n(o,e,s){var u;if(void 0===s&&(s={}),u=c.call(this)||this,!o)throw new Error("A non-empty playlist URL or object is required");u.logger_=na("PlaylistLoader");var m=s.withCredentials,g=void 0!==m&&m,T=s.handleManifestRedirects,L=void 0!==T&&T;u.src=o,u.vhs_=e,u.withCredentials=g,u.handleManifestRedirects=L;var P=e.options_;return u.customTagParsers=P&&P.customTagParsers||[],u.customTagMappers=P&&P.customTagMappers||[],u.experimentalLLHLS=P&&P.experimentalLLHLS||!1,ct.browser.IE_VERSION&&(u.experimentalLLHLS=!1),u.state="HAVE_NOTHING",u.handleMediaupdatetimeout_=u.handleMediaupdatetimeout_.bind(qi(u)),u.on("mediaupdatetimeout",u.handleMediaupdatetimeout_),u}Ti(n,c);var r=n.prototype;return r.handleMediaupdatetimeout_=function(){var e=this;if("HAVE_METADATA"===this.state){var s=this.media(),u=ia(this.master.uri,s.uri);this.experimentalLLHLS&&(u=function(n,r){if(r.endList||!r.serverControl)return n;var o={};if(r.serverControl.canBlockReload){var e=r.preloadSegment,s=r.mediaSequence+r.segments.length;if(e){var u=e.parts||[],d=Xl(r)-1;d>-1&&d!==u.length-1&&(o._HLS_part=d),(d>-1||u.length)&&s--}o._HLS_msn=s}if(r.serverControl&&r.serverControl.canSkipUntil&&(o._HLS_skip=r.serverControl.canSkipDateranges?"v2":"YES"),Object.keys(o).length){var m=new window.URL(n);["_HLS_skip","_HLS_msn","_HLS_part"].forEach(function(g){!o.hasOwnProperty(g)||m.searchParams.set(g,o[g])}),n=m.toString()}return n}(u,s)),this.state="HAVE_CURRENT_METADATA",this.request=this.vhs_.xhr({uri:u,withCredentials:this.withCredentials},function(d,m){if(e.request){if(d)return e.playlistRequestError(e.request,e.media(),"HAVE_METADATA");e.haveMetadata({playlistString:e.request.responseText,url:e.media().uri,id:e.media().id})}})}},r.playlistRequestError=function(e,s,u){var d=s.uri,m=s.id;this.request=null,u&&(this.state=u),this.error={playlist:this.master.playlists[m],status:e.status,message:"HLS playlist request error at URL: "+d+".",responseText:e.responseText,code:e.status>=500?4:2},this.trigger("error")},r.parseManifest_=function(e){var s=this,u=e.url;return function(n){var r=n.onwarn,o=n.oninfo,e=n.manifestString,s=n.customTagParsers,u=void 0===s?[]:s,d=n.customTagMappers,m=void 0===d?[]:d,g=n.experimentalLLHLS,T=new Lg;r&&T.on("warn",r),o&&T.on("info",o),u.forEach(function(_e){return T.addParser(_e)}),m.forEach(function(_e){return T.addTagMapper(_e)}),T.push(e),T.end();var L=T.manifest;if(g||(["preloadSegment","skip","serverControl","renditionReports","partInf","partTargetDuration"].forEach(function(_e){L.hasOwnProperty(_e)&&delete L[_e]}),L.segments&&L.segments.forEach(function(_e){["parts","preloadHints"].forEach(function(ge){_e.hasOwnProperty(ge)&&delete _e[ge]})})),!L.targetDuration){var P=10;L.segments&&L.segments.length&&(P=L.segments.reduce(function(_e,ge){return Math.max(_e,ge.duration)},0)),r&&r("manifest has no targetDuration defaulting to "+P),L.targetDuration=P}var q=yh(L);if(q.length&&!L.partTargetDuration){var le=q.reduce(function(_e,ge){return Math.max(_e,ge.duration)},0);r&&(r("manifest has no partTargetDuration defaulting to "+le),Ql.error("LL-HLS manifest has parts but lacks required #EXT-X-PART-INF:PART-TARGET value. See https://datatracker.ietf.org/doc/html/draft-pantos-hls-rfc8216bis-09#section-4.4.3.7. Playback is not guaranteed.")),L.partTargetDuration=le}return L}({onwarn:function(g){return s.logger_("m3u8-parser warn for "+u+": "+g.message)},oninfo:function(g){return s.logger_("m3u8-parser info for "+u+": "+g.message)},manifestString:e.manifestString,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers,experimentalLLHLS:this.experimentalLLHLS})},r.haveMetadata=function(e){var s=e.playlistString,u=e.playlistObject,d=e.url,m=e.id;this.request=null,this.state="HAVE_METADATA";var g=u||this.parseManifest_({url:d,manifestString:s});g.lastRequest=Date.now(),Sh({playlist:g,uri:d,id:m});var T=ka(this.master,g);this.targetDuration=g.partTargetDuration||g.targetDuration,this.pendingMedia_=null,T?(this.master=T,this.media_=this.master.playlists[m]):this.trigger("playlistunchanged"),this.updateMediaUpdateTimeout_($a(this.media(),!!T)),this.trigger("loadedplaylist")},r.dispose=function(){this.trigger("dispose"),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),window.clearTimeout(this.finalRenditionTimeout),this.off()},r.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},r.media=function(e,s){var u=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}if(window.clearTimeout(this.finalRenditionTimeout),s){var d=(e.partTargetDuration||e.targetDuration)/2*1e3||5e3;this.finalRenditionTimeout=window.setTimeout(this.media.bind(this,e,!1),d)}else{var m=this.state,g=!this.media_||e.id!==this.media_.id,T=this.master.playlists[e.id];if(T&&T.endList||e.endList&&e.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(g&&(this.trigger("mediachanging"),this.trigger("HAVE_MASTER"===m?"loadedmetadata":"mediachange")));if(this.updateMediaUpdateTimeout_($a(e,!0)),g){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.pendingMedia_=e,this.request=this.vhs_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},function(L,P){if(u.request){if(e.lastRequest=Date.now(),e.resolvedUri=zs(u.handleManifestRedirects,e.resolvedUri,P),L)return u.playlistRequestError(u.request,e,m);u.haveMetadata({playlistString:P.responseText,url:e.uri,id:e.id}),u.trigger("HAVE_MASTER"===m?"loadedmetadata":"mediachange")}})}}},r.pause=function(){this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.stopRequest(),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.state=this.media_?"HAVE_METADATA":"HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},r.load=function(e){var s=this;this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null);var u=this.media();e?this.mediaUpdateTimeout=window.setTimeout(function(){s.mediaUpdateTimeout=null,s.load()},u?(u.partTargetDuration||u.targetDuration)/2*1e3:5e3):this.started?this.trigger(u&&!u.endList?"mediaupdatetimeout":"loadedplaylist"):this.start()},r.updateMediaUpdateTimeout_=function(e){var s=this;this.mediaUpdateTimeout&&(window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null),this.media()&&!this.media().endList&&(this.mediaUpdateTimeout=window.setTimeout(function(){s.mediaUpdateTimeout=null,s.trigger("mediaupdatetimeout"),s.updateMediaUpdateTimeout_(e)},e))},r.start=function(){var e=this;if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=window.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(function(){e.setupInitialPlaylist(e.src)},0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(s,u){if(e.request){if(e.request=null,s)return e.error={status:u.status,message:"HLS playlist request error at URL: "+e.src+".",responseText:u.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.src=zs(e.handleManifestRedirects,e.src,u);var d=e.parseManifest_({manifestString:u.responseText,url:e.src});e.setupInitialPlaylist(d)}})},r.srcUri=function(){return"string"==typeof this.src?this.src:this.src.uri},r.setupInitialPlaylist=function(e){if(this.state="HAVE_MASTER",e.playlists)return this.master=e,Hm(this.master,this.srcUri()),e.playlists.forEach(function(u){u.segments=Vm(u),u.segments.forEach(function(d){zm(d,u.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.master.playlists[0]));var s=this.srcUri()||window.location.href;this.master=function(n,r){var o=$u(0,r),e={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:window.location.href,resolvedUri:window.location.href,playlists:[{uri:r,id:o,resolvedUri:r,attributes:{}}]};return e.playlists[o]=e.playlists[0],e.playlists[r]=e.playlists[0],e}(0,s),this.haveMetadata({playlistObject:e,url:s,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},n}(ct.EventTarget),gs=ct.xhr,ys=ct.mergeOptions,Ja=function(n,r,o,e){var s="arraybuffer"===n.responseType?n.response:n.responseText;!r&&s&&(n.responseTime=Date.now(),n.roundTripTime=n.responseTime-n.requestTime,n.bytesReceived=s.byteLength||s.length,n.bandwidth||(n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3))),o.headers&&(n.responseHeaders=o.headers),r&&"ETIMEDOUT"===r.code&&(n.timedout=!0),!r&&!n.aborted&&200!==o.statusCode&&206!==o.statusCode&&0!==o.statusCode&&(r=new Error("XHR Failed with a response of: "+(n&&(s||n.responseText)))),e(r,n)},es=function(){var n=function r(o,e){o=ys({timeout:45e3},o);var s=r.beforeRequest||ct.Vhs.xhr.beforeRequest;if(s&&"function"==typeof s){var u=s(o);u&&(o=u)}var m=(!0===ct.Vhs.xhr.original?gs:ct.Vhs.xhr)(o,function(T,L){return Ja(m,T,L,e)}),g=m.abort;return m.abort=function(){return m.aborted=!0,g.apply(m,arguments)},m.uri=o.uri,m.requestTime=Date.now(),m};return n.original=!0,n},Ws=function(n){var r={};return n.byterange&&(r.Range=function(n){return"bytes="+n.offset+"-"+("bigint"==typeof n.offset||"bigint"==typeof n.length?window.BigInt(n.offset)+window.BigInt(n.length)-window.BigInt(1):n.offset+n.length-1)}(n.byterange)),r},_s=function(n,r){return n.start(r)+"-"+n.end(r)},Zl=function(n,r){var o=n.toString(16);return"00".substring(0,2-o.length)+o+(r%2?" ":"")},er=function(n){return n>=32&&n<126?String.fromCharCode(n):"."},rf=function(n){var r={};return Object.keys(n).forEach(function(o){var e=n[o];r[o]=wp(e)?{bytes:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}:e}),r},Ba=function(n){var r=n.byterange||{length:1/0,offset:0};return[r.length,r.offset,n.resolvedUri].join(",")},Mh=function(n){return n.resolvedUri},af=function(n){for(var r=Array.prototype.slice.call(n),o=16,e="",d=0;d<r.length/o;d++)e+=r.slice(d*o,d*o+o).map(Zl).join("")+" "+r.slice(d*o,d*o+o).map(er).join("")+"\n";return e},of=Object.freeze({__proto__:null,createTransferableMessage:rf,initSegmentId:Ba,segmentKeyId:Mh,hexDump:af,tagDump:function(n){return af(n.bytes)},textRanges:function(n){var o,r="";for(o=0;o<n.length;o++)r+=_s(n,o)+" ";return r}}),Ph=function c(n){var r=n.programTime,o=n.playlist,e=n.retryCount,s=void 0===e?2:e,u=n.seekTo,d=n.pauseAfterSeek,m=void 0===d||d,g=n.tech,T=n.callback;if(!T)throw new Error("seekToProgramTime: callback must be provided");if(typeof r>"u"||!o||!u)return T({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!o.endList&&!g.hasStarted_)return T({message:"player must be playing a live stream to start buffering"});if(!function(n){if(!n.segments||0===n.segments.length)return!1;for(var r=0;r<n.segments.length;r++)if(!n.segments[r].dateTimeObject)return!1;return!0}(o))return T({message:"programDateTime tags must be provided in the manifest "+o.resolvedUri});var L=function(n,r){var o;try{o=new Date(n)}catch{return null}if(!r||!r.segments||0===r.segments.length)return null;var e=r.segments[0];if(o<e.dateTimeObject)return null;for(var s=0;s<r.segments.length-1&&(e=r.segments[s],!(o<r.segments[s+1].dateTimeObject));s++);var d=r.segments[r.segments.length-1],m=d.dateTimeObject,g=d.videoTimingInfo?function(n){return n.transmuxedPresentationEnd-n.transmuxedPresentationStart-n.transmuxerPrependedSeconds}(d.videoTimingInfo):d.duration+.25*d.duration;return o>new Date(m.getTime()+1e3*g)?null:(o>m&&(e=d),{segment:e,estimatedStart:e.videoTimingInfo?e.videoTimingInfo.transmuxedPresentationStart:Jn.duration(r,r.mediaSequence+r.segments.indexOf(e)),type:e.videoTimingInfo?"accurate":"estimate"})}(r,o);if(!L)return T({message:r+" was not found in the stream"});var P=L.segment,q=function(n,r){var o,e;try{o=new Date(n),e=new Date(r)}catch{}var s=o.getTime();return(e.getTime()-s)/1e3}(P.dateTimeObject,r);if("estimate"===L.type)return 0===s?T({message:r+" is not buffered yet. Try again"}):(u(L.estimatedStart+q),void g.one("seeked",function(){c({programTime:r,playlist:o,retryCount:s-1,seekTo:u,pauseAfterSeek:m,tech:g,callback:T})}));var le=P.start+q;g.one("seeked",function(){return T(null,g.currentTime())}),m&&g.pause(),u(le)},ec=function(n,r){if(4===n.readyState)return r()},lf=ct.mergeOptions,Km=function(n,r){if(!Kl(n,r)||n.sidx&&r.sidx&&(n.sidx.offset!==r.sidx.offset||n.sidx.length!==r.sidx.length))return!1;if(!n.sidx&&r.sidx||n.sidx&&!r.sidx||n.segments&&!r.segments||!n.segments&&r.segments)return!1;if(!n.segments&&!r.segments)return!0;for(var o=0;o<n.segments.length;o++){var e=n.segments[o],s=r.segments[o];if(e.uri!==s.uri)return!1;if(e.byterange||s.byterange){var u=e.byterange,d=s.byterange;if(u&&!d||!u&&d||u.offset!==d.offset||u.length!==d.length)return!1}}return!0},Zm=function(n,r){return(Boolean(!n.map&&!r.map)||Boolean(n.map&&r.map&&n.map.byterange.offset===r.map.byterange.offset&&n.map.byterange.length===r.map.byterange.length))&&n.uri===r.uri&&n.byterange.offset===r.byterange.offset&&n.byterange.length===r.byterange.length},tc=function(n,r){var o={};for(var e in n){var u=n[e].sidx;if(u){var d=Uu(u);if(!r[d])break;Zm(r[d].sidxInfo,u)&&(o[d]=r[d])}}return o},ic=function(c){function n(o,e,s,u){var d;void 0===s&&(s={}),(d=c.call(this)||this).masterPlaylistLoader_=u||qi(d),u||(d.isMaster_=!0);var g=s.withCredentials,T=void 0!==g&&g,L=s.handleManifestRedirects,P=void 0!==L&&L;if(d.vhs_=e,d.withCredentials=T,d.handleManifestRedirects=P,!o)throw new Error("A non-empty playlist URL or object is required");return d.on("minimumUpdatePeriod",function(){d.refreshXml_()}),d.on("mediaupdatetimeout",function(){d.refreshMedia_(d.media().id)}),d.state="HAVE_NOTHING",d.loadedPlaylists_={},d.logger_=na("DashPlaylistLoader"),d.isMaster_?(d.masterPlaylistLoader_.srcUrl=o,d.masterPlaylistLoader_.sidxMapping_={}):d.childPlaylist_=o,d}Ti(n,c);var r=n.prototype;return r.requestErrored_=function(e,s,u){return!this.request||(this.request=null,e?(this.error="object"!=typeof e||e instanceof Error?{status:s.status,message:"DASH request error at URL: "+s.uri,response:s.response,code:2}:e,u&&(this.state=u),this.trigger("error"),!0):void 0)},r.addSidxSegments_=function(e,s,u){var d=this,m=e.sidx&&Uu(e.sidx);if(e.sidx&&m&&!this.masterPlaylistLoader_.sidxMapping_[m]){var g=zs(this.handleManifestRedirects,e.sidx.resolvedUri),T=function(P,q){if(!d.requestErrored_(P,q,s)){var _e,le=d.masterPlaylistLoader_.sidxMapping_;try{_e=function(n){var r=new DataView(n.buffer,n.byteOffset,n.byteLength),o={version:n[0],flags:new Uint8Array(n.subarray(1,4)),references:[],referenceId:r.getUint32(4),timescale:r.getUint32(8)},e=12;0===o.version?(o.earliestPresentationTime=r.getUint32(e),o.firstOffset=r.getUint32(e+4),e+=8):(o.earliestPresentationTime=Qd(n.subarray(e)),o.firstOffset=Qd(n.subarray(e+8)),e+=16);var s=r.getUint16(e+=2);for(e+=2;s>0;e+=12,s--)o.references.push({referenceType:(128&n[e])>>>7,referencedSize:2147483647&r.getUint32(e),subsegmentDuration:r.getUint32(e+4),startsWithSap:!!(128&n[e+8]),sapType:(112&n[e+8])>>>4,sapDeltaTime:268435455&r.getUint32(e+8)});return o}(en(q.response).subarray(8))}catch(ge){return void d.requestErrored_(ge,q,s)}return le[m]={sidxInfo:e.sidx,sidx:_e},jo(e,_e,e.sidx.resolvedUri),u(!0)}};this.request=function(n,r,o){var s,e=[],u=!1,d=function(P,q,le,_e){return q.abort(),u=!0,o(P,q,le,_e)},m=function(P,q){if(!u){if(P)return d(P,q,"",e);var le=q.responseText.substring(e&&e.byteLength||0,q.responseText.length);if(e=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if((r=r.filter(function(d){return d&&(d.byteLength||d.length)&&"string"!=typeof d})).length<=1)return en(r[0]);var e=r.reduce(function(d,m,g){return d+(m.byteLength||m.length)},0),s=new Uint8Array(e),u=0;return r.forEach(function(d){d=en(d),s.set(d,u),u+=d.byteLength}),s}(e,Sp(le,!0)),s=s||Xu(e),e.length<10||s&&e.length<s+2)return ec(q,function(){return d(P,q,"",e)});var _e=Yo(e);return"ts"===_e&&e.length<188||!_e&&e.length<376?ec(q,function(){return d(P,q,"",e)}):d(null,q,_e,e)}},T=r({uri:n,beforeSend:function(P){P.overrideMimeType("text/plain; charset=x-user-defined"),P.addEventListener("progress",function(q){return Ja(P,null,{statusCode:P.status},m)})}},function(L,P){return Ja(T,L,P,m)});return T}(g,this.vhs_.xhr,function(L,P,q,le){if(L)return T(L,P);if(!q||"mp4"!==q)return T({status:P.status,message:"Unsupported "+(q||"unknown")+" container type for sidx segment at URL: "+g,response:"",playlist:e,internal:!0,blacklistDuration:1/0,code:2},P);var _e=e.sidx.byterange,ge=_e.offset,rt=_e.length;if(le.length>=rt+ge)return T(L,{response:le.subarray(ge,ge+rt),status:P.status,uri:P.uri});d.request=d.vhs_.xhr({uri:g,responseType:"arraybuffer",headers:Ws({byterange:e.sidx.byterange})},T)})}else this.mediaRequest_=window.setTimeout(function(){return u(!1)},0)},r.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},window.clearTimeout(this.minimumUpdatePeriodTimeout_),window.clearTimeout(this.mediaRequest_),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},r.hasPendingRequest=function(){return this.request||this.mediaRequest_},r.stopRequest=function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}},r.media=function(e){var s=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var u=this.state;if("string"==typeof e){if(!this.masterPlaylistLoader_.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.masterPlaylistLoader_.master.playlists[e]}var d=!this.media_||e.id!==this.media_.id;if(d&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(d&&(this.trigger("mediachanging"),this.trigger("mediachange")));!d||(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,u,function(m){s.haveMetadata({startingState:u,playlist:e})}))},r.haveMetadata=function(e){var s=e.startingState,u=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[u.id]=u,this.mediaRequest_=null,this.refreshMedia_(u.id),this.trigger("HAVE_MASTER"===s?"loadedmetadata":"mediachange")},r.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.isMaster_&&(window.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null),"HAVE_NOTHING"===this.state&&(this.started=!1)},r.load=function(e){var s=this;window.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var u=this.media();e?this.mediaUpdateTimeout=window.setTimeout(function(){return s.load()},u?u.targetDuration/2*1e3:5e3):this.started?u&&!u.endList?(this.isMaster_&&!this.minimumUpdatePeriodTimeout_&&(this.trigger("minimumUpdatePeriod"),this.updateMinimumUpdatePeriodTimeout_()),this.trigger("mediaupdatetimeout")):this.trigger("loadedplaylist"):this.start()},r.start=function(){var e=this;this.started=!0,this.isMaster_?this.requestMaster_(function(s,u){e.haveMaster_(),!e.hasPendingRequest()&&!e.media_&&e.media(e.masterPlaylistLoader_.master.playlists[0])}):this.mediaRequest_=window.setTimeout(function(){return e.haveMaster_()},0)},r.requestMaster_=function(e){var s=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(u,d){if(!s.requestErrored_(u,d)){var m=d.responseText!==s.masterPlaylistLoader_.masterXml_;return s.masterPlaylistLoader_.masterXml_=d.responseText,s.masterLoaded_=d.responseHeaders&&d.responseHeaders.date?Date.parse(d.responseHeaders.date):Date.now(),s.masterPlaylistLoader_.srcUrl=zs(s.handleManifestRedirects,s.masterPlaylistLoader_.srcUrl,d),m?(s.handleMaster_(),void s.syncClientServerClock_(function(){return e(d,m)})):e(d,m)}"HAVE_NOTHING"===s.state&&(s.started=!1)})},r.syncClientServerClock_=function(e){var s=this,u=function(n){return function(n){var r=sr(n,"UTCTiming")[0];if(!r)return null;var o=Ar(r);switch(o.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":o.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":o.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":o.method="DIRECT",o.value=Date.parse(o.value);break;default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return o}(Wu(n))}(this.masterPlaylistLoader_.masterXml_);return null===u?(this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===u.method?(this.masterPlaylistLoader_.clientOffset_=u.value-Date.now(),e()):void(this.request=this.vhs_.xhr({uri:ia(this.masterPlaylistLoader_.srcUrl,u.value),method:u.method,withCredentials:this.withCredentials},function(d,m){if(s.request){if(d)return s.masterPlaylistLoader_.clientOffset_=s.masterLoaded_-Date.now(),e();var g;g="HEAD"===u.method?m.responseHeaders&&m.responseHeaders.date?Date.parse(m.responseHeaders.date):s.masterLoaded_:Date.parse(m.responseText),s.masterPlaylistLoader_.clientOffset_=g-Date.now(),e()}}))},r.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},r.handleMaster_=function(){this.mediaRequest_=null;var e=this.masterPlaylistLoader_.master,s=function(n){var o=n.srcUrl,d=function(n,r){void 0===r&&(r={});var o=function(n,r){void 0===r&&(r={});var o=r,e=o.manifestUri,s=void 0===e?"":e,u=o.NOW,d=void 0===u?Date.now():u,m=o.clientOffset,g=void 0===m?0:m,T=sr(n,"Period");if(!T.length)throw new Error("INVALID_NUMBER_OF_PERIOD");var L=sr(n,"Location"),P=Ar(n),q=ms([s],sr(n,"BaseURL"));P.type=P.type||"static",P.sourceDuration=P.mediaPresentationDuration||0,P.NOW=d,P.clientOffset=g,L.length&&(P.locations=L.map(zl));var le=[];return T.forEach(function(_e,ge){var rt=Ar(_e),yt=le[ge-1];rt.start=function(n){var r=n.attributes,o=n.priorPeriodAttributes;return"number"==typeof r.start?r.start:o&&"number"==typeof o.start&&"number"==typeof o.duration?o.start+o.duration:o||"static"!==n.mpdType?null:0}({attributes:rt,priorPeriodAttributes:yt?yt.attributes:null,mpdType:P.type}),le.push({node:_e,attributes:rt})}),{locations:P.locations,representationInfo:Us(le.map(Pm(P,q)))}}(Wu(n),r),e=function(n){return n.map(wm)}(o.representationInfo);return _m({dashPlaylists:e,locations:o.locations,sidxMapping:r.sidxMapping,previousManifest:r.previousManifest})}(n.masterXml,{manifestUri:o,clientOffset:n.clientOffset,sidxMapping:n.sidxMapping,previousManifest:n.previousManifest});return Hm(d,o),d}({masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_,previousManifest:e});e&&(s=function(n,r,o){for(var e=!0,s=lf(n,{duration:r.duration,minimumUpdatePeriod:r.minimumUpdatePeriod,timelineStarts:r.timelineStarts}),u=0;u<r.playlists.length;u++){var d=r.playlists[u];if(d.sidx){var m=Uu(d.sidx);o&&o[m]&&o[m].sidx&&jo(d,o[m].sidx,d.sidx.resolvedUri)}var g=ka(s,d,Km);g&&(s=g,e=!1)}return Ko(r,function(T,L,P,q){if(T.playlists&&T.playlists.length){var le=T.playlists[0].id,_e=ka(s,T.playlists[0],Km);_e&&((s=_e).mediaGroups[L][P][q].playlists[0]=s.playlists[le],e=!1)}}),r.minimumUpdatePeriod!==n.minimumUpdatePeriod&&(e=!1),e?null:s}(e,s,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=s||e;var u=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return u&&u!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=u),(!e||s&&s.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(s)},r.updateMinimumUpdatePeriodTimeout_=function(){var e=this.masterPlaylistLoader_;e.createMupOnMedia_&&(e.off("loadedmetadata",e.createMupOnMedia_),e.createMupOnMedia_=null),e.minimumUpdatePeriodTimeout_&&(window.clearTimeout(e.minimumUpdatePeriodTimeout_),e.minimumUpdatePeriodTimeout_=null);var s=e.master&&e.master.minimumUpdatePeriod;0===s&&(e.media()?s=1e3*e.media().targetDuration:(e.createMupOnMedia_=e.updateMinimumUpdatePeriodTimeout_,e.one("loadedmetadata",e.createMupOnMedia_))),"number"!=typeof s||s<=0?s<0&&this.logger_("found invalid minimumUpdatePeriod of "+s+", not setting a timeout"):this.createMUPTimeout_(s)},r.createMUPTimeout_=function(e){var s=this.masterPlaylistLoader_;s.minimumUpdatePeriodTimeout_=window.setTimeout(function(){s.minimumUpdatePeriodTimeout_=null,s.trigger("minimumUpdatePeriod"),s.createMUPTimeout_(e)},e)},r.refreshXml_=function(){var e=this;this.requestMaster_(function(s,u){!u||(e.media_&&(e.media_=e.masterPlaylistLoader_.master.playlists[e.media_.id]),e.masterPlaylistLoader_.sidxMapping_=function(n,r){var e=tc(n.playlists,r);return Ko(n,function(s,u,d,m){s.playlists&&s.playlists.length&&(e=lf(e,tc(s.playlists,r)))}),e}(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.sidxMapping_),e.addSidxSegments_(e.media(),e.state,function(d){e.refreshMedia_(e.media().id)}))})},r.refreshMedia_=function(e){var s=this;if(!e)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var u=this.masterPlaylistLoader_.master.playlists,d=!this.media_||this.media_!==u[e];d?this.media_=u[e]:this.trigger("playlistunchanged"),this.mediaUpdateTimeout||function g(){s.media().endList||(s.mediaUpdateTimeout=window.setTimeout(function(){s.trigger("mediaupdatetimeout"),g()},$a(s.media(),Boolean(d))))}(),this.trigger("loadedplaylist")},n}(ct.EventTarget),Sr={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},uf=function(n){return n.on=n.addEventListener,n.off=n.removeEventListener,n},tv=function(n){return function(){var r=function(n){try{return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}catch{var r=new BlobBuilder;return r.append(n),URL.createObjectURL(r.getBlob())}}(n),o=uf(new Worker(r));o.objURL=r;var e=o.terminate;return o.on=o.addEventListener,o.off=o.removeEventListener,o.terminate=function(){return URL.revokeObjectURL(r),e.call(this)},o}},iv=function(n){return"var browserWorkerPolyFill = "+uf.toString()+";\nbrowserWorkerPolyFill(self);\n"+n},nv=function(n){return n.toString().replace(/^function.+?{/,"").slice(0,-1)},rv=iv(nv(function(){var c=function(){this.init=function(){var x={};this.on=function(S,w){x[S]||(x[S]=[]),x[S]=x[S].concat(w)},this.off=function(S,w){var I;return!!x[S]&&(I=x[S].indexOf(w),x[S]=x[S].slice(),x[S].splice(I,1),I>-1)},this.trigger=function(S){var w,I,H,W;if(w=x[S])if(2===arguments.length)for(H=w.length,I=0;I<H;++I)w[I].call(this,arguments[1]);else{for(W=[],I=arguments.length,I=1;I<arguments.length;++I)W.push(arguments[I]);for(H=w.length,I=0;I<H;++I)w[I].apply(this,W)}},this.dispose=function(){x={}}}};c.prototype.pipe=function(re){return this.on("data",function(x){re.push(x)}),this.on("done",function(x){re.flush(x)}),this.on("partialdone",function(x){re.partialFlush(x)}),this.on("endedtimeline",function(x){re.endTimeline(x)}),this.on("reset",function(x){re.reset(x)}),re},c.prototype.push=function(re){this.trigger("data",re)},c.prototype.flush=function(re){this.trigger("done",re)},c.prototype.partialFlush=function(re){this.trigger("partialdone",re)},c.prototype.endTimeline=function(re){this.trigger("endedtimeline",re)},c.prototype.reset=function(re){this.trigger("reset",re)};var u,d,m,g,T,L,P,q,le,_e,ge,rt,yt,ni,It,Bt,ci,Zt,Mt,ai,qt,gi,E,D,X,J,xe,Xe,st,$t,Ft,bt,Ot,hi,Bi,ji,re,x,n=c,r=Math.pow(2,32),e={getUint64:function(x){var w,S=new DataView(x.buffer,x.byteOffset,x.byteLength);return S.getBigUint64?(w=S.getBigUint64(0))<Number.MAX_SAFE_INTEGER?Number(w):w:S.getUint32(0)*r+S.getUint32(4)},MAX_UINT32:r},s=e.MAX_UINT32;(function(){var re;if(E={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(re in E)E.hasOwnProperty(re)&&(E[re]=[re.charCodeAt(0),re.charCodeAt(1),re.charCodeAt(2),re.charCodeAt(3)]);D=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),J=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),X=new Uint8Array([0,0,0,1]),xe=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Xe=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),st={video:xe,audio:Xe},bt=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Ft=new Uint8Array([0,0,0,0,0,0,0,0]),Ot=new Uint8Array([0,0,0,0,0,0,0,0]),hi=Ot,Bi=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),ji=Ot,$t=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),u=function(x){var I,H,S=[],w=0;for(I=1;I<arguments.length;I++)S.push(arguments[I]);for(I=S.length;I--;)w+=S[I].byteLength;for(H=new Uint8Array(w+8),new DataView(H.buffer,H.byteOffset,H.byteLength).setUint32(0,H.byteLength),H.set(x,4),I=0,w=8;I<S.length;I++)H.set(S[I],w),w+=S[I].byteLength;return H},d=function(){return u(E.dinf,u(E.dref,bt))},m=function(x){return u(E.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,x.audioobjecttype<<3|x.samplingfrequencyindex>>>1,x.samplingfrequencyindex<<7|x.channelcount<<3,6,1,2]))},g=function(){return u(E.ftyp,D,X,D,J)},Bt=function(x){return u(E.hdlr,st[x])},T=function(x){return u(E.mdat,x)},It=function(x){var S=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,x.duration>>>24&255,x.duration>>>16&255,x.duration>>>8&255,255&x.duration,85,196,0,0]);return x.samplerate&&(S[12]=x.samplerate>>>24&255,S[13]=x.samplerate>>>16&255,S[14]=x.samplerate>>>8&255,S[15]=255&x.samplerate),u(E.mdhd,S)},ni=function(x){return u(E.mdia,It(x),Bt(x.type),P(x))},L=function(x){return u(E.mfhd,new Uint8Array([0,0,0,0,(4278190080&x)>>24,(16711680&x)>>16,(65280&x)>>8,255&x]))},P=function(x){return u(E.minf,"video"===x.type?u(E.vmhd,$t):u(E.smhd,Ft),d(),Zt(x))},q=function(x,S){for(var w=[],I=S.length;I--;)w[I]=ai(S[I]);return u.apply(null,[E.moof,L(x)].concat(w))},le=function(x){for(var S=x.length,w=[];S--;)w[S]=rt(x[S]);return u.apply(null,[E.moov,ge(4294967295)].concat(w).concat(_e(x)))},_e=function(x){for(var S=x.length,w=[];S--;)w[S]=qt(x[S]);return u.apply(null,[E.mvex].concat(w))},ge=function(x){var S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&x)>>24,(16711680&x)>>16,(65280&x)>>8,255&x,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return u(E.mvhd,S)},ci=function(x){var I,H,S=x.samples||[],w=new Uint8Array(4+S.length);for(H=0;H<S.length;H++)w[H+4]=(I=S[H].flags).dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return u(E.sdtp,w)},Zt=function(x){return u(E.stbl,Mt(x),u(E.stts,ji),u(E.stsc,hi),u(E.stsz,Bi),u(E.stco,Ot))},Mt=function(w){return u(E.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===w.type?re(w):x(w))},re=function(w){var Ne,tt,I=w.sps||[],H=w.pps||[],W=[],Ce=[];for(Ne=0;Ne<I.length;Ne++)W.push((65280&I[Ne].byteLength)>>>8),W.push(255&I[Ne].byteLength),W=W.concat(Array.prototype.slice.call(I[Ne]));for(Ne=0;Ne<H.length;Ne++)Ce.push((65280&H[Ne].byteLength)>>>8),Ce.push(255&H[Ne].byteLength),Ce=Ce.concat(Array.prototype.slice.call(H[Ne]));if(tt=[E.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&w.width)>>8,255&w.width,(65280&w.height)>>8,255&w.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u(E.avcC,new Uint8Array([1,w.profileIdc,w.profileCompatibility,w.levelIdc,255].concat([I.length],W,[H.length],Ce))),u(E.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],w.sarRatio){var Qe=w.sarRatio[0],dt=w.sarRatio[1];tt.push(u(E.pasp,new Uint8Array([(4278190080&Qe)>>24,(16711680&Qe)>>16,(65280&Qe)>>8,255&Qe,(4278190080&dt)>>24,(16711680&dt)>>16,(65280&dt)>>8,255&dt])))}return u.apply(null,tt)},x=function(w){return u(E.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&w.channelcount)>>8,255&w.channelcount,(65280&w.samplesize)>>8,255&w.samplesize,0,0,0,0,(65280&w.samplerate)>>8,255&w.samplerate,0,0]),m(w))},yt=function(x){var S=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&x.id)>>24,(16711680&x.id)>>16,(65280&x.id)>>8,255&x.id,0,0,0,0,(4278190080&x.duration)>>24,(16711680&x.duration)>>16,(65280&x.duration)>>8,255&x.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&x.width)>>8,255&x.width,0,0,(65280&x.height)>>8,255&x.height,0,0]);return u(E.tkhd,S)},ai=function(x){var S,w,I,H,Ce,Ne;return S=u(E.tfhd,new Uint8Array([0,0,0,58,(4278190080&x.id)>>24,(16711680&x.id)>>16,(65280&x.id)>>8,255&x.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),Ce=Math.floor(x.baseMediaDecodeTime/s),Ne=Math.floor(x.baseMediaDecodeTime%s),w=u(E.tfdt,new Uint8Array([1,0,0,0,Ce>>>24&255,Ce>>>16&255,Ce>>>8&255,255&Ce,Ne>>>24&255,Ne>>>16&255,Ne>>>8&255,255&Ne])),"audio"===x.type?(I=gi(x,92),u(E.traf,S,w,I)):(H=ci(x),I=gi(x,H.length+92),u(E.traf,S,w,I,H))},rt=function(x){return x.duration=x.duration||4294967295,u(E.trak,yt(x),ni(x))},qt=function(x){var S=new Uint8Array([0,0,0,0,(4278190080&x.id)>>24,(16711680&x.id)>>16,(65280&x.id)>>8,255&x.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==x.type&&(S[S.length-1]=0),u(E.trex,S)},function(){var re,x,S;S=function(I,H){var W=0,Ce=0,Ne=0,tt=0;return I.length&&(void 0!==I[0].duration&&(W=1),void 0!==I[0].size&&(Ce=2),void 0!==I[0].flags&&(Ne=4),void 0!==I[0].compositionTimeOffset&&(tt=8)),[0,0,W|Ce|Ne|tt,1,(4278190080&I.length)>>>24,(16711680&I.length)>>>16,(65280&I.length)>>>8,255&I.length,(4278190080&H)>>>24,(16711680&H)>>>16,(65280&H)>>>8,255&H]},x=function(I,H){var W,Ce,Ne,tt,Qe,dt;for(Ne=S(tt=I.samples||[],H+=20+16*tt.length),(Ce=new Uint8Array(Ne.length+16*tt.length)).set(Ne),W=Ne.length,dt=0;dt<tt.length;dt++)Ce[W++]=(4278190080&(Qe=tt[dt]).duration)>>>24,Ce[W++]=(16711680&Qe.duration)>>>16,Ce[W++]=(65280&Qe.duration)>>>8,Ce[W++]=255&Qe.duration,Ce[W++]=(4278190080&Qe.size)>>>24,Ce[W++]=(16711680&Qe.size)>>>16,Ce[W++]=(65280&Qe.size)>>>8,Ce[W++]=255&Qe.size,Ce[W++]=Qe.flags.isLeading<<2|Qe.flags.dependsOn,Ce[W++]=Qe.flags.isDependedOn<<6|Qe.flags.hasRedundancy<<4|Qe.flags.paddingValue<<1|Qe.flags.isNonSyncSample,Ce[W++]=61440&Qe.flags.degradationPriority,Ce[W++]=15&Qe.flags.degradationPriority,Ce[W++]=(4278190080&Qe.compositionTimeOffset)>>>24,Ce[W++]=(16711680&Qe.compositionTimeOffset)>>>16,Ce[W++]=(65280&Qe.compositionTimeOffset)>>>8,Ce[W++]=255&Qe.compositionTimeOffset;return u(E.trun,Ce)},re=function(I,H){var W,Ce,Ne,tt,Qe,dt;for(Ne=S(tt=I.samples||[],H+=20+8*tt.length),(W=new Uint8Array(Ne.length+8*tt.length)).set(Ne),Ce=Ne.length,dt=0;dt<tt.length;dt++)W[Ce++]=(4278190080&(Qe=tt[dt]).duration)>>>24,W[Ce++]=(16711680&Qe.duration)>>>16,W[Ce++]=(65280&Qe.duration)>>>8,W[Ce++]=255&Qe.duration,W[Ce++]=(4278190080&Qe.size)>>>24,W[Ce++]=(16711680&Qe.size)>>>16,W[Ce++]=(65280&Qe.size)>>>8,W[Ce++]=255&Qe.size;return u(E.trun,W)},gi=function(I,H){return"audio"===I.type?re(I,H):x(I,H)}}();var Zo,Jo,el,co,tl,nu,ru,au,Ki_mdat=T,Ki_moof=q,fr=function(x,S){var w={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return w.dataOffset=S,w.compositionTimeOffset=x.pts-x.dts,w.duration=x.duration,w.size=4*x.length,w.size+=x.byteLength,x.keyFrame&&(w.flags.dependsOn=2,w.flags.isNonSyncSample=0),w},yr=[33,16,5,32,164,27],aa=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],Pn=function(x){for(var S=[];x--;)S.push(0);return S};Jo=function(x){return 9e4*x},el=function(x,S){return x*S},co=function(x){return x/9e4},tl=function(x,S){return x/S},nu=function(x,S){return Jo(tl(x,S))},ru=function(x,S){return el(co(x),S)},au=function(x,S,w){return co(w?x:x-S)};var un_secondsToVideoTs=Jo,un_videoTsToSeconds=co,un_audioTsToVideoTs=nu,un_videoTsToAudioTs=ru,un_metadataTsToSeconds=au,_v_prefixWithSilence=function(x,S,w,I){var H,Qe,dt,jt,W=0,Ce=0,Ne=0,tt=0;if(S.length&&(H=un_audioTsToVideoTs(x.baseMediaDecodeTime,x.samplerate),W=Math.ceil(9e4/(x.samplerate/1024)),w&&I&&(Ce=H-Math.max(w,I),tt=(Ne=Math.floor(Ce/W))*W),!(Ne<1||tt>45e3))){for((Qe=function(){if(!Zo){var x={96e3:[yr,[227,64],Pn(154),[56]],88200:[yr,[231],Pn(170),[56]],64e3:[yr,[248,192],Pn(240),[56]],48e3:[yr,[255,192],Pn(268),[55,148,128],Pn(54),[112]],44100:[yr,[255,192],Pn(268),[55,163,128],Pn(84),[112]],32e3:[yr,[255,192],Pn(268),[55,234],Pn(226),[112]],24e3:[yr,[255,192],Pn(268),[55,255,128],Pn(268),[111,112],Pn(126),[224]],16e3:[yr,[255,192],Pn(268),[55,255,128],Pn(268),[111,255],Pn(269),[223,108],Pn(195),[1,192]],12e3:[aa,Pn(268),[3,127,248],Pn(268),[6,255,240],Pn(268),[13,255,224],Pn(268),[27,253,128],Pn(259),[56]],11025:[aa,Pn(268),[3,127,248],Pn(268),[6,255,240],Pn(268),[13,255,224],Pn(268),[27,255,192],Pn(268),[55,175,128],Pn(108),[112]],8e3:[aa,Pn(268),[3,121,16],Pn(47),[7]]};Zo=function(x){return Object.keys(x).reduce(function(S,w){return S[w]=new Uint8Array(x[w].reduce(function(I,H){return I.concat(H)},[])),S},{})}(x)}return Zo}()[x.samplerate])||(Qe=S[0].data),dt=0;dt<Ne;dt++)S.splice(0,0,{data:Qe,dts:(jt=S[0]).dts-W,pts:jt.pts-W});return x.baseMediaDecodeTime-=Math.floor(un_videoTsToAudioTs(tt,x.samplerate)),tt}},js_clearDtsInfo=function(x){delete x.minSegmentDts,delete x.maxSegmentDts,delete x.minSegmentPts,delete x.maxSegmentPts},js_calculateTrackBaseMediaDecodeTime=function(x,S){var w,H=x.minSegmentDts;return S||(H-=x.timelineStartInfo.dts),w=x.timelineStartInfo.baseMediaDecodeTime,w+=H,w=Math.max(0,w),"audio"===x.type&&(w*=x.samplerate/9e4,w=Math.floor(w)),w},js_collectDtsInfo=function(x,S){"number"==typeof S.pts&&(void 0===x.timelineStartInfo.pts&&(x.timelineStartInfo.pts=S.pts),x.minSegmentPts=void 0===x.minSegmentPts?S.pts:Math.min(x.minSegmentPts,S.pts),x.maxSegmentPts=void 0===x.maxSegmentPts?S.pts:Math.max(x.maxSegmentPts,S.pts)),"number"==typeof S.dts&&(void 0===x.timelineStartInfo.dts&&(x.timelineStartInfo.dts=S.dts),x.minSegmentDts=void 0===x.minSegmentDts?S.dts:Math.min(x.minSegmentDts,S.dts),x.maxSegmentDts=void 0===x.maxSegmentDts?S.dts:Math.max(x.maxSegmentDts,S.dts))},ns=function re(x){x=x||{},re.prototype.init.call(this),this.parse708captions_="boolean"!=typeof x.parse708captions||x.parse708captions,this.captionPackets_=[],this.ccStreams_=[new pr(0,0),new pr(0,1),new pr(1,0),new pr(1,1)],this.parse708captions_&&(this.cc708Stream_=new nr({captionServices:x.captionServices})),this.reset(),this.ccStreams_.forEach(function(S){S.on("data",this.trigger.bind(this,"data")),S.on("partialdone",this.trigger.bind(this,"partialdone")),S.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};(ns.prototype=new n).push=function(re){var x,S,w;if("sei_rbsp"===re.nalUnitType&&(x=function(x){for(var S=0,w={payloadType:-1,payloadSize:0},I=0,H=0;S<x.byteLength&&128!==x[S];){for(;255===x[S];)I+=255,S++;for(I+=x[S++];255===x[S];)H+=255,S++;if(H+=x[S++],!w.payload&&4===I){if("GA94"===String.fromCharCode(x[S+3],x[S+4],x[S+5],x[S+6])){w.payloadType=I,w.payloadSize=H,w.payload=x.subarray(S,S+H);break}w.payload=void 0}S+=H,I=0,H=0}return w}(re.escapedRBSP)).payload&&4===x.payloadType&&(S=function(x){return 181!==x.payload[0]||49!=(x.payload[1]<<8|x.payload[2])||"GA94"!==String.fromCharCode(x.payload[3],x.payload[4],x.payload[5],x.payload[6])||3!==x.payload[7]?null:x.payload.subarray(8,x.payload.length-1)}(x))){if(re.dts<this.latestDts_)return void(this.ignoreNextEqualDts_=!0);if(re.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));w=function(x,S){var I,H,W,Ce,w=[];if(!(64&S[0]))return w;for(H=31&S[0],I=0;I<H;I++)Ce={type:3&S[2+(W=3*I)],pts:x},4&S[W+2]&&(Ce.ccData=S[W+3]<<8|S[W+4],w.push(Ce));return w}(re.pts,S),this.captionPackets_=this.captionPackets_.concat(w),this.latestDts_!==re.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=re.dts}},ns.prototype.flushCCStreams=function(re){this.ccStreams_.forEach(function(x){return"flush"===re?x.flush():x.partialFlush()},this)},ns.prototype.flushStream=function(re){this.captionPackets_.length?(this.captionPackets_.forEach(function(x,S){x.presortIndex=S}),this.captionPackets_.sort(function(x,S){return x.pts===S.pts?x.presortIndex-S.presortIndex:x.pts-S.pts}),this.captionPackets_.forEach(function(x){x.type<2?this.dispatchCea608Packet(x):this.dispatchCea708Packet(x)},this),this.captionPackets_.length=0,this.flushCCStreams(re)):this.flushCCStreams(re)},ns.prototype.flush=function(){return this.flushStream("flush")},ns.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ns.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(re){re.reset()})},ns.prototype.dispatchCea608Packet=function(re){this.setsTextOrXDSActive(re)?this.activeCea608Channel_[re.type]=null:this.setsChannel1Active(re)?this.activeCea608Channel_[re.type]=0:this.setsChannel2Active(re)&&(this.activeCea608Channel_[re.type]=1),null!==this.activeCea608Channel_[re.type]&&this.ccStreams_[(re.type<<1)+this.activeCea608Channel_[re.type]].push(re)},ns.prototype.setsChannel1Active=function(re){return 4096==(30720&re.ccData)},ns.prototype.setsChannel2Active=function(re){return 6144==(30720&re.ccData)},ns.prototype.setsTextOrXDSActive=function(re){return 256==(28928&re.ccData)||4138==(30974&re.ccData)||6186==(30974&re.ccData)},ns.prototype.dispatchCea708Packet=function(re){this.parse708captions_&&this.cc708Stream_.push(re)};var f_={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},xv=function(x){return 32<=x&&x<=127||160<=x&&x<=255},il=function(x){this.windowNum=x,this.reset()};il.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},il.prototype.getText=function(){return this.rows.join("\n")},il.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},il.prototype.newLine=function(re){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(re),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},il.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},il.prototype.addText=function(re){this.rows[this.rowIdx]+=re},il.prototype.backspace=function(){if(!this.isEmpty()){var re=this.rows[this.rowIdx];this.rows[this.rowIdx]=re.substr(0,re.length-1)}};var bv=function(x,S,w){this.serviceNum=x,this.text="",this.currentWindow=new il(-1),this.windows=[],this.stream=w,"string"==typeof S&&this.createTextDecoder(S)};bv.prototype.init=function(re,x){this.startPts=re;for(var S=0;S<8;S++)this.windows[S]=new il(S),"function"==typeof x&&(this.windows[S].beforeRowOverflow=x)},bv.prototype.setCurrentWindow=function(re){this.currentWindow=this.windows[re]},bv.prototype.createTextDecoder=function(re){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(re)}catch(x){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+re+" encoding. "+x})}};var nr=function re(x){x=x||{},re.prototype.init.call(this);var H,S=this,w=x.captionServices||{},I={};Object.keys(w).forEach(function(W){H=w[W],/^SERVICE/.test(W)&&(I[W]=H.encoding)}),this.serviceEncodings=I,this.current708Packet=null,this.services={},this.push=function(W){3===W.type?(S.new708Packet(),S.add708Bytes(W)):(null===S.current708Packet&&S.new708Packet(),S.add708Bytes(W))}};nr.prototype=new n,nr.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},nr.prototype.add708Bytes=function(re){var x=re.ccData,S=x>>>8,w=255&x;this.current708Packet.ptsVals.push(re.pts),this.current708Packet.data.push(S),this.current708Packet.data.push(w)},nr.prototype.push708Packet=function(){var re=this.current708Packet,x=re.data,S=null,w=null,I=0,H=x[I++];for(re.seq=H>>6,re.sizeCode=63&H;I<x.length;I++)w=31&(H=x[I++]),7==(S=H>>5)&&w>0&&(S=H=x[I++]),this.pushServiceBlock(S,I,w),w>0&&(I+=w-1)},nr.prototype.pushServiceBlock=function(re,x,S){var w,I=x,H=this.current708Packet.data,W=this.services[re];for(W||(W=this.initService(re,I));I<x+S&&I<H.length;I++)xv(w=H[I])?I=this.handleText(I,W):24===w?I=this.multiByteCharacter(I,W):16===w?I=this.extendedCommands(I,W):128<=w&&w<=135?I=this.setCurrentWindow(I,W):152<=w&&w<=159?I=this.defineWindow(I,W):136===w?I=this.clearWindows(I,W):140===w?I=this.deleteWindows(I,W):137===w?I=this.displayWindows(I,W):138===w?I=this.hideWindows(I,W):139===w?I=this.toggleWindows(I,W):151===w?I=this.setWindowAttributes(I,W):144===w?I=this.setPenAttributes(I,W):145===w?I=this.setPenColor(I,W):146===w?I=this.setPenLocation(I,W):143===w?W=this.reset(I,W):8===w?W.currentWindow.backspace():12===w?W.currentWindow.clearText():13===w?W.currentWindow.pendingNewLine=!0:14===w?W.currentWindow.clearText():141===w&&I++},nr.prototype.extendedCommands=function(re,x){var w=this.current708Packet.data[++re];return xv(w)&&(re=this.handleText(re,x,{isExtended:!0})),re},nr.prototype.getPts=function(re){return this.current708Packet.ptsVals[Math.floor(re/2)]},nr.prototype.initService=function(re,x){var w,I,S=this;return(w="SERVICE"+re)in this.serviceEncodings&&(I=this.serviceEncodings[w]),this.services[re]=new bv(re,I,S),this.services[re].init(this.getPts(x),function(H){S.flushDisplayed(H,S.services[re])}),this.services[re]},nr.prototype.handleText=function(re,x,S){var Qe,dt,w=S&&S.isExtended,H=this.current708Packet.data,W=w?4096:0,Ce=H[re],tt=x.currentWindow;return x.textDecoder_&&!w?(S&&S.isMultiByte?(dt=[Ce,H[re+1]],re++):dt=[Ce],Qe=x.textDecoder_.decode(new Uint8Array(dt))):Qe=function(x){var S=f_[x]||x;return 4096&x&&x===S?"":String.fromCharCode(S)}(W|Ce),tt.pendingNewLine&&!tt.isEmpty()&&tt.newLine(this.getPts(re)),tt.pendingNewLine=!1,tt.addText(Qe),re},nr.prototype.multiByteCharacter=function(re,x){var S=this.current708Packet.data,I=S[re+2];return xv(S[re+1])&&xv(I)&&(re=this.handleText(++re,x,{isMultiByte:!0})),re},nr.prototype.setCurrentWindow=function(re,x){return x.setCurrentWindow(7&this.current708Packet.data[re]),re},nr.prototype.defineWindow=function(re,x){var S=this.current708Packet.data,w=S[re];x.setCurrentWindow(7&w);var H=x.currentWindow;return w=S[++re],H.visible=(32&w)>>5,H.rowLock=(16&w)>>4,H.columnLock=(8&w)>>3,H.priority=7&w,w=S[++re],H.relativePositioning=(128&w)>>7,H.anchorVertical=127&w,w=S[++re],H.anchorHorizontal=w,w=S[++re],H.anchorPoint=(240&w)>>4,H.rowCount=15&w,w=S[++re],H.columnCount=63&w,w=S[++re],H.windowStyle=(56&w)>>3,H.penStyle=7&w,H.virtualRowCount=H.rowCount+1,re},nr.prototype.setWindowAttributes=function(re,x){var S=this.current708Packet.data,w=S[re],I=x.currentWindow.winAttr;return w=S[++re],I.fillOpacity=(192&w)>>6,I.fillRed=(48&w)>>4,I.fillGreen=(12&w)>>2,I.fillBlue=3&w,w=S[++re],I.borderType=(192&w)>>6,I.borderRed=(48&w)>>4,I.borderGreen=(12&w)>>2,I.borderBlue=3&w,w=S[++re],I.borderType+=(128&w)>>5,I.wordWrap=(64&w)>>6,I.printDirection=(48&w)>>4,I.scrollDirection=(12&w)>>2,I.justify=3&w,w=S[++re],I.effectSpeed=(240&w)>>4,I.effectDirection=(12&w)>>2,I.displayEffect=3&w,re},nr.prototype.flushDisplayed=function(re,x){for(var S=[],w=0;w<8;w++)x.windows[w].visible&&!x.windows[w].isEmpty()&&S.push(x.windows[w].getText());x.endPts=re,x.text=S.join("\n\n"),this.pushCaption(x),x.startPts=re},nr.prototype.pushCaption=function(re){""!==re.text&&(this.trigger("data",{startPts:re.startPts,endPts:re.endPts,text:re.text,stream:"cc708_"+re.serviceNum}),re.text="",re.startPts=re.endPts)},nr.prototype.displayWindows=function(re,x){var w=this.current708Packet.data[++re],I=this.getPts(re);this.flushDisplayed(I,x);for(var H=0;H<8;H++)w&1<<H&&(x.windows[H].visible=1);return re},nr.prototype.hideWindows=function(re,x){var w=this.current708Packet.data[++re],I=this.getPts(re);this.flushDisplayed(I,x);for(var H=0;H<8;H++)w&1<<H&&(x.windows[H].visible=0);return re},nr.prototype.toggleWindows=function(re,x){var w=this.current708Packet.data[++re],I=this.getPts(re);this.flushDisplayed(I,x);for(var H=0;H<8;H++)w&1<<H&&(x.windows[H].visible^=1);return re},nr.prototype.clearWindows=function(re,x){var w=this.current708Packet.data[++re],I=this.getPts(re);this.flushDisplayed(I,x);for(var H=0;H<8;H++)w&1<<H&&x.windows[H].clearText();return re},nr.prototype.deleteWindows=function(re,x){var w=this.current708Packet.data[++re],I=this.getPts(re);this.flushDisplayed(I,x);for(var H=0;H<8;H++)w&1<<H&&x.windows[H].reset();return re},nr.prototype.setPenAttributes=function(re,x){var S=this.current708Packet.data,w=S[re],I=x.currentWindow.penAttr;return w=S[++re],I.textTag=(240&w)>>4,I.offset=(12&w)>>2,I.penSize=3&w,w=S[++re],I.italics=(128&w)>>7,I.underline=(64&w)>>6,I.edgeType=(56&w)>>3,I.fontStyle=7&w,re},nr.prototype.setPenColor=function(re,x){var S=this.current708Packet.data,w=S[re],I=x.currentWindow.penColor;return w=S[++re],I.fgOpacity=(192&w)>>6,I.fgRed=(48&w)>>4,I.fgGreen=(12&w)>>2,I.fgBlue=3&w,w=S[++re],I.bgOpacity=(192&w)>>6,I.bgRed=(48&w)>>4,I.bgGreen=(12&w)>>2,I.bgBlue=3&w,w=S[++re],I.edgeRed=(48&w)>>4,I.edgeGreen=(12&w)>>2,I.edgeBlue=3&w,re},nr.prototype.setPenLocation=function(re,x){var S=this.current708Packet.data,w=S[re],I=x.currentWindow.penLoc;return x.currentWindow.pendingNewLine=!0,w=S[++re],I.row=15&w,w=S[++re],I.column=63&w,re},nr.prototype.reset=function(re,x){var S=this.getPts(re);return this.flushDisplayed(S,x),this.initService(x.serviceNum,re)};var m_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},Tv=function(x){return null===x?"":(x=m_[x]||x,String.fromCharCode(x))},v_=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],dc=function(){for(var x=[],S=15;S--;)x.push("");return x},pr=function re(x,S){re.prototype.init.call(this),this.field_=x||0,this.dataChannel_=S||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(w){var I,H,W,Ce,Ne;if((I=32639&w.ccData)!==this.lastControlCode_){if(4096==(61440&I)?this.lastControlCode_=I:I!==this.PADDING_&&(this.lastControlCode_=null),W=I>>>8,Ce=255&I,I!==this.PADDING_)if(I===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(I===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(w.pts),this.flushDisplayed(w.pts),H=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=H,this.startPts_=w.pts;else if(I===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(w.pts);else if(I===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(w.pts);else if(I===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(w.pts);else if(I===this.CARRIAGE_RETURN_)this.clearFormatting(w.pts),this.flushDisplayed(w.pts),this.shiftRowsUp_(),this.startPts_=w.pts;else if(I===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(I===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(w.pts),this.displayed_=dc();else if(I===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=dc();else if(I===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(w.pts),this.displayed_=dc()),this.mode_="paintOn",this.startPts_=w.pts;else if(this.isSpecialCharacter(W,Ce))Ne=Tv((W=(3&W)<<8)|Ce),this[this.mode_](w.pts,Ne),this.column_++;else if(this.isExtCharacter(W,Ce))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),Ne=Tv((W=(3&W)<<8)|Ce),this[this.mode_](w.pts,Ne),this.column_++;else if(this.isMidRowCode(W,Ce))this.clearFormatting(w.pts),this[this.mode_](w.pts," "),this.column_++,14==(14&Ce)&&this.addFormatting(w.pts,["i"]),1==(1&Ce)&&this.addFormatting(w.pts,["u"]);else if(this.isOffsetControlCode(W,Ce))this.column_+=3&Ce;else if(this.isPAC(W,Ce)){var tt=v_.indexOf(7968&I);"rollUp"===this.mode_&&(tt-this.rollUpRows_+1<0&&(tt=this.rollUpRows_-1),this.setRollUp(w.pts,tt)),tt!==this.row_&&(this.clearFormatting(w.pts),this.row_=tt),1&Ce&&-1===this.formatting_.indexOf("u")&&this.addFormatting(w.pts,["u"]),16==(16&I)&&(this.column_=4*((14&I)>>1)),this.isColorPAC(Ce)&&14==(14&Ce)&&this.addFormatting(w.pts,["i"])}else this.isNormalChar(W)&&(0===Ce&&(Ce=null),Ne=Tv(W),Ne+=Tv(Ce),this[this.mode_](w.pts,Ne),this.column_+=Ne.length)}else this.lastControlCode_=null}};pr.prototype=new n,pr.prototype.flushDisplayed=function(re){var x=this.displayed_.map(function(S,w){try{return S.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+w+"."}),""}},this).join("\n").replace(/^\n+|\n+$/g,"");x.length&&this.trigger("data",{startPts:this.startPts_,endPts:re,text:x,stream:this.name_})},pr.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=dc(),this.nonDisplayed_=dc(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},pr.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},pr.prototype.isSpecialCharacter=function(re,x){return re===this.EXT_&&x>=48&&x<=63},pr.prototype.isExtCharacter=function(re,x){return(re===this.EXT_+1||re===this.EXT_+2)&&x>=32&&x<=63},pr.prototype.isMidRowCode=function(re,x){return re===this.EXT_&&x>=32&&x<=47},pr.prototype.isOffsetControlCode=function(re,x){return re===this.OFFSET_&&x>=33&&x<=35},pr.prototype.isPAC=function(re,x){return re>=this.BASE_&&re<this.BASE_+8&&x>=64&&x<=127},pr.prototype.isColorPAC=function(re){return re>=64&&re<=79||re>=96&&re<=127},pr.prototype.isNormalChar=function(re){return re>=32&&re<=127},pr.prototype.setRollUp=function(re,x){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(re),this.nonDisplayed_=dc(),this.displayed_=dc()),void 0!==x&&x!==this.row_)for(var S=0;S<this.rollUpRows_;S++)this.displayed_[x-S]=this.displayed_[this.row_-S],this.displayed_[this.row_-S]="";void 0===x&&(x=this.row_),this.topRow_=x-this.rollUpRows_+1},pr.prototype.addFormatting=function(re,x){this.formatting_=this.formatting_.concat(x);var S=x.reduce(function(w,I){return w+"<"+I+">"},"");this[this.mode_](re,S)},pr.prototype.clearFormatting=function(re){if(this.formatting_.length){var x=this.formatting_.reverse().reduce(function(S,w){return S+"</"+w+">"},"");this.formatting_=[],this[this.mode_](re,x)}},pr.prototype.popOn=function(re,x){var S=this.nonDisplayed_[this.row_];this.nonDisplayed_[this.row_]=S+=x},pr.prototype.rollUp=function(re,x){var S=this.displayed_[this.row_];this.displayed_[this.row_]=S+=x},pr.prototype.shiftRowsUp_=function(){var re;for(re=0;re<this.topRow_;re++)this.displayed_[re]="";for(re=this.row_+1;re<15;re++)this.displayed_[re]="";for(re=this.topRow_;re<this.row_;re++)this.displayed_[re]=this.displayed_[re+1];this.displayed_[this.row_]=""},pr.prototype.paintOn=function(re,x){var S=this.displayed_[this.row_];this.displayed_[this.row_]=S+=x};var wv={CaptionStream:ns,Cea608Stream:pr,Cea708Stream:nr},sa={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},sy=function(x,S){var w=1;for(x>S&&(w=-1);Math.abs(S-x)>4294967296;)x+=8589934592*w;return x},by=function re(x){var S,w;re.prototype.init.call(this),this.type_=x||"shared",this.push=function(I){"shared"!==this.type_&&I.type!==this.type_||(void 0===w&&(w=I.dts),I.dts=sy(I.dts,w),I.pts=sy(I.pts,w),S=I.dts,this.trigger("data",I))},this.flush=function(){w=S,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){w=void 0,S=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};by.prototype=new n;var Mv,Ty_TimestampRolloverStream=by,Ty_handleRollover=sy,Ay=function(x,S,w){var I,H="";for(I=S;I<w;I++)H+="%"+("00"+x[I].toString(16)).slice(-2);return H},Sv=function(x,S,w){return decodeURIComponent(Ay(x,S,w))},__=function(x,S,w){return unescape(Ay(x,S,w))},Ev=function(x){return x[0]<<21|x[1]<<14|x[2]<<7|x[3]},wy={TXXX:function(x){var S;if(3===x.data[0]){for(S=1;S<x.data.length;S++)if(0===x.data[S]){x.description=Sv(x.data,1,S),x.value=Sv(x.data,S+1,x.data.length).replace(/\0*$/,"");break}x.data=x.value}},WXXX:function(x){var S;if(3===x.data[0])for(S=1;S<x.data.length;S++)if(0===x.data[S]){x.description=Sv(x.data,1,S),x.url=Sv(x.data,S+1,x.data.length);break}},PRIV:function(x){var S;for(S=0;S<x.data.length;S++)if(0===x.data[S]){x.owner=__(x.data,0,S);break}x.privateData=x.data.subarray(S+1),x.data=x.privateData}};Mv=function(x){var W,S={descriptor:x&&x.descriptor},w=0,I=[],H=0;if(Mv.prototype.init.call(this),this.dispatchType=sa.METADATA_STREAM_TYPE.toString(16),S.descriptor)for(W=0;W<S.descriptor.length;W++)this.dispatchType+=("00"+S.descriptor[W].toString(16)).slice(-2);this.push=function(Ce){var Ne,tt,Qe,dt,jt;if("timed-metadata"===Ce.type){if(Ce.dataAlignmentIndicator&&(H=0,I.length=0),0===I.length&&(Ce.data.length<10||Ce.data[0]!=="I".charCodeAt(0)||Ce.data[1]!=="D".charCodeAt(0)||Ce.data[2]!=="3".charCodeAt(0)))return void this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});if(I.push(Ce),H+=Ce.data.byteLength,1===I.length&&(w=Ev(Ce.data.subarray(6,10)),w+=10),!(H<w)){for(Ne={data:new Uint8Array(w),frames:[],pts:I[0].pts,dts:I[0].dts},jt=0;jt<w;)Ne.data.set(I[0].data.subarray(0,w-jt),jt),jt+=I[0].data.byteLength,H-=I[0].data.byteLength,I.shift();tt=10,64&Ne.data[5]&&(tt+=4,tt+=Ev(Ne.data.subarray(10,14)),w-=Ev(Ne.data.subarray(16,20)));do{if((Qe=Ev(Ne.data.subarray(tt+4,tt+8)))<1)return void this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});if((dt={id:String.fromCharCode(Ne.data[tt],Ne.data[tt+1],Ne.data[tt+2],Ne.data[tt+3]),data:Ne.data.subarray(tt+10,tt+Qe+10)}).key=dt.id,wy[dt.id]&&(wy[dt.id](dt),"com.apple.streaming.transportStreamTimestamp"===dt.owner)){var ki=dt.data,yi=(1&ki[3])<<30|ki[4]<<22|ki[5]<<14|ki[6]<<6|ki[7]>>>2;yi*=4,dt.timeStamp=yi+=3&ki[7],void 0===Ne.pts&&void 0===Ne.dts&&(Ne.pts=dt.timeStamp,Ne.dts=dt.timeStamp),this.trigger("timestamp",dt)}Ne.frames.push(dt),tt+=10,tt+=Qe}while(tt<w);this.trigger("data",Ne)}}}},Mv.prototype=new n;var Cv,Tf,Pv,x_=Mv,b_=Ty_TimestampRolloverStream;Cv=function(){var x=new Uint8Array(188),S=0;Cv.prototype.init.call(this),this.push=function(w){var W,I=0,H=188;for(S?((W=new Uint8Array(w.byteLength+S)).set(x.subarray(0,S)),W.set(w,S),S=0):W=w;H<W.byteLength;)71!==W[I]||71!==W[H]?(I++,H++):(this.trigger("data",W.subarray(I,H)),I+=188,H+=188);I<W.byteLength&&(x.set(W.subarray(I),0),S=W.byteLength-I)},this.flush=function(){188===S&&71===x[0]&&(this.trigger("data",x),S=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){S=0,this.trigger("reset")}},Cv.prototype=new n,Tf=function(){var x,S,w,I;Tf.prototype.init.call(this),I=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,x=function(W,Ce){var Ne=0;Ce.payloadUnitStartIndicator&&(Ne+=W[Ne]+1),"pat"===Ce.type?S(W.subarray(Ne),Ce):w(W.subarray(Ne),Ce)},S=function(W,Ce){Ce.section_number=W[7],Ce.last_section_number=W[8],I.pmtPid=(31&W[10])<<8|W[11],Ce.pmtPid=I.pmtPid},w=function(W,Ce){var tt,dt;if(1&W[5]){for(I.programMapTable={video:null,audio:null,"timed-metadata":{}},tt=3+((15&W[1])<<8|W[2])-4,dt=12+((15&W[10])<<8|W[11]);dt<tt;){var jt=W[dt],Mi=(31&W[dt+1])<<8|W[dt+2];jt===sa.H264_STREAM_TYPE&&null===I.programMapTable.video?I.programMapTable.video=Mi:jt===sa.ADTS_STREAM_TYPE&&null===I.programMapTable.audio?I.programMapTable.audio=Mi:jt===sa.METADATA_STREAM_TYPE&&(I.programMapTable["timed-metadata"][Mi]=jt),dt+=5+((15&W[dt+3])<<8|W[dt+4])}Ce.programMapTable=I.programMapTable}},this.push=function(H){var W={},Ce=4;if(W.payloadUnitStartIndicator=!!(64&H[1]),W.pid=31&H[1],W.pid<<=8,W.pid|=H[2],(48&H[3])>>>4>1&&(Ce+=H[Ce]+1),0===W.pid)W.type="pat",x(H.subarray(Ce),W),this.trigger("data",W);else if(W.pid===this.pmtPid)for(W.type="pmt",x(H.subarray(Ce),W),this.trigger("data",W);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([H,Ce,W]):this.processPes_(H,Ce,W)},this.processPes_=function(H,W,Ce){Ce.streamType=Ce.pid===this.programMapTable.video?sa.H264_STREAM_TYPE:Ce.pid===this.programMapTable.audio?sa.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][Ce.pid],Ce.type="pes",Ce.data=H.subarray(W),this.trigger("data",Ce)}},Tf.prototype=new n,Tf.STREAM_TYPES={h264:27,adts:15},Pv=function(){var W,x=this,S=!1,w={data:[],size:0},I={data:[],size:0},H={data:[],size:0},Ne=function(Qe,dt,jt){var Ea,Mi=new Uint8Array(Qe.size),ki={type:dt},yi=0,cn=0,Ur=!1;if(Qe.data.length&&!(Qe.size<9)){for(ki.trackId=Qe.data[0].pid,yi=0;yi<Qe.data.length;yi++)Mi.set((Ea=Qe.data[yi]).data,cn),cn+=Ea.data.byteLength;(function(Qe,dt){var jt,Mi=Qe[0]<<16|Qe[1]<<8|Qe[2];dt.data=new Uint8Array,1===Mi&&(dt.packetLength=6+(Qe[4]<<8|Qe[5]),dt.dataAlignmentIndicator=0!=(4&Qe[6]),192&(jt=Qe[7])&&(dt.pts=(14&Qe[9])<<27|(255&Qe[10])<<20|(254&Qe[11])<<12|(255&Qe[12])<<5|(254&Qe[13])>>>3,dt.pts*=4,dt.pts+=(6&Qe[13])>>>1,dt.dts=dt.pts,64&jt&&(dt.dts=(14&Qe[14])<<27|(255&Qe[15])<<20|(254&Qe[16])<<12|(255&Qe[17])<<5|(254&Qe[18])>>>3,dt.dts*=4,dt.dts+=(6&Qe[18])>>>1)),dt.data=Qe.subarray(9+Qe[8]))})(Mi,ki),Ur="video"===dt||ki.packetLength<=Qe.size,(jt||Ur)&&(Qe.size=0,Qe.data.length=0),Ur&&x.trigger("data",ki)}};Pv.prototype.init.call(this),this.push=function(tt){({pat:function(){},pes:function(){var dt,jt;switch(tt.streamType){case sa.H264_STREAM_TYPE:dt=w,jt="video";break;case sa.ADTS_STREAM_TYPE:dt=I,jt="audio";break;case sa.METADATA_STREAM_TYPE:dt=H,jt="timed-metadata";break;default:return}tt.payloadUnitStartIndicator&&Ne(dt,jt,!0),dt.data.push(tt),dt.size+=tt.data.byteLength},pmt:function(){var dt={type:"metadata",tracks:[]};null!==(W=tt.programMapTable).video&&dt.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+W.video,codec:"avc",type:"video"}),null!==W.audio&&dt.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+W.audio,codec:"adts",type:"audio"}),S=!0,x.trigger("data",dt)}})[tt.type]()},this.reset=function(){w.size=0,w.data.length=0,I.size=0,I.data.length=0,this.trigger("reset")},this.flushStreams_=function(){Ne(w,"video"),Ne(I,"audio"),Ne(H,"timed-metadata")},this.flush=function(){if(!S&&W){var tt={type:"metadata",tracks:[]};null!==W.video&&tt.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+W.video,codec:"avc",type:"video"}),null!==W.audio&&tt.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+W.audio,codec:"adts",type:"audio"}),x.trigger("data",tt)}S=!1,this.flushStreams_(),this.trigger("done")}},Pv.prototype=new n;var Sy={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:Cv,TransportParseStream:Tf,ElementaryStream:Pv,TimestampRolloverStream:b_,CaptionStream:wv.CaptionStream,Cea608Stream:wv.Cea608Stream,Cea708Stream:wv.Cea708Stream,MetadataStream:x_};for(var ly in sa)sa.hasOwnProperty(ly)&&(Sy[ly]=sa[ly]);var Lv,nl=Sy,Ey=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Lv=function(x){var S,w=0;Lv.prototype.init.call(this),this.skipWarn_=function(I,H){this.trigger("log",{level:"warn",message:"adts skiping bytes "+I+" to "+H+" in frame "+w+" outside syncword"})},this.push=function(I){var W,Ce,Ne,tt,Qe,H=0;if(x||(w=0),"audio"===I.type){S&&S.length?(Ne=S,(S=new Uint8Array(Ne.byteLength+I.data.byteLength)).set(Ne),S.set(I.data,Ne.byteLength)):S=I.data;for(var dt;H+7<S.length;)if(255===S[H]&&240==(246&S[H+1])){if("number"==typeof dt&&(this.skipWarn_(dt,H),dt=null),Ce=2*(1&~S[H+1]),Qe=9e4*(tt=1024*(1+(3&S[H+6])))/Ey[(60&S[H+2])>>>2],S.byteLength-H<(W=(3&S[H+3])<<11|S[H+4]<<3|(224&S[H+5])>>5))break;this.trigger("data",{pts:I.pts+w*Qe,dts:I.dts+w*Qe,sampleCount:tt,audioobjecttype:1+(S[H+2]>>>6&3),channelcount:(1&S[H+2])<<2|(192&S[H+3])>>>6,samplerate:Ey[(60&S[H+2])>>>2],samplingfrequencyindex:(60&S[H+2])>>>2,samplesize:16,data:S.subarray(H+7+Ce,H+W)}),w++,H+=W}else"number"!=typeof dt&&(dt=H),H++;"number"==typeof dt&&(this.skipWarn_(dt,H),dt=null),S=S.subarray(H)}},this.flush=function(){w=0,this.trigger("done")},this.reset=function(){S=void 0,this.trigger("reset")},this.endTimeline=function(){S=void 0,this.trigger("endedtimeline")}},Lv.prototype=new n;var Cy,My=Lv;Cy=function(x){var S=x.byteLength,w=0,I=0;this.length=function(){return 8*S},this.bitsAvailable=function(){return 8*S+I},this.loadWord=function(){var H=x.byteLength-S,W=new Uint8Array(4),Ce=Math.min(4,S);if(0===Ce)throw new Error("no bytes available");W.set(x.subarray(H,H+Ce)),w=new DataView(W.buffer).getUint32(0),I=8*Ce,S-=Ce},this.skipBits=function(H){var W;I>H?(w<<=H,I-=H):(H-=I,H-=8*(W=Math.floor(H/8)),S-=W,this.loadWord(),w<<=H,I-=H)},this.readBits=function(H){var W=Math.min(I,H),Ce=w>>>32-W;return(I-=W)>0?w<<=W:S>0&&this.loadWord(),(W=H-W)>0?Ce<<W|this.readBits(W):Ce},this.skipLeadingZeros=function(){var H;for(H=0;H<I;++H)if(0!=(w&2147483648>>>H))return w<<=H,I-=H,H;return this.loadWord(),H+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var H=this.skipLeadingZeros();return this.readBits(H+1)-1},this.readExpGolomb=function(){var H=this.readUnsignedExpGolomb();return 1&H?1+H>>>1:-1*(H>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var Iv,Af,Py,A_=Cy;Af=function(){var S,w,x=0;Af.prototype.init.call(this),this.push=function(I){var H;w?((H=new Uint8Array(w.byteLength+I.data.byteLength)).set(w),H.set(I.data,w.byteLength),w=H):w=I.data;for(var W=w.byteLength;x<W-3;x++)if(1===w[x+2]){S=x+5;break}for(;S<W;)switch(w[S]){case 0:if(0!==w[S-1]){S+=2;break}if(0!==w[S-2]){S++;break}x+3!==S-2&&this.trigger("data",w.subarray(x+3,S-2));do{S++}while(1!==w[S]&&S<W);x=S-2,S+=3;break;case 1:if(0!==w[S-1]||0!==w[S-2]){S+=3;break}this.trigger("data",w.subarray(x+3,S-2)),x=S-2,S+=3;break;default:S+=3}w=w.subarray(x),S-=x,x=0},this.reset=function(){w=null,x=0,this.trigger("reset")},this.flush=function(){w&&w.byteLength>3&&this.trigger("data",w.subarray(x+3)),w=null,x=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Af.prototype=new n,Py={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Iv=function(){var S,w,I,H,W,Ce,Ne,x=new Af;Iv.prototype.init.call(this),S=this,this.push=function(tt){"video"===tt.type&&(w=tt.trackId,I=tt.pts,H=tt.dts,x.push(tt))},x.on("data",function(tt){var Qe={trackId:w,pts:I,dts:H,data:tt,nalUnitTypeCode:31&tt[0]};switch(Qe.nalUnitTypeCode){case 5:Qe.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:Qe.nalUnitType="sei_rbsp",Qe.escapedRBSP=W(tt.subarray(1));break;case 7:Qe.nalUnitType="seq_parameter_set_rbsp",Qe.escapedRBSP=W(tt.subarray(1)),Qe.config=Ce(Qe.escapedRBSP);break;case 8:Qe.nalUnitType="pic_parameter_set_rbsp";break;case 9:Qe.nalUnitType="access_unit_delimiter_rbsp"}S.trigger("data",Qe)}),x.on("done",function(){S.trigger("done")}),x.on("partialdone",function(){S.trigger("partialdone")}),x.on("reset",function(){S.trigger("reset")}),x.on("endedtimeline",function(){S.trigger("endedtimeline")}),this.flush=function(){x.flush()},this.partialFlush=function(){x.partialFlush()},this.reset=function(){x.reset()},this.endTimeline=function(){x.endTimeline()},Ne=function(Qe,dt){var ki,jt=8,Mi=8;for(ki=0;ki<Qe;ki++)0!==Mi&&(Mi=(jt+dt.readExpGolomb()+256)%256),jt=0===Mi?jt:Mi},W=function(Qe){for(var ki,yi,dt=Qe.byteLength,jt=[],Mi=1;Mi<dt-2;)0===Qe[Mi]&&0===Qe[Mi+1]&&3===Qe[Mi+2]?(jt.push(Mi+2),Mi+=2):Mi++;if(0===jt.length)return Qe;ki=dt-jt.length,yi=new Uint8Array(ki);var cn=0;for(Mi=0;Mi<ki;cn++,Mi++)cn===jt[0]&&(cn++,jt.shift()),yi[Mi]=Qe[cn];return yi},Ce=function(Qe){var yi,cn,Ur,Ea,vc,py,Yy,Qy,Ky,my,Zy,gc,dt=0,jt=0,Mi=0,ki=0,Er=[1,1];if(cn=(yi=new A_(Qe)).readUnsignedByte(),Ea=yi.readUnsignedByte(),Ur=yi.readUnsignedByte(),yi.skipUnsignedExpGolomb(),Py[cn]&&(3===(vc=yi.readUnsignedExpGolomb())&&yi.skipBits(1),yi.skipUnsignedExpGolomb(),yi.skipUnsignedExpGolomb(),yi.skipBits(1),yi.readBoolean()))for(Zy=3!==vc?8:12,gc=0;gc<Zy;gc++)yi.readBoolean()&&Ne(gc<6?16:64,yi);if(yi.skipUnsignedExpGolomb(),0===(py=yi.readUnsignedExpGolomb()))yi.readUnsignedExpGolomb();else if(1===py)for(yi.skipBits(1),yi.skipExpGolomb(),yi.skipExpGolomb(),Yy=yi.readUnsignedExpGolomb(),gc=0;gc<Yy;gc++)yi.skipExpGolomb();if(yi.skipUnsignedExpGolomb(),yi.skipBits(1),Qy=yi.readUnsignedExpGolomb(),Ky=yi.readUnsignedExpGolomb(),0===(my=yi.readBits(1))&&yi.skipBits(1),yi.skipBits(1),yi.readBoolean()&&(dt=yi.readUnsignedExpGolomb(),jt=yi.readUnsignedExpGolomb(),Mi=yi.readUnsignedExpGolomb(),ki=yi.readUnsignedExpGolomb()),yi.readBoolean()&&yi.readBoolean())switch(yi.readUnsignedByte()){case 1:Er=[1,1];break;case 2:Er=[12,11];break;case 3:Er=[10,11];break;case 4:Er=[16,11];break;case 5:Er=[40,33];break;case 6:Er=[24,11];break;case 7:Er=[20,11];break;case 8:Er=[32,11];break;case 9:Er=[80,33];break;case 10:Er=[18,11];break;case 11:Er=[15,11];break;case 12:Er=[64,33];break;case 13:Er=[160,99];break;case 14:Er=[4,3];break;case 15:Er=[3,2];break;case 16:Er=[2,1];break;case 255:Er=[yi.readUnsignedByte()<<8|yi.readUnsignedByte(),yi.readUnsignedByte()<<8|yi.readUnsignedByte()]}return{profileIdc:cn,levelIdc:Ur,profileCompatibility:Ea,width:16*(Qy+1)-2*dt-2*jt,height:(2-my)*(Ky+1)*16-2*Mi-2*ki,sarRatio:Er}}},Iv.prototype=new n;var Dv,w_={H264Stream:Iv,NalByteStream:Af},S_=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ly=function(x,S){var w=x[S+6]<<21|x[S+7]<<14|x[S+8]<<7|x[S+9];return w=w>=0?w:0,(16&x[S+5])>>4?w+20:w+10},E_=function re(x,S){return x.length-S<10||x[S]!=="I".charCodeAt(0)||x[S+1]!=="D".charCodeAt(0)||x[S+2]!=="3".charCodeAt(0)?S:re(x,S+=Ly(x,S))},Iy=function(x){return x[0]<<21|x[1]<<14|x[2]<<7|x[3]},P_=function(x,S,w){return unescape(function(x,S,w){var I,H="";for(I=S;I<w;I++)H+="%"+("00"+x[I].toString(16)).slice(-2);return H}(x,S,w))},Rv={isLikelyAacData:function(x){var S=E_(x,0);return x.length>=S+2&&255==(255&x[S])&&240==(240&x[S+1])&&16==(22&x[S+1])},parseId3TagSize:Ly,parseAdtsSize:function(x,S){return 6144&x[S+3]|x[S+4]<<3|(224&x[S+5])>>5},parseType:function(x,S){return x[S]==="I".charCodeAt(0)&&x[S+1]==="D".charCodeAt(0)&&x[S+2]==="3".charCodeAt(0)?"timed-metadata":!0&x[S]&&240==(240&x[S+1])?"audio":null},parseSampleRate:function(x){for(var S=0;S+5<x.length;){if(255===x[S]&&240==(246&x[S+1]))return S_[(60&x[S+2])>>>2];S++}return null},parseAacTimestamp:function(x){var S,w,I;S=10,64&x[5]&&(S+=4,S+=Iy(x.subarray(10,14)));do{if((w=Iy(x.subarray(S+4,S+8)))<1)return null;if("PRIV"===String.fromCharCode(x[S],x[S+1],x[S+2],x[S+3])){I=x.subarray(S+10,S+w+10);for(var W=0;W<I.byteLength;W++)if(0===I[W]){if("com.apple.streaming.transportStreamTimestamp"===P_(I,0,W)){var Ne=I.subarray(W+1),tt=(1&Ne[3])<<30|Ne[4]<<22|Ne[5]<<14|Ne[6]<<6|Ne[7]>>>2;return(tt*=4)+(3&Ne[7])}break}}S+=10,S+=w}while(S<x.byteLength);return null}};Dv=function(){var x=new Uint8Array,S=0;Dv.prototype.init.call(this),this.setTimestamp=function(w){S=w},this.push=function(w){var Ce,Ne,tt,I=0,H=0;for(x.length?(tt=x.length,(x=new Uint8Array(w.byteLength+tt)).set(x.subarray(0,tt)),x.set(w,tt)):x=w;x.length-H>=3;)if(x[H]!=="I".charCodeAt(0)||x[H+1]!=="D".charCodeAt(0)||x[H+2]!=="3".charCodeAt(0))if(255!=(255&x[H])||240!=(240&x[H+1]))H++;else{if(x.length-H<7||H+(I=Rv.parseAdtsSize(x,H))>x.length)break;Ne={type:"audio",data:x.subarray(H,H+I),pts:S,dts:S},this.trigger("data",Ne),H+=I}else{if(x.length-H<10||H+(I=Rv.parseId3TagSize(x,H))>x.length)break;Ce={type:"timed-metadata",data:x.subarray(H,H+I)},this.trigger("data",Ce),H+=I}x=x.length-H>0?x.subarray(H):new Uint8Array},this.reset=function(){x=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){x=new Uint8Array,this.trigger("endedtimeline")}},Dv.prototype=new n;var wf,zh,Ov,fc,O_=Dv,uy=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],cy=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],k_=w_.H264Stream,B_=Rv.isLikelyAacData,H_=function(x,S){S.stream=x,this.trigger("log",S)},Ry=function(x,S){for(var w=Object.keys(S),I=0;I<w.length;I++){var H=w[I];"headOfPipeline"===H||!S[H].on||S[H].on("log",H_.bind(x,H))}},Dy=function(x,S){var w;if(x.length!==S.length)return!1;for(w=0;w<x.length;w++)if(x[w]!==S[w])return!1;return!0},hy=function(x,S,w,I,H,W){return{start:{dts:x,pts:x+(w-S)},end:{dts:x+(I-S),pts:x+(H-w)},prependedContentDuration:W,baseMediaDecodeTime:x}};zh=function(x,S){var I,w=[],H=0,W=0,Ce=1/0;I=(S=S||{}).firstSequenceNumber||0,zh.prototype.init.call(this),this.push=function(Ne){js_collectDtsInfo(x,Ne),x&&uy.forEach(function(tt){x[tt]=Ne[tt]}),w.push(Ne)},this.setEarliestDts=function(Ne){H=Ne},this.setVideoBaseMediaDecodeTime=function(Ne){Ce=Ne},this.setAudioAppendStart=function(Ne){W=Ne},this.flush=function(){var Ne,tt,Qe,dt,jt,Mi,ki;0!==w.length?(Ne=function(x,S,w){return S.minSegmentDts>=w?x:(S.minSegmentDts=1/0,x.filter(function(I){return I.dts>=w&&(S.minSegmentDts=Math.min(S.minSegmentDts,I.dts),S.minSegmentPts=S.minSegmentDts,!0)}))}(w,x,H),x.baseMediaDecodeTime=js_calculateTrackBaseMediaDecodeTime(x,S.keepOriginalTimestamps),ki=_v_prefixWithSilence(x,Ne,W,Ce),x.samples=function(x){var S,I=[];for(S=0;S<x.length;S++)I.push({size:x[S].data.byteLength,duration:1024});return I}(Ne),Qe=Ki_mdat(function(x){var S,w,I=0,H=new Uint8Array(function(x){var S,I=0;for(S=0;S<x.length;S++)I+=x[S].data.byteLength;return I}(x));for(S=0;S<x.length;S++)H.set((w=x[S]).data,I),I+=w.data.byteLength;return H}(Ne)),w=[],tt=Ki_moof(I,[x]),dt=new Uint8Array(tt.byteLength+Qe.byteLength),I++,dt.set(tt),dt.set(Qe,tt.byteLength),js_clearDtsInfo(x),jt=Math.ceil(9216e4/x.samplerate),Ne.length&&(Mi=Ne.length*jt,this.trigger("segmentTimingInfo",hy(un_audioTsToVideoTs(x.baseMediaDecodeTime,x.samplerate),Ne[0].dts,Ne[0].pts,Ne[0].dts+Mi,Ne[0].pts+Mi,ki||0)),this.trigger("timingInfo",{start:Ne[0].pts,end:Ne[0].pts+Mi})),this.trigger("data",{track:x,boxes:dt}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){js_clearDtsInfo(x),w=[],this.trigger("reset")}},zh.prototype=new n,wf=function(x,S){var w,W,Ce,I=[],H=[];w=(S=S||{}).firstSequenceNumber||0,wf.prototype.init.call(this),delete x.minPTS,this.gopCache_=[],this.push=function(Ne){js_collectDtsInfo(x,Ne),"seq_parameter_set_rbsp"===Ne.nalUnitType&&!W&&(W=Ne.config,x.sps=[Ne.data],cy.forEach(function(tt){x[tt]=W[tt]},this)),"pic_parameter_set_rbsp"===Ne.nalUnitType&&!Ce&&(Ce=Ne.data,x.pps=[Ne.data]),I.push(Ne)},this.flush=function(){for(var Ne,tt,Qe,dt,jt,Mi,yi,cn,ki=0;I.length&&"access_unit_delimiter_rbsp"!==I[0].nalUnitType;)I.shift();if(0===I.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(Ne=function(x){var S,w,I=[],H=[];for(H.byteLength=0,H.nalCount=0,H.duration=0,I.byteLength=0,S=0;S<x.length;S++)"access_unit_delimiter_rbsp"===(w=x[S]).nalUnitType?(I.length&&(I.duration=w.dts-I.dts,H.byteLength+=I.byteLength,H.nalCount+=I.length,H.duration+=I.duration,H.push(I)),(I=[w]).byteLength=w.data.byteLength,I.pts=w.pts,I.dts=w.dts):("slice_layer_without_partitioning_rbsp_idr"===w.nalUnitType&&(I.keyFrame=!0),I.duration=w.dts-I.dts,I.byteLength+=w.data.byteLength,I.push(w));return H.length&&(!I.duration||I.duration<=0)&&(I.duration=H[H.length-1].duration),H.byteLength+=I.byteLength,H.nalCount+=I.length,H.duration+=I.duration,H.push(I),H}(I),(Qe=function(x){var S,w,I=[],H=[];for(I.byteLength=0,I.nalCount=0,I.duration=0,I.pts=x[0].pts,I.dts=x[0].dts,H.byteLength=0,H.nalCount=0,H.duration=0,H.pts=x[0].pts,H.dts=x[0].dts,S=0;S<x.length;S++)(w=x[S]).keyFrame?(I.length&&(H.push(I),H.byteLength+=I.byteLength,H.nalCount+=I.nalCount,H.duration+=I.duration),(I=[w]).nalCount=w.length,I.byteLength=w.byteLength,I.pts=w.pts,I.dts=w.dts,I.duration=w.duration):(I.duration+=w.duration,I.nalCount+=w.length,I.byteLength+=w.byteLength,I.push(w));return H.length&&I.duration<=0&&(I.duration=H[H.length-1].duration),H.byteLength+=I.byteLength,H.nalCount+=I.nalCount,H.duration+=I.duration,H.push(I),H}(Ne))[0][0].keyFrame||((tt=this.getGopForFusion_(I[0],x))?(ki=tt.duration,Qe.unshift(tt),Qe.byteLength+=tt.byteLength,Qe.nalCount+=tt.nalCount,Qe.pts=tt.pts,Qe.dts=tt.dts,Qe.duration+=tt.duration):Qe=function(x){var S;return!x[0][0].keyFrame&&x.length>1&&(S=x.shift(),x.byteLength-=S.byteLength,x.nalCount-=S.nalCount,x[0][0].dts=S.dts,x[0][0].pts=S.pts,x[0][0].duration+=S.duration),x}(Qe)),H.length){var Ur;if(!(Ur=S.alignGopsAtEnd?this.alignGopsAtEnd_(Qe):this.alignGopsAtStart_(Qe)))return this.gopCache_.unshift({gop:Qe.pop(),pps:x.pps,sps:x.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),I=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");js_clearDtsInfo(x),Qe=Ur}js_collectDtsInfo(x,Qe),x.samples=function(x,S){var w,I,H,W,Ne=S||0,tt=[];for(w=0;w<x.length;w++)for(W=x[w],I=0;I<W.length;I++)Ne+=(H=fr(W[I],Ne)).size,tt.push(H);return tt}(Qe),jt=Ki_mdat(function(x){var S,w,I,H,W,Ce,Ne=0,jt=new Uint8Array(x.byteLength+4*x.nalCount),Mi=new DataView(jt.buffer);for(S=0;S<x.length;S++)for(H=x[S],w=0;w<H.length;w++)for(W=H[w],I=0;I<W.length;I++)Mi.setUint32(Ne,(Ce=W[I]).data.byteLength),jt.set(Ce.data,Ne+=4),Ne+=Ce.data.byteLength;return jt}(Qe)),x.baseMediaDecodeTime=js_calculateTrackBaseMediaDecodeTime(x,S.keepOriginalTimestamps),this.trigger("processedGopsInfo",Qe.map(function(Ea){return{pts:Ea.pts,dts:Ea.dts,byteLength:Ea.byteLength}})),this.trigger("segmentTimingInfo",hy(x.baseMediaDecodeTime,(yi=Qe[0]).dts,yi.pts,(cn=Qe[Qe.length-1]).dts+cn.duration,cn.pts+cn.duration,ki)),this.trigger("timingInfo",{start:Qe[0].pts,end:Qe[Qe.length-1].pts+Qe[Qe.length-1].duration}),this.gopCache_.unshift({gop:Qe.pop(),pps:x.pps,sps:x.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),I=[],this.trigger("baseMediaDecodeTime",x.baseMediaDecodeTime),this.trigger("timelineStartInfo",x.timelineStartInfo),dt=Ki_moof(w,[x]),Mi=new Uint8Array(dt.byteLength+jt.byteLength),w++,Mi.set(dt),Mi.set(jt,dt.byteLength),this.trigger("data",{track:x,boxes:Mi}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),I=[],this.gopCache_.length=0,H.length=0,this.trigger("reset")},this.resetStream_=function(){js_clearDtsInfo(x),W=void 0,Ce=void 0},this.getGopForFusion_=function(Ne){var jt,Mi,ki,yi,cn,dt=1/0;for(cn=0;cn<this.gopCache_.length;cn++)ki=(yi=this.gopCache_[cn]).gop,x.pps&&Dy(x.pps[0],yi.pps[0])&&x.sps&&Dy(x.sps[0],yi.sps[0])&&(ki.dts<x.timelineStartInfo.dts||(jt=Ne.dts-ki.dts-ki.duration)>=-1e4&&jt<=45e3&&(!Mi||dt>jt)&&(Mi=yi,dt=jt));return Mi?Mi.gop:null},this.alignGopsAtStart_=function(Ne){var tt,Qe,dt,jt,Mi,ki,yi,cn;for(Mi=Ne.byteLength,ki=Ne.nalCount,yi=Ne.duration,tt=Qe=0;tt<H.length&&Qe<Ne.length&&(dt=H[tt]).pts!==(jt=Ne[Qe]).pts;)jt.pts>dt.pts?tt++:(Qe++,Mi-=jt.byteLength,ki-=jt.nalCount,yi-=jt.duration);return 0===Qe?Ne:Qe===Ne.length?null:((cn=Ne.slice(Qe)).byteLength=Mi,cn.duration=yi,cn.nalCount=ki,cn.pts=cn[0].pts,cn.dts=cn[0].dts,cn)},this.alignGopsAtEnd_=function(Ne){var tt,Qe,dt,jt,Mi,ki,yi;for(tt=H.length-1,Qe=Ne.length-1,Mi=null,ki=!1;tt>=0&&Qe>=0;){if((dt=H[tt]).pts===(jt=Ne[Qe]).pts){ki=!0;break}dt.pts>jt.pts?tt--:(tt===H.length-1&&(Mi=Qe),Qe--)}if(!ki&&null===Mi)return null;if(0===(yi=ki?Qe:Mi))return Ne;var cn=Ne.slice(yi),Ur=cn.reduce(function(Ea,vc){return Ea.byteLength+=vc.byteLength,Ea.duration+=vc.duration,Ea.nalCount+=vc.nalCount,Ea},{byteLength:0,duration:0,nalCount:0});return cn.byteLength=Ur.byteLength,cn.duration=Ur.duration,cn.nalCount=Ur.nalCount,cn.pts=cn[0].pts,cn.dts=cn[0].dts,cn},this.alignGopsWith=function(Ne){H=Ne}},wf.prototype=new n,fc=function(x,S){this.numberOfTracks=0,this.metadataStream=S,this.remuxTracks=!(typeof(x=x||{}).remux<"u"&&!x.remux),this.keepOriginalTimestamps="boolean"==typeof x.keepOriginalTimestamps&&x.keepOriginalTimestamps,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,fc.prototype.init.call(this),this.push=function(w){return w.text?this.pendingCaptions.push(w):w.frames?this.pendingMetadata.push(w):(this.pendingTracks.push(w.track),this.pendingBytes+=w.boxes.byteLength,"video"===w.track.type&&(this.videoTrack=w.track,this.pendingBoxes.push(w.boxes)),void("audio"===w.track.type&&(this.audioTrack=w.track,this.pendingBoxes.unshift(w.boxes))))}},fc.prototype=new n,fc.prototype.flush=function(re){var w,I,H,Ce,x=0,S={captions:[],captionStreams:{},metadata:[],info:{}},W=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==re&&"AudioSegmentStream"!==re)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(W=this.videoTrack.timelineStartInfo.pts,cy.forEach(function(Ne){S.info[Ne]=this.videoTrack[Ne]},this)):this.audioTrack&&(W=this.audioTrack.timelineStartInfo.pts,uy.forEach(function(Ne){S.info[Ne]=this.audioTrack[Ne]},this)),this.videoTrack||this.audioTrack){for(S.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,H=function(x){var I,S=g(),w=le(x);return(I=new Uint8Array(S.byteLength+w.byteLength)).set(S),I.set(w,S.byteLength),I}(this.pendingTracks),S.initSegment=new Uint8Array(H.byteLength),S.initSegment.set(H),S.data=new Uint8Array(this.pendingBytes),Ce=0;Ce<this.pendingBoxes.length;Ce++)S.data.set(this.pendingBoxes[Ce],x),x+=this.pendingBoxes[Ce].byteLength;for(Ce=0;Ce<this.pendingCaptions.length;Ce++)(w=this.pendingCaptions[Ce]).startTime=un_metadataTsToSeconds(w.startPts,W,this.keepOriginalTimestamps),w.endTime=un_metadataTsToSeconds(w.endPts,W,this.keepOriginalTimestamps),S.captionStreams[w.stream]=!0,S.captions.push(w);for(Ce=0;Ce<this.pendingMetadata.length;Ce++)(I=this.pendingMetadata[Ce]).cueTime=un_metadataTsToSeconds(I.pts,W,this.keepOriginalTimestamps),S.metadata.push(I);for(S.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",S),Ce=0;Ce<S.captions.length;Ce++)this.trigger("caption",w=S.captions[Ce]);for(Ce=0;Ce<S.metadata.length;Ce++)this.trigger("id3Frame",I=S.metadata[Ce])}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},fc.prototype.setRemux=function(re){this.remuxTracks=re},Ov=function(x){var I,H,S=this,w=!0;Ov.prototype.init.call(this),this.baseMediaDecodeTime=(x=x||{}).baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var W={};this.transmuxPipeline_=W,W.type="aac",W.metadataStream=new nl.MetadataStream,W.aacStream=new O_,W.audioTimestampRolloverStream=new nl.TimestampRolloverStream("audio"),W.timedMetadataTimestampRolloverStream=new nl.TimestampRolloverStream("timed-metadata"),W.adtsStream=new My,W.coalesceStream=new fc(x,W.metadataStream),W.headOfPipeline=W.aacStream,W.aacStream.pipe(W.audioTimestampRolloverStream).pipe(W.adtsStream),W.aacStream.pipe(W.timedMetadataTimestampRolloverStream).pipe(W.metadataStream).pipe(W.coalesceStream),W.metadataStream.on("timestamp",function(Ce){W.aacStream.setTimestamp(Ce.timeStamp)}),W.aacStream.on("data",function(Ce){"timed-metadata"!==Ce.type&&"audio"!==Ce.type||W.audioSegmentStream||(H=H||{timelineStartInfo:{baseMediaDecodeTime:S.baseMediaDecodeTime},codec:"adts",type:"audio"},W.coalesceStream.numberOfTracks++,W.audioSegmentStream=new zh(H,x),W.audioSegmentStream.on("log",S.getLogTrigger_("audioSegmentStream")),W.audioSegmentStream.on("timingInfo",S.trigger.bind(S,"audioTimingInfo")),W.adtsStream.pipe(W.audioSegmentStream).pipe(W.coalesceStream),S.trigger("trackinfo",{hasAudio:!!H,hasVideo:!!I}))}),W.coalesceStream.on("data",this.trigger.bind(this,"data")),W.coalesceStream.on("done",this.trigger.bind(this,"done")),Ry(this,W)},this.setupTsPipeline=function(){var W={};this.transmuxPipeline_=W,W.type="ts",W.metadataStream=new nl.MetadataStream,W.packetStream=new nl.TransportPacketStream,W.parseStream=new nl.TransportParseStream,W.elementaryStream=new nl.ElementaryStream,W.timestampRolloverStream=new nl.TimestampRolloverStream,W.adtsStream=new My,W.h264Stream=new k_,W.captionStream=new nl.CaptionStream(x),W.coalesceStream=new fc(x,W.metadataStream),W.headOfPipeline=W.packetStream,W.packetStream.pipe(W.parseStream).pipe(W.elementaryStream).pipe(W.timestampRolloverStream),W.timestampRolloverStream.pipe(W.h264Stream),W.timestampRolloverStream.pipe(W.adtsStream),W.timestampRolloverStream.pipe(W.metadataStream).pipe(W.coalesceStream),W.h264Stream.pipe(W.captionStream).pipe(W.coalesceStream),W.elementaryStream.on("data",function(Ce){var Ne;if("metadata"===Ce.type){for(Ne=Ce.tracks.length;Ne--;)I||"video"!==Ce.tracks[Ne].type?!H&&"audio"===Ce.tracks[Ne].type&&((H=Ce.tracks[Ne]).timelineStartInfo.baseMediaDecodeTime=S.baseMediaDecodeTime):(I=Ce.tracks[Ne]).timelineStartInfo.baseMediaDecodeTime=S.baseMediaDecodeTime;I&&!W.videoSegmentStream&&(W.coalesceStream.numberOfTracks++,W.videoSegmentStream=new wf(I,x),W.videoSegmentStream.on("log",S.getLogTrigger_("videoSegmentStream")),W.videoSegmentStream.on("timelineStartInfo",function(tt){H&&!x.keepOriginalTimestamps&&(H.timelineStartInfo=tt,W.audioSegmentStream.setEarliestDts(tt.dts-S.baseMediaDecodeTime))}),W.videoSegmentStream.on("processedGopsInfo",S.trigger.bind(S,"gopInfo")),W.videoSegmentStream.on("segmentTimingInfo",S.trigger.bind(S,"videoSegmentTimingInfo")),W.videoSegmentStream.on("baseMediaDecodeTime",function(tt){H&&W.audioSegmentStream.setVideoBaseMediaDecodeTime(tt)}),W.videoSegmentStream.on("timingInfo",S.trigger.bind(S,"videoTimingInfo")),W.h264Stream.pipe(W.videoSegmentStream).pipe(W.coalesceStream)),H&&!W.audioSegmentStream&&(W.coalesceStream.numberOfTracks++,W.audioSegmentStream=new zh(H,x),W.audioSegmentStream.on("log",S.getLogTrigger_("audioSegmentStream")),W.audioSegmentStream.on("timingInfo",S.trigger.bind(S,"audioTimingInfo")),W.audioSegmentStream.on("segmentTimingInfo",S.trigger.bind(S,"audioSegmentTimingInfo")),W.adtsStream.pipe(W.audioSegmentStream).pipe(W.coalesceStream)),S.trigger("trackinfo",{hasAudio:!!H,hasVideo:!!I})}}),W.coalesceStream.on("data",this.trigger.bind(this,"data")),W.coalesceStream.on("id3Frame",function(Ce){Ce.dispatchType=W.metadataStream.dispatchType,S.trigger("id3Frame",Ce)}),W.coalesceStream.on("caption",this.trigger.bind(this,"caption")),W.coalesceStream.on("done",this.trigger.bind(this,"done")),Ry(this,W)},this.setBaseMediaDecodeTime=function(W){var Ce=this.transmuxPipeline_;x.keepOriginalTimestamps||(this.baseMediaDecodeTime=W),H&&(H.timelineStartInfo.dts=void 0,H.timelineStartInfo.pts=void 0,js_clearDtsInfo(H),Ce.audioTimestampRolloverStream&&Ce.audioTimestampRolloverStream.discontinuity()),I&&(Ce.videoSegmentStream&&(Ce.videoSegmentStream.gopCache_=[]),I.timelineStartInfo.dts=void 0,I.timelineStartInfo.pts=void 0,js_clearDtsInfo(I),Ce.captionStream.reset()),Ce.timestampRolloverStream&&Ce.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(W){H&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(W)},this.setRemux=function(W){var Ce=this.transmuxPipeline_;x.remux=W,Ce&&Ce.coalesceStream&&Ce.coalesceStream.setRemux(W)},this.alignGopsWith=function(W){I&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(W)},this.getLogTrigger_=function(W){var Ce=this;return function(Ne){Ne.stream=W,Ce.trigger("log",Ne)}},this.push=function(W){if(w){var Ce=B_(W);Ce&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():!Ce&&"ts"!==this.transmuxPipeline_.type&&this.setupTsPipeline(),w=!1}this.transmuxPipeline_.headOfPipeline.push(W)},this.flush=function(){w=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},Ov.prototype=new n;var Hy,Gy,dy,z_={Transmuxer:Ov,VideoSegmentStream:wf,AudioSegmentStream:zh,AUDIO_PROPERTIES:uy,VIDEO_PROPERTIES:cy,generateSegmentTimingInfo:hy},Fv_toUnsigned=function(x){return x>>>0},pc=function(x){var S="";return S+=String.fromCharCode(x[0]),S+=String.fromCharCode(x[1]),(S+=String.fromCharCode(x[2]))+String.fromCharCode(x[3])},j_=Fv_toUnsigned,lr=function re(x,S){var I,H,W,Ce,Ne,w=[];if(!S.length)return null;for(I=0;I<x.byteLength;)H=j_(x[I]<<24|x[I+1]<<16|x[I+2]<<8|x[I+3]),W=pc(x.subarray(I+4,I+8)),Ce=H>1?I+H:x.byteLength,W===S[0]&&(1===S.length?w.push(x.subarray(I+8,Ce)):(Ne=re(x.subarray(I+8,Ce),S.slice(1))).length&&(w=w.concat(Ne))),I=Ce;return w},q_=Fv_toUnsigned,Y_=e.getUint64,Fy=function(x){return{isLeading:(12&x[0])>>>2,dependsOn:3&x[0],isDependedOn:(192&x[1])>>>6,hasRedundancy:(48&x[1])>>>4,paddingValue:(14&x[1])>>>1,isNonSyncSample:1&x[1],degradationPriority:x[2]<<8|x[3]}},By=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ef=typeof window<"u"?window:typeof By<"u"?By:typeof self<"u"?self:{},J_=function(x){for(var H,W,S=x.byteLength,w=[],I=1;I<S-2;)0===x[I]&&0===x[I+1]&&3===x[I+2]?(w.push(I+2),I+=2):I++;if(0===w.length)return x;H=S-w.length,W=new Uint8Array(H);var Ce=0;for(I=0;I<H;Ce++,I++)Ce===w[0]&&(Ce++,w.shift()),W[I]=x[Ce];return W},e1=wv.CaptionStream,t1=function(x,S){for(var w=x,I=0;I<S.length;I++){var H=S[I];if(w<H.size)return H;w-=H.size}return null},r1=function(x,S){var w=lr(x,["moof","traf"]),I=lr(x,["mdat"]),H={},W=[];return I.forEach(function(Ce,Ne){W.push({mdat:Ce,traf:w[Ne]})}),W.forEach(function(Ce){var cn,Ur,Ne=Ce.mdat,tt=Ce.traf,dt=function(x){var dt,S=new DataView(x.buffer,x.byteOffset,x.byteLength),w={version:x[0],flags:new Uint8Array(x.subarray(1,4)),trackId:S.getUint32(4)},I=1&w.flags[2],H=2&w.flags[2],W=8&w.flags[2],Ce=16&w.flags[2],Ne=32&w.flags[2],tt=65536&w.flags[0],Qe=131072&w.flags[0];return dt=8,I&&(dt+=4,w.baseDataOffset=S.getUint32(12),dt+=4),H&&(w.sampleDescriptionIndex=S.getUint32(dt),dt+=4),W&&(w.defaultSampleDuration=S.getUint32(dt),dt+=4),Ce&&(w.defaultSampleSize=S.getUint32(dt),dt+=4),Ne&&(w.defaultSampleFlags=S.getUint32(dt)),tt&&(w.durationIsEmpty=!0),!I&&Qe&&(w.baseDataOffsetIsMoof=!0),w}(lr(tt,["tfhd"])[0]),jt=dt.trackId,Mi=lr(tt,["tfdt"]),ki=Mi.length>0?function(x){var S={version:x[0],flags:new Uint8Array(x.subarray(1,4))};return S.baseMediaDecodeTime=1===S.version?Y_(x.subarray(4)):q_(x[4]<<24|x[5]<<16|x[6]<<8|x[7]),S}(Mi[0]).baseMediaDecodeTime:0,yi=lr(tt,["trun"]);S===jt&&yi.length>0&&(cn=function(x,S,w){var I=S,H=w.defaultSampleDuration||0,W=w.defaultSampleSize||0,Ce=w.trackId,Ne=[];return x.forEach(function(tt){var dt=function(x){var jt,S={version:x[0],flags:new Uint8Array(x.subarray(1,4)),samples:[]},w=new DataView(x.buffer,x.byteOffset,x.byteLength),I=1&S.flags[2],H=4&S.flags[2],W=1&S.flags[1],Ce=2&S.flags[1],Ne=4&S.flags[1],tt=8&S.flags[1],Qe=w.getUint32(4),dt=8;for(I&&(S.dataOffset=w.getInt32(dt),dt+=4),H&&Qe&&(jt={flags:Fy(x.subarray(dt,dt+4))},dt+=4,W&&(jt.duration=w.getUint32(dt),dt+=4),Ce&&(jt.size=w.getUint32(dt),dt+=4),tt&&(jt.compositionTimeOffset=1===S.version?w.getInt32(dt):w.getUint32(dt),dt+=4),S.samples.push(jt),Qe--);Qe--;)jt={},W&&(jt.duration=w.getUint32(dt),dt+=4),Ce&&(jt.size=w.getUint32(dt),dt+=4),Ne&&(jt.flags=Fy(x.subarray(dt,dt+4)),dt+=4),tt&&(jt.compositionTimeOffset=1===S.version?w.getInt32(dt):w.getUint32(dt),dt+=4),S.samples.push(jt);return S}(tt).samples;dt.forEach(function(jt){void 0===jt.duration&&(jt.duration=H),void 0===jt.size&&(jt.size=W),jt.trackId=Ce,jt.dts=I,void 0===jt.compositionTimeOffset&&(jt.compositionTimeOffset=0),"bigint"==typeof I?(jt.pts=I+Ef.BigInt(jt.compositionTimeOffset),I+=Ef.BigInt(jt.duration)):(jt.pts=I+jt.compositionTimeOffset,I+=jt.duration)}),Ne=Ne.concat(dt)}),Ne}(yi,ki,dt),Ur=function(x,S,w){var W,Ce,Ne,tt,I=new DataView(x.buffer,x.byteOffset,x.byteLength),H={logs:[],seiNals:[]};for(Ce=0;Ce+4<x.length;Ce+=Ne)if(Ne=I.getUint32(Ce),Ce+=4,!(Ne<=0))switch(31&x[Ce]){case 6:var Qe=x.subarray(Ce+1,Ce+1+Ne),dt=t1(Ce,S);if(W={nalUnitType:"sei_rbsp",size:Ne,data:Qe,escapedRBSP:J_(Qe),trackId:w},dt)W.pts=dt.pts,W.dts=dt.dts,tt=dt;else{if(!tt){H.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+Ce+" for trackId "+w+". See mux.js#223."});break}W.pts=tt.pts,W.dts=tt.dts}H.seiNals.push(W)}return H}(Ne,cn,jt),H[jt]||(H[jt]={seiNals:[],logs:[]}),H[jt].seiNals=H[jt].seiNals.concat(Ur.seiNals),H[jt].logs=H[jt].logs.concat(Ur.logs))}),H},o1=function(){var S,w,I,H,W,Ce,x=!1;this.isInitialized=function(){return x},this.init=function(Ne){S=new e1,x=!0,Ce=!!Ne&&Ne.isPartial,S.on("data",function(tt){tt.startTime=tt.startPts/H,tt.endTime=tt.endPts/H,W.captions.push(tt),W.captionStreams[tt.stream]=!0}),S.on("log",function(tt){W.logs.push(tt)})},this.isNewInit=function(Ne,tt){return!(Ne&&0===Ne.length||tt&&"object"==typeof tt&&0===Object.keys(tt).length||I===Ne[0]&&H===tt[I])},this.parse=function(Ne,tt,Qe){var dt;if(!this.isInitialized())return null;if(!tt||!Qe)return null;if(this.isNewInit(tt,Qe))H=Qe[I=tt[0]];else if(null===I||!H)return w.push(Ne),null;for(;w.length>0;){var jt=w.shift();this.parse(jt,tt,Qe)}return dt=function(x,S,w){if(null===S)return null;var H=r1(x,S)[S]||{};return{seiNals:H.seiNals,logs:H.logs,timescale:w}}(Ne,I,H),dt&&dt.logs&&(W.logs=W.logs.concat(dt.logs)),null!==dt&&dt.seiNals?(this.pushNals(dt.seiNals),this.flushStream(),W):W.logs.length?{logs:W.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(Ne){if(!this.isInitialized()||!Ne||0===Ne.length)return null;Ne.forEach(function(tt){S.push(tt)})},this.flushStream=function(){if(!this.isInitialized())return null;Ce?S.partialFlush():S.flush()},this.clearParsedCaptions=function(){W.captions=[],W.captionStreams={},W.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;S.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){w=[],I=null,H=null,W?this.clearParsedCaptions():W={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Nv=Fv_toUnsigned,Mf=function(x){return("00"+x.toString(16)).slice(-2)},l1=e.getUint64;Hy=function(x,S){var I=lr(S,["moof","traf"]).reduce(function(H,W){var jt,Mi,Ce=lr(W,["tfhd"])[0],Ne=Nv(Ce[4]<<24|Ce[5]<<16|Ce[6]<<8|Ce[7]),tt=x[Ne]||9e4,Qe=lr(W,["tfdt"])[0],dt=new DataView(Qe.buffer,Qe.byteOffset,Qe.byteLength);return"bigint"==typeof(jt=1===Qe[0]?l1(Qe.subarray(4,12)):dt.getUint32(4))?Mi=jt/Ef.BigInt(tt):"number"==typeof jt&&!isNaN(jt)&&(Mi=jt/tt),Mi<Number.MAX_SAFE_INTEGER&&(Mi=Number(Mi)),Mi<H&&(H=Mi),H},1/0);return"bigint"==typeof I||isFinite(I)?I:0},dy=function(x){var w=0===x[0]?12:20;return Nv(x[w]<<24|x[w+1]<<16|x[w+2]<<8|x[w+3])},Gy=function(x){var S=lr(x,["moov","trak"]),w=[];return S.forEach(function(I){var Ce,Ne,H={},W=lr(I,["tkhd"])[0];W&&(Ne=(Ce=new DataView(W.buffer,W.byteOffset,W.byteLength)).getUint8(0),H.id=Ce.getUint32(0===Ne?12:20));var tt=lr(I,["mdia","hdlr"])[0];if(tt){var Qe=pc(tt.subarray(8,12));H.type="vide"===Qe?"video":"soun"===Qe?"audio":Qe}var dt=lr(I,["mdia","minf","stbl","stsd"])[0];if(dt){var jt=dt.subarray(8);H.codec=pc(jt.subarray(4,8));var ki,Mi=lr(jt,[H.codec])[0];Mi&&(/^[asm]vc[1-9]$/i.test(H.codec)?(ki=Mi.subarray(78),"avcC"===pc(ki.subarray(4,8))&&ki.length>11?(H.codec+=".",H.codec+=Mf(ki[9]),H.codec+=Mf(ki[10]),H.codec+=Mf(ki[11])):H.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(H.codec)?(ki=Mi.subarray(28),"esds"===pc(ki.subarray(4,8))&&ki.length>20&&0!==ki[19]?(H.codec+="."+Mf(ki[19]),H.codec+="."+Mf(ki[20]>>>2&63).replace(/^0/,"")):H.codec="mp4a.40.2"):H.codec=H.codec.toLowerCase())}var cn=lr(I,["mdia","mdhd"])[0];cn&&(H.timescale=dy(cn)),w.push(H)}),w};var Wy_startTime=Hy,Wy_tracks=Gy,jy=function(x){var S=31&x[1];return(S<<=8)|x[2]},kv=function(x){return!!(64&x[1])},Bv=function(x){var S=0;return(48&x[3])>>>4>1&&(S+=x[4]+1),S},fy=function(x){switch(x){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},m1={parseType:function(x,S){var w=jy(x);return 0===w?"pat":w===S?"pmt":S?"pes":null},parsePat:function(x){var S=kv(x),w=4+Bv(x);return S&&(w+=x[w]+1),(31&x[w+10])<<8|x[w+11]},parsePmt:function(x){var S={},w=kv(x),I=4+Bv(x);if(w&&(I+=x[I]+1),1&x[I+5]){var W;W=3+((15&x[I+1])<<8|x[I+2])-4;for(var Ne=12+((15&x[I+10])<<8|x[I+11]);Ne<W;){var tt=I+Ne;S[(31&x[tt+1])<<8|x[tt+2]]=x[tt],Ne+=5+((15&x[tt+3])<<8|x[tt+4])}return S}},parsePayloadUnitStartIndicator:kv,parsePesType:function(x,S){switch(S[jy(x)]){case sa.H264_STREAM_TYPE:return"video";case sa.ADTS_STREAM_TYPE:return"audio";case sa.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(x){if(!kv(x))return null;var w=4+Bv(x);if(w>=x.byteLength)return null;var H,I=null;return 192&(H=x[w+7])&&((I={}).pts=(14&x[w+9])<<27|(255&x[w+10])<<20|(254&x[w+11])<<12|(255&x[w+12])<<5|(254&x[w+13])>>>3,I.pts*=4,I.pts+=(6&x[w+13])>>>1,I.dts=I.pts,64&H&&(I.dts=(14&x[w+14])<<27|(255&x[w+15])<<20|(254&x[w+16])<<12|(255&x[w+17])<<5|(254&x[w+18])>>>3,I.dts*=4,I.dts+=(6&x[w+18])>>>1)),I},videoPacketContainsKeyFrame:function(x){for(var S=4+Bv(x),w=x.subarray(S),I=0,H=0,W=!1;H<w.byteLength-3;H++)if(1===w[H+2]){I=H+5;break}for(;I<w.byteLength;)switch(w[I]){case 0:if(0!==w[I-1]){I+=2;break}if(0!==w[I-2]){I++;break}H+3!==I-2&&"slice_layer_without_partitioning_rbsp_idr"===fy(31&w[H+3])&&(W=!0);do{I++}while(1!==w[I]&&I<w.length);H=I-2,I+=3;break;case 1:if(0!==w[I-1]||0!==w[I-2]){I+=3;break}"slice_layer_without_partitioning_rbsp_idr"===fy(31&w[H+3])&&(W=!0),H=I-2,I+=3;break;default:I+=3}return w=w.subarray(H),I-=H,H=0,w&&w.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===fy(31&w[H+3])&&(W=!0),W}},Vh=Ty_handleRollover,Xn={};Xn.ts=m1,Xn.aac=Rv;var mc=9e4,Sa=188,Xy=function(x,S,w){for(var W,Ne,tt,Qe,I=0,H=Sa,dt=!1;H<=x.byteLength;)if(71!==x[I]||71!==x[H]&&H!==x.byteLength)I++,H++;else{if("pes"===(W=x.subarray(I,H),Xn.ts.parseType(W,S.pid))&&(Ne=Xn.ts.parsePesType(W,S.table),tt=Xn.ts.parsePayloadUnitStartIndicator(W),"audio"===Ne&&tt&&(Qe=Xn.ts.parsePesTime(W))&&(Qe.type="audio",w.audio.push(Qe),dt=!0)),dt)break;I+=Sa,H+=Sa}for(I=(H=x.byteLength)-Sa,dt=!1;I>=0;)if(71!==x[I]||71!==x[H]&&H!==x.byteLength)I--,H--;else{if("pes"===(W=x.subarray(I,H),Xn.ts.parseType(W,S.pid))&&(Ne=Xn.ts.parsePesType(W,S.table),tt=Xn.ts.parsePayloadUnitStartIndicator(W),"audio"===Ne&&tt&&(Qe=Xn.ts.parsePesTime(W))&&(Qe.type="audio",w.audio.push(Qe),dt=!0)),dt)break;I-=Sa,H-=Sa}},g1=function(x,S,w){for(var W,Ne,tt,Qe,dt,jt,Mi,I=0,H=Sa,ki=!1,yi={data:[],size:0};H<x.byteLength;)if(71!==x[I]||71!==x[H])I++,H++;else{if("pes"===(W=x.subarray(I,H),Xn.ts.parseType(W,S.pid))&&(Ne=Xn.ts.parsePesType(W,S.table),tt=Xn.ts.parsePayloadUnitStartIndicator(W),"video"===Ne&&(tt&&!ki&&(Qe=Xn.ts.parsePesTime(W))&&(Qe.type="video",w.video.push(Qe),ki=!0),!w.firstKeyFrame))){if(tt&&0!==yi.size){for(dt=new Uint8Array(yi.size),jt=0;yi.data.length;)Mi=yi.data.shift(),dt.set(Mi,jt),jt+=Mi.byteLength;if(Xn.ts.videoPacketContainsKeyFrame(dt)){var cn=Xn.ts.parsePesTime(dt);cn?(w.firstKeyFrame=cn,w.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}yi.size=0}yi.data.push(W),yi.size+=W.byteLength}if(ki&&w.firstKeyFrame)break;I+=Sa,H+=Sa}for(I=(H=x.byteLength)-Sa,ki=!1;I>=0;)if(71!==x[I]||71!==x[H])I--,H--;else{if("pes"===(W=x.subarray(I,H),Xn.ts.parseType(W,S.pid))&&(Ne=Xn.ts.parsePesType(W,S.table),tt=Xn.ts.parsePayloadUnitStartIndicator(W),"video"===Ne&&tt&&(Qe=Xn.ts.parsePesTime(W))&&(Qe.type="video",w.video.push(Qe),ki=!0)),ki)break;I-=Sa,H-=Sa}},T1_inspect=function(x,S){var I;return I=Xn.aac.isLikelyAacData(x)?function(x){for(var Ne,S=!1,w=0,I=null,H=null,W=0,Ce=0;x.length-Ce>=3;){switch(Xn.aac.parseType(x,Ce)){case"timed-metadata":if(x.length-Ce<10){S=!0;break}if((W=Xn.aac.parseId3TagSize(x,Ce))>x.length){S=!0;break}null===H&&(Ne=x.subarray(Ce,Ce+W),H=Xn.aac.parseAacTimestamp(Ne)),Ce+=W;break;case"audio":if(x.length-Ce<7){S=!0;break}if((W=Xn.aac.parseAdtsSize(x,Ce))>x.length){S=!0;break}null===I&&(Ne=x.subarray(Ce,Ce+W),I=Xn.aac.parseSampleRate(Ne)),w++,Ce+=W;break;default:Ce++}if(S)return null}if(null===I||null===H)return null;var Qe=mc/I;return{audio:[{type:"audio",dts:H,pts:H},{type:"audio",dts:H+1024*w*Qe,pts:H+1024*w*Qe}]}}(x):function(x){var S={pid:null,table:null},w={};for(var I in function(x,S){for(var H,w=0,I=Sa;I<x.byteLength;)if(71!==x[w]||71!==x[I])w++,I++;else{switch(H=x.subarray(w,I),Xn.ts.parseType(H,S.pid)){case"pat":S.pid=Xn.ts.parsePat(H);break;case"pmt":var Ce=Xn.ts.parsePmt(H);S.table=S.table||{},Object.keys(Ce).forEach(function(Ne){S.table[Ne]=Ce[Ne]})}w+=Sa,I+=Sa}}(x,S),S.table)if(S.table.hasOwnProperty(I))switch(S.table[I]){case sa.H264_STREAM_TYPE:w.video=[],g1(x,S,w),0===w.video.length&&delete w.video;break;case sa.ADTS_STREAM_TYPE:w.audio=[],Xy(x,S,w),0===w.audio.length&&delete w.audio}return w}(x),I&&(I.audio||I.video)?(function(x,S){if(x.audio&&x.audio.length){var w=S;(typeof w>"u"||isNaN(w))&&(w=x.audio[0].dts),x.audio.forEach(function(W){W.dts=Vh(W.dts,w),W.pts=Vh(W.pts,w),W.dtsTime=W.dts/mc,W.ptsTime=W.pts/mc})}if(x.video&&x.video.length){var I=S;if((typeof I>"u"||isNaN(I))&&(I=x.video[0].dts),x.video.forEach(function(W){W.dts=Vh(W.dts,I),W.pts=Vh(W.pts,I),W.dtsTime=W.dts/mc,W.ptsTime=W.pts/mc}),x.firstKeyFrame){var H=x.firstKeyFrame;H.dts=Vh(H.dts,I),H.pts=Vh(H.pts,I),H.dtsTime=H.dts/mc,H.ptsTime=H.pts/mc}}}(I,S),I):null},qy=function(){function re(S,w){this.options=w||{},this.self=S,this.init()}var x=re.prototype;return x.init=function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new z_.Transmuxer(this.options),function(x,S){S.on("data",function(w){var I=w.initSegment;w.initSegment={data:I.buffer,byteOffset:I.byteOffset,byteLength:I.byteLength};var H=w.data;w.data=H.buffer,x.postMessage({action:"data",segment:w,byteOffset:H.byteOffset,byteLength:H.byteLength},[w.data])}),S.on("done",function(w){x.postMessage({action:"done"})}),S.on("gopInfo",function(w){x.postMessage({action:"gopInfo",gopInfo:w})}),S.on("videoSegmentTimingInfo",function(w){var I={start:{decode:un_videoTsToSeconds(w.start.dts),presentation:un_videoTsToSeconds(w.start.pts)},end:{decode:un_videoTsToSeconds(w.end.dts),presentation:un_videoTsToSeconds(w.end.pts)},baseMediaDecodeTime:un_videoTsToSeconds(w.baseMediaDecodeTime)};w.prependedContentDuration&&(I.prependedContentDuration=un_videoTsToSeconds(w.prependedContentDuration)),x.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:I})}),S.on("audioSegmentTimingInfo",function(w){var I={start:{decode:un_videoTsToSeconds(w.start.dts),presentation:un_videoTsToSeconds(w.start.pts)},end:{decode:un_videoTsToSeconds(w.end.dts),presentation:un_videoTsToSeconds(w.end.pts)},baseMediaDecodeTime:un_videoTsToSeconds(w.baseMediaDecodeTime)};w.prependedContentDuration&&(I.prependedContentDuration=un_videoTsToSeconds(w.prependedContentDuration)),x.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:I})}),S.on("id3Frame",function(w){x.postMessage({action:"id3Frame",id3Frame:w})}),S.on("caption",function(w){x.postMessage({action:"caption",caption:w})}),S.on("trackinfo",function(w){x.postMessage({action:"trackinfo",trackInfo:w})}),S.on("audioTimingInfo",function(w){x.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:un_videoTsToSeconds(w.start),end:un_videoTsToSeconds(w.end)}})}),S.on("videoTimingInfo",function(w){x.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:un_videoTsToSeconds(w.start),end:un_videoTsToSeconds(w.end)}})}),S.on("log",function(w){x.postMessage({action:"log",log:w})})}(this.self,this.transmuxer)},x.pushMp4Captions=function(w){this.captionParser||(this.captionParser=new o1,this.captionParser.init());var I=new Uint8Array(w.data,w.byteOffset,w.byteLength),H=this.captionParser.parse(I,w.trackIds,w.timescales);this.self.postMessage({action:"mp4Captions",captions:H&&H.captions||[],logs:H&&H.logs||[],data:I.buffer},[I.buffer])},x.probeMp4StartTime=function(w){var H=w.data,W=Wy_startTime(w.timescales,H);this.self.postMessage({action:"probeMp4StartTime",startTime:W,data:H},[H.buffer])},x.probeMp4Tracks=function(w){var I=w.data,H=Wy_tracks(I);this.self.postMessage({action:"probeMp4Tracks",tracks:H,data:I},[I.buffer])},x.probeTs=function(w){var I=w.data,H=w.baseStartTime,W="number"!=typeof H||isNaN(H)?void 0:9e4*H,Ce=T1_inspect(I,W),Ne=null;Ce&&((Ne={hasVideo:Ce.video&&2===Ce.video.length||!1,hasAudio:Ce.audio&&2===Ce.audio.length||!1}).hasVideo&&(Ne.videoStart=Ce.video[0].ptsTime),Ne.hasAudio&&(Ne.audioStart=Ce.audio[0].ptsTime)),this.self.postMessage({action:"probeTs",result:Ne,data:I},[I.buffer])},x.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},x.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},x.push=function(w){var I=new Uint8Array(w.data,w.byteOffset,w.byteLength);this.transmuxer.push(I)},x.reset=function(){this.transmuxer.reset()},x.setTimestampOffset=function(w){this.transmuxer.setBaseMediaDecodeTime(Math.round(un_secondsToVideoTs(w.timestampOffset||0)))},x.setAudioAppendStart=function(w){this.transmuxer.setAudioAppendStart(Math.ceil(un_secondsToVideoTs(w.appendStart)))},x.setRemux=function(w){this.transmuxer.setRemux(w.remux)},x.flush=function(w){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},x.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},x.alignGopsWith=function(w){this.transmuxer.alignGopsWith(w.gopsToAlignWith.slice())},re}();self.onmessage=function(re){"init"===re.data.action&&re.data.options?this.messageHandlers=new qy(self,re.data.options):(this.messageHandlers||(this.messageHandlers=new qy(self)),re.data&&re.data.action&&"init"!==re.data.action&&this.messageHandlers[re.data.action]&&this.messageHandlers[re.data.action](re.data))}})),cf=tv(rv),av=function(n){var r=n.transmuxer,o=n.bytes,e=n.audioAppendStart,s=n.gopsToAlignWith,u=n.remux,d=n.onData,m=n.onTrackInfo,g=n.onAudioTimingInfo,T=n.onVideoTimingInfo,L=n.onVideoSegmentTimingInfo,P=n.onAudioSegmentTimingInfo,q=n.onId3,le=n.onCaptions,_e=n.onDone,ge=n.onEndedTimeline,rt=n.onTransmuxerLog,yt=n.isEndOfTimeline,ni={buffer:[]},It=yt;if(r.onmessage=function(ai){r.currentTransmux===n&&("data"===ai.data.action&&function(n,r,o){var e=n.data.segment,s=e.type,u=e.initSegment,T=e.videoFrameDtsTime,L=e.videoFramePtsTime;r.buffer.push({captions:e.captions,captionStreams:e.captionStreams,metadata:e.metadata});var P=n.data.segment.boxes||{data:n.data.segment.data},q={type:s,data:new Uint8Array(P.data,P.data.byteOffset,P.data.byteLength),initSegment:new Uint8Array(u.data,u.byteOffset,u.byteLength)};typeof T<"u"&&(q.videoFrameDtsTime=T),typeof L<"u"&&(q.videoFramePtsTime=L),o(q)}(ai,ni,d),"trackinfo"===ai.data.action&&m(ai.data.trackInfo),"gopInfo"===ai.data.action&&function(n,r){r.gopInfo=n.data.gopInfo}(ai,ni),"audioTimingInfo"===ai.data.action&&g(ai.data.audioTimingInfo),"videoTimingInfo"===ai.data.action&&T(ai.data.videoTimingInfo),"videoSegmentTimingInfo"===ai.data.action&&L(ai.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===ai.data.action&&P(ai.data.audioSegmentTimingInfo),"id3Frame"===ai.data.action&&q([ai.data.id3Frame],ai.data.id3Frame.dispatchType),"caption"===ai.data.action&&le(ai.data.caption),"endedtimeline"===ai.data.action&&(It=!1,ge()),"log"===ai.data.action&&rt(ai.data.log),"transmuxed"===ai.data.type&&(It||(r.onmessage=null,function(n){var r=n.transmuxedData,o=n.callback;r.buffer=[],o(r)}({transmuxedData:ni,callback:_e}),sv(r))))},e&&r.postMessage({action:"setAudioAppendStart",appendStart:e}),Array.isArray(s)&&r.postMessage({action:"alignGopsWith",gopsToAlignWith:s}),typeof u<"u"&&r.postMessage({action:"setRemux",remux:u}),o.byteLength){var ci=o instanceof ArrayBuffer?o:o.buffer,Zt=o instanceof ArrayBuffer?0:o.byteOffset;r.postMessage({action:"push",data:ci,byteOffset:Zt,byteLength:o.byteLength},[ci])}yt&&r.postMessage({action:"endTimeline"}),r.postMessage({action:"flush"})},sv=function(n){n.currentTransmux=null,n.transmuxQueue.length&&(n.currentTransmux=n.transmuxQueue.shift(),"function"==typeof n.currentTransmux?n.currentTransmux():av(n.currentTransmux))},ov=function(n,r){n.postMessage({action:r}),sv(n)},ff_reset=function(n){!function(n,r){if(!r.currentTransmux)return r.currentTransmux=n,void ov(r,n);r.transmuxQueue.push(ov.bind(null,r,n))}("reset",n)},Lh=function(n){var r=n.transmuxer,o=n.endAction||n.action,e=n.callback,s=Be({},n,{endAction:null,transmuxer:null,callback:null});if(r.addEventListener("message",function g(T){T.data.action===o&&(r.removeEventListener("message",g),T.data.data&&(T.data.data=new Uint8Array(T.data.data,n.byteOffset||0,n.byteLength||T.data.data.byteLength),n.data&&(n.data=T.data.data)),e(T.data))}),n.data){var d=n.data instanceof ArrayBuffer;s.byteOffset=d?0:n.data.byteOffset,s.byteLength=n.data.byteLength,r.postMessage(s,[d?n.data:n.data.buffer])}else r.postMessage(s)},nc=function(n){n.forEach(function(r){r.abort()})},Ih=function(n,r){return r.timedout?{status:r.status,message:"HLS request timed-out at URL: "+r.uri,code:-101,xhr:r}:r.aborted?{status:r.status,message:"HLS request aborted at URL: "+r.uri,code:-102,xhr:r}:n?{status:r.status,message:"HLS request errored at URL: "+r.uri,code:2,xhr:r}:"arraybuffer"===r.responseType&&0===r.response.byteLength?{status:r.status,message:"Empty HLS response at URL: "+r.uri,code:2,xhr:r}:null},pf=function(n,r,o){return function(e,s){var u=s.response,d=Ih(e,s);if(d)return o(d,n);if(16!==u.byteLength)return o({status:s.status,message:"Invalid HLS key at URL: "+s.uri,code:2,xhr:s},n);for(var m=new DataView(u),g=new Uint32Array([m.getUint32(0),m.getUint32(4),m.getUint32(8),m.getUint32(12)]),T=0;T<r.length;T++)r[T].bytes=g;return o(null,n)}},Rh=function(n,r){var o=Yo(n.map.bytes);if("mp4"!==o)return r({internal:!0,message:"Found unsupported "+(o||"unknown")+" container for initialization segment at URL: "+(n.map.resolvedUri||n.map.uri),code:2});Lh({action:"probeMp4Tracks",data:n.map.bytes,transmuxer:n.transmuxer,callback:function(u){var d=u.tracks;return n.map.bytes=u.data,d.forEach(function(g){n.map.tracks=n.map.tracks||{},!n.map.tracks[g.type]&&(n.map.tracks[g.type]=g,"number"==typeof g.id&&g.timescale&&(n.map.timescales=n.map.timescales||{},n.map.timescales[g.id]=g.timescale))}),r(null)}})},q0=function(n){var r=n.segment,o=n.bytes,e=n.trackInfoFn,s=n.timingInfoFn,u=n.videoSegmentTimingInfoFn,d=n.audioSegmentTimingInfoFn,m=n.id3Fn,g=n.captionsFn,T=n.isEndOfTimeline,L=n.endedTimelineFn,P=n.dataFn,q=n.doneFn,le=n.onTransmuxerLog,_e=r.map&&r.map.tracks||{},ge=Boolean(_e.audio&&_e.video),rt=s.bind(null,r,"audio","start"),yt=s.bind(null,r,"audio","end"),ni=s.bind(null,r,"video","start"),It=s.bind(null,r,"video","end");Lh({action:"probeTs",transmuxer:r.transmuxer,data:o,baseStartTime:r.baseStartTime,callback:function(Zt){r.bytes=o=Zt.data;var Mt=Zt.result;Mt&&(e(r,{hasAudio:Mt.hasAudio,hasVideo:Mt.hasVideo,isMuxed:ge}),e=null,Mt.hasAudio&&!ge&&rt(Mt.audioStart),Mt.hasVideo&&ni(Mt.videoStart),rt=null,ni=null),function(n){if(!n.transmuxer.currentTransmux)return n.transmuxer.currentTransmux=n,void av(n);n.transmuxer.transmuxQueue.push(n)}({bytes:o,transmuxer:r.transmuxer,audioAppendStart:r.audioAppendStart,gopsToAlignWith:r.gopsToAlignWith,remux:ge,onData:function(Mt){Mt.type="combined"===Mt.type?"video":Mt.type,P(r,Mt)},onTrackInfo:function(Mt){e&&(ge&&(Mt.isMuxed=!0),e(r,Mt))},onAudioTimingInfo:function(Mt){rt&&typeof Mt.start<"u"&&(rt(Mt.start),rt=null),yt&&typeof Mt.end<"u"&&yt(Mt.end)},onVideoTimingInfo:function(Mt){ni&&typeof Mt.start<"u"&&(ni(Mt.start),ni=null),It&&typeof Mt.end<"u"&&It(Mt.end)},onVideoSegmentTimingInfo:function(Mt){u(Mt)},onAudioSegmentTimingInfo:function(Mt){d(Mt)},onId3:function(Mt,ai){m(r,Mt,ai)},onCaptions:function(Mt){g(r,[Mt])},isEndOfTimeline:T,onEndedTimeline:function(){L()},onTransmuxerLog:le,onDone:function(Mt){!q||(Mt.type="combined"===Mt.type?"video":Mt.type,q(null,r,Mt))}})}})},mf=function(n){var r=n.segment,o=n.bytes,e=n.trackInfoFn,s=n.timingInfoFn,u=n.videoSegmentTimingInfoFn,d=n.audioSegmentTimingInfoFn,m=n.id3Fn,g=n.captionsFn,T=n.isEndOfTimeline,L=n.endedTimelineFn,P=n.dataFn,q=n.doneFn,le=n.onTransmuxerLog,_e=new Uint8Array(o);if(function(n){return M0(n,["moof"]).length>0}(_e)){r.isFmp4=!0;var ge=r.map.tracks,rt={isFmp4:!0,hasVideo:!!ge.video,hasAudio:!!ge.audio};ge.audio&&ge.audio.codec&&"enca"!==ge.audio.codec&&(rt.audioCodec=ge.audio.codec),ge.video&&ge.video.codec&&"encv"!==ge.video.codec&&(rt.videoCodec=ge.video.codec),ge.video&&ge.audio&&(rt.isMuxed=!0),e(r,rt);var yt=function(It){P(r,{data:_e,type:rt.hasAudio&&!rt.isMuxed?"audio":"video"}),It&&It.length&&g(r,It),q(null,r,{})};Lh({action:"probeMp4StartTime",timescales:r.map.timescales,data:_e,transmuxer:r.transmuxer,callback:function(It){var Bt=It.data,ci=It.startTime;o=Bt.buffer,r.bytes=_e=Bt,rt.hasAudio&&!rt.isMuxed&&s(r,"audio","start",ci),rt.hasVideo&&s(r,"video","start",ci),ge.video&&Bt.byteLength&&r.transmuxer?Lh({action:"pushMp4Captions",endAction:"mp4Captions",transmuxer:r.transmuxer,data:_e,timescales:r.map.timescales,trackIds:[ge.video.id],callback:function(Mt){o=Mt.data.buffer,r.bytes=_e=Mt.data,Mt.logs.forEach(function(ai){le(ct.mergeOptions(ai,{stream:"mp4CaptionParser"}))}),yt(Mt.captions)}}):yt()}})}else{if(r.transmuxer)return typeof r.container>"u"&&(r.container=Yo(_e)),"ts"!==r.container&&"aac"!==r.container?(e(r,{hasAudio:!1,hasVideo:!1}),void q(null,r,{})):void q0({segment:r,bytes:o,trackInfoFn:e,timingInfoFn:s,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:m,captionsFn:g,isEndOfTimeline:T,endedTimelineFn:L,dataFn:P,doneFn:q,onTransmuxerLog:le});q(null,r,{})}},rc=function(n,r){var m,o=n.id,e=n.key,s=n.encryptedBytes,u=n.decryptionWorker;u.addEventListener("message",function g(T){if(T.data.source===o){u.removeEventListener("message",g);var L=T.data.decrypted;r(new Uint8Array(L.bytes,L.byteOffset,L.byteLength))}}),m=e.bytes.slice?e.bytes.slice():new Uint32Array(Array.prototype.slice.call(e.bytes)),u.postMessage(rf({source:o,encrypted:s,key:m,iv:e.iv}),[s.buffer,m.buffer])},vf=function(n){var r=n.xhr,o=n.xhrOptions,s=n.segment,u=n.abortFn,d=n.progressFn,m=n.trackInfoFn,g=n.timingInfoFn,T=n.videoSegmentTimingInfoFn,L=n.audioSegmentTimingInfoFn,P=n.id3Fn,q=n.captionsFn,le=n.isEndOfTimeline,_e=n.endedTimelineFn,ge=n.dataFn,ni=[],It=function(n){var r=n.activeXhrs,o=n.decryptionWorker,e=n.trackInfoFn,s=n.timingInfoFn,u=n.videoSegmentTimingInfoFn,d=n.audioSegmentTimingInfoFn,m=n.id3Fn,g=n.captionsFn,T=n.isEndOfTimeline,L=n.endedTimelineFn,P=n.dataFn,q=n.doneFn,le=n.onTransmuxerLog,_e=0,ge=!1;return function(rt,yt){if(!ge){if(rt)return ge=!0,nc(r),q(rt,yt);if((_e+=1)===r.length){var ni=function(){if(yt.encryptedBytes)return function(n){var o=n.segment,e=n.trackInfoFn,s=n.timingInfoFn,u=n.videoSegmentTimingInfoFn,d=n.audioSegmentTimingInfoFn,m=n.id3Fn,g=n.captionsFn,T=n.isEndOfTimeline,L=n.endedTimelineFn,P=n.dataFn,q=n.doneFn,le=n.onTransmuxerLog;rc({id:o.requestId,key:o.key,encryptedBytes:o.encryptedBytes,decryptionWorker:n.decryptionWorker},function(_e){o.bytes=_e,mf({segment:o,bytes:o.bytes,trackInfoFn:e,timingInfoFn:s,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:m,captionsFn:g,isEndOfTimeline:T,endedTimelineFn:L,dataFn:P,doneFn:q,onTransmuxerLog:le})})}({decryptionWorker:o,segment:yt,trackInfoFn:e,timingInfoFn:s,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:m,captionsFn:g,isEndOfTimeline:T,endedTimelineFn:L,dataFn:P,doneFn:q,onTransmuxerLog:le});mf({segment:yt,bytes:yt.bytes,trackInfoFn:e,timingInfoFn:s,videoSegmentTimingInfoFn:u,audioSegmentTimingInfoFn:d,id3Fn:m,captionsFn:g,isEndOfTimeline:T,endedTimelineFn:L,dataFn:P,doneFn:q,onTransmuxerLog:le})};if(yt.endOfAllRequests=Date.now(),yt.map&&yt.map.encryptedBytes&&!yt.map.bytes)return rc({decryptionWorker:o,id:yt.requestId+"-init",encryptedBytes:yt.map.encryptedBytes,key:yt.map.key},function(It){yt.map.bytes=It,Rh(yt,function(Bt){if(Bt)return nc(r),q(Bt,yt);ni()})});ni()}}}}({activeXhrs:ni,decryptionWorker:n.decryptionWorker,trackInfoFn:m,timingInfoFn:g,videoSegmentTimingInfoFn:T,audioSegmentTimingInfoFn:L,id3Fn:P,captionsFn:q,isEndOfTimeline:le,endedTimelineFn:_e,dataFn:ge,doneFn:n.doneFn,onTransmuxerLog:n.onTransmuxerLog});if(s.key&&!s.key.bytes){var Bt=[s.key];s.map&&!s.map.bytes&&s.map.key&&s.map.key.resolvedUri===s.key.resolvedUri&&Bt.push(s.map.key);var Mt=r(ct.mergeOptions(o,{uri:s.key.resolvedUri,responseType:"arraybuffer"}),pf(s,Bt,It));ni.push(Mt)}if(s.map&&!s.map.bytes){if(s.map.key&&(!s.key||s.key.resolvedUri!==s.map.key.resolvedUri)){var E=r(ct.mergeOptions(o,{uri:s.map.key.resolvedUri,responseType:"arraybuffer"}),pf(s,[s.map.key],It));ni.push(E)}var D=ct.mergeOptions(o,{uri:s.map.resolvedUri,responseType:"arraybuffer",headers:Ws(s.map)}),X=function(n){var r=n.segment,o=n.finishProcessingFn;return function(e,s){var u=Ih(e,s);if(u)return o(u,r);var d=new Uint8Array(s.response);if(r.map.key)return r.map.encryptedBytes=d,o(null,r);r.map.bytes=d,Rh(r,function(m){if(m)return m.xhr=s,m.status=s.status,o(m,r);o(null,r)})}}({segment:s,finishProcessingFn:It}),J=r(D,X);ni.push(J)}var xe=ct.mergeOptions(o,{uri:s.part&&s.part.resolvedUri||s.resolvedUri,responseType:"arraybuffer",headers:Ws(s)}),st=r(xe,function(n){var r=n.segment,o=n.finishProcessingFn,e=n.responseType;return function(s,u){var d=Ih(s,u);if(d)return o(d,r);var m="arraybuffer"!==e&&u.responseText?function(n){for(var r=new Uint8Array(new ArrayBuffer(n.length)),o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r.buffer}(u.responseText.substring(r.lastReachedChar||0)):u.response;return r.stats=function(n){return{bandwidth:n.bandwidth,bytesReceived:n.bytesReceived||0,roundTripTime:n.roundTripTime||0}}(u),r.key?r.encryptedBytes=new Uint8Array(m):r.bytes=new Uint8Array(m),o(null,r)}}({segment:s,finishProcessingFn:It,responseType:xe.responseType}));st.addEventListener("progress",function(n){var r=n.segment,o=n.progressFn;return function(e){if(!e.target.aborted)return r.stats=ct.mergeOptions(r.stats,function(n){var r=n.target,e={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-r.requestTime||0};return e.bytesReceived=n.loaded,e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3),e}(e)),!r.stats.firstBytesReceivedAt&&r.stats.bytesReceived&&(r.stats.firstBytesReceivedAt=Date.now()),o(e,r)}}({segment:s,progressFn:d,trackInfoFn:m,timingInfoFn:g,videoSegmentTimingInfoFn:T,audioSegmentTimingInfoFn:L,id3Fn:P,captionsFn:q,isEndOfTimeline:le,endedTimelineFn:_e,dataFn:ge})),ni.push(st);var $t={};return ni.forEach(function(Ft){Ft.addEventListener("loadend",function(n){var r=n.loadendState,o=n.abortFn;return function(e){e.target.aborted&&o&&!r.calledAbortFn&&(o(),r.calledAbortFn=!0)}}({loadendState:$t,abortFn:u}))}),function(){return nc(ni)}},Q0=na("CodecUtils"),pv=function(n,r){var o=r.attributes||{};return n&&n.mediaGroups&&n.mediaGroups.AUDIO&&o.AUDIO&&n.mediaGroups.AUDIO[o.AUDIO]},gf=function(n){var r={};return n.forEach(function(o){var e=o.mediaType,s=o.type,u=o.details;r[e]=r[e]||[],r[e].push(xp(""+s+u))}),Object.keys(r).forEach(function(o){if(r[o].length>1)return Q0("multiple "+o+" codecs found as attributes: "+r[o].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),void(r[o]=null);r[o]=r[o][0]}),r},yf=function(n){var r=0;return n.audio&&r++,n.video&&r++,r},ac=function(n,r){var o=r.attributes||{},e=gf(function(n){var r=n.attributes||{};if(r.CODECS)return hs(r.CODECS)}(r)||[]);if(pv(n,r)&&!e.audio&&!function(n,r){if(!pv(n,r))return!0;var e=n.mediaGroups.AUDIO[(r.attributes||{}).AUDIO];for(var s in e)if(!e[s].uri&&!e[s].playlists)return!0;return!1}(n,r)){var s=gf(function(n,r){if(!n.mediaGroups.AUDIO||!r)return null;var o=n.mediaGroups.AUDIO[r];if(!o)return null;for(var e in o){var s=o[e];if(s.default&&s.playlists)return hs(s.playlists[0].attributes.CODECS)}return null}(n,o.AUDIO)||[]);s.audio&&(e.audio=s.audio)}return e},Fh=na("PlaylistSelector"),$l=function(n){if(n&&n.playlist){var r=n.playlist;return JSON.stringify({id:r.id,bandwidth:n.bandwidth,width:n.width,height:n.height,codecs:r.attributes&&r.attributes.CODECS||""})}},Nh=function(n,r){if(!n)return"";var o=window.getComputedStyle(n);return o?o[r]:""},Jl=function(n,r){var o=n.slice();n.sort(function(e,s){var u=r(e,s);return 0===u?o.indexOf(e)-o.indexOf(s):u})},_f=function(n,r){var o,e;return n.attributes.BANDWIDTH&&(o=n.attributes.BANDWIDTH),o=o||window.Number.MAX_VALUE,r.attributes.BANDWIDTH&&(e=r.attributes.BANDWIDTH),o-(e||window.Number.MAX_VALUE)},sc=function(n,r,o,e,s,u){if(n){var d={bandwidth:r,width:o,height:e,limitRenditionByPlayerDimensions:s},m=n.playlists;Jn.isAudioOnly(n)&&(m=u.getAudioTrackPlaylists_(),d.audioOnly=!0);var g=m.map(function(qt){return{bandwidth:qt.attributes&&qt.attributes.BANDWIDTH||window.Number.MAX_VALUE,width:qt.attributes&&qt.attributes.RESOLUTION&&qt.attributes.RESOLUTION.width,height:qt.attributes&&qt.attributes.RESOLUTION&&qt.attributes.RESOLUTION.height,playlist:qt}});Jl(g,function(qt,gi){return qt.bandwidth-gi.bandwidth});var T=(g=g.filter(function(qt){return!Jn.isIncompatible(qt.playlist)})).filter(function(qt){return Jn.isEnabled(qt.playlist)});T.length||(T=g.filter(function(qt){return!Jn.isDisabled(qt.playlist)}));var L=T.filter(function(qt){return qt.bandwidth*Sr.BANDWIDTH_VARIANCE<r}),P=L[L.length-1],q=L.filter(function(qt){return qt.bandwidth===P.bandwidth})[0];if(!1===s){var le=q||T[0]||g[0];if(le&&le.playlist){var _e="sortedPlaylistReps";return q&&(_e="bandwidthBestRep"),T[0]&&(_e="enabledPlaylistReps"),Fh("choosing "+$l(le)+" using "+_e+" with options",d),le.playlist}return Fh("could not choose a playlist with options",d),null}var ge=L.filter(function(qt){return qt.width&&qt.height});Jl(ge,function(qt,gi){return qt.width-gi.width});var rt=ge.filter(function(qt){return qt.width===o&&qt.height===e});P=rt[rt.length-1];var ni,It,Bt,ci,yt=rt.filter(function(qt){return qt.bandwidth===P.bandwidth})[0];if(yt||(It=(ni=ge.filter(function(qt){return qt.width>o||qt.height>e})).filter(function(qt){return qt.width===ni[0].width&&qt.height===ni[0].height}),P=It[It.length-1],Bt=It.filter(function(qt){return qt.bandwidth===P.bandwidth})[0]),u.experimentalLeastPixelDiffSelector){var Zt=ge.map(function(qt){return qt.pixelDiff=Math.abs(qt.width-o)+Math.abs(qt.height-e),qt});Jl(Zt,function(qt,gi){return qt.pixelDiff===gi.pixelDiff?gi.bandwidth-qt.bandwidth:qt.pixelDiff-gi.pixelDiff}),ci=Zt[0]}var Mt=ci||Bt||yt||q||T[0]||g[0];if(Mt&&Mt.playlist){var ai="sortedPlaylistReps";return ci?ai="leastPixelDiffRep":Bt?ai="resolutionPlusOneRep":yt?ai="resolutionBestRep":q?ai="bandwidthBestRep":T[0]&&(ai="enabledPlaylistReps"),Fh("choosing "+$l(Mt)+" using "+ai+" with options",d),Mt.playlist}return Fh("could not choose a playlist with options",d),null}},kh=function(){var n=this.useDevicePixelRatio&&window.devicePixelRatio||1;return sc(this.playlists.master,this.systemBandwidth,parseInt(Nh(this.tech_.el(),"width"),10)*n,parseInt(Nh(this.tech_.el(),"height"),10)*n,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)},oc=function(n,r,o){var e,s;if(o&&o.cues)for(e=o.cues.length;e--;)(s=o.cues[e]).startTime>=n&&s.endTime<=r&&o.removeCue(s)},f=function(n){return"number"==typeof n&&isFinite(n)},p=1/60,A=function(n){var r=n.startOfSegment,o=n.duration,e=n.segment,s=n.part,u=n.playlist,d=u.mediaSequence,m=u.id,g=u.segments,L=n.mediaIndex,P=n.partIndex,q=n.timeline,le=(void 0===g?[]:g).length-1,_e="mediaIndex/partIndex increment";n.getMediaInfoForTime?_e="getMediaInfoForTime ("+n.getMediaInfoForTime+")":n.isSyncRequest&&(_e="getSyncSegmentCandidate (isSyncRequest)"),n.independent&&(_e+=" with independent "+n.independent);var ge="number"==typeof P,rt=n.segment.uri?"segment":"pre-segment",yt=ge?Xl({preloadSegment:e})-1:0;return rt+" ["+(d+L)+"/"+(d+le)+"]"+(ge?" part ["+P+"/"+yt+"]":"")+" segment start/end ["+e.start+" => "+e.end+"]"+(ge?" part start/end ["+s.start+" => "+s.end+"]":"")+" startOfSegment ["+r+"] duration ["+o+"] timeline ["+q+"] selected by ["+_e+"] playlist ["+m+"]"},C=function(n){return n+"TimingInfo"},R=function(n){var r=n.timelineChangeController,e=n.segmentTimeline,s=n.loaderType,u=n.audioDisabled;if(n.currentTimeline===e)return!1;if("audio"===s){var d=r.lastTimelineChange({type:"main"});return!d||d.to!==e}if("main"===s&&u){var m=r.pendingTimelineChange({type:"audio"});return!(m&&m.to===e)}return!1},z=function(n){var r=n.segmentDuration,o=n.maxDuration;return!!r&&Math.round(r)>o+Xr},ce=function(c){function n(o,e){var s;if(s=c.call(this)||this,!o)throw new TypeError("Initialization settings are required");if("function"!=typeof o.currentTime)throw new TypeError("No currentTime getter specified");if(!o.mediaSource)throw new TypeError("No MediaSource specified");return s.bandwidth=o.bandwidth,s.throughput={rate:0,count:0},s.roundTrip=NaN,s.resetStats_(),s.mediaIndex=null,s.partIndex=null,s.hasPlayed_=o.hasPlayed,s.currentTime_=o.currentTime,s.seekable_=o.seekable,s.seeking_=o.seeking,s.duration_=o.duration,s.mediaSource_=o.mediaSource,s.vhs_=o.vhs,s.loaderType_=o.loaderType,s.currentMediaInfo_=void 0,s.startingMediaInfo_=void 0,s.segmentMetadataTrack_=o.segmentMetadataTrack,s.goalBufferLength_=o.goalBufferLength,s.sourceType_=o.sourceType,s.sourceUpdater_=o.sourceUpdater,s.inbandTextTracks_=o.inbandTextTracks,s.state_="INIT",s.timelineChangeController_=o.timelineChangeController,s.shouldSaveSegmentTimingInfo_=!0,s.parse708captions_=o.parse708captions,s.useDtsForTimestampOffset_=o.useDtsForTimestampOffset,s.captionServices_=o.captionServices,s.experimentalExactManifestTimings=o.experimentalExactManifestTimings,s.checkBufferTimeout_=null,s.error_=void 0,s.currentTimeline_=-1,s.pendingSegment_=null,s.xhrOptions_=null,s.pendingSegments_=[],s.audioDisabled_=!1,s.isPendingTimestampOffset_=!1,s.gopBuffer_=[],s.timeMapping_=0,s.safeAppend_=ct.browser.IE_VERSION>=11,s.appendInitSegment_={audio:!0,video:!0},s.playlistOfLastInitSegment_={audio:null,video:null},s.callQueue_=[],s.loadQueue_=[],s.metadataQueue_={id3:[],caption:[]},s.waitingOnRemove_=!1,s.quotaExceededErrorRetryTimeout_=null,s.activeInitSegmentId_=null,s.initSegments_={},s.cacheEncryptionKeys_=o.cacheEncryptionKeys,s.keyCache_={},s.decrypter_=o.decrypter,s.syncController_=o.syncController,s.syncPoint_={segmentIndex:0,time:0},s.transmuxer_=s.createTransmuxer_(),s.triggerSyncInfoUpdate_=function(){return s.trigger("syncinfoupdate")},s.syncController_.on("syncinfoupdate",s.triggerSyncInfoUpdate_),s.mediaSource_.addEventListener("sourceopen",function(){s.isEndOfStream_()||(s.ended_=!1)}),s.fetchAtBuffer_=!1,s.logger_=na("SegmentLoader["+s.loaderType_+"]"),Object.defineProperty(qi(s),"state",{get:function(){return this.state_},set:function(d){d!==this.state_&&(this.logger_(this.state_+" -> "+d),this.state_=d,this.trigger("statechange"))}}),s.sourceUpdater_.on("ready",function(){s.hasEnoughInfoToAppend_()&&s.processCallQueue_()}),"main"===s.loaderType_&&s.timelineChangeController_.on("pendingtimelinechange",function(){s.hasEnoughInfoToAppend_()&&s.processCallQueue_()}),"audio"===s.loaderType_&&s.timelineChangeController_.on("timelinechange",function(){s.hasEnoughInfoToLoad_()&&s.processLoadQueue_(),s.hasEnoughInfoToAppend_()&&s.processCallQueue_()}),s}Ti(n,c);var r=n.prototype;return r.createTransmuxer_=function(){return function(n){var r=new cf;r.currentTransmux=null,r.transmuxQueue=[];var o=r.terminate;return r.terminate=function(){return r.currentTransmux=null,r.transmuxQueue.length=0,o.call(r)},r.postMessage({action:"init",options:n}),r}({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,parse708captions:this.parse708captions_,captionServices:this.captionServices_})},r.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0,this.mediaAppends=0},r.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},r.setAudio=function(e){this.audioDisabled_=!e,e?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},r.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},r.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,window.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},r.checkForAbort_=function(e){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==e:(this.state="READY",!0)},r.error=function(e){return typeof e<"u"&&(this.logger_("error occurred:",e),this.error_=e),this.pendingSegment_=null,this.error_},r.endOfStream=function(){this.ended_=!0,this.transmuxer_&&ff_reset(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},r.buffered_=function(){var e=this.getMediaInfo_();if(!this.sourceUpdater_||!e)return ct.createTimeRanges();if("main"===this.loaderType_){var u=e.hasVideo;if(u&&e.hasAudio&&!this.audioDisabled_&&!e.isMuxed)return this.sourceUpdater_.buffered();if(u)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},r.initSegmentForMap=function(e,s){if(void 0===s&&(s=!1),!e)return null;var u=Ba(e),d=this.initSegments_[u];return s&&!d&&e.bytes&&(this.initSegments_[u]=d={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,tracks:e.tracks,timescales:e.timescales}),d||e},r.segmentKey=function(e,s){if(void 0===s&&(s=!1),!e)return null;var u=Mh(e),d=this.keyCache_[u];this.cacheEncryptionKeys_&&s&&!d&&e.bytes&&(this.keyCache_[u]=d={resolvedUri:e.resolvedUri,bytes:e.bytes});var m={resolvedUri:(d||e).resolvedUri};return d&&(m.bytes=d.bytes),m},r.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},r.load=function(){if(this.monitorBuffer_(),this.playlist_){if("INIT"===this.state&&this.couldBeginLoading_())return this.init_();!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY")}},r.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},r.playlist=function(e,s){if(void 0===s&&(s={}),e){var u=this.playlist_,d=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=s,"INIT"===this.state&&(e.syncInfo={mediaSequence:e.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(e));var m=null;if(u&&(u.id?m=u.id:u.uri&&(m=u.uri)),this.logger_("playlist update ["+m+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!u||u.uri!==e.uri)return null!==this.mediaIndex&&(e.endList?this.resyncLoader():this.resetLoader()),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");var g=e.mediaSequence-u.mediaSequence;if(this.logger_("live window shift ["+g+"]"),null!==this.mediaIndex)if(this.mediaIndex-=g,this.mediaIndex<0)this.mediaIndex=null,this.partIndex=null;else{var T=this.playlist_.segments[this.mediaIndex];if(this.partIndex&&(!T.parts||!T.parts.length||!T.parts[this.partIndex])){var L=this.mediaIndex;this.logger_("currently processing part (index "+this.partIndex+") no longer exists."),this.resetLoader(),this.mediaIndex=L}}d&&(d.mediaIndex-=g,d.mediaIndex<0?(d.mediaIndex=null,d.partIndex=null):(d.mediaIndex>=0&&(d.segment=e.segments[d.mediaIndex]),d.partIndex>=0&&d.segment.parts&&(d.part=d.segment.parts[d.partIndex]))),this.syncController_.saveExpiredSegmentInfo(u,e)}},r.pause=function(){this.checkBufferTimeout_&&(window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},r.paused=function(){return null===this.checkBufferTimeout_},r.resetEverything=function(e){this.ended_=!1,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,e),this.transmuxer_&&(this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.transmuxer_.postMessage({action:"reset"}))},r.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},r.resyncLoader=function(){this.transmuxer_&&ff_reset(this.transmuxer_),this.mediaIndex=null,this.partIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},r.remove=function(e,s,u,d){if(void 0===u&&(u=function(){}),void 0===d&&(d=!1),s===1/0&&(s=this.duration_()),s<=e)this.logger_("skipping remove because end ${end} is <= start ${start}");else if(this.sourceUpdater_&&this.getMediaInfo_()){var m=1,g=function(){0==--m&&u()};for(var T in(d||!this.audioDisabled_)&&(m++,this.sourceUpdater_.removeAudio(e,s,g)),(d||"main"===this.loaderType_)&&(this.gopBuffer_=function(n,r,o,e){for(var s=Math.ceil((r-e)*mh),u=Math.ceil((o-e)*mh),d=n.slice(),m=n.length;m--&&!(n[m].pts<=u););if(-1===m)return d;for(var g=m+1;g--&&!(n[g].pts<=s););return g=Math.max(g,0),d.splice(g,m-g+1),d}(this.gopBuffer_,e,s,this.timeMapping_),m++,this.sourceUpdater_.removeVideo(e,s,g)),this.inbandTextTracks_)oc(e,s,this.inbandTextTracks_[T]);oc(e,s,this.segmentMetadataTrack_),g()}else this.logger_("skipping remove because no source updater or starting media info")},r.monitorBuffer_=function(){this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),1)},r.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&window.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=window.setTimeout(this.monitorBufferTick_.bind(this),500)},r.fillBuffer_=function(){if(!this.sourceUpdater_.updating()){var e=this.chooseNextRequest_();!e||("number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!1,this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline})),this.loadSegment_(e))}},r.isEndOfStream_=function(e,s,u){if(void 0===e&&(e=this.mediaIndex),void 0===s&&(s=this.playlist_),void 0===u&&(u=this.partIndex),!s||!this.mediaSource_)return!1;var d="number"==typeof e&&s.segments[e];return s.endList&&"open"===this.mediaSource_.readyState&&e+1===s.segments.length&&(!d||!d.parts||u+1===d.parts.length)},r.chooseNextRequest_=function(){var e=this.buffered_(),s=vh(e)||0,u=jl(e,this.currentTime_()),d=!this.hasPlayed_()&&u>=1,m=u>=this.goalBufferLength_(),g=this.playlist_.segments;if(!g.length||d||m)return null;this.syncPoint_=this.syncPoint_||this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_());var T={partIndex:null,mediaIndex:null,startOfSegment:null,playlist:this.playlist_,isSyncRequest:Boolean(!this.syncPoint_)};if(T.isSyncRequest)T.mediaIndex=function(n,r,o){r=r||[];for(var e=[],s=0,u=0;u<r.length;u++){var d=r[u];if(n===d.timeline&&(e.push(u),(s+=d.duration)>o))return u}return 0===e.length?0:e[e.length-1]}(this.currentTimeline_,g,s);else if(null!==this.mediaIndex){var L=g[this.mediaIndex],P="number"==typeof this.partIndex?this.partIndex:-1;T.startOfSegment=L.end?L.end:s,L.parts&&L.parts[P+1]?(T.mediaIndex=this.mediaIndex,T.partIndex=P+1):T.mediaIndex=this.mediaIndex+1}else{var q=Jn.getMediaInfoForTime({experimentalExactManifestTimings:this.experimentalExactManifestTimings,playlist:this.playlist_,currentTime:this.fetchAtBuffer_?s:this.currentTime_(),startingPartIndex:this.syncPoint_.partIndex,startingSegmentIndex:this.syncPoint_.segmentIndex,startTime:this.syncPoint_.time}),le=q.segmentIndex,_e=q.startTime,ge=q.partIndex;T.getMediaInfoForTime=this.fetchAtBuffer_?"bufferedEnd "+s:"currentTime "+this.currentTime_(),T.mediaIndex=le,T.startOfSegment=_e,T.partIndex=ge}var rt=g[T.mediaIndex],yt=rt&&"number"==typeof T.partIndex&&rt.parts&&rt.parts[T.partIndex];if(!rt||"number"==typeof T.partIndex&&!yt)return null;if("number"!=typeof T.partIndex&&rt.parts&&(T.partIndex=0,yt=rt.parts[0]),!u&&yt&&!yt.independent)if(0===T.partIndex){var ni=g[T.mediaIndex-1],It=ni.parts&&ni.parts.length&&ni.parts[ni.parts.length-1];It&&It.independent&&(T.mediaIndex-=1,T.partIndex=ni.parts.length-1,T.independent="previous segment")}else rt.parts[T.partIndex-1].independent&&(T.partIndex-=1,T.independent="previous part");return T.mediaIndex>=g.length-1&&this.mediaSource_&&"ended"===this.mediaSource_.readyState&&!this.seeking_()?null:this.generateSegmentInfo_(T)},r.generateSegmentInfo_=function(e){var s=e.independent,u=e.playlist,d=e.mediaIndex,m=e.startOfSegment,g=e.isSyncRequest,T=e.partIndex,L=e.forceTimestampOffset,P=e.getMediaInfoForTime,q=u.segments[d],le="number"==typeof T&&q.parts[T],_e={requestId:"segment-loader-"+Math.random(),uri:le&&le.resolvedUri||q.resolvedUri,mediaIndex:d,partIndex:le?T:null,isSyncRequest:g,startOfSegment:m,playlist:u,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:q.timeline,duration:le&&le.duration||q.duration,segment:q,part:le,byteLength:0,transmuxer:this.transmuxer_,getMediaInfoForTime:P,independent:s},ge=typeof L<"u"?L:this.isPendingTimestampOffset_;_e.timestampOffset=this.timestampOffsetForSegment_({segmentTimeline:q.timeline,currentTimeline:this.currentTimeline_,startOfSegment:m,buffered:this.buffered_(),overrideCheck:ge});var rt=vh(this.sourceUpdater_.audioBuffered());return"number"==typeof rt&&(_e.audioAppendStart=rt-this.sourceUpdater_.audioTimestampOffset()),this.sourceUpdater_.videoBuffered().length&&(_e.gopsToAlignWith=function(n,r,o){if(typeof r>"u"||null===r||!n.length)return[];var s,e=Math.ceil((r-o+3)*mh);for(s=0;s<n.length&&!(n[s].pts>e);s++);return n.slice(s)}(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),_e},r.timestampOffsetForSegment_=function(e){return function(n){var r=n.segmentTimeline,o=n.currentTimeline,e=n.startOfSegment,s=n.buffered;return n.overrideCheck||r!==o?r<o?e:s.length?s.end(s.length-1):e:null}(e)},r.earlyAbortWhenNeeded_=function(e){if(!this.vhs_.tech_.paused()&&this.xhrOptions_.timeout&&this.playlist_.attributes.BANDWIDTH&&!(Date.now()-(e.firstBytesReceivedAt||Date.now())<1e3)){var s=this.currentTime_(),u=e.bandwidth,d=this.pendingSegment_.duration,m=Jn.estimateSegmentRequestTime(d,u,this.playlist_,e.bytesReceived),g=function(n,r,o){return void 0===o&&(o=1),((n.length?n.end(n.length-1):0)-r)/o}(this.buffered_(),s,this.vhs_.tech_.playbackRate())-1;if(!(m<=g)){var T=function(n){var o=n.currentTime,e=n.bandwidth,s=n.duration,u=n.segmentDuration,d=n.timeUntilRebuffer,m=n.currentTimeline,g=n.syncController,T=n.master.playlists.filter(function(_e){return!Jn.isIncompatible(_e)}),L=T.filter(Jn.isEnabled);L.length||(L=T.filter(function(_e){return!Jn.isDisabled(_e)}));var q=L.filter(Jn.hasAttribute.bind(null,"BANDWIDTH")).map(function(_e){var rt=g.getSyncPoint(_e,s,m,o)?1:2;return{playlist:_e,rebufferingImpact:Jn.estimateSegmentRequestTime(u,e,_e)*rt-d}}),le=q.filter(function(_e){return _e.rebufferingImpact<=0});return Jl(le,function(_e,ge){return _f(ge.playlist,_e.playlist)}),le.length?le[0]:(Jl(q,function(_e,ge){return _e.rebufferingImpact-ge.rebufferingImpact}),q[0]||null)}({master:this.vhs_.playlists.master,currentTime:s,bandwidth:u,duration:this.duration_(),segmentDuration:d,timeUntilRebuffer:g,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(T){var q=.5;g<=Xr&&(q=1),T.playlist&&T.playlist.uri!==this.playlist_.uri&&!(m-g-T.rebufferingImpact<q)&&(this.bandwidth=T.playlist.attributes.BANDWIDTH*Sr.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort"))}}}},r.handleAbort_=function(e){this.logger_("Aborting "+A(e)),this.mediaRequestsAborted+=1},r.handleProgress_=function(e,s){this.earlyAbortWhenNeeded_(s.stats),!this.checkForAbort_(s.requestId)&&this.trigger("progress")},r.handleTrackInfo_=function(e,s){this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)&&(this.checkForIllegalMediaSwitch(s)||(function(n,r){if(!n&&!r||!n&&r||n&&!r)return!1;if(n===r)return!0;var o=Object.keys(n).sort(),e=Object.keys(r).sort();if(o.length!==e.length)return!1;for(var s=0;s<o.length;s++){var u=o[s];if(u!==e[s]||n[u]!==r[u])return!1}return!0}(this.currentMediaInfo_,s=s||{})||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=s,this.currentMediaInfo_=s,this.logger_("trackinfo update",s),this.trigger("trackinfo")),!this.checkForAbort_(e.requestId)&&(this.pendingSegment_.trackInfo=s,this.hasEnoughInfoToAppend_()&&this.processCallQueue_())))},r.handleTimingInfo_=function(e,s,u,d){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){var m=this.pendingSegment_,g=C(s);m[g]=m[g]||{},m[g][u]=d,this.logger_("timinginfo: "+s+" - "+u+" - "+d),this.hasEnoughInfoToAppend_()&&this.processCallQueue_()}},r.handleCaptions_=function(e,s){var u=this;if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){if(0===s.length)return void this.logger_("SegmentLoader received no captions from a caption event");if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,e,s));var m=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),g={};s.forEach(function(T){g[T.stream]=g[T.stream]||{startTime:1/0,captions:[],endTime:0};var L=g[T.stream];L.startTime=Math.min(L.startTime,T.startTime+m),L.endTime=Math.max(L.endTime,T.endTime+m),L.captions.push(T)}),Object.keys(g).forEach(function(T){var L=g[T],P=L.startTime,q=L.endTime,le=L.captions,_e=u.inbandTextTracks_;u.logger_("adding cues from "+P+" -> "+q+" for "+T),function(n,r,o){if(!n[o]){r.trigger({type:"usage",name:"vhs-608"}),r.trigger({type:"usage",name:"hls-608"});var e=o;/^cc708_/.test(o)&&(e="SERVICE"+o.split("_")[1]);var s=r.textTracks().getTrackById(e);if(s)n[o]=s;else{var d=o,m=o,g=!1,T=(r.options_.vhs&&r.options_.vhs.captionServices||{})[e];T&&(d=T.label,m=T.language,g=T.default),n[o]=r.addRemoteTextTrack({kind:"captions",id:e,default:g,label:d,language:m},!1).track}}}(_e,u.vhs_.tech_,T),oc(P,q,_e[T]),function(n){var r=n.inbandTextTracks,o=n.captionArray,e=n.timestampOffset;if(o){var s=window.WebKitDataCue||window.VTTCue;o.forEach(function(u){r[u.stream].addCue(new s(u.startTime+e,u.endTime+e,u.text))})}}({captionArray:le,inbandTextTracks:_e,timestampOffset:m})}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})}},r.handleId3_=function(e,s,u){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){if(!this.pendingSegment_.hasAppendedData_)return void this.metadataQueue_.id3.push(this.handleId3_.bind(this,e,s,u));var m=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset();(function(n,r,o){n.metadataTrack_||(n.metadataTrack_=o.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,n.metadataTrack_.inBandMetadataTrackDispatchType=r)})(this.inbandTextTracks_,u,this.vhs_.tech_),function(n){var o=n.metadataArray,e=n.timestampOffset,s=n.videoDuration;if(o){var u=window.WebKitDataCue||window.VTTCue,d=n.inbandTextTracks.metadataTrack_;if(d&&(o.forEach(function(q){var le=q.cueTime+e;"number"!=typeof le||window.isNaN(le)||le<0||!(le<1/0)||q.frames.forEach(function(_e){var ge=new u(le,le,_e.value||_e.url||_e.data||"");ge.frame=_e,ge.value=_e,function(n){Object.defineProperties(n.frame,{id:{get:function(){return ct.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),n.value.key}},value:{get:function(){return ct.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),n.value.data}},privateData:{get:function(){return ct.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),n.value.data}}})}(ge),d.addCue(ge)})}),d.cues&&d.cues.length)){for(var m=d.cues,g=[],T=0;T<m.length;T++)m[T]&&g.push(m[T]);var L=g.reduce(function(q,le){var _e=q[le.startTime]||[];return _e.push(le),q[le.startTime]=_e,q},{}),P=Object.keys(L).sort(function(q,le){return Number(q)-Number(le)});P.forEach(function(q,le){var _e=L[q],ge=Number(P[le+1])||s;_e.forEach(function(rt){rt.endTime=ge})})}}}({inbandTextTracks:this.inbandTextTracks_,metadataArray:s,timestampOffset:m,videoDuration:this.duration_()})}},r.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(e){return e()}),this.metadataQueue_.caption.forEach(function(e){return e()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},r.processCallQueue_=function(){var e=this.callQueue_;this.callQueue_=[],e.forEach(function(s){return s()})},r.processLoadQueue_=function(){var e=this.loadQueue_;this.loadQueue_=[],e.forEach(function(s){return s()})},r.hasEnoughInfoToLoad_=function(){if("audio"!==this.loaderType_)return!0;var e=this.pendingSegment_;return!(!e||this.getCurrentMediaInfo_()&&R({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},r.getCurrentMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),e&&e.trackInfo||this.currentMediaInfo_},r.getMediaInfo_=function(e){return void 0===e&&(e=this.pendingSegment_),this.getCurrentMediaInfo_(e)||this.startingMediaInfo_},r.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready()||this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var e=this.pendingSegment_,s=this.getCurrentMediaInfo_();return!(!e||!s||s.hasVideo&&!e.videoTimingInfo||s.hasAudio&&!this.audioDisabled_&&!s.isMuxed&&!e.audioTimingInfo||R({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:e.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},r.handleData_=function(e,s){if(this.earlyAbortWhenNeeded_(e.stats),!this.checkForAbort_(e.requestId)){if(this.callQueue_.length||!this.hasEnoughInfoToAppend_())return void this.callQueue_.push(this.handleData_.bind(this,e,s));var u=this.pendingSegment_;if(this.setTimeMapping_(u.timeline),this.updateMediaSecondsLoaded_(u.part||u.segment),"closed"!==this.mediaSource_.readyState){if(e.map&&(e.map=this.initSegmentForMap(e.map,!0),u.segment.map=e.map),e.key&&this.segmentKey(e.key,!0),u.isFmp4=e.isFmp4,u.timingInfo=u.timingInfo||{},u.isFmp4)this.trigger("fmp4"),u.timingInfo.start=u[C(s.type)].start;else{var g,d=this.getCurrentMediaInfo_(),m="main"===this.loaderType_&&d&&d.hasVideo;m&&(g=u.videoTimingInfo.start),u.timingInfo.start=this.trueSegmentStart_({currentStart:u.timingInfo.start,playlist:u.playlist,mediaIndex:u.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:m,firstVideoFrameTimeForData:g,videoTimingInfo:u.videoTimingInfo,audioTimingInfo:u.audioTimingInfo})}if(this.updateAppendInitSegmentStatus(u,s.type),this.updateSourceBufferTimestampOffset_(u),u.isSyncRequest){this.updateTimingInfoEnd_(u),this.syncController_.saveSegmentTimingInfo({segmentInfo:u,shouldSaveTimelineMapping:"main"===this.loaderType_});var T=this.chooseNextRequest_();if(T.mediaIndex!==u.mediaIndex||T.partIndex!==u.partIndex)return void this.logger_("sync segment was incorrect, not appending");this.logger_("sync segment was correct, appending")}u.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(u,s)}}},r.updateAppendInitSegmentStatus=function(e,s){"main"===this.loaderType_&&"number"==typeof e.timestampOffset&&!e.changedTimestampOffset&&(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[s]!==e.playlist&&(this.appendInitSegment_[s]=!0)},r.getInitSegmentAndUpdateState_=function(e){var s=e.type,u=e.initSegment,d=e.map,m=e.playlist;if(d){var g=Ba(d);if(this.activeInitSegmentId_===g)return null;u=this.initSegmentForMap(d,!0).bytes,this.activeInitSegmentId_=g}return u&&this.appendInitSegment_[s]?(this.playlistOfLastInitSegment_[s]=m,this.appendInitSegment_[s]=!1,this.activeInitSegmentId_=null,u):null},r.handleQuotaExceededError_=function(e,s){var u=this,d=e.segmentInfo,m=e.type,g=e.bytes,T=this.sourceUpdater_.audioBuffered(),L=this.sourceUpdater_.videoBuffered();T.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Rn(T).join(", ")),L.length>1&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Rn(L).join(", "));var P=T.length?T.start(0):0,q=T.length?T.end(T.length-1):0,le=L.length?L.start(0):0,_e=L.length?L.end(L.length-1):0;if(q-P<=1&&_e-le<=1)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: "+g.byteLength+", audio buffer: "+Rn(T).join(", ")+", video buffer: "+Rn(L).join(", ")+", "),this.error({message:"Quota exceeded error with append of a single segment of content",excludeUntil:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:d,type:m,bytes:g}));var rt=this.currentTime_()-1;this.logger_("On QUOTA_EXCEEDED_ERR, removing audio/video from 0 to "+rt),this.remove(0,rt,function(){u.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),u.waitingOnRemove_=!1,u.quotaExceededErrorRetryTimeout_=window.setTimeout(function(){u.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),u.quotaExceededErrorRetryTimeout_=null,u.processCallQueue_()},1e3)},!0)},r.handleAppendError_=function(e,s){var u=e.segmentInfo,d=e.type,m=e.bytes;if(s){if(22===s.code)return void this.handleQuotaExceededError_({segmentInfo:u,type:d,bytes:m});this.logger_("Received non QUOTA_EXCEEDED_ERR on append",s),this.error(d+" append of "+m.length+"b failed for segment #"+u.mediaIndex+" in playlist "+u.playlist.id),this.trigger("appenderror")}},r.appendToSourceBuffer_=function(e){var s=e.segmentInfo,u=e.type,d=e.initSegment,m=e.data,g=e.bytes;if(!g){var T=[m],L=m.byteLength;d&&(T.unshift(d),L+=d.byteLength),g=function(n){var o,r=0;return n.bytes&&(o=new Uint8Array(n.bytes),n.segments.forEach(function(e){o.set(e,r),r+=e.byteLength})),o}({bytes:L,segments:T})}this.sourceUpdater_.appendBuffer({segmentInfo:s,type:u,bytes:g},this.handleAppendError_.bind(this,{segmentInfo:s,type:u,bytes:g}))},r.handleSegmentTimingInfo_=function(e,s,u){if(this.pendingSegment_&&s===this.pendingSegment_.requestId){var d=this.pendingSegment_.segment,m=e+"TimingInfo";d[m]||(d[m]={}),d[m].transmuxerPrependedSeconds=u.prependedContentDuration||0,d[m].transmuxedPresentationStart=u.start.presentation,d[m].transmuxedDecodeStart=u.start.decode,d[m].transmuxedPresentationEnd=u.end.presentation,d[m].transmuxedDecodeEnd=u.end.decode,d[m].baseMediaDecodeTime=u.baseMediaDecodeTime}},r.appendData_=function(e,s){var u=s.type,d=s.data;if(d&&d.byteLength&&("audio"!==u||!this.audioDisabled_)){var m=this.getInitSegmentAndUpdateState_({type:u,initSegment:s.initSegment,playlist:e.playlist,map:e.isFmp4?e.segment.map:null});this.appendToSourceBuffer_({segmentInfo:e,type:u,initSegment:m,data:d})}},r.loadSegment_=function(e){var s=this;this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push(function(){var u=Be({},e,{forceTimestampOffset:!0});Be(e,s.generateSegmentInfo_(u)),s.isPendingTimestampOffset_=!1,s.updateTransmuxerAndRequestSegment_(e)})},r.updateTransmuxerAndRequestSegment_=function(e){var s=this;this.shouldUpdateTransmuxerTimestampOffset_(e.timestampOffset)&&(this.gopBuffer_.length=0,e.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e.timestampOffset}));var u=this.createSimplifiedSegmentObj_(e),T=this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)||null!==this.mediaIndex&&e.timeline!==this.currentTimeline_&&e.timeline>0;this.logger_("Requesting "+A(e)),u.map&&!u.map.bytes&&(this.logger_("going to request init segment."),this.appendInitSegment_={video:!0,audio:!0}),e.abortRequests=vf({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:u,abortFn:this.handleAbort_.bind(this,e),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",e.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",e.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:T,endedTimelineFn:function(){s.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this),onTransmuxerLog:function(P){var q=P.message,le=P.level,_e=P.stream;s.logger_(A(e)+" logged from transmuxer stream "+_e+" as a "+le+": "+q)}})},r.trimBackBuffer_=function(e){var s=function(n,r,o){var e=r-Sr.BACK_BUFFER_LENGTH;return n.length&&(e=Math.max(e,n.start(0))),Math.min(r-o,e)}(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);s>0&&this.remove(0,s)},r.createSimplifiedSegmentObj_=function(e){var s=e.segment,u=e.part,d={resolvedUri:u?u.resolvedUri:s.resolvedUri,byterange:u?u.byterange:s.byterange,requestId:e.requestId,transmuxer:e.transmuxer,audioAppendStart:e.audioAppendStart,gopsToAlignWith:e.gopsToAlignWith,part:e.part},m=e.playlist.segments[e.mediaIndex-1];if(m&&m.timeline===s.timeline&&(m.videoTimingInfo?d.baseStartTime=m.videoTimingInfo.transmuxedDecodeEnd:m.audioTimingInfo&&(d.baseStartTime=m.audioTimingInfo.transmuxedDecodeEnd)),s.key){var g=s.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);d.key=this.segmentKey(s.key),d.key.iv=g}return s.map&&(d.map=this.initSegmentForMap(s.map)),d},r.saveTransferStats_=function(e){this.mediaRequests+=1,e&&(this.mediaBytesTransferred+=e.bytesReceived,this.mediaTransferDuration+=e.roundTripTime)},r.saveBandwidthRelatedStats_=function(e,s){this.pendingSegment_.byteLength=s.bytesReceived,e<p?this.logger_("Ignoring segment's bandwidth because its duration of "+e+" is less than the min to record "+p):(this.bandwidth=s.bandwidth,this.roundTrip=s.roundTripTime)},r.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")},r.segmentRequestFinished_=function(e,s,u){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,e,s,u));else if(this.saveTransferStats_(s.stats),this.pendingSegment_&&s.requestId===this.pendingSegment_.requestId){if(e){if(this.pendingSegment_=null,this.state="READY",-102===e.code)return;return this.pause(),-101===e.code?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error"))}var d=this.pendingSegment_;this.saveBandwidthRelatedStats_(d.duration,s.stats),d.endOfAllRequests=s.endOfAllRequests,u.gopInfo&&(this.gopBuffer_=function(n,r,o){if(!r.length)return n;if(o)return r.slice();for(var e=r[0].pts,s=0;s<n.length&&!(n[s].pts>=e);s++);return n.slice(0,s).concat(r)}(this.gopBuffer_,u.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(d)}},r.setTimeMapping_=function(e){var s=this.syncController_.mappingForTimeline(e);null!==s&&(this.timeMapping_=s)},r.updateMediaSecondsLoaded_=function(e){this.mediaSecondsLoaded+="number"==typeof e.start&&"number"==typeof e.end?e.end-e.start:e.duration},r.shouldUpdateTransmuxerTimestampOffset_=function(e){return null!==e&&("main"===this.loaderType_&&e!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&e!==this.sourceUpdater_.audioTimestampOffset())},r.trueSegmentStart_=function(e){var s=e.currentStart,d=e.mediaIndex,m=e.firstVideoFrameTimeForData;if(typeof s<"u")return s;if(!e.useVideoTimingInfo)return e.audioTimingInfo.start;var q=e.playlist.segments[d-1];return 0===d||!q||typeof q.start>"u"||q.end!==m+e.currentVideoTimestampOffset?m:e.videoTimingInfo.start},r.waitForAppendsToComplete_=function(e){var s=this.getCurrentMediaInfo_(e);if(!s)return this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),void this.trigger("error");var g="main"===this.loaderType_&&s.hasVideo,T=!this.audioDisabled_&&s.hasAudio&&!s.isMuxed;if(e.waitingOnAppends=0,!e.hasAppendedData_)return!e.timingInfo&&"number"==typeof e.timestampOffset&&(this.isPendingTimestampOffset_=!0),e.timingInfo={start:0},e.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(e),this.processMetadataQueue_()),void this.checkAppendsDone_(e);g&&e.waitingOnAppends++,T&&e.waitingOnAppends++,g&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,e)),T&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,e))},r.checkAppendsDone_=function(e){this.checkForAbort_(e.requestId)||(e.waitingOnAppends--,0===e.waitingOnAppends&&this.handleAppendsDone_())},r.checkForIllegalMediaSwitch=function(e){var s=function(n,r,o){return"main"===n&&r&&o?o.hasAudio||o.hasVideo?r.hasVideo&&!o.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!r.hasVideo&&o.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null}(this.loaderType_,this.getCurrentMediaInfo_(),e);return!!s&&(this.error({message:s,blacklistDuration:1/0}),this.trigger("error"),!0)},r.updateSourceBufferTimestampOffset_=function(e){if(null!==e.timestampOffset&&"number"==typeof e.timingInfo.start&&!e.changedTimestampOffset&&"main"===this.loaderType_){var s=!1;e.timestampOffset-=this.getSegmentStartTimeForTimestampOffsetCalculation_({videoTimingInfo:e.segment.videoTimingInfo,audioTimingInfo:e.segment.audioTimingInfo,timingInfo:e.timingInfo}),e.changedTimestampOffset=!0,e.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(e.timestampOffset),s=!0),e.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(e.timestampOffset),s=!0),s&&this.trigger("timestampoffset")}},r.getSegmentStartTimeForTimestampOffsetCalculation_=function(e){var s=e.videoTimingInfo,u=e.audioTimingInfo,d=e.timingInfo;return this.useDtsForTimestampOffset_?s&&"number"==typeof s.transmuxedDecodeStart?s.transmuxedDecodeStart:u&&"number"==typeof u.transmuxedDecodeStart?u.transmuxedDecodeStart:d.start:d.start},r.updateTimingInfoEnd_=function(e){e.timingInfo=e.timingInfo||{};var s=this.getMediaInfo_(),d="main"===this.loaderType_&&s&&s.hasVideo&&e.videoTimingInfo?e.videoTimingInfo:e.audioTimingInfo;!d||(e.timingInfo.end="number"==typeof d.end?d.end:d.start+e.duration)},r.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_;this.updateTimingInfoEnd_(e),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:e,shouldSaveTimelineMapping:"main"===this.loaderType_});var s=function(n,r){if("hls"!==r)return null;var o=function(n){var r=0;return["video","audio"].forEach(function(o){var e=n[o+"TimingInfo"];if(e){var d,s=e.start,u=e.end;"bigint"==typeof s||"bigint"==typeof u?d=window.BigInt(u)-window.BigInt(s):"number"==typeof s&&"number"==typeof u&&(d=u-s),typeof d<"u"&&d>r&&(r=d)}}),"bigint"==typeof r&&r<Number.MAX_SAFE_INTEGER&&(r=Number(r)),r}({audioTimingInfo:n.audioTimingInfo,videoTimingInfo:n.videoTimingInfo});if(!o)return null;var e=n.playlist.targetDuration,s=z({segmentDuration:o,maxDuration:2*e}),u=z({segmentDuration:o,maxDuration:e});return s||u?{severity:s?"warn":"info",message:"Segment with index "+n.mediaIndex+" from playlist "+n.playlist.id+" has a duration of "+o+" when the reported duration is "+n.duration+" and the target duration is "+e+". For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1"}:null}(e,this.sourceType_);if(s&&("warn"===s.severity?ct.log.warn(s.message):this.logger_(s.message)),this.recordThroughput_(e),this.pendingSegment_=null,this.state="READY",!e.isSyncRequest||(this.trigger("syncinfoupdate"),e.hasAppendedData_)){this.logger_("Appended "+A(e)),this.addSegmentMetadataCue_(e),this.fetchAtBuffer_=!0,this.currentTimeline_!==e.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),"main"===this.loaderType_&&!this.audioDisabled_&&this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:e.timeline})),this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate");var u=e.segment,d=e.part,m=u.end&&this.currentTime_()-u.end>3*e.playlist.targetDuration,g=d&&d.end&&this.currentTime_()-d.end>3*e.playlist.partTargetDuration;if(m||g)return this.logger_("bad "+(m?"segment":"part")+" "+A(e)),void this.resetEverything();null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=e.mediaIndex,this.partIndex=e.partIndex,this.isEndOfStream_(e.mediaIndex,e.playlist,e.partIndex)&&this.endOfStream(),this.trigger("appended"),e.hasAppendedData_&&this.mediaAppends++,this.paused()||this.monitorBuffer_()}else this.logger_("Throwing away un-appended sync request "+A(e))},r.recordThroughput_=function(e){if(e.duration<p)this.logger_("Ignoring segment's throughput because its duration of "+e.duration+" is less than the min to record "+p);else{var s=this.throughput.rate,u=Date.now()-e.endOfAllRequests+1,d=Math.floor(e.byteLength/u*8*1e3);this.throughput.rate+=(d-s)/++this.throughput.count}},r.addSegmentMetadataCue_=function(e){if(this.segmentMetadataTrack_){var s=e.segment,u=s.start,d=s.end;if(f(u)&&f(d)){oc(u,d,this.segmentMetadataTrack_);var m=window.WebKitDataCue||window.VTTCue,g={custom:s.custom,dateTimeObject:s.dateTimeObject,dateTimeString:s.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.id,start:u,end:d},L=new m(u,d,JSON.stringify(g));L.value=g,this.segmentMetadataTrack_.addCue(L)}}},n}(ct.EventTarget);function V(){}var Wt,U=function(n){return"string"!=typeof n?n:n.replace(/./,function(r){return r.toUpperCase()})},je=["video","audio"],Ze=function(n,r){var o=r[n+"Buffer"];return o&&o.updating||r.queuePending[n]},Ie=function c(n,r){if(0!==r.queue.length){var o=0,e=r.queue[o];if("mediaSource"===e.type)return void(!r.updating()&&"closed"!==r.mediaSource.readyState&&(r.queue.shift(),e.action(r),e.doneFn&&e.doneFn(),c("audio",r),c("video",r)));if("mediaSource"!==n&&r.ready()&&"closed"!==r.mediaSource.readyState&&!Ze(n,r)){if(e.type!==n){if(o=function(n,r){for(var o=0;o<r.length;o++){var e=r[o];if("mediaSource"===e.type)return null;if(e.type===n)return o}return null}(n,r.queue),null===o)return;e=r.queue[o]}if(r.queue.splice(o,1),r.queuePending[n]=e,e.action(n,r),!e.doneFn)return r.queuePending[n]=null,void c(n,r)}}},it=function(n,r){var o=r[n+"Buffer"],e=U(n);!o||(o.removeEventListener("updateend",r["on"+e+"UpdateEnd_"]),o.removeEventListener("error",r["on"+e+"Error_"]),r.codecs[n]=null,r[n+"Buffer"]=null)},Gt=function(n,r){return n&&r&&-1!==Array.prototype.indexOf.call(n.sourceBuffers,r)},ht_appendBuffer=function(n,r,o){return function(e,s){var u=s[e+"Buffer"];if(Gt(s.mediaSource,u)){s.logger_("Appending segment "+r.mediaIndex+"'s "+n.length+" bytes to "+e+"Buffer");try{u.appendBuffer(n)}catch(d){s.logger_("Error with code "+d.code+" "+(22===d.code?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment "+r.mediaIndex+" to "+e+"Buffer"),s.queuePending[e]=null,o(d)}}}},ht_remove=function(n,r){return function(o,e){var s=e[o+"Buffer"];if(Gt(e.mediaSource,s)){e.logger_("Removing "+n+" to "+r+" from "+o+"Buffer");try{s.remove(n,r)}catch{e.logger_("Remove "+n+" to "+r+" from "+o+"Buffer failed")}}}},ht_timestampOffset=function(n){return function(r,o){var e=o[r+"Buffer"];!Gt(o.mediaSource,e)||(o.logger_("Setting "+r+"timestampOffset to "+n),e.timestampOffset=n)}},ht_callback=function(n){return function(r,o){n()}},ht_endOfStream=function(n){return function(r){if("open"===r.mediaSource.readyState){r.logger_("Calling mediaSource endOfStream("+(n||"")+")");try{r.mediaSource.endOfStream(n)}catch(o){ct.log.warn("Failed to call media source endOfStream",o)}}}},ht_duration=function(n){return function(r){r.logger_("Setting mediaSource duration to "+n);try{r.mediaSource.duration=n}catch(o){ct.log.warn("Failed to set media source duration",o)}}},ht_addSourceBuffer=function(n,r){return function(o){var e=U(n),s=Su(r);o.logger_("Adding "+n+"Buffer with codec "+r+" to mediaSource");var u=o.mediaSource.addSourceBuffer(s);u.addEventListener("updateend",o["on"+e+"UpdateEnd_"]),u.addEventListener("error",o["on"+e+"Error_"]),o.codecs[n]=r,o[n+"Buffer"]=u}},ht_removeSourceBuffer=function(n){return function(r){var o=r[n+"Buffer"];if(it(n,r),Gt(r.mediaSource,o)){r.logger_("Removing "+n+"Buffer with codec "+r.codecs[n]+" from mediaSource");try{r.mediaSource.removeSourceBuffer(o)}catch(e){ct.log.warn("Failed to removeSourceBuffer "+n+"Buffer",e)}}}},ht_changeType=function(n){return function(r,o){var e=o[r+"Buffer"],s=Su(n);!Gt(o.mediaSource,e)||o.codecs[r]!==n&&(o.logger_("changing "+r+"Buffer codec from "+o.codecs[r]+" to "+n),e.changeType(s),o.codecs[r]=n)}},At=function(n){var r=n.type,o=n.sourceUpdater;o.queue.push({type:r,action:n.action,doneFn:n.doneFn,name:n.name}),Ie(r,o)},Lt=function(n,r){return function(o){if(r.queuePending[n]){var e=r.queuePending[n].doneFn;r.queuePending[n]=null,e&&e(r[n+"Error_"])}Ie(n,r)}},Yt=function(c){function n(o){var e;return(e=c.call(this)||this).mediaSource=o,e.sourceopenListener_=function(){return Ie("mediaSource",qi(e))},e.mediaSource.addEventListener("sourceopen",e.sourceopenListener_),e.logger_=na("SourceUpdater"),e.audioTimestampOffset_=0,e.videoTimestampOffset_=0,e.queue=[],e.queuePending={audio:null,video:null},e.delayedAudioAppendQueue_=[],e.videoAppendQueued_=!1,e.codecs={},e.onVideoUpdateEnd_=Lt("video",qi(e)),e.onAudioUpdateEnd_=Lt("audio",qi(e)),e.onVideoError_=function(s){e.videoError_=s},e.onAudioError_=function(s){e.audioError_=s},e.createdSourceBuffers_=!1,e.initializedEme_=!1,e.triggeredReady_=!1,e}Ti(n,c);var r=n.prototype;return r.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},r.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},r.hasInitializedAnyEme=function(){return this.initializedEme_},r.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},r.createSourceBuffers=function(e){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(e),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},r.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},r.addSourceBuffer=function(e,s){At({type:"mediaSource",sourceUpdater:this,action:ht_addSourceBuffer(e,s),name:"addSourceBuffer"})},r.abort=function(e){At({type:e,sourceUpdater:this,action:function(n,r){if("open"===r.mediaSource.readyState){var o=r[n+"Buffer"];if(Gt(r.mediaSource,o)){r.logger_("calling abort on "+n+"Buffer");try{o.abort()}catch(e){ct.log.warn("Failed to abort on "+n+"Buffer",e)}}}},name:"abort"})},r.removeSourceBuffer=function(e){this.canRemoveSourceBuffer()?At({type:"mediaSource",sourceUpdater:this,action:ht_removeSourceBuffer(e),name:"removeSourceBuffer"}):ct.log.error("removeSourceBuffer is not supported!")},r.canRemoveSourceBuffer=function(){return!ct.browser.IE_VERSION&&!ct.browser.IS_FIREFOX&&window.MediaSource&&window.MediaSource.prototype&&"function"==typeof window.MediaSource.prototype.removeSourceBuffer},n.canChangeType=function(){return window.SourceBuffer&&window.SourceBuffer.prototype&&"function"==typeof window.SourceBuffer.prototype.changeType},r.canChangeType=function(){return this.constructor.canChangeType()},r.changeType=function(e,s){this.canChangeType()?At({type:e,sourceUpdater:this,action:ht_changeType(s),name:"changeType"}):ct.log.error("changeType is not supported!")},r.addOrChangeSourceBuffers=function(e){var s=this;if(!e||"object"!=typeof e||0===Object.keys(e).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(e).forEach(function(u){var d=e[u];if(!s.hasCreatedSourceBuffers())return s.addSourceBuffer(u,d);s.canChangeType()&&s.changeType(u,d)})},r.appendBuffer=function(e,s){var u=this,d=e.segmentInfo,m=e.type,g=e.bytes;if(this.processedAppend_=!0,"audio"===m&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([e,s]),void this.logger_("delayed audio append of "+g.length+" until video append");if(At({type:m,sourceUpdater:this,action:ht_appendBuffer(g,d||{mediaIndex:-1},s),doneFn:s,name:"appendBuffer"}),"video"===m){if(this.videoAppendQueued_=!0,!this.delayedAudioAppendQueue_.length)return;var L=this.delayedAudioAppendQueue_.slice();this.logger_("queuing delayed audio "+L.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,L.forEach(function(P){u.appendBuffer.apply(u,P)})}},r.audioBuffered=function(){return Gt(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:ct.createTimeRange()},r.videoBuffered=function(){return Gt(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:ct.createTimeRange()},r.buffered=function(){var e=Gt(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,s=Gt(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return s&&!e?this.audioBuffered():e&&!s?this.videoBuffered():function(n,r){var o=null,e=null,s=0,u=[],d=[];if(!(n&&n.length&&r&&r.length))return ct.createTimeRange();for(var m=n.length;m--;)u.push({time:n.start(m),type:"start"}),u.push({time:n.end(m),type:"end"});for(m=r.length;m--;)u.push({time:r.start(m),type:"start"}),u.push({time:r.end(m),type:"end"});for(u.sort(function(g,T){return g.time-T.time}),m=0;m<u.length;m++)"start"===u[m].type?2==++s&&(o=u[m].time):"end"===u[m].type&&1==--s&&(e=u[m].time),null!==o&&null!==e&&(d.push([o,e]),o=null,e=null);return ct.createTimeRanges(d)}(this.audioBuffered(),this.videoBuffered())},r.setDuration=function(e,s){void 0===s&&(s=V),At({type:"mediaSource",sourceUpdater:this,action:ht_duration(e),name:"duration",doneFn:s})},r.endOfStream=function(e,s){void 0===e&&(e=null),void 0===s&&(s=V),"string"!=typeof e&&(e=void 0),At({type:"mediaSource",sourceUpdater:this,action:ht_endOfStream(e),name:"endOfStream",doneFn:s})},r.removeAudio=function(e,s,u){void 0===u&&(u=V),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?At({type:"audio",sourceUpdater:this,action:ht_remove(e,s),doneFn:u,name:"remove"}):u()},r.removeVideo=function(e,s,u){void 0===u&&(u=V),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?At({type:"video",sourceUpdater:this,action:ht_remove(e,s),doneFn:u,name:"remove"}):u()},r.updating=function(){return!(!Ze("audio",this)&&!Ze("video",this))},r.audioTimestampOffset=function(e){return typeof e<"u"&&this.audioBuffer&&this.audioTimestampOffset_!==e&&(At({type:"audio",sourceUpdater:this,action:ht_timestampOffset(e),name:"timestampOffset"}),this.audioTimestampOffset_=e),this.audioTimestampOffset_},r.videoTimestampOffset=function(e){return typeof e<"u"&&this.videoBuffer&&this.videoTimestampOffset!==e&&(At({type:"video",sourceUpdater:this,action:ht_timestampOffset(e),name:"timestampOffset"}),this.videoTimestampOffset_=e),this.videoTimestampOffset_},r.audioQueueCallback=function(e){!this.audioBuffer||At({type:"audio",sourceUpdater:this,action:ht_callback(e),name:"callback"})},r.videoQueueCallback=function(e){!this.videoBuffer||At({type:"video",sourceUpdater:this,action:ht_callback(e),name:"callback"})},r.dispose=function(){var e=this;this.trigger("dispose"),je.forEach(function(s){e.abort(s),e.canRemoveSourceBuffer()?e.removeSourceBuffer(s):e[s+"QueueCallback"](function(){return it(s,e)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},n}(ct.EventTarget),Rt=function(n){return decodeURIComponent(escape(String.fromCharCode.apply(null,n)))},qe=new Uint8Array("\n\n".split("").map(function(c){return c.charCodeAt(0)})),ut=function(c){function n(o,e){var s;return void 0===e&&(e={}),(s=c.call(this,o,e)||this).mediaSource_=null,s.subtitlesTrack_=null,s.loaderType_="subtitle",s.featuresNativeTextTracks_=o.featuresNativeTextTracks,s.shouldSaveSegmentTimingInfo_=!1,s}Ti(n,c);var r=n.prototype;return r.createTransmuxer_=function(){return null},r.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return ct.createTimeRanges();var e=this.subtitlesTrack_.cues;return ct.createTimeRanges([[e[0].startTime,e[e.length-1].startTime]])},r.initSegmentForMap=function(e,s){if(void 0===s&&(s=!1),!e)return null;var u=Ba(e),d=this.initSegments_[u];if(s&&!d&&e.bytes){var g=new Uint8Array(qe.byteLength+e.bytes.byteLength);g.set(e.bytes),g.set(qe,e.bytes.byteLength),this.initSegments_[u]=d={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:g}}return d||e},r.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},r.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},r.track=function(e){return typeof e>"u"||(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_},r.remove=function(e,s){oc(e,s,this.subtitlesTrack_)},r.fillBuffer_=function(){var e=this,s=this.chooseNextRequest_();if(s){if(null===this.syncController_.timestampOffsetForTimeline(s.timeline))return this.syncController_.one("timestampoffset",function(){e.state="READY",e.paused()||e.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE");this.loadSegment_(s)}},r.timestampOffsetForSegment_=function(){return null},r.chooseNextRequest_=function(){return this.skipEmptySegments_(c.prototype.chooseNextRequest_.call(this))},r.skipEmptySegments_=function(e){for(;e&&e.segment.empty;){if(e.mediaIndex+1>=e.playlist.segments.length){e=null;break}e=this.generateSegmentInfo_({playlist:e.playlist,mediaIndex:e.mediaIndex+1,startOfSegment:e.startOfSegment+e.duration,isSyncRequest:e.isSyncRequest})}return e},r.stopForError=function(e){this.error(e),this.state="READY",this.pause(),this.trigger("error")},r.segmentRequestFinished_=function(e,s,u){var d=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(s.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(e)return-101===e.code&&this.handleTimeout_(),-102===e.code?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(e);var m=this.pendingSegment_;this.saveBandwidthRelatedStats_(m.duration,s.stats),s.key&&this.segmentKey(s.key,!0),this.state="APPENDING",this.trigger("appending");var g=m.segment;if(g.map&&(g.map.bytes=s.map.bytes),m.bytes=s.bytes,"function"!=typeof window.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var T,L=function(){d.subtitlesTrack_.tech_.off("vttjsloaded",T),d.stopForError({message:"Error loading vtt.js"})};return T=function(){d.subtitlesTrack_.tech_.off("vttjserror",L),d.segmentRequestFinished_(e,s,u)},this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",T),void this.subtitlesTrack_.tech_.one("vttjserror",L)}g.requested=!0;try{this.parseVTTCues_(m)}catch(P){return void this.stopForError({message:P.message})}if(this.updateTimeMapping_(m,this.syncController_.timelines[m.timeline],this.playlist_),m.timingInfo=m.cues.length?{start:m.cues[0].startTime,end:m.cues[m.cues.length-1].endTime}:{start:m.startOfSegment,end:m.startOfSegment+m.duration},m.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");m.byteLength=m.bytes.byteLength,this.mediaSecondsLoaded+=g.duration,m.cues.forEach(function(P){d.subtitlesTrack_.addCue(d.featuresNativeTextTracks_?new window.VTTCue(P.startTime,P.endTime,P.text):P)}),function(n){var r=n.cues;if(r)for(var o=0;o<r.length;o++){for(var e=[],s=0,u=0;u<r.length;u++)r[o].startTime===r[u].startTime&&r[o].endTime===r[u].endTime&&r[o].text===r[u].text&&++s>1&&e.push(r[u]);e.length&&e.forEach(function(d){return n.removeCue(d)})}}(this.subtitlesTrack_),this.handleAppendsDone_()}else this.state="READY"},r.handleData_=function(){},r.updateTimingInfoEnd_=function(){},r.parseVTTCues_=function(e){var s,u=!1;"function"==typeof window.TextDecoder?s=new window.TextDecoder("utf8"):(s=window.WebVTT.StringDecoder(),u=!0);var d=new window.WebVTT.Parser(window,window.vttjs,s);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},d.oncue=e.cues.push.bind(e.cues),d.ontimestampmap=function(T){e.timestampmap=T},d.onparsingerror=function(T){ct.log.warn("Error encountered when parsing cues: "+T.message)},e.segment.map){var m=e.segment.map.bytes;u&&(m=Rt(m)),d.parse(m)}var g=e.bytes;u&&(g=Rt(g)),d.parse(g),d.flush()},r.updateTimeMapping_=function(e,s,u){var d=e.segment;if(s){if(!e.cues.length)return void(d.empty=!0);var m=e.timestampmap,g=m.MPEGTS/mh-m.LOCAL+s.mapping;e.cues.forEach(function(P){P.startTime+=g,P.endTime+=g}),u.syncInfo||(u.syncInfo={mediaSequence:u.mediaSequence+e.mediaIndex,time:Math.min(e.cues[0].startTime,e.cues[e.cues.length-1].startTime-d.duration)})}},n}(ce),xt=function(n,r){for(var o=n.cues,e=0;e<o.length;e++){var s=o[e];if(r>=s.adStartTime&&r<=s.adEndTime)return s}return null},ri=[{name:"VOD",run:function(n,r,o,e,s){return o!==1/0?{time:0,segmentIndex:0,partIndex:null}:null}},{name:"ProgramDateTime",run:function(n,r,o,e,s){if(!Object.keys(n.timelineToDatetimeMappings).length)return null;var u=null,d=null,m=Qu(r);s=s||0;for(var g=0;g<m.length;g++){var L=m[r.endList||0===s?g:m.length-(g+1)],P=L.segment,q=n.timelineToDatetimeMappings[P.timeline];if(q&&P.dateTimeObject){var _e=P.dateTimeObject.getTime()/1e3+q;if(P.parts&&"number"==typeof L.partIndex)for(var ge=0;ge<L.partIndex;ge++)_e+=P.parts[ge].duration;var rt=Math.abs(s-_e);if(null!==d&&(0===rt||d<rt))break;d=rt,u={time:_e,segmentIndex:L.segmentIndex,partIndex:L.partIndex}}}return u}},{name:"Segment",run:function(n,r,o,e,s){var u=null,d=null;s=s||0;for(var m=Qu(r),g=0;g<m.length;g++){var L=m[r.endList||0===s?g:m.length-(g+1)],P=L.segment,q=L.part&&L.part.start||P&&P.start;if(P.timeline===e&&typeof q<"u"){var le=Math.abs(s-q);if(null!==d&&d<le)break;(!u||null===d||d>=le)&&(d=le,u={time:q,segmentIndex:L.segmentIndex,partIndex:L.partIndex})}}return u}},{name:"Discontinuity",run:function(n,r,o,e,s){var u=null;if(s=s||0,r.discontinuityStarts&&r.discontinuityStarts.length)for(var d=null,m=0;m<r.discontinuityStarts.length;m++){var g=r.discontinuityStarts[m],L=n.discontinuities[r.discontinuitySequence+m+1];if(L){var P=Math.abs(s-L.time);if(null!==d&&d<P)break;(!u||null===d||d>=P)&&(d=P,u={time:L.time,segmentIndex:g,partIndex:null})}}return u}},{name:"Playlist",run:function(n,r,o,e,s){return r.syncInfo?{time:r.syncInfo.time,segmentIndex:r.syncInfo.mediaSequence-r.mediaSequence,partIndex:null}:null}}],di=function(c){function n(o){var e;return(e=c.call(this)||this).timelines=[],e.discontinuities=[],e.timelineToDatetimeMappings={},e.logger_=na("SyncController"),e}Ti(n,c);var r=n.prototype;return r.getSyncPoint=function(e,s,u,d){var m=this.runStrategies_(e,s,u,d);return m.length?this.selectSyncPoint_(m,{key:"time",value:d}):null},r.getExpiredTime=function(e,s){if(!e||!e.segments)return null;var u=this.runStrategies_(e,s,e.discontinuitySequence,0);if(!u.length)return null;var d=this.selectSyncPoint_(u,{key:"segmentIndex",value:0});return d.segmentIndex>0&&(d.time*=-1),Math.abs(d.time+Ku({defaultDuration:e.targetDuration,durationList:e.segments,startIndex:d.segmentIndex,endIndex:0}))},r.runStrategies_=function(e,s,u,d){for(var m=[],g=0;g<ri.length;g++){var T=ri[g],L=T.run(this,e,s,u,d);L&&(L.strategy=T.name,m.push({strategy:T.name,syncPoint:L}))}return m},r.selectSyncPoint_=function(e,s){for(var u=e[0].syncPoint,d=Math.abs(e[0].syncPoint[s.key]-s.value),m=e[0].strategy,g=1;g<e.length;g++){var T=Math.abs(e[g].syncPoint[s.key]-s.value);T<d&&(d=T,u=e[g].syncPoint,m=e[g].strategy)}return this.logger_("syncPoint for ["+s.key+": "+s.value+"] chosen with strategy ["+m+"]: [time:"+u.time+", segmentIndex:"+u.segmentIndex+("number"==typeof u.partIndex?",partIndex:"+u.partIndex:"")+"]"),u},r.saveExpiredSegmentInfo=function(e,s){var u=s.mediaSequence-e.mediaSequence;if(u>86400)ct.log.warn("Not saving expired segment info. Media sequence gap "+u+" is too large.");else for(var d=u-1;d>=0;d--){var m=e.segments[d];if(m&&typeof m.start<"u"){s.syncInfo={mediaSequence:e.mediaSequence+d,time:m.start},this.logger_("playlist refresh sync: [time:"+s.syncInfo.time+", mediaSequence: "+s.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},r.setDateTimeMappingForStart=function(e){if(this.timelineToDatetimeMappings={},e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var s=e.segments[0],u=s.dateTimeObject.getTime()/1e3;this.timelineToDatetimeMappings[s.timeline]=-u}},r.saveSegmentTimingInfo=function(e){var s=e.segmentInfo,u=e.shouldSaveTimelineMapping,d=this.calculateSegmentTimeMapping_(s,s.timingInfo,u),m=s.segment;d&&(this.saveDiscontinuitySyncInfo_(s),s.playlist.syncInfo||(s.playlist.syncInfo={mediaSequence:s.playlist.mediaSequence+s.mediaIndex,time:m.start}));var g=m.dateTimeObject;m.discontinuity&&u&&g&&(this.timelineToDatetimeMappings[m.timeline]=-g.getTime()/1e3)},r.timestampOffsetForTimeline=function(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].time},r.mappingForTimeline=function(e){return typeof this.timelines[e]>"u"?null:this.timelines[e].mapping},r.calculateSegmentTimeMapping_=function(e,s,u){var T,L,d=e.segment,m=e.part,g=this.timelines[e.timeline];if("number"==typeof e.timestampOffset)g={time:e.startOfSegment,mapping:e.startOfSegment-s.start},u&&(this.timelines[e.timeline]=g,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": [time: "+g.time+"] [mapping: "+g.mapping+"]")),T=e.startOfSegment,L=s.end+g.mapping;else{if(!g)return!1;T=s.start+g.mapping,L=s.end+g.mapping}return m&&(m.start=T,m.end=L),(!d.start||T<d.start)&&(d.start=T),d.end=L,!0},r.saveDiscontinuitySyncInfo_=function(e){var s=e.playlist,u=e.segment;if(u.discontinuity)this.discontinuities[u.timeline]={time:u.start,accuracy:0};else if(s.discontinuityStarts&&s.discontinuityStarts.length)for(var d=0;d<s.discontinuityStarts.length;d++){var m=s.discontinuityStarts[d],g=s.discontinuitySequence+d+1,T=m-e.mediaIndex,L=Math.abs(T);if(!this.discontinuities[g]||this.discontinuities[g].accuracy>L){var P;P=T<0?u.start-Ku({defaultDuration:s.targetDuration,durationList:s.segments,startIndex:e.mediaIndex,endIndex:m}):u.end+Ku({defaultDuration:s.targetDuration,durationList:s.segments,startIndex:e.mediaIndex+1,endIndex:m}),this.discontinuities[g]={time:P,accuracy:L}}}},r.dispose=function(){this.trigger("dispose"),this.off()},n}(ct.EventTarget),_i=function(c){function n(){var o;return(o=c.call(this)||this).pendingTimelineChanges_={},o.lastTimelineChanges_={},o}Ti(n,c);var r=n.prototype;return r.clearPendingTimelineChange=function(e){this.pendingTimelineChanges_[e]=null,this.trigger("pendingtimelinechange")},r.pendingTimelineChange=function(e){var s=e.type,u=e.from,d=e.to;return"number"==typeof u&&"number"==typeof d&&(this.pendingTimelineChanges_[s]={type:s,from:u,to:d},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[s]},r.lastTimelineChange=function(e){var s=e.type,u=e.from,d=e.to;return"number"==typeof u&&"number"==typeof d&&(this.lastTimelineChanges_[s]={type:s,from:u,to:d},delete this.pendingTimelineChanges_[s],this.trigger("timelinechange")),this.lastTimelineChanges_[s]},r.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},n}(ct.EventTarget),Yi=iv(nv(function(){var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function n(It,Bt,ci){return It(ci={path:Bt,exports:{},require:function(Mt,ai){return function r(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},ci.exports),ci.exports}var o=n(function(It){function Bt(Zt,Mt){for(var ai=0;ai<Mt.length;ai++){var qt=Mt[ai];qt.enumerable=qt.enumerable||!1,qt.configurable=!0,"value"in qt&&(qt.writable=!0),Object.defineProperty(Zt,qt.key,qt)}}It.exports=function ci(Zt,Mt,ai){return Mt&&Bt(Zt.prototype,Mt),ai&&Bt(Zt,ai),Zt},It.exports.default=It.exports,It.exports.__esModule=!0}),e=n(function(It){function Bt(ci,Zt){return It.exports=Bt=Object.setPrototypeOf||function(ai,qt){return ai.__proto__=qt,ai},It.exports.default=It.exports,It.exports.__esModule=!0,Bt(ci,Zt)}It.exports=Bt,It.exports.default=It.exports,It.exports.__esModule=!0}),s=n(function(It){It.exports=function Bt(ci,Zt){ci.prototype=Object.create(Zt.prototype),ci.prototype.constructor=ci,e(ci,Zt)},It.exports.default=It.exports,It.exports.__esModule=!0}),u=function(){function It(){this.listeners={}}var Bt=It.prototype;return Bt.on=function(Zt,Mt){this.listeners[Zt]||(this.listeners[Zt]=[]),this.listeners[Zt].push(Mt)},Bt.off=function(Zt,Mt){if(!this.listeners[Zt])return!1;var ai=this.listeners[Zt].indexOf(Mt);return this.listeners[Zt]=this.listeners[Zt].slice(0),this.listeners[Zt].splice(ai,1),ai>-1},Bt.trigger=function(Zt){var Mt=this.listeners[Zt];if(Mt)if(2===arguments.length)for(var ai=Mt.length,qt=0;qt<ai;++qt)Mt[qt].call(this,arguments[1]);else for(var gi=Array.prototype.slice.call(arguments,1),E=Mt.length,D=0;D<E;++D)Mt[D].apply(this,gi)},Bt.dispose=function(){this.listeners={}},Bt.pipe=function(Zt){this.on("data",function(Mt){Zt.push(Mt)})},It}(),g=null,T=function(){function It(ci){g||(g=function(){var qt,gi,E,J,xe,st,$t,Ft,Bt=[[[],[],[],[],[]],[[],[],[],[],[]]],ci=Bt[0],Zt=Bt[1],Mt=ci[4],ai=Zt[4],D=[],X=[];for(qt=0;qt<256;qt++)X[(D[qt]=qt<<1^283*(qt>>7))^qt]=qt;for(gi=E=0;!Mt[gi];gi^=J||1,E=X[E]||1)for(Mt[gi]=st=(st=E^E<<1^E<<2^E<<3^E<<4)>>8^255&st^99,ai[st]=gi,Ft=16843009*D[xe=D[J=D[gi]]]^65537*xe^257*J^16843008*gi,$t=257*D[st]^16843008*st,qt=0;qt<4;qt++)ci[qt][gi]=$t=$t<<24^$t>>>8,Zt[qt][st]=Ft=Ft<<24^Ft>>>8;for(qt=0;qt<5;qt++)ci[qt]=ci[qt].slice(0),Zt[qt]=Zt[qt].slice(0);return Bt}()),this._tables=[[g[0][0].slice(),g[0][1].slice(),g[0][2].slice(),g[0][3].slice(),g[0][4].slice()],[g[1][0].slice(),g[1][1].slice(),g[1][2].slice(),g[1][3].slice(),g[1][4].slice()]];var Zt,Mt,ai,qt=this._tables[0][4],gi=this._tables[1],E=ci.length,D=1;if(4!==E&&6!==E&&8!==E)throw new Error("Invalid aes key size");var X=ci.slice(0),J=[];for(this._key=[X,J],Zt=E;Zt<4*E+28;Zt++)ai=X[Zt-1],(Zt%E==0||8===E&&Zt%E==4)&&(ai=qt[ai>>>24]<<24^qt[ai>>16&255]<<16^qt[ai>>8&255]<<8^qt[255&ai],Zt%E==0&&(ai=ai<<8^ai>>>24^D<<24,D=D<<1^283*(D>>7))),X[Zt]=X[Zt-E]^ai;for(Mt=0;Zt;Mt++,Zt--)ai=X[3&Mt?Zt:Zt-4],J[Mt]=Zt<=4||Mt<4?ai:gi[0][qt[ai>>>24]]^gi[1][qt[ai>>16&255]]^gi[2][qt[ai>>8&255]]^gi[3][qt[255&ai]]}return It.prototype.decrypt=function(Zt,Mt,ai,qt,gi,E){var st,$t,Ft,Ot,D=this._key[1],X=Zt^D[0],J=qt^D[1],xe=ai^D[2],Xe=Mt^D[3],bt=D.length/4-2,hi=4,Bi=this._tables[1],ji=Bi[0],Ki=Bi[1],Sn=Bi[2],vn=Bi[3],pn=Bi[4];for(Ot=0;Ot<bt;Ot++)st=ji[X>>>24]^Ki[J>>16&255]^Sn[xe>>8&255]^vn[255&Xe]^D[hi],$t=ji[J>>>24]^Ki[xe>>16&255]^Sn[Xe>>8&255]^vn[255&X]^D[hi+1],Ft=ji[xe>>>24]^Ki[Xe>>16&255]^Sn[X>>8&255]^vn[255&J]^D[hi+2],Xe=ji[Xe>>>24]^Ki[X>>16&255]^Sn[J>>8&255]^vn[255&xe]^D[hi+3],hi+=4,X=st,J=$t,xe=Ft;for(Ot=0;Ot<4;Ot++)gi[(3&-Ot)+E]=pn[X>>>24]<<24^pn[J>>16&255]<<16^pn[xe>>8&255]<<8^pn[255&Xe]^D[hi++],st=X,X=J,J=xe,xe=Xe,Xe=st},It}(),L=function(It){function Bt(){var Zt;return(Zt=It.call(this,u)||this).jobs=[],Zt.delay=1,Zt.timeout_=null,Zt}s(Bt,It);var ci=Bt.prototype;return ci.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},ci.push=function(Mt){this.jobs.push(Mt),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},Bt}(u),P=function(Bt){return Bt<<24|(65280&Bt)<<8|(16711680&Bt)>>8|Bt>>>24},le=function(){function It(ci,Zt,Mt,ai){var qt=It.STEP,gi=new Int32Array(ci.buffer),E=new Uint8Array(ci.byteLength),D=0;for(this.asyncStream_=new L,this.asyncStream_.push(this.decryptChunk_(gi.subarray(D,D+qt),Zt,Mt,E)),D=qt;D<gi.length;D+=qt)Mt=new Uint32Array([P(gi[D-4]),P(gi[D-3]),P(gi[D-2]),P(gi[D-1])]),this.asyncStream_.push(this.decryptChunk_(gi.subarray(D,D+qt),Zt,Mt,E));this.asyncStream_.push(function(){ai(null,function d(It){return It.subarray(0,It.byteLength-It[It.byteLength-1])}(E))})}return It.prototype.decryptChunk_=function(Zt,Mt,ai,qt){return function(){var gi=function(Bt,ci,Zt){var E,D,X,J,xe,Xe,st,$t,Ft,Mt=new Int32Array(Bt.buffer,Bt.byteOffset,Bt.byteLength>>2),ai=new T(Array.prototype.slice.call(ci)),qt=new Uint8Array(Bt.byteLength),gi=new Int32Array(qt.buffer);for(E=Zt[0],D=Zt[1],X=Zt[2],J=Zt[3],Ft=0;Ft<Mt.length;Ft+=4)xe=P(Mt[Ft]),Xe=P(Mt[Ft+1]),st=P(Mt[Ft+2]),$t=P(Mt[Ft+3]),ai.decrypt(xe,Xe,st,$t,gi,Ft),gi[Ft]=P(gi[Ft]^E),gi[Ft+1]=P(gi[Ft+1]^D),gi[Ft+2]=P(gi[Ft+2]^X),gi[Ft+3]=P(gi[Ft+3]^J),E=xe,D=Xe,X=st,J=$t;return qt}(Zt,Mt,ai);qt.set(gi,Zt.byteOffset)}},o(It,null,[{key:"STEP",get:function(){return 32e3}}]),It}(),yt=(typeof window<"u"?window:typeof c<"u"?c:typeof self<"u"?self:{}).BigInt||Number;yt("0x1"),yt("0x100"),yt("0x10000"),yt("0x1000000"),yt("0x100000000"),yt("0x10000000000"),yt("0x1000000000000"),yt("0x100000000000000"),yt("0x10000000000000000");self.onmessage=function(It){var Bt=It.data,ci=new Uint8Array(Bt.encrypted.bytes,Bt.encrypted.byteOffset,Bt.encrypted.byteLength),Zt=new Uint32Array(Bt.key.bytes,Bt.key.byteOffset,Bt.key.byteLength/4),Mt=new Uint32Array(Bt.iv.bytes,Bt.iv.byteOffset,Bt.iv.byteLength/4);new le(ci,Zt,Mt,function(ai,qt){self.postMessage(function(Bt){var ci={};return Object.keys(Bt).forEach(function(Zt){var Mt=Bt[Zt];ci[Zt]=function(Bt){return"function"===ArrayBuffer.isView?ArrayBuffer.isView(Bt):Bt&&Bt.buffer instanceof ArrayBuffer}(Mt)?{bytes:Mt.buffer,byteOffset:Mt.byteOffset,byteLength:Mt.byteLength}:Mt}),ci}({source:Bt.source,decrypted:qt}),[qt.buffer])})}})),Ji=tv(Yi),Mn=function(n){var r=n.default?"main":"alternative";return n.characteristics&&n.characteristics.indexOf("public.accessibility.describes-video")>=0&&(r="main-desc"),r},Kt=function(n,r){n.abort(),n.pause(),r&&r.activePlaylistLoader&&(r.activePlaylistLoader.pause(),r.activePlaylistLoader=null)},Qn=function(n,r){r.activePlaylistLoader=n,n.load()},bn={AUDIO:function(n,r){return function(){var e=r.mediaTypes[n],s=r.blacklistCurrentPlaylist;Kt(r.segmentLoaders[n],e);var u=e.activeTrack(),d=e.activeGroup(),m=(d.filter(function(L){return L.default})[0]||d[0]).id,g=e.tracks[m];if(u!==g){for(var T in ct.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),e.tracks)e.tracks[T].enabled=e.tracks[T]===g;e.onTrackChanged()}else s({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(n,r){return function(){var o=r.segmentLoaders[n],e=r.mediaTypes[n];ct.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),Kt(o,e);var s=e.activeTrack();s&&(s.mode="disabled"),e.onTrackChanged()}}},mn={AUDIO:function(n,r,o){if(r){var e=o.tech,s=o.requestOptions,u=o.segmentLoaders[n];r.on("loadedmetadata",function(){var d=r.media();u.playlist(d,s),(!e.paused()||d.endList&&"none"!==e.preload())&&u.load()}),r.on("loadedplaylist",function(){u.playlist(r.media(),s),e.paused()||u.load()}),r.on("error",bn[n](n,o))}},SUBTITLES:function(n,r,o){var e=o.tech,s=o.requestOptions,u=o.segmentLoaders[n],d=o.mediaTypes[n];r.on("loadedmetadata",function(){var m=r.media();u.playlist(m,s),u.track(d.activeTrack()),(!e.paused()||m.endList&&"none"!==e.preload())&&u.load()}),r.on("loadedplaylist",function(){u.playlist(r.media(),s),e.paused()||u.load()}),r.on("error",bn[n](n,o))}},fi={AUDIO:function(n,r){var o=r.vhs,e=r.sourceType,s=r.segmentLoaders[n],u=r.requestOptions,d=r.master.mediaGroups,m=r.mediaTypes[n],g=m.groups,T=m.tracks,L=m.logger_,P=r.masterPlaylistLoader,q=Wi(P.master);for(var le in(!d[n]||0===Object.keys(d[n]).length)&&(d[n]={main:{default:{default:!0}}},q&&(d[n].main.default.playlists=P.master.playlists)),d[n])for(var _e in g[le]||(g[le]=[]),d[n][le]){var ge=d[n][le][_e],rt=void 0;if(q?(L("AUDIO group '"+le+"' label '"+_e+"' is a master playlist"),ge.isMasterPlaylist=!0,rt=null):rt="vhs-json"===e&&ge.playlists?new Lr(ge.playlists[0],o,u):ge.resolvedUri?new Lr(ge.resolvedUri,o,u):ge.playlists&&"dash"===e?new ic(ge.playlists[0],o,u,P):null,ge=ct.mergeOptions({id:_e,playlistLoader:rt},ge),mn[n](n,ge.playlistLoader,r),g[le].push(ge),typeof T[_e]>"u"){var yt=new ct.AudioTrack({id:_e,kind:Mn(ge),enabled:!1,language:ge.language,default:ge.default,label:_e});T[_e]=yt}}s.on("error",bn[n](n,r))},SUBTITLES:function(n,r){var o=r.tech,e=r.vhs,s=r.sourceType,u=r.segmentLoaders[n],d=r.requestOptions,m=r.master.mediaGroups,g=r.mediaTypes[n],T=g.groups,L=g.tracks,P=r.masterPlaylistLoader;for(var q in m[n])for(var le in T[q]||(T[q]=[]),m[n][q])if(!m[n][q][le].forced){var _e=m[n][q][le],ge=void 0;if("hls"===s)ge=new Lr(_e.resolvedUri,e,d);else if("dash"===s){if(!_e.playlists.filter(function(ni){return ni.excludeUntil!==1/0}).length)return;ge=new ic(_e.playlists[0],e,d,P)}else"vhs-json"===s&&(ge=new Lr(_e.playlists?_e.playlists[0]:_e.resolvedUri,e,d));if(_e=ct.mergeOptions({id:le,playlistLoader:ge},_e),mn[n](n,_e.playlistLoader,r),T[q].push(_e),typeof L[le]>"u"){var yt=o.addRemoteTextTrack({id:le,kind:"subtitles",default:_e.default&&_e.autoselect,language:_e.language,label:le},!1).track;L[le]=yt}}u.on("error",bn[n](n,r))},"CLOSED-CAPTIONS":function(n,r){var o=r.tech,e=r.master.mediaGroups,s=r.mediaTypes[n],u=s.groups,d=s.tracks;for(var m in e[n])for(var g in u[m]||(u[m]=[]),e[n][m]){var T=e[n][m][g];if(/^(?:CC|SERVICE)/.test(T.instreamId)){var L=o.options_.vhs&&o.options_.vhs.captionServices||{},P={label:g,language:T.language,instreamId:T.instreamId,default:T.default&&T.autoselect};if(L[P.instreamId]&&(P=ct.mergeOptions(P,L[P.instreamId])),void 0===P.default&&delete P.default,u[m].push(ct.mergeOptions({id:g},T)),typeof d[g]>"u"){var q=o.addRemoteTextTrack({id:P.instreamId,kind:"captions",default:P.default,language:P.language,label:P.label},!1).track;d[g]=q}}}}},xi=function c(n,r){for(var o=0;o<n.length;o++)if(Th(r,n[o])||n[o].playlists&&c(n[o].playlists,r))return!0;return!1},Ui={AUDIO:function(n,r){return function(){var o=r.mediaTypes[n].tracks;for(var e in o)if(o[e].enabled)return o[e];return null}},SUBTITLES:function(n,r){return function(){var o=r.mediaTypes[n].tracks;for(var e in o)if("showing"===o[e].mode||"hidden"===o[e].mode)return o[e];return null}}},ot=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred","mediaAppends"],pi=function(n){return this.audioSegmentLoader_[n]+this.mainSegmentLoader_[n]},Gi=function(c){function n(o){var e;e=c.call(this)||this;var s=o.src,u=o.handleManifestRedirects,d=o.withCredentials,m=o.tech,g=o.bandwidth,T=o.externVhs,L=o.useCueTags,P=o.blacklistDuration,q=o.enableLowInitialPlaylist,le=o.sourceType,_e=o.cacheEncryptionKeys,ge=o.experimentalBufferBasedABR,rt=o.experimentalLeastPixelDiffSelector,yt=o.captionServices;if(!s)throw new Error("A non-empty playlist URL or JSON manifest string is required");var ni=o.maxPlaylistRetries;(null===ni||typeof ni>"u")&&(ni=1/0),Wt=T,e.experimentalBufferBasedABR=Boolean(ge),e.experimentalLeastPixelDiffSelector=Boolean(rt),e.withCredentials=d,e.tech_=m,e.vhs_=m.vhs,e.sourceType_=le,e.useCueTags_=L,e.blacklistDuration=P,e.maxPlaylistRetries=ni,e.enableLowInitialPlaylist=q,e.useCueTags_&&(e.cueTagsTrack_=e.tech_.addTextTrack("metadata","ad-cues"),e.cueTagsTrack_.inBandMetadataTrackDispatchType=""),e.requestOptions_={withCredentials:d,handleManifestRedirects:u,maxPlaylistRetries:ni,timeout:null},e.on("error",e.pauseLoading),e.mediaTypes_=function(){var n={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(r){n[r]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:V,activeTrack:V,getActiveGroup:V,onGroupChanged:V,onTrackChanged:V,lastTrack_:null,logger_:na("MediaGroups["+r+"]")}}),n}(),e.mediaSource=new window.MediaSource,e.handleDurationChange_=e.handleDurationChange_.bind(qi(e)),e.handleSourceOpen_=e.handleSourceOpen_.bind(qi(e)),e.handleSourceEnded_=e.handleSourceEnded_.bind(qi(e)),e.mediaSource.addEventListener("durationchange",e.handleDurationChange_),e.mediaSource.addEventListener("sourceopen",e.handleSourceOpen_),e.mediaSource.addEventListener("sourceended",e.handleSourceEnded_),e.seekable_=ct.createTimeRanges(),e.hasPlayed_=!1,e.syncController_=new di(o),e.segmentMetadataTrack_=m.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,e.decrypter_=new Ji,e.sourceUpdater_=new Yt(e.mediaSource),e.inbandTextTracks_={},e.timelineChangeController_=new _i;var It={vhs:e.vhs_,parse708captions:o.parse708captions,useDtsForTimestampOffset:o.useDtsForTimestampOffset,captionServices:yt,mediaSource:e.mediaSource,currentTime:e.tech_.currentTime.bind(e.tech_),seekable:function(){return e.seekable()},seeking:function(){return e.tech_.seeking()},duration:function(){return e.duration()},hasPlayed:function(){return e.hasPlayed_},goalBufferLength:function(){return e.goalBufferLength()},bandwidth:g,syncController:e.syncController_,decrypter:e.decrypter_,sourceType:e.sourceType_,inbandTextTracks:e.inbandTextTracks_,cacheEncryptionKeys:_e,sourceUpdater:e.sourceUpdater_,timelineChangeController:e.timelineChangeController_,experimentalExactManifestTimings:o.experimentalExactManifestTimings};e.masterPlaylistLoader_="dash"===e.sourceType_?new ic(s,e.vhs_,e.requestOptions_):new Lr(s,e.vhs_,e.requestOptions_),e.setupMasterPlaylistLoaderListeners_(),e.mainSegmentLoader_=new ce(ct.mergeOptions(It,{segmentMetadataTrack:e.segmentMetadataTrack_,loaderType:"main"}),o),e.audioSegmentLoader_=new ce(ct.mergeOptions(It,{loaderType:"audio"}),o),e.subtitleSegmentLoader_=new ut(ct.mergeOptions(It,{loaderType:"vtt",featuresNativeTextTracks:e.tech_.featuresNativeTextTracks}),o),e.setupSegmentLoaderListeners_(),e.experimentalBufferBasedABR&&(e.masterPlaylistLoader_.one("loadedplaylist",function(){return e.startABRTimer_()}),e.tech_.on("pause",function(){return e.stopABRTimer_()}),e.tech_.on("play",function(){return e.startABRTimer_()})),ot.forEach(function(ci){e[ci+"_"]=pi.bind(qi(e),ci)}),e.logger_=na("MPC"),e.triggeredFmp4Usage=!1,"none"===e.tech_.preload()?(e.loadOnPlay_=function(){e.loadOnPlay_=null,e.masterPlaylistLoader_.load()},e.tech_.one("play",e.loadOnPlay_)):e.masterPlaylistLoader_.load(),e.timeToLoadedData__=-1,e.mainAppendsToLoadedData__=-1,e.audioAppendsToLoadedData__=-1;var Bt="none"===e.tech_.preload()?"play":"loadstart";return e.tech_.one(Bt,function(){var ci=Date.now();e.tech_.one("loadeddata",function(){e.timeToLoadedData__=Date.now()-ci,e.mainAppendsToLoadedData__=e.mainSegmentLoader_.mediaAppends,e.audioAppendsToLoadedData__=e.audioSegmentLoader_.mediaAppends})}),e}Ti(n,c);var r=n.prototype;return r.mainAppendsToLoadedData_=function(){return this.mainAppendsToLoadedData__},r.audioAppendsToLoadedData_=function(){return this.audioAppendsToLoadedData__},r.appendsToLoadedData_=function(){var e=this.mainAppendsToLoadedData_(),s=this.audioAppendsToLoadedData_();return-1===e||-1===s?-1:e+s},r.timeToLoadedData_=function(){return this.timeToLoadedData__},r.checkABR_=function(){var e=this.selectPlaylist();e&&this.shouldSwitchToMedia_(e)&&this.switchMedia_(e,"abr")},r.switchMedia_=function(e,s,u){var d=this.media(),m=d&&(d.id||d.uri),g=e.id||e.uri;m&&m!==g&&(this.logger_("switch media "+m+" -> "+g+" from "+s),this.tech_.trigger({type:"usage",name:"vhs-rendition-change-"+s})),this.masterPlaylistLoader_.media(e,u)},r.startABRTimer_=function(){var e=this;this.stopABRTimer_(),this.abrTimer_=window.setInterval(function(){return e.checkABR_()},250)},r.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(window.clearInterval(this.abrTimer_),this.abrTimer_=null)},r.getAudioTrackPlaylists_=function(){var e=this.master(),s=e&&e.playlists||[];if(!e||!e.mediaGroups||!e.mediaGroups.AUDIO)return s;var m,u=e.mediaGroups.AUDIO,d=Object.keys(u);if(Object.keys(this.mediaTypes_.AUDIO.groups).length)m=this.mediaTypes_.AUDIO.activeTrack();else{var g=u.main||d.length&&u[d[0]];for(var T in g)if(g[T].default){m={label:T};break}}if(!m)return s;var L=[];for(var P in u)if(u[P][m.label]){var q=u[P][m.label];if(q.playlists&&q.playlists.length)L.push.apply(L,q.playlists);else if(q.uri)L.push(q);else if(e.playlists.length)for(var le=0;le<e.playlists.length;le++){var _e=e.playlists[le];_e.attributes&&_e.attributes.AUDIO&&_e.attributes.AUDIO===P&&L.push(_e)}}return L.length?L:s},r.setupMasterPlaylistLoaderListeners_=function(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var s=e.masterPlaylistLoader_.media(),u=1.5*s.targetDuration*1e3;e.requestOptions_.timeout=Zu(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?0:u,s.endList&&"none"!==e.tech_.preload()&&(e.mainSegmentLoader_.playlist(s,e.requestOptions_),e.mainSegmentLoader_.load()),function(n){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(le){fi[le](le,n)});var r=n.mediaTypes,o=n.masterPlaylistLoader,e=n.tech,s=n.vhs,u=n.segmentLoaders,d=u.AUDIO,m=u.main;["AUDIO","SUBTITLES"].forEach(function(le){r[le].activeGroup=function(n,r){return function(o){var s=r.mediaTypes[n].groups,u=r.masterPlaylistLoader.media();if(!u)return null;var d=null;u.attributes[n]&&(d=s[u.attributes[n]]);var m=Object.keys(s);if(!d)if("AUDIO"===n&&m.length>1&&Wi(r.master))for(var g=0;g<m.length;g++){var T=s[m[g]];if(xi(T,u)){d=T;break}}else s.main?d=s.main:1===m.length&&(d=s[m[0]]);return typeof o>"u"?d:null!==o&&d&&d.filter(function(L){return L.id===o.id})[0]||null}}(le,n),r[le].activeTrack=Ui[le](le,n),r[le].onGroupChanged=function(n,r){return function(){var o=r.segmentLoaders,e=o[n],s=o.main,u=r.mediaTypes[n],d=u.activeTrack(),m=u.getActiveGroup(),g=u.activePlaylistLoader,T=u.lastGroup_;if((!m||!T||m.id!==T.id)&&(u.lastGroup_=m,u.lastTrack_=d,Kt(e,u),m&&!m.isMasterPlaylist)){if(!m.playlistLoader)return void(g&&s.resetEverything());e.resyncLoader(),Qn(m.playlistLoader,u)}}}(le,n),r[le].onGroupChanging=function(n,r){return function(){var o=r.segmentLoaders[n];r.mediaTypes[n].lastGroup_=null,o.abort(),o.pause()}}(le,n),r[le].onTrackChanged=function(n,r){return function(){var o=r.masterPlaylistLoader,e=r.segmentLoaders,s=e[n],u=e.main,d=r.mediaTypes[n],m=d.activeTrack(),g=d.getActiveGroup(),T=d.activePlaylistLoader,L=d.lastTrack_;if((!L||!m||L.id!==m.id)&&(d.lastGroup_=g,d.lastTrack_=m,Kt(s,d),g)){if(g.isMasterPlaylist){if(!m||!L||m.id===L.id)return;var P=r.vhs.masterPlaylistController_,q=P.selectPlaylist();if(P.media()===q)return;return d.logger_("track change. Switching master audio from "+L.id+" to "+m.id),o.pause(),u.resetEverything(),void P.fastQualityChange_(q)}if("AUDIO"===n){if(!g.playlistLoader)return u.setAudio(!0),void u.resetEverything();s.setAudio(!0),u.setAudio(!1)}if(T===g.playlistLoader)return void Qn(g.playlistLoader,d);s.track&&s.track(m),s.resetEverything(),Qn(g.playlistLoader,d)}}}(le,n),r[le].getActiveGroup=function(n,r){var o=r.mediaTypes;return function(){var e=o[n].activeTrack();return e?o[n].activeGroup(e):null}}(le,n)});var g=r.AUDIO.activeGroup();if(g){var T=(g.filter(function(le){return le.default})[0]||g[0]).id;r.AUDIO.tracks[T].enabled=!0,r.AUDIO.onGroupChanged(),r.AUDIO.onTrackChanged(),r.AUDIO.getActiveGroup().playlistLoader?(m.setAudio(!1),d.setAudio(!0)):m.setAudio(!0)}o.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(le){return r[le].onGroupChanged()})}),o.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(le){return r[le].onGroupChanging()})});var P=function(){r.AUDIO.onTrackChanged(),e.trigger({type:"usage",name:"vhs-audio-change"}),e.trigger({type:"usage",name:"hls-audio-change"})};for(var q in e.audioTracks().addEventListener("change",P),e.remoteTextTracks().addEventListener("change",r.SUBTITLES.onTrackChanged),s.on("dispose",function(){e.audioTracks().removeEventListener("change",P),e.remoteTextTracks().removeEventListener("change",r.SUBTITLES.onTrackChanged)}),e.clearTracks("audio"),r.AUDIO.tracks)e.audioTracks().addTrack(r.AUDIO.tracks[q])}({sourceType:e.sourceType_,segmentLoaders:{AUDIO:e.audioSegmentLoader_,SUBTITLES:e.subtitleSegmentLoader_,main:e.mainSegmentLoader_},tech:e.tech_,requestOptions:e.requestOptions_,masterPlaylistLoader:e.masterPlaylistLoader_,vhs:e.vhs_,master:e.master(),mediaTypes:e.mediaTypes_,blacklistCurrentPlaylist:e.blacklistCurrentPlaylist.bind(e)}),e.triggerPresenceUsage_(e.master(),s),e.setupFirstPlay(),!e.mediaTypes_.AUDIO.activePlaylistLoader||e.mediaTypes_.AUDIO.activePlaylistLoader.media()?e.trigger("selectedinitialmedia"):e.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){e.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){e.loadOnPlay_&&e.tech_.off("play",e.loadOnPlay_);var s=e.masterPlaylistLoader_.media();if(!s){var u;if(e.excludeUnsupportedVariants_(),e.enableLowInitialPlaylist&&(u=e.selectInitialPlaylist()),u||(u=e.selectPlaylist()),!u||!e.shouldSwitchToMedia_(u))return;if(e.initialMedia_=u,e.switchMedia_(e.initialMedia_,"initial"),"vhs-json"!==e.sourceType_||!e.initialMedia_.segments)return;s=e.initialMedia_}e.handleUpdatedMediaPlaylist(s)}),this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort(),e.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var s=e.masterPlaylistLoader_.media(),u=1.5*s.targetDuration*1e3;e.requestOptions_.timeout=Zu(e.masterPlaylistLoader_.master,e.masterPlaylistLoader_.media())?0:u,e.mainSegmentLoader_.playlist(s,e.requestOptions_),e.mainSegmentLoader_.load(),e.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var s=e.masterPlaylistLoader_.media();"playlist-unchanged"!==s.lastExcludeReason_&&e.stuckAtPlaylistEnd_(s)&&(e.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),e.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){e.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),e.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},r.handleUpdatedMediaPlaylist=function(e){this.useCueTags_&&this.updateAdCues_(e),this.mainSegmentLoader_.playlist(e,this.requestOptions_),this.updateDuration(!e.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},r.triggerPresenceUsage_=function(e,s){var u=e.mediaGroups||{},d=!0,m=Object.keys(u.AUDIO);for(var g in u.AUDIO)for(var T in u.AUDIO[g])u.AUDIO[g][T].uri||(d=!1);d&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(u.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),Wt.Playlist.isAes(s)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),m.length&&Object.keys(u.AUDIO[m[0]]).length>1&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},r.shouldSwitchToMedia_=function(e){var s=this.masterPlaylistLoader_.media()||this.masterPlaylistLoader_.pendingMedia_,u=this.tech_.currentTime(),d=this.bufferLowWaterLine(),m=this.bufferHighWaterLine();return function(n){var r=n.currentPlaylist,o=n.buffered,e=n.currentTime,s=n.nextPlaylist,u=n.bufferLowWaterLine,d=n.bufferHighWaterLine,m=n.duration,g=n.experimentalBufferBasedABR,T=n.log;if(!s)return ct.log.warn("We received no playlist to switch to. Please check your stream."),!1;var L="allowing switch "+(r&&r.id||"null")+" -> "+s.id;if(!r)return T(L+" as current playlist is not set"),!0;if(s.id===r.id)return!1;var P=Boolean(Ka(o,e).length);if(!r.endList)return P||"number"!=typeof r.partTargetDuration?(T(L+" as current playlist is live"),!0):(T("not "+L+" as current playlist is live llhls, but currentTime isn't in buffered."),!1);var q=jl(o,e),le=g?Sr.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:Sr.MAX_BUFFER_LOW_WATER_LINE;if(m<le)return T(L+" as duration < max low water line ("+m+" < "+le+")"),!0;var _e=s.attributes.BANDWIDTH,ge=r.attributes.BANDWIDTH;if(_e<ge&&(!g||q<d)){var rt=L+" as next bandwidth < current bandwidth ("+_e+" < "+ge+")";return g&&(rt+=" and forwardBuffer < bufferHighWaterLine ("+q+" < "+d+")"),T(rt),!0}if((!g||_e>ge)&&q>=u){var yt=L+" as forwardBuffer >= bufferLowWaterLine ("+q+" >= "+u+")";return g&&(yt+=" and next bandwidth > current bandwidth ("+_e+" > "+ge+")"),T(yt),!0}return T("not "+L+" as no switching criteria met"),!1}({buffered:this.tech_.buffered(),currentTime:u,currentPlaylist:s,nextPlaylist:e,bufferLowWaterLine:d,bufferHighWaterLine:m,duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},r.setupSegmentLoaderListeners_=function(){var e=this;this.experimentalBufferBasedABR||(this.mainSegmentLoader_.on("bandwidthupdate",function(){var u=e.selectPlaylist();e.shouldSwitchToMedia_(u)&&e.switchMedia_(u,"bandwidthupdate"),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")})),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){e.error=e.mainSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){e.error=e.audioSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){e.logger_("main segment loader ended"),e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(u){e.experimentalBufferBasedABR||(e.delegateLoaders_("all",["abort"]),e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120))});var s=function(){if(!e.sourceUpdater_.hasCreatedSourceBuffers())return e.tryToCreateSourceBuffers_();var d=e.getCodecsOrExclude_();!d||e.sourceUpdater_.addOrChangeSourceBuffers(d)};this.mainSegmentLoader_.on("trackinfo",s),this.audioSegmentLoader_.on("trackinfo",s),this.mainSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){e.logger_("audioSegmentLoader ended"),e.onEndOfStream()})},r.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},r.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},r.smoothQualityChange_=function(e){void 0===e&&(e=this.selectPlaylist()),this.fastQualityChange_(e)},r.fastQualityChange_=function(e){var s=this;void 0===e&&(e=this.selectPlaylist()),e!==this.masterPlaylistLoader_.media()?(this.switchMedia_(e,"fast-quality"),this.mainSegmentLoader_.resetEverything(function(){s.tech_.setCurrentTime(ct.browser.IE_VERSION||ct.browser.IS_EDGE?s.tech_.currentTime()+.04:s.tech_.currentTime())})):this.logger_("skipping fastQualityChange because new media is same as old")},r.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.tech_.setCurrentTime(e.end(e.length-1))}},r.setupFirstPlay=function(){var e=this,s=this.masterPlaylistLoader_.media();if(!s||this.tech_.paused()||this.hasPlayed_)return!1;if(!s.endList){var u=this.seekable();if(!u.length)return!1;if(ct.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.tech_.setCurrentTime(u.end(0)),e.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(u.end(0))}return this.hasPlayed_=!0,this.load(),!0},r.handleSourceOpen_=function(){if(this.tryToCreateSourceBuffers_(),this.tech_.autoplay()){var e=this.tech_.play();typeof e<"u"&&"function"==typeof e.then&&e.then(null,function(s){})}this.trigger("sourceopen")},r.handleSourceEnded_=function(){if(this.inbandTextTracks_.metadataTrack_){var e=this.inbandTextTracks_.metadataTrack_.cues;if(e&&e.length){var s=this.duration();e[e.length-1].endTime=isNaN(s)||Math.abs(s)===1/0?Number.MAX_VALUE:s}}},r.handleDurationChange_=function(){this.tech_.trigger("durationchange")},r.onEndOfStream=function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){var s=this.mainSegmentLoader_.getCurrentMediaInfo_();e=!s||s.hasVideo?e&&this.audioSegmentLoader_.ended_:this.audioSegmentLoader_.ended_}!e||(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},r.stuckAtPlaylistEnd_=function(e){if(!this.seekable().length)return!1;var u=this.syncController_.getExpiredTime(e,this.duration());if(null===u)return!1;var d=Wt.Playlist.playlistEnd(e,u),m=this.tech_.currentTime(),g=this.tech_.buffered();if(!g.length)return d-m<=qr;var T=g.end(g.length-1);return T-m<=qr&&d-T<=qr},r.blacklistCurrentPlaylist=function(e,s){void 0===e&&(e={});var u=e.playlist||this.masterPlaylistLoader_.media();if(s=s||e.blacklistDuration||this.blacklistDuration,!u)return this.error=e,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));u.playlistErrors_++;var L,d=this.masterPlaylistLoader_.master.playlists,m=d.filter(fa),g=1===m.length&&m[0]===u;if(1===d.length&&s!==1/0)return ct.log.warn("Problem encountered with playlist "+u.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(g);if(g){var T=!1;d.forEach(function(rt){if(rt!==u){var yt=rt.excludeUntil;typeof yt<"u"&&yt!==1/0&&(T=!0,delete rt.excludeUntil)}}),T&&(ct.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))}L=u.playlistErrors_>this.maxPlaylistRetries?1/0:Date.now()+1e3*s,u.excludeUntil=L,e.reason&&(u.lastExcludeReason_=e.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});var P=this.selectPlaylist();if(!P)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");(e.internal?this.logger_:ct.log.warn)((e.internal?"Internal problem":"Problem")+" encountered with playlist "+u.id+"."+(e.message?" "+e.message:"")+" Switching to playlist "+P.id+"."),P.attributes.AUDIO!==u.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),P.attributes.SUBTITLES!==u.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);var _e=P.targetDuration/2*1e3||5e3,ge="number"==typeof P.lastRequest&&Date.now()-P.lastRequest<=_e;return this.switchMedia_(P,"exclude",g||ge)},r.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},r.delegateLoaders_=function(e,s){var u=this,d=[],m="all"===e;(m||"main"===e)&&d.push(this.masterPlaylistLoader_);var g=[];(m||"audio"===e)&&g.push("AUDIO"),(m||"subtitle"===e)&&(g.push("CLOSED-CAPTIONS"),g.push("SUBTITLES")),g.forEach(function(T){var L=u.mediaTypes_[T]&&u.mediaTypes_[T].activePlaylistLoader;L&&d.push(L)}),["main","audio","subtitle"].forEach(function(T){var L=u[T+"SegmentLoader_"];L&&(e===T||"all"===e)&&d.push(L)}),d.forEach(function(T){return s.forEach(function(L){"function"==typeof T[L]&&T[L]()})})},r.setCurrentTime=function(e){var s=Ka(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?s&&s.length?e:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},r.duration=function(){if(!this.masterPlaylistLoader_)return 0;var e=this.masterPlaylistLoader_.media();return e?e.endList?this.mediaSource?this.mediaSource.duration:Wt.Playlist.duration(e):1/0:0},r.seekable=function(){return this.seekable_},r.onSyncInfoUpdate_=function(){var e;if(this.masterPlaylistLoader_){var s=this.masterPlaylistLoader_.media();if(s){var u=this.syncController_.getExpiredTime(s,this.duration());if(null!==u){var g,T,d=this.masterPlaylistLoader_.master,m=Wt.Playlist.seekable(s,u,Wt.Playlist.liveEdgeDelay(d,s));0===m.length||this.mediaTypes_.AUDIO.activePlaylistLoader&&(s=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(u=this.syncController_.getExpiredTime(s,this.duration()))||0===(e=Wt.Playlist.seekable(s,u,Wt.Playlist.liveEdgeDelay(d,s))).length)||(this.seekable_&&this.seekable_.length&&(g=this.seekable_.end(0),T=this.seekable_.start(0)),this.seekable_=e?e.start(0)>m.end(0)||m.start(0)>e.end(0)?m:ct.createTimeRanges([[e.start(0)>m.start(0)?e.start(0):m.start(0),e.end(0)<m.end(0)?e.end(0):m.end(0)]]):m,(!this.seekable_||!this.seekable_.length||this.seekable_.end(0)!==g||this.seekable_.start(0)!==T)&&(this.logger_("seekable updated ["+Qo(this.seekable_)+"]"),this.tech_.trigger("seekablechanged")))}}}},r.updateDuration=function(e){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,e),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);if(e){var s=this.seekable();if(!s.length)return;(isNaN(this.mediaSource.duration)||this.mediaSource.duration<s.end(s.length-1))&&this.sourceUpdater_.setDuration(s.end(s.length-1))}else{var u=this.tech_.buffered(),d=Wt.Playlist.duration(this.masterPlaylistLoader_.media());u.length>0&&(d=Math.max(d,u.end(u.length-1))),this.mediaSource.duration!==d&&this.sourceUpdater_.setDuration(d)}},r.dispose=function(){var e=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(s){var u=e.mediaTypes_[s].groups;for(var d in u)u[d].forEach(function(m){m.playlistLoader&&m.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},r.master=function(){return this.masterPlaylistLoader_.master},r.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},r.areMediaTypesKnown_=function(){var e=!!this.mediaTypes_.AUDIO.activePlaylistLoader,s=!!this.mainSegmentLoader_.getCurrentMediaInfo_(),u=!e||!!this.audioSegmentLoader_.getCurrentMediaInfo_();return!(!s||!u)},r.getCodecsOrExclude_=function(){var e=this,s={main:this.mainSegmentLoader_.getCurrentMediaInfo_()||{},audio:this.audioSegmentLoader_.getCurrentMediaInfo_()||{}};s.video=s.main;var u=ac(this.master(),this.media()),d={},m=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(s.main.hasVideo&&(d.video=u.video||s.main.videoCodec||"avc1.4d400d"),s.main.isMuxed&&(d.video+=","+(u.audio||s.main.audioCodec||Tp)),(s.main.hasAudio&&!s.main.isMuxed||s.audio.hasAudio||m)&&(d.audio=u.audio||s.main.audioCodec||s.audio.audioCodec||Tp,s.audio.isFmp4=s.main.hasAudio&&!s.main.isMuxed?s.main.isFmp4:s.audio.isFmp4),d.audio||d.video){var L,T={};if(["video","audio"].forEach(function(_e){if(d.hasOwnProperty(_e)&&!function(ge,rt){return ge?Wc(rt):bd(rt)}(s[_e].isFmp4,d[_e])){var ge=s[_e].isFmp4?"browser":"muxer";T[ge]=T[ge]||[],T[ge].push(d[_e]),"audio"===_e&&(L=ge)}}),m&&L&&this.media().attributes.AUDIO){var P=this.media().attributes.AUDIO;this.master().playlists.forEach(function(_e){(_e.attributes&&_e.attributes.AUDIO)===P&&_e!==e.media()&&(_e.excludeUntil=1/0)}),this.logger_("excluding audio group "+P+" as "+L+' does not support codec(s): "'+d.audio+'"')}if(!Object.keys(T).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var le=[];if(["video","audio"].forEach(function(_e){var ge=(hs(e.sourceUpdater_.codecs[_e]||"")[0]||{}).type,rt=(hs(d[_e]||"")[0]||{}).type;ge&&rt&&ge.toLowerCase()!==rt.toLowerCase()&&le.push('"'+e.sourceUpdater_.codecs[_e]+'" -> "'+d[_e]+'"')}),le.length)return void this.blacklistCurrentPlaylist({playlist:this.media(),message:"Codec switching not supported: "+le.join(", ")+".",blacklistDuration:1/0,internal:!0})}return d}var q=Object.keys(T).reduce(function(_e,ge){return _e&&(_e+=", "),_e+(ge+' does not support codec(s): "')+T[ge].join(",")+'"'},"")+".";this.blacklistCurrentPlaylist({playlist:this.media(),internal:!0,message:q,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:this.media(),message:"Could not determine codecs for playlist.",blacklistDuration:1/0})},r.tryToCreateSourceBuffers_=function(){if("open"===this.mediaSource.readyState&&!this.sourceUpdater_.hasCreatedSourceBuffers()&&this.areMediaTypesKnown_()){var e=this.getCodecsOrExclude_();if(e){this.sourceUpdater_.createSourceBuffers(e);var s=[e.video,e.audio].filter(Boolean).join(",");this.excludeIncompatibleVariants_(s)}}},r.excludeUnsupportedVariants_=function(){var e=this,s=this.master().playlists,u=[];Object.keys(s).forEach(function(d){var m=s[d];if(-1===u.indexOf(m.id)){u.push(m.id);var g=ac(e.master,m),T=[];g.audio&&!bd(g.audio)&&!Wc(g.audio)&&T.push("audio codec "+g.audio),g.video&&!bd(g.video)&&!Wc(g.video)&&T.push("video codec "+g.video),g.text&&"stpp.ttml.im1t"===g.text&&T.push("text codec "+g.text),T.length&&(m.excludeUntil=1/0,e.logger_("excluding "+m.id+" for unsupported: "+T.join(", ")))}})},r.excludeIncompatibleVariants_=function(e){var s=this,u=[],d=this.master().playlists,m=gf(hs(e)),g=yf(m),T=m.video&&hs(m.video)[0]||null,L=m.audio&&hs(m.audio)[0]||null;Object.keys(d).forEach(function(P){var q=d[P];if(-1===u.indexOf(q.id)&&q.excludeUntil!==1/0){u.push(q.id);var le=[],_e=ac(s.masterPlaylistLoader_.master,q),ge=yf(_e);if(_e.audio||_e.video){if(ge!==g&&le.push('codec count "'+ge+'" !== "'+g+'"'),!s.sourceUpdater_.canChangeType()){var rt=_e.video&&hs(_e.video)[0]||null,yt=_e.audio&&hs(_e.audio)[0]||null;rt&&T&&rt.type.toLowerCase()!==T.type.toLowerCase()&&le.push('video codec "'+rt.type+'" !== "'+T.type+'"'),yt&&L&&yt.type.toLowerCase()!==L.type.toLowerCase()&&le.push('audio codec "'+yt.type+'" !== "'+L.type+'"')}le.length&&(q.excludeUntil=1/0,s.logger_("blacklisting "+q.id+": "+le.join(" && ")))}}})},r.updateAdCues_=function(e){var s=0,u=this.seekable();u.length&&(s=u.start(0)),function(n,r,o){if(void 0===o&&(o=0),n.segments)for(var s,e=o,u=0;u<n.segments.length;u++){var d=n.segments[u];if(s||(s=xt(r,e+d.duration/2)),s){if("cueIn"in d){s.endTime=e,s.adEndTime=e,e+=d.duration,s=null;continue}if(e<s.endTime){e+=d.duration;continue}s.endTime+=d.duration}else if("cueOut"in d&&((s=new window.VTTCue(e,e+d.duration,d.cueOut)).adStartTime=e,s.adEndTime=e+parseFloat(d.cueOut),r.addCue(s)),"cueOutCont"in d){var m=d.cueOutCont.split("/").map(parseFloat),g=m[0],T=m[1];(s=new window.VTTCue(e,e+d.duration,"")).adStartTime=e-g,s.adEndTime=s.adStartTime+T,r.addCue(s)}e+=d.duration}}(e,this.cueTagsTrack_,s)},r.goalBufferLength=function(){var e=this.tech_.currentTime(),s=Sr.GOAL_BUFFER_LENGTH,u=Sr.GOAL_BUFFER_LENGTH_RATE,d=Math.max(s,Sr.MAX_GOAL_BUFFER_LENGTH);return Math.min(s+e*u,d)},r.bufferLowWaterLine=function(){var e=this.tech_.currentTime(),s=Sr.BUFFER_LOW_WATER_LINE,u=Sr.BUFFER_LOW_WATER_LINE_RATE,d=Math.max(s,Sr.MAX_BUFFER_LOW_WATER_LINE),m=Math.max(s,Sr.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(s+e*u,this.experimentalBufferBasedABR?m:d)},r.bufferHighWaterLine=function(){return Sr.BUFFER_HIGH_WATER_LINE},n}(ct.EventTarget),Vi=function(n,r,o){var e=n.masterPlaylistController_,d=e[(n.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(e);if(r.attributes){var m=r.attributes.RESOLUTION;this.width=m&&m.width,this.height=m&&m.height,this.bandwidth=r.attributes.BANDWIDTH}this.codecs=ac(e.master(),r),this.playlist=r,this.id=o,this.enabled=function(n,r,o){return function(e){var s=n.master.playlists[r],u=kn(s),d=fa(s);return typeof e>"u"?d:(e?delete s.disabled:s.disabled=!0,e!==d&&!u&&(o(),n.trigger(e?"renditionenabled":"renditiondisabled")),e)}}(n.playlists,r.id,d)},gn=["seeking","seeked","pause","playing","error"],Hi=function(){function c(r){var o=this;this.masterPlaylistController_=r.masterPlaylistController,this.tech_=r.tech,this.seekable=r.seekable,this.allowSeeksWithinUnsafeLiveWindow=r.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=r.liveRangeSafeTimeDelta,this.media=r.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=na("PlaybackWatcher"),this.logger_("initialize");var e=function(){return o.monitorCurrentTime_()},s=function(){return o.monitorCurrentTime_()},u=function(){return o.techWaiting_()},d=function(){return o.cancelTimer_()},m=this.masterPlaylistController_,g=["main","subtitle","audio"],T={};g.forEach(function(P){T[P]={reset:function(){return o.resetSegmentDownloads_(P)},updateend:function(){return o.checkSegmentDownloads_(P)}},m[P+"SegmentLoader_"].on("appendsdone",T[P].updateend),m[P+"SegmentLoader_"].on("playlistupdate",T[P].reset),o.tech_.on(["seeked","seeking"],T[P].reset)});var L=function(q){["main","audio"].forEach(function(le){m[le+"SegmentLoader_"][q]("appended",o.seekingAppendCheck_)})};this.seekingAppendCheck_=function(){o.fixesBadSeeks_()&&(o.consecutiveUpdates=0,o.lastRecordedTime=o.tech_.currentTime(),L("off"))},this.clearSeekingAppendCheck_=function(){return L("off")},this.watchForBadSeeking_=function(){o.clearSeekingAppendCheck_(),L("on")},this.tech_.on("seeked",this.clearSeekingAppendCheck_),this.tech_.on("seeking",this.watchForBadSeeking_),this.tech_.on("waiting",u),this.tech_.on(gn,d),this.tech_.on("canplay",s),this.tech_.one("play",e),this.dispose=function(){o.clearSeekingAppendCheck_(),o.logger_("dispose"),o.tech_.off("waiting",u),o.tech_.off(gn,d),o.tech_.off("canplay",s),o.tech_.off("play",e),o.tech_.off("seeking",o.watchForBadSeeking_),o.tech_.off("seeked",o.clearSeekingAppendCheck_),g.forEach(function(P){m[P+"SegmentLoader_"].off("appendsdone",T[P].updateend),m[P+"SegmentLoader_"].off("playlistupdate",T[P].reset),o.tech_.off(["seeked","seeking"],T[P].reset)}),o.checkCurrentTimeTimeout_&&window.clearTimeout(o.checkCurrentTimeTimeout_),o.cancelTimer_()}}var n=c.prototype;return n.monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&window.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=window.setTimeout(this.monitorCurrentTime_.bind(this),250)},n.resetSegmentDownloads_=function(o){var e=this.masterPlaylistController_[o+"SegmentLoader_"];this[o+"StalledDownloads_"]>0&&this.logger_("resetting possible stalled download count for "+o+" loader"),this[o+"StalledDownloads_"]=0,this[o+"Buffered_"]=e.buffered_()},n.checkSegmentDownloads_=function(o){var e=this.masterPlaylistController_,s=e[o+"SegmentLoader_"],u=s.buffered_(),d=function(n,r){if(n===r)return!1;if(!n&&r||!r&&n||n.length!==r.length)return!0;for(var o=0;o<n.length;o++)if(n.start(o)!==r.start(o)||n.end(o)!==r.end(o))return!0;return!1}(this[o+"Buffered_"],u);this[o+"Buffered_"]=u,d?this.resetSegmentDownloads_(o):(this[o+"StalledDownloads_"]++,this.logger_("found #"+this[o+"StalledDownloads_"]+" "+o+" appends that did not increase buffer (possible stalled download)",{playlistId:s.playlist_&&s.playlist_.id,buffered:Rn(u)}),!(this[o+"StalledDownloads_"]<10)&&(this.logger_(o+" loader stalled download exclusion"),this.resetSegmentDownloads_(o),this.tech_.trigger({type:"usage",name:"vhs-"+o+"-download-exclusion"}),"subtitle"!==o&&e.blacklistCurrentPlaylist({message:"Excessive "+o+" segment downloading detected."},1/0)))},n.checkCurrentTime_=function(){if(!this.tech_.paused()&&!this.tech_.seeking()){var o=this.tech_.currentTime(),e=this.tech_.buffered();if(this.lastRecordedTime===o&&(!e.length||o+qr>=e.end(e.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&o===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):o===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=o)}},n.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},n.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var d,e=this.seekable(),s=this.tech_.currentTime();if(this.afterSeekableWindow_(e,s,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(d=e.end(e.length-1)),this.beforeSeekableWindow_(e,s)){var g=e.start(0);d=g+(g===e.end(0)?0:qr)}if(typeof d<"u")return this.logger_("Trying to seek outside of seekable at time "+s+" with seekable range "+Qo(e)+". Seeking to "+d+"."),this.tech_.setCurrentTime(d),!0;for(var T=this.masterPlaylistController_.sourceUpdater_,L=this.tech_.buffered(),P=T.audioBuffer?T.audioBuffered():null,q=T.videoBuffer?T.videoBuffered():null,le=this.media(),_e=le.partTargetDuration?le.partTargetDuration:2*(le.targetDuration-Xr),ge=[P,q],rt=0;rt<ge.length;rt++)if(ge[rt]&&jl(ge[rt],s)<_e)return!1;var ni=Vs(L,s);return 0!==ni.length&&(d=ni.start(0)+qr,this.logger_("Buffered region starts ("+ni.start(0)+")  just beyond seek point ("+s+"). Seeking to "+d+"."),this.tech_.setCurrentTime(d),!0)},n.waiting_=function(){if(!this.techWaiting_()){var o=this.tech_.currentTime(),e=this.tech_.buffered(),s=Ka(e,o);if(s.length&&o+3<=s.end(0))return this.cancelTimer_(),this.tech_.setCurrentTime(o),this.logger_("Stopped at "+o+" while inside a buffered region ["+s.start(0)+" -> "+s.end(0)+"]. Attempting to resume playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})}},n.techWaiting_=function(){var o=this.seekable(),e=this.tech_.currentTime();if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(o,e)){var s=o.end(o.length-1);return this.logger_("Fell out of live window at time "+e+". Seeking to live point (seekable end) "+s),this.cancelTimer_(),this.tech_.setCurrentTime(s),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var u=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,d=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:u.audioBuffered(),videoBuffered:u.videoBuffered(),currentTime:e}))return this.cancelTimer_(),this.tech_.setCurrentTime(e),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;var g=Vs(d,e);if(g.length>0){var T=g.start(0)-e;return this.logger_("Stopped at "+e+", setting timer for "+T+", seeking to "+g.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*T,e),!0}return!1},n.afterSeekableWindow_=function(o,e,s,u){if(void 0===u&&(u=!1),!o.length)return!1;var d=o.end(o.length-1)+qr;return!s.endList&&u&&(d=o.end(o.length-1)+3*s.targetDuration),e>d},n.beforeSeekableWindow_=function(o,e){return!!(o.length&&o.start(0)>0&&e<o.start(0)-this.liveRangeSafeTimeDelta)},n.videoUnderflow_=function(o){var e=o.videoBuffered,s=o.audioBuffered,u=o.currentTime;if(e){var d;if(e.length&&s.length){var m=Ka(e,u-3),g=Ka(e,u),T=Ka(s,u);T.length&&!g.length&&m.length&&(d={start:m.end(0),end:T.end(0)})}else Vs(e,u).length||(d=this.gapFromVideoUnderflow_(e,u));return!!d&&(this.logger_("Encountered a gap in video from "+d.start+" to "+d.end+". Seeking to current time "+u),!0)}},n.skipTheGap_=function(o){var e=this.tech_.buffered(),s=this.tech_.currentTime(),u=Vs(e,s);this.cancelTimer_(),0!==u.length&&s===o&&(this.logger_("skipTheGap_:","currentTime:",s,"scheduled currentTime:",o,"nextRange start:",u.start(0)),this.tech_.setCurrentTime(u.start(0)+Xr),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},n.gapFromVideoUnderflow_=function(o,e){for(var s=function(n){if(n.length<2)return ct.createTimeRanges();for(var r=[],o=1;o<n.length;o++){var e=n.end(o-1),s=n.start(o);r.push([e,s])}return ct.createTimeRanges(r)}(o),u=0;u<s.length;u++){var d=s.start(u),m=s.end(u);if(e-d<4&&e-d>2)return{start:d,end:m}}return null},c}(),ln={errorInterval:30,getSource:function(n){return n(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},In=function c(n,r){var o=0,e=0,s=ct.mergeOptions(ln,r);n.ready(function(){n.trigger({type:"usage",name:"vhs-error-reload-initialized"}),n.trigger({type:"usage",name:"hls-error-reload-initialized"})});var u=function(){e&&n.currentTime(e)},d=function(P){null!=P&&(e=n.duration()!==1/0&&n.currentTime()||0,n.one("loadedmetadata",u),n.src(P),n.trigger({type:"usage",name:"vhs-error-reload"}),n.trigger({type:"usage",name:"hls-error-reload"}),n.play())},m=function(){return Date.now()-o<1e3*s.errorInterval?(n.trigger({type:"usage",name:"vhs-error-reload-canceled"}),void n.trigger({type:"usage",name:"hls-error-reload-canceled"})):s.getSource&&"function"==typeof s.getSource?(o=Date.now(),s.getSource.call(n,d)):void ct.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")},g=function L(){n.off("loadedmetadata",u),n.off("error",m),n.off("dispose",L)};n.on("error",m),n.on("dispose",g),n.reloadSourceOnError=function(P){g(),c(n,P)}},fn={PlaylistLoader:Lr,Playlist:Jn,utils:of,STANDARD_PLAYLIST_SELECTOR:kh,INITIAL_PLAYLIST_SELECTOR:function(){var n=this,r=this.playlists.master.playlists.filter(Jn.isEnabled);return Jl(r,function(e,s){return _f(e,s)}),r.filter(function(e){return!!ac(n.playlists.master,e).video})[0]||null},lastBandwidthSelector:kh,movingAverageBandwidthSelector:function(n){var r=-1,o=-1;if(n<0||n>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var e=this.useDevicePixelRatio&&window.devicePixelRatio||1;return r<0&&(r=this.systemBandwidth,o=this.systemBandwidth),this.systemBandwidth>0&&this.systemBandwidth!==o&&(r=n*this.systemBandwidth+(1-n)*r,o=this.systemBandwidth),sc(this.playlists.master,r,parseInt(Nh(this.tech_.el(),"width"),10)*e,parseInt(Nh(this.tech_.el(),"height"),10)*e,this.limitRenditionByPlayerDimensions,this.masterPlaylistController_)}},comparePlaylistBandwidth:_f,comparePlaylistResolution:function(n,r){var o,e;return n.attributes.RESOLUTION&&n.attributes.RESOLUTION.width&&(o=n.attributes.RESOLUTION.width),o=o||window.Number.MAX_VALUE,r.attributes.RESOLUTION&&r.attributes.RESOLUTION.width&&(e=r.attributes.RESOLUTION.width),o===(e=e||window.Number.MAX_VALUE)&&n.attributes.BANDWIDTH&&r.attributes.BANDWIDTH?n.attributes.BANDWIDTH-r.attributes.BANDWIDTH:o-e},xhr:es()};Object.keys(Sr).forEach(function(c){Object.defineProperty(fn,c,{get:function(){return ct.log.warn("using Vhs."+c+" is UNSAFE be sure you know what you are doing"),Sr[c]},set:function(r){ct.log.warn("using Vhs."+c+" is UNSAFE be sure you know what you are doing"),"number"!=typeof r||r<0?ct.log.warn("value of Vhs."+c+" must be greater than or equal to 0"):Sr[c]=r}})});var bs="videojs-vhs",uc=function(n,r){for(var o=r.media(),e=-1,s=0;s<n.length;s++)if(n[s].id===o.id){e=s;break}n.selectedIndex_=e,n.trigger({selectedIndex:e,type:"change"})};fn.canPlaySource=function(){return ct.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Uh=function(){if(!window.localStorage)return null;var n=window.localStorage.getItem(bs);if(!n)return null;try{return JSON.parse(n)}catch{return null}};fn.supportsNativeHls=function(){if(!document||!document.createElement)return!1;var c=document.createElement("video");return!!ct.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(r){return/maybe|probably/i.test(c.canPlayType(r))})}(),fn.supportsNativeDash=!!(document&&document.createElement&&ct.getTech("Html5").isSupported())&&/maybe|probably/i.test(document.createElement("video").canPlayType("application/dash+xml")),fn.supportsTypeNatively=function(c){return"hls"===c?fn.supportsNativeHls:"dash"===c&&fn.supportsNativeDash},fn.isSupported=function(){return ct.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var ii=function(c){function n(o,e,s){var u;if(u=c.call(this,e,ct.mergeOptions(s.hls,s.vhs))||this,s.hls&&Object.keys(s.hls).length&&ct.log.warn("Using hls options is deprecated. Please rename `hls` to `vhs` in your options object."),"number"==typeof s.initialBandwidth&&(u.options_.bandwidth=s.initialBandwidth),u.logger_=na("VhsHandler"),e.options_&&e.options_.playerId){var d=ct(e.options_.playerId);d.hasOwnProperty("hls")||Object.defineProperty(d,"hls",{get:function(){return ct.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"hls-player-access"}),qi(u)},configurable:!0}),d.hasOwnProperty("vhs")||Object.defineProperty(d,"vhs",{get:function(){return ct.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"vhs-player-access"}),qi(u)},configurable:!0}),d.hasOwnProperty("dash")||Object.defineProperty(d,"dash",{get:function(){return ct.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),qi(u)},configurable:!0}),u.player_=d}if(u.tech_=e,u.source_=o,u.stats={},u.ignoreNextSeekingEvent_=!1,u.setOptions_(),u.options_.overrideNative&&e.overrideNativeAudioTracks&&e.overrideNativeVideoTracks)e.overrideNativeAudioTracks(!0),e.overrideNativeVideoTracks(!0);else if(u.options_.overrideNative&&(e.featuresNativeVideoTracks||e.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return u.on(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(m){var g=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;g&&g.contains(u.tech_.el())?u.masterPlaylistController_.fastQualityChange_():u.masterPlaylistController_.checkABR_()}),u.on(u.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),u.on(u.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),u.on(u.tech_,"play",u.play),u}Ti(n,c);var r=n.prototype;return r.setOptions_=function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=typeof this.source_.useBandwidthFromLocalStorage<"u"?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.useNetworkInformationApi=this.options_.useNetworkInformationApi||!1,this.options_.useDtsForTimestampOffset=this.options_.useDtsForTimestampOffset||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var s=Uh();s&&s.bandwidth&&(this.options_.bandwidth=s.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),s&&s.throughput&&(this.options_.throughput=s.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=Sr.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===Sr.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta","experimentalLLHLS","useNetworkInformationApi","useDtsForTimestampOffset","experimentalExactManifestTimings","experimentalLeastPixelDiffSelector"].forEach(function(u){typeof e.source_[u]<"u"&&(e.options_[u]=e.source_[u])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},r.src=function(e,s){var u=this;if(e){this.setOptions_(),this.options_.src=function(n){return 0===n.toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(n.substring(n.indexOf(",")+1)):n}(this.source_.src),this.options_.tech=this.tech_,this.options_.externVhs=fn,this.options_.sourceType=Ap(s),this.options_.seekTo=function(g){u.tech_.setCurrentTime(g)},this.options_.smoothQualityChange&&ct.log.warn("smoothQualityChange is deprecated and will be removed in the next major version"),this.masterPlaylistController_=new Gi(this.options_);var d=ct.mergeOptions({liveRangeSafeTimeDelta:qr},this.options_,{seekable:function(){return u.seekable()},media:function(){return u.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_});this.playbackWatcher_=new Hi(d),this.masterPlaylistController_.on("error",function(){var g=ct.players[u.tech_.options_.playerId],T=u.masterPlaylistController_.error;"object"!=typeof T||T.code?"string"==typeof T&&(T={message:T,code:3}):T.code=3,g.error(T)});var m=this.options_.experimentalBufferBasedABR?fn.movingAverageBandwidthSelector(.55):fn.STANDARD_PLAYLIST_SELECTOR;this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):m.bind(this),this.masterPlaylistController_.selectInitialPlaylist=fn.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(T){this.masterPlaylistController_.selectPlaylist=T.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(T){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=T,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){var T=this.masterPlaylistController_.mainSegmentLoader_.bandwidth,L=window.navigator.connection||window.navigator.mozConnection||window.navigator.webkitConnection,P=1e7;if(this.options_.useNetworkInformationApi&&L){var q=1e3*L.downlink*1e3;T=q>=P&&T>=P?Math.max(T,q):q}return T},set:function(T){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=T,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){return Math.floor(1/(1/(this.bandwidth||1)+(this.throughput>0?1/this.throughput:0)))},set:function(){ct.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return u.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return u.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return u.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return u.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return u.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return u.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return u.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return u.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},mediaAppends:{get:function(){return u.masterPlaylistController_.mediaAppends_()||0},enumerable:!0},mainAppendsToLoadedData:{get:function(){return u.masterPlaylistController_.mainAppendsToLoadedData_()||0},enumerable:!0},audioAppendsToLoadedData:{get:function(){return u.masterPlaylistController_.audioAppendsToLoadedData_()||0},enumerable:!0},appendsToLoadedData:{get:function(){return u.masterPlaylistController_.appendsToLoadedData_()||0},enumerable:!0},timeToLoadedData:{get:function(){return u.masterPlaylistController_.timeToLoadedData_()||0},enumerable:!0},buffered:{get:function(){return Rn(u.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return u.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return u.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return u.tech_.name_},enumerable:!0},duration:{get:function(){return u.tech_.duration()},enumerable:!0},master:{get:function(){return u.playlists.master},enumerable:!0},playerDimensions:{get:function(){return u.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Rn(u.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return u.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){u.options_.useBandwidthFromLocalStorage&&function(n){if(!window.localStorage)return!1;var r=Uh();r=r?ct.mergeOptions(r,n):n;try{window.localStorage.setItem(bs,JSON.stringify(r))}catch{return!1}}({bandwidth:u.bandwidth,throughput:Math.round(u.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){!function(n){n.representations=function(){var r=n.masterPlaylistController_.master(),o=Wi(r)?n.masterPlaylistController_.getAudioTrackPlaylists_():r.playlists;return o?o.filter(function(e){return!kn(e)}).map(function(e,s){return new Vi(n,e,e.id)}):[]}}(u)}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){u.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=window.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_))}},r.createKeySessions_=function(){var e=this,s=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader;this.logger_("waiting for EME key session creation"),function(n){var r=n.player,o=n.sourceKeySystems,e=n.audioMedia,s=n.mainPlaylists;if(!r.eme.initializeMediaKeys)return Promise.resolve();var d=function(n,r){return n.reduce(function(o,e){if(!e.contentProtection)return o;var s=r.reduce(function(u,d){var m=e.contentProtection[d];return m&&m.pssh&&(u[d]={pssh:m.pssh}),u},{});return Object.keys(s).length&&o.push(s),o},[])}(e?s.concat([e]):s,Object.keys(o)),m=[],g=[];return d.forEach(function(T){g.push(new Promise(function(L,P){r.tech_.one("keysessioncreated",L)})),m.push(new Promise(function(L,P){r.eme.initializeMediaKeys({keySystems:T},function(q){q?P(q):L()})}))}),Promise.race([Promise.all(m),Promise.race(g)])}({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:s&&s.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){e.logger_("created EME key session"),e.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(u){e.logger_("error while creating EME key session",u),e.player_.error({message:"Failed to initialize media keys for EME",code:3})})},r.handleWaitingForKey_=function(){this.logger_("waitingforkey fired, attempting to create any new key sessions"),this.createKeySessions_()},r.setupEme_=function(){var e=this,s=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,u=function(n){var r=n.player,u=function(n,r,o){if(!n)return n;var e={};r&&r.attributes&&r.attributes.CODECS&&(e=gf(hs(r.attributes.CODECS))),o&&o.attributes&&o.attributes.CODECS&&(e.audio=o.attributes.CODECS);var s=Su(e.video),u=Su(e.audio),d={};for(var m in n)d[m]={},u&&(d[m].audioContentType=u),s&&(d[m].videoContentType=s),r.contentProtection&&r.contentProtection[m]&&r.contentProtection[m].pssh&&(d[m].pssh=r.contentProtection[m].pssh),"string"==typeof n[m]&&(d[m].url=n[m]);return ct.mergeOptions(n,d)}(n.sourceKeySystems,n.media,n.audioMedia);return!(!u||(r.currentSource().keySystems=u,u&&!r.eme&&(ct.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),1)))}({player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:s&&s.media()});this.player_.tech_.on("keystatuschange",function(d){if("output-restricted"===d.status){var m=e.masterPlaylistController_.master();if(m&&m.playlists){var T,g=[];m.playlists.forEach(function(L){L&&L.attributes&&L.attributes.RESOLUTION&&L.attributes.RESOLUTION.height>=720&&(!L.excludeUntil||L.excludeUntil<1/0)&&(L.excludeUntil=1/0,g.push(L))}),g.length&&((T=ct.log).warn.apply(T,['DRM keystatus changed to "output-restricted." Removing the following HD playlists that will most likely fail to play and clearing the buffer. This may be due to HDCP restrictions on the stream and the capabilities of the current device.'].concat(g)),e.masterPlaylistController_.fastQualityChange_())}}}),this.handleWaitingForKey_=this.handleWaitingForKey_.bind(this),this.player_.tech_.on("waitingforkey",this.handleWaitingForKey_),11!==ct.browser.IE_VERSION&&u?this.createKeySessions_():this.masterPlaylistController_.sourceUpdater_.initializedEme()},r.setupQualityLevels_=function(){var e=this,s=ct.players[this.tech_.options_.playerId];!s||!s.qualityLevels||this.qualityLevels_||(this.qualityLevels_=s.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){!function(n,r){r.representations().forEach(function(o){n.addQualityLevel(o)}),uc(n,r.playlists)}(e.qualityLevels_,e)}),this.playlists.on("mediachange",function(){uc(e.qualityLevels_,e.playlists)}))},n.version=function(){return{"@videojs/http-streaming":"2.14.3","mux.js":"6.0.1","mpd-parser":"0.21.1","m3u8-parser":"4.7.1","aes-decrypter":"3.1.3"}},r.version=function(){return this.constructor.version()},r.canChangeType=function(){return Yt.canChangeType()},r.play=function(){this.masterPlaylistController_.play()},r.setCurrentTime=function(e){this.masterPlaylistController_.setCurrentTime(e)},r.duration=function(){return this.masterPlaylistController_.duration()},r.seekable=function(){return this.masterPlaylistController_.seekable()},r.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&window.URL.revokeObjectURL&&(window.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),this.tech_&&this.tech_.off("waitingforkey",this.handleWaitingForKey_),c.prototype.dispose.call(this)},r.convertToProgramTime=function(e,s){return function(n){var r=n.playlist,o=n.time,e=void 0===o?void 0:o,s=n.callback;if(!s)throw new Error("getProgramTime: callback must be provided");if(!r||void 0===e)return s({message:"getProgramTime: playlist and time must be provided"});var u=function(n,r){if(!r||!r.segments||0===r.segments.length)return null;for(var e,o=0,s=0;s<r.segments.length&&!(n<=(o=(e=r.segments[s]).videoTimingInfo?e.videoTimingInfo.transmuxedPresentationEnd:o+e.duration));s++);var u=r.segments[r.segments.length-1];if(u.videoTimingInfo&&u.videoTimingInfo.transmuxedPresentationEnd<n)return null;if(n>o){if(n>o+.25*u.duration)return null;e=u}return{segment:e,estimatedStart:e.videoTimingInfo?e.videoTimingInfo.transmuxedPresentationStart:o-e.duration,type:e.videoTimingInfo?"accurate":"estimate"}}(e,r);if(!u)return s({message:"valid programTime was not found"});if("estimate"===u.type)return s({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:u.estimatedStart});var d={mediaSeconds:e},m=function(n,r){if(!r.dateTimeObject)return null;var u=n-(r.videoTimingInfo.transmuxedPresentationStart+r.videoTimingInfo.transmuxerPrependedSeconds);return new Date(r.dateTimeObject.getTime()+1e3*u)}(e,u.segment);return m&&(d.programDateTime=m.toISOString()),s(null,d)}({playlist:this.masterPlaylistController_.media(),time:e,callback:s})},r.seekToProgramTime=function(e,s,u,d){return void 0===u&&(u=!0),void 0===d&&(d=2),Ph({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:d,pauseAfterSeek:u,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:s})},n}(ct.getComponent("Component")),Ei={name:"videojs-http-streaming",VERSION:"2.14.3",canHandleSource:function(n,r){void 0===r&&(r={});var o=ct.mergeOptions(ct.options,r);return Ei.canPlayType(n.type,o)},handleSource:function(n,r,o){void 0===o&&(o={});var e=ct.mergeOptions(ct.options,o);return r.vhs=new ii(n,r,e),ct.hasOwnProperty("hls")||Object.defineProperty(r,"hls",{get:function(){return ct.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),r.vhs},configurable:!0}),r.vhs.xhr=es(),r.vhs.src(n.src,n.type),r.vhs},canPlayType:function(n,r){void 0===r&&(r={});var o=ct.mergeOptions(ct.options,r),e=o.vhs,s=(e=void 0===e?{}:e).overrideNative,u=void 0===s?!ct.browser.IS_ANY_SAFARI:s,d=o.hls,m=(d=void 0===d?{}:d).overrideNative,g=void 0!==m&&m,T=Ap(n);return T&&(!fn.supportsTypeNatively(T)||g||u)?"maybe":""}};return Wc("avc1.4d400d,mp4a.40.2")&&ct.getTech("Html5").registerSourceHandler(Ei,0),ct.VhsHandler=ii,Object.defineProperty(ct,"HlsHandler",{get:function(){return ct.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),ii},configurable:!0}),ct.VhsSourceHandler=Ei,Object.defineProperty(ct,"HlsSourceHandler",{get:function(){return ct.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),Ei},configurable:!0}),ct.Vhs=fn,Object.defineProperty(ct,"Hls",{get:function(){return ct.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),fn},configurable:!0}),ct.use||(ct.registerComponent("Hls",fn),ct.registerComponent("Vhs",fn)),ct.options.vhs=ct.options.vhs||{},ct.options.hls=ct.options.hls||{},ct.getPlugin&&ct.getPlugin("reloadSourceOnError")||(ct.registerPlugin||ct.plugin)("reloadSourceOnError",function(n){In(this,n)}),ct}),function(Nt,Ni){"object"==typeof exports&&typeof module<"u"?module.exports=Ni(require("global/window"),require("global/document"),require("video.js")):"function"==typeof define&&define.amd?define(["global/window","global/document","video.js"],Ni):(Nt=Nt||self).videojsVr=Ni(Nt.window,Nt.document,Nt.videojs)}(this,function(Nt,Ni,Ri){"use strict";Nt=Nt&&Nt.hasOwnProperty("default")?Nt.default:Nt,Ni=Ni&&Ni.hasOwnProperty("default")?Ni.default:Ni,Ri=Ri&&Ri.hasOwnProperty("default")?Ri.default:Ri;var Y=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function et(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function B(i,t){return i(t={exports:{}},t.exports),t.exports}var me=B(function(i){i.exports=function t(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a},i.exports.default=i.exports,i.exports.__esModule=!0}),ie=et(me),ue=B(function(i){function t(a,l){return i.exports=t=Object.setPrototypeOf||function(f,p){return f.__proto__=p,f},i.exports.default=i.exports,i.exports.__esModule=!0,t(a,l)}i.exports=t,i.exports.default=i.exports,i.exports.__esModule=!0});et(ue);var Z=B(function(i){i.exports=function t(a,l){a.prototype=Object.create(l.prototype),a.prototype.constructor=a,ue(a,l)},i.exports.default=i.exports,i.exports.__esModule=!0}),Q=et(Z),de=B(function(i,t){i.exports=function(){var a=typeof window<"u"?window:typeof Y<"u"?Y:typeof self<"u"?self:{};var f=function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},p=function(V,U){for(var je=0,Ze=V.length;je<Ze;je++)U[je]=V[je]},y=function(V,U){for(var je in U)U.hasOwnProperty(je)&&(V[je]=U[je]);return V},A=function l(ce){return ce&&ce.__esModule&&Object.prototype.hasOwnProperty.call(ce,"default")?ce.default:ce}(function h(ce,V){return ce(V={exports:{}},V.exports),V.exports}(function(ce,V){ce.exports=function(){var E,je=function(){function E(D,X){for(var J=0;J<X.length;J++){var xe=X[J];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(D,xe.key,xe)}}return function(D,X,J){return X&&E(D.prototype,X),J&&E(D,J),D}}(),Ze=function(D,X){if(Array.isArray(D))return D;if(Symbol.iterator in Object(D))return function E(D,X){var J=[],xe=!0,Xe=!1,st=void 0;try{for(var Ft,$t=D[Symbol.iterator]();!(xe=(Ft=$t.next()).done)&&(J.push(Ft.value),!X||J.length!==X);xe=!0);}catch(bt){Xe=!0,st=bt}finally{try{!xe&&$t.return&&$t.return()}finally{if(Xe)throw st}}return J}(D,X);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Gt=function(D,X,J){return D+(X-D)*J},ht=(E=/iPad|iPhone|iPod/.test(navigator.platform),function(){return E}),At=function(){var E=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return E}}(),Lt=function(){var E=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return E}}(),Yt=function(){var E=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return E}}(),Rt=function(){var E=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),D=E?parseInt(E[1],10):null;return function(){return D}}(),qe=function(){var E;return E=ht()&&Lt()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return E}}(),ut=function(){var E=!1;if(65===Rt()){var D=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(D){var X=D[1].split("."),J=Ze(X,4),$t=J[3];E=3325===parseInt(J[2],10)&&parseInt($t,10)<148}}return function(){return E}}(),xt=function(){var E=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return E}}(),zt=function(){var D=90==window.orientation||-90==window.orientation;return xt()?!D:D},ri=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},di=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Yi=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},Mn=function(D,X,J,xe){var Xe=D.createShader(D.VERTEX_SHADER);D.shaderSource(Xe,X),D.compileShader(Xe);var st=D.createShader(D.FRAGMENT_SHADER);D.shaderSource(st,J),D.compileShader(st);var $t=D.createProgram();for(var Ft in D.attachShader($t,Xe),D.attachShader($t,st),xe)D.bindAttribLocation($t,xe[Ft],Ft);return D.linkProgram($t),D.deleteShader(Xe),D.deleteShader(st),$t},Kt=function(D,X){for(var J={},xe=D.getProgramParameter(X,D.ACTIVE_UNIFORMS),Xe="",st=0;st<xe;st++)J[Xe=D.getActiveUniform(X,st).name.replace("[0]","")]=D.getUniformLocation(X,Xe);return J},tn=function(){var X,D=!1;return X=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(X)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(X.substr(0,4)))&&(D=!0),D},An=function(D,X){for(var J in X)X.hasOwnProperty(J)&&(D[J]=X[J]);return D},nn=function(D){if(ht()){var X=D.style.width,J=D.style.height;D.style.width=parseInt(X)+1+"px",D.style.height=parseInt(J)+"px",setTimeout(function(){D.style.width=X,D.style.height=J},100)}window.canvas=D},bn=function(){var E=Math.PI/180,D=.25*Math.PI;var st=new Float32Array([0,0,0,1]),$t=new Float32Array([0,0,0]);function Ft(bt,Ot,hi,Bi,ji,Ki){(function X(bt,Ot,hi,Bi){var ji=Math.tan(Ot?Ot.upDegrees*E:D),Ki=Math.tan(Ot?Ot.downDegrees*E:D),Sn=Math.tan(Ot?Ot.leftDegrees*E:D),vn=Math.tan(Ot?Ot.rightDegrees*E:D),pn=2/(Sn+vn),tr=2/(ji+Ki);return bt[0]=pn,bt[1]=0,bt[2]=0,bt[3]=0,bt[4]=0,bt[5]=tr,bt[6]=0,bt[7]=0,bt[8]=-(Sn-vn)*pn*.5,bt[9]=(ji-Ki)*tr*.5,bt[10]=Bi/(hi-Bi),bt[11]=-1,bt[12]=0,bt[13]=0,bt[14]=Bi*hi/(hi-Bi),bt[15]=0,bt})(bt,Bi||null,Ki.depthNear,Ki.depthFar),function J(bt,Ot,hi){var Bi=Ot[0],ji=Ot[1],Ki=Ot[2],Sn=Ot[3],vn=Bi+Bi,pn=ji+ji,tr=Ki+Ki,fr=Bi*vn,Rr=Bi*pn,hr=Bi*tr,Yr=ji*pn,wa=ji*tr,Br=Ki*tr,yr=Sn*vn,aa=Sn*pn,Pn=Sn*tr;return bt[0]=1-(Yr+Br),bt[1]=Rr+Pn,bt[2]=hr-aa,bt[3]=0,bt[4]=Rr-Pn,bt[5]=1-(fr+Br),bt[6]=wa+yr,bt[7]=0,bt[8]=hr+aa,bt[9]=wa-yr,bt[10]=1-(fr+Yr),bt[11]=0,bt[12]=hi[0],bt[13]=hi[1],bt[14]=hi[2],bt[15]=1,bt}(Ot,hi.orientation||st,hi.position||$t),ji&&function xe(bt,Ot,hi){var Sn,vn,pn,tr,fr,Rr,hr,Yr,wa,Br,yr,aa,Bi=hi[0],ji=hi[1],Ki=hi[2];return Ot===bt?(bt[12]=Ot[0]*Bi+Ot[4]*ji+Ot[8]*Ki+Ot[12],bt[13]=Ot[1]*Bi+Ot[5]*ji+Ot[9]*Ki+Ot[13],bt[14]=Ot[2]*Bi+Ot[6]*ji+Ot[10]*Ki+Ot[14],bt[15]=Ot[3]*Bi+Ot[7]*ji+Ot[11]*Ki+Ot[15]):(vn=Ot[1],pn=Ot[2],tr=Ot[3],fr=Ot[4],Rr=Ot[5],hr=Ot[6],Yr=Ot[7],wa=Ot[8],Br=Ot[9],yr=Ot[10],aa=Ot[11],bt[0]=Sn=Ot[0],bt[1]=vn,bt[2]=pn,bt[3]=tr,bt[4]=fr,bt[5]=Rr,bt[6]=hr,bt[7]=Yr,bt[8]=wa,bt[9]=Br,bt[10]=yr,bt[11]=aa,bt[12]=Sn*Bi+fr*ji+wa*Ki+Ot[12],bt[13]=vn*Bi+Rr*ji+Br*Ki+Ot[13],bt[14]=pn*Bi+hr*ji+yr*Ki+Ot[14],bt[15]=tr*Bi+Yr*ji+aa*Ki+Ot[15]),bt}(Ot,Ot,ji),function Xe(bt,Ot){var hi=Ot[0],Bi=Ot[1],ji=Ot[2],Ki=Ot[3],Sn=Ot[4],vn=Ot[5],pn=Ot[6],tr=Ot[7],fr=Ot[8],Rr=Ot[9],hr=Ot[10],Yr=Ot[11],wa=Ot[12],Br=Ot[13],yr=Ot[14],aa=Ot[15],Pn=hi*vn-Bi*Sn,cc=hi*pn-ji*Sn,Zo=hi*tr-Ki*Sn,hc=Bi*pn-ji*vn,$o=Bi*tr-Ki*vn,Jo=ji*tr-Ki*pn,el=fr*Br-Rr*wa,co=fr*yr-hr*wa,tl=fr*aa-Yr*wa,nu=Rr*yr-hr*Br,ru=Rr*aa-Yr*Br,au=hr*aa-Yr*yr,un=Pn*au-cc*ru+Zo*nu+hc*tl-$o*co+Jo*el;return un?(bt[0]=(vn*au-pn*ru+tr*nu)*(un=1/un),bt[1]=(ji*ru-Bi*au-Ki*nu)*un,bt[2]=(Br*Jo-yr*$o+aa*hc)*un,bt[3]=(hr*$o-Rr*Jo-Yr*hc)*un,bt[4]=(pn*tl-Sn*au-tr*co)*un,bt[5]=(hi*au-ji*tl+Ki*co)*un,bt[6]=(yr*Zo-wa*Jo-aa*cc)*un,bt[7]=(fr*Jo-hr*Zo+Yr*cc)*un,bt[8]=(Sn*ru-vn*tl+tr*el)*un,bt[9]=(Bi*tl-hi*ru-Ki*el)*un,bt[10]=(wa*$o-Br*Zo+aa*Pn)*un,bt[11]=(Rr*Zo-fr*$o-Yr*Pn)*un,bt[12]=(vn*co-Sn*nu-pn*el)*un,bt[13]=(hi*nu-Bi*co+ji*el)*un,bt[14]=(Br*cc-wa*hc-yr*Pn)*un,bt[15]=(fr*hc-Rr*cc+hr*Pn)*un,bt):null}(Ot,Ot)}return function(bt,Ot,hi){return!(!bt||!Ot||(bt.pose=Ot,bt.timestamp=Ot.timestamp,Ft(bt.leftProjectionMatrix,bt.leftViewMatrix,Ot,hi._getFieldOfView("left"),hi._getEyeOffset("left"),hi),Ft(bt.rightProjectionMatrix,bt.rightViewMatrix,Ot,hi._getFieldOfView("right"),hi._getEyeOffset("right"),hi),0))}}(),fi=function(D){var J=D.indexOf("://"),xe=D.indexOf("/",-1!==J?J+3:0);return-1===xe&&(xe=D.length),D.substring(0,xe)},Si=function(){var E={};return function(D,X){void 0===E[D]&&(console.warn("webvr-polyfill: "+X),E[D]=!0)}}(),Ui=function(D,X){Si(D,D+" has been deprecated. This may not work on native WebVR displays. "+(X?"Please use "+X+" instead.":""))};var Fe=function pt(E,D,X){if(D){for(var J=[],xe=null,Xe=0;Xe<D.length;++Xe)switch(st=D[Xe]){case E.TEXTURE_BINDING_2D:case E.TEXTURE_BINDING_CUBE_MAP:if(($t=D[++Xe])<E.TEXTURE0||$t>E.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),J.push(null,null);break}xe||(xe=E.getParameter(E.ACTIVE_TEXTURE)),E.activeTexture($t),J.push(E.getParameter(st),null);break;case E.ACTIVE_TEXTURE:xe=E.getParameter(E.ACTIVE_TEXTURE),J.push(null);break;default:J.push(E.getParameter(st))}for(X(E),Xe=0;Xe<D.length;++Xe){var st,Ft=J[Xe];switch(st=D[Xe]){case E.ACTIVE_TEXTURE:break;case E.ARRAY_BUFFER_BINDING:E.bindBuffer(E.ARRAY_BUFFER,Ft);break;case E.COLOR_CLEAR_VALUE:E.clearColor(Ft[0],Ft[1],Ft[2],Ft[3]);break;case E.COLOR_WRITEMASK:E.colorMask(Ft[0],Ft[1],Ft[2],Ft[3]);break;case E.CURRENT_PROGRAM:E.useProgram(Ft);break;case E.ELEMENT_ARRAY_BUFFER_BINDING:E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,Ft);break;case E.FRAMEBUFFER_BINDING:E.bindFramebuffer(E.FRAMEBUFFER,Ft);break;case E.RENDERBUFFER_BINDING:E.bindRenderbuffer(E.RENDERBUFFER,Ft);break;case E.TEXTURE_BINDING_2D:if(($t=D[++Xe])<E.TEXTURE0||$t>E.TEXTURE31)break;E.activeTexture($t),E.bindTexture(E.TEXTURE_2D,Ft);break;case E.TEXTURE_BINDING_CUBE_MAP:var $t;if(($t=D[++Xe])<E.TEXTURE0||$t>E.TEXTURE31)break;E.activeTexture($t),E.bindTexture(E.TEXTURE_CUBE_MAP,Ft);break;case E.VIEWPORT:E.viewport(Ft[0],Ft[1],Ft[2],Ft[3]);break;case E.BLEND:case E.CULL_FACE:case E.DEPTH_TEST:case E.SCISSOR_TEST:case E.STENCIL_TEST:Ft?E.enable(st):E.disable(st);break;default:console.log("No GL restore behavior for 0x"+st.toString(16))}xe&&E.activeTexture(xe)}}else X(E)},Re=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),oi=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function Wt(E,D,X,J){this.gl=E,this.cardboardUI=D,this.bufferScale=X,this.dirtySubmitFrameBindings=J,this.ctxAttribs=E.getContextAttributes(),this.instanceExt=E.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=E.drawingBufferWidth,this.bufferHeight=E.drawingBufferHeight,this.realBindFramebuffer=E.bindFramebuffer,this.realEnable=E.enable,this.realDisable=E.disable,this.realColorMask=E.colorMask,this.realClearColor=E.clearColor,this.realViewport=E.viewport,ht()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(E.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(E.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=Mn(E,Re,oi,this.attribs),this.uniforms=Kt(E,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=E.createBuffer(),this.indexBuffer=E.createBuffer(),this.indexCount=0,this.renderTarget=E.createTexture(),this.framebuffer=E.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=E.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=E.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=E.createRenderbuffer()),this.patch(),this.onResize()}Wt.prototype.destroy=function(){var E=this.gl;this.unpatch(),E.deleteProgram(this.program),E.deleteBuffer(this.vertexBuffer),E.deleteBuffer(this.indexBuffer),E.deleteTexture(this.renderTarget),E.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&E.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&E.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&E.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},Wt.prototype.onResize=function(){var E=this.gl,D=this;Fe(E,[E.RENDERBUFFER_BINDING,E.TEXTURE_BINDING_2D,E.TEXTURE0],function(J){D.realBindFramebuffer.call(J,J.FRAMEBUFFER,null),D.scissorTest&&D.realDisable.call(J,J.SCISSOR_TEST),D.realColorMask.call(J,!0,!0,!0,!0),D.realViewport.call(J,0,0,J.drawingBufferWidth,J.drawingBufferHeight),D.realClearColor.call(J,0,0,0,1),J.clear(J.COLOR_BUFFER_BIT),D.realBindFramebuffer.call(J,J.FRAMEBUFFER,D.framebuffer),J.bindTexture(J.TEXTURE_2D,D.renderTarget),J.texImage2D(J.TEXTURE_2D,0,D.ctxAttribs.alpha?J.RGBA:J.RGB,D.bufferWidth,D.bufferHeight,0,D.ctxAttribs.alpha?J.RGBA:J.RGB,J.UNSIGNED_BYTE,null),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,D.renderTarget,0),D.ctxAttribs.depth&&D.ctxAttribs.stencil?(J.bindRenderbuffer(J.RENDERBUFFER,D.depthStencilBuffer),J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_STENCIL,D.bufferWidth,D.bufferHeight),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_STENCIL_ATTACHMENT,J.RENDERBUFFER,D.depthStencilBuffer)):D.ctxAttribs.depth?(J.bindRenderbuffer(J.RENDERBUFFER,D.depthBuffer),J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,D.bufferWidth,D.bufferHeight),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,D.depthBuffer)):D.ctxAttribs.stencil&&(J.bindRenderbuffer(J.RENDERBUFFER,D.stencilBuffer),J.renderbufferStorage(J.RENDERBUFFER,J.STENCIL_INDEX8,D.bufferWidth,D.bufferHeight),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.STENCIL_ATTACHMENT,J.RENDERBUFFER,D.stencilBuffer)),!J.checkFramebufferStatus(J.FRAMEBUFFER)===J.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),D.realBindFramebuffer.call(J,J.FRAMEBUFFER,D.lastBoundFramebuffer),D.scissorTest&&D.realEnable.call(J,J.SCISSOR_TEST),D.realColorMask.apply(J,D.colorMask),D.realViewport.apply(J,D.viewport),D.realClearColor.apply(J,D.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},Wt.prototype.patch=function(){if(!this.isPatched){var E=this,D=this.gl.canvas,X=this.gl;ht()||(D.width=ri()*this.bufferScale,D.height=di()*this.bufferScale,Object.defineProperty(D,"width",{configurable:!0,enumerable:!0,get:function(){return E.bufferWidth},set:function(xe){E.bufferWidth=xe,E.realCanvasWidth.set.call(D,xe),E.onResize()}}),Object.defineProperty(D,"height",{configurable:!0,enumerable:!0,get:function(){return E.bufferHeight},set:function(xe){E.bufferHeight=xe,E.realCanvasHeight.set.call(D,xe),E.onResize()}})),this.lastBoundFramebuffer=X.getParameter(X.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(X.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(J,xe){E.lastBoundFramebuffer=xe||E.framebuffer,E.realBindFramebuffer.call(X,J,E.lastBoundFramebuffer)},this.cullFace=X.getParameter(X.CULL_FACE),this.depthTest=X.getParameter(X.DEPTH_TEST),this.blend=X.getParameter(X.BLEND),this.scissorTest=X.getParameter(X.SCISSOR_TEST),this.stencilTest=X.getParameter(X.STENCIL_TEST),X.enable=function(J){switch(J){case X.CULL_FACE:E.cullFace=!0;break;case X.DEPTH_TEST:E.depthTest=!0;break;case X.BLEND:E.blend=!0;break;case X.SCISSOR_TEST:E.scissorTest=!0;break;case X.STENCIL_TEST:E.stencilTest=!0}E.realEnable.call(X,J)},X.disable=function(J){switch(J){case X.CULL_FACE:E.cullFace=!1;break;case X.DEPTH_TEST:E.depthTest=!1;break;case X.BLEND:E.blend=!1;break;case X.SCISSOR_TEST:E.scissorTest=!1;break;case X.STENCIL_TEST:E.stencilTest=!1}E.realDisable.call(X,J)},this.colorMask=X.getParameter(X.COLOR_WRITEMASK),X.colorMask=function(J,xe,Xe,st){E.colorMask[0]=J,E.colorMask[1]=xe,E.colorMask[2]=Xe,E.colorMask[3]=st,E.realColorMask.call(X,J,xe,Xe,st)},this.clearColor=X.getParameter(X.COLOR_CLEAR_VALUE),X.clearColor=function(J,xe,Xe,st){E.clearColor[0]=J,E.clearColor[1]=xe,E.clearColor[2]=Xe,E.clearColor[3]=st,E.realClearColor.call(X,J,xe,Xe,st)},this.viewport=X.getParameter(X.VIEWPORT),X.viewport=function(J,xe,Xe,st){E.viewport[0]=J,E.viewport[1]=xe,E.viewport[2]=Xe,E.viewport[3]=st,E.realViewport.call(X,J,xe,Xe,st)},this.isPatched=!0,nn(D)}},Wt.prototype.unpatch=function(){if(this.isPatched){var E=this.gl,D=this.gl.canvas;ht()||(Object.defineProperty(D,"width",this.realCanvasWidth),Object.defineProperty(D,"height",this.realCanvasHeight)),D.width=this.bufferWidth,D.height=this.bufferHeight,E.bindFramebuffer=this.realBindFramebuffer,E.enable=this.realEnable,E.disable=this.realDisable,E.colorMask=this.realColorMask,E.clearColor=this.realClearColor,E.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&E.bindFramebuffer(E.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){nn(D)},1)}},Wt.prototype.setTextureBounds=function(E,D){E||(E=[0,0,.5,1]),D||(D=[.5,0,.5,1]),this.viewportOffsetScale[0]=E[0],this.viewportOffsetScale[1]=E[1],this.viewportOffsetScale[2]=E[2],this.viewportOffsetScale[3]=E[3],this.viewportOffsetScale[4]=D[0],this.viewportOffsetScale[5]=D[1],this.viewportOffsetScale[6]=D[2],this.viewportOffsetScale[7]=D[3]},Wt.prototype.submitFrame=function(){var E=this.gl,D=this,X=[];if(this.dirtySubmitFrameBindings||X.push(E.CURRENT_PROGRAM,E.ARRAY_BUFFER_BINDING,E.ELEMENT_ARRAY_BUFFER_BINDING,E.TEXTURE_BINDING_2D,E.TEXTURE0),Fe(E,X,function(xe){D.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,null);var Xe=0,st=0;D.instanceExt&&(Xe=xe.getVertexAttrib(D.attribs.position,D.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),st=xe.getVertexAttrib(D.attribs.texCoord,D.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),D.cullFace&&D.realDisable.call(xe,xe.CULL_FACE),D.depthTest&&D.realDisable.call(xe,xe.DEPTH_TEST),D.blend&&D.realDisable.call(xe,xe.BLEND),D.scissorTest&&D.realDisable.call(xe,xe.SCISSOR_TEST),D.stencilTest&&D.realDisable.call(xe,xe.STENCIL_TEST),D.realColorMask.call(xe,!0,!0,!0,!0),D.realViewport.call(xe,0,0,xe.drawingBufferWidth,xe.drawingBufferHeight),(D.ctxAttribs.alpha||ht())&&(D.realClearColor.call(xe,0,0,0,1),xe.clear(xe.COLOR_BUFFER_BIT)),xe.useProgram(D.program),xe.bindBuffer(xe.ELEMENT_ARRAY_BUFFER,D.indexBuffer),xe.bindBuffer(xe.ARRAY_BUFFER,D.vertexBuffer),xe.enableVertexAttribArray(D.attribs.position),xe.enableVertexAttribArray(D.attribs.texCoord),xe.vertexAttribPointer(D.attribs.position,2,xe.FLOAT,!1,20,0),xe.vertexAttribPointer(D.attribs.texCoord,3,xe.FLOAT,!1,20,8),D.instanceExt&&(0!=Xe&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.position,0),0!=st&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.texCoord,0)),xe.activeTexture(xe.TEXTURE0),xe.uniform1i(D.uniforms.diffuse,0),xe.bindTexture(xe.TEXTURE_2D,D.renderTarget),xe.uniform4fv(D.uniforms.viewportOffsetScale,D.viewportOffsetScale),xe.drawElements(xe.TRIANGLES,D.indexCount,xe.UNSIGNED_SHORT,0),D.cardboardUI&&D.cardboardUI.renderNoState(),D.realBindFramebuffer.call(D.gl,xe.FRAMEBUFFER,D.framebuffer),D.ctxAttribs.preserveDrawingBuffer||(D.realClearColor.call(xe,0,0,0,0),xe.clear(xe.COLOR_BUFFER_BIT)),D.dirtySubmitFrameBindings||D.realBindFramebuffer.call(xe,xe.FRAMEBUFFER,D.lastBoundFramebuffer),D.cullFace&&D.realEnable.call(xe,xe.CULL_FACE),D.depthTest&&D.realEnable.call(xe,xe.DEPTH_TEST),D.blend&&D.realEnable.call(xe,xe.BLEND),D.scissorTest&&D.realEnable.call(xe,xe.SCISSOR_TEST),D.stencilTest&&D.realEnable.call(xe,xe.STENCIL_TEST),D.realColorMask.apply(xe,D.colorMask),D.realViewport.apply(xe,D.viewport),(D.ctxAttribs.alpha||!D.ctxAttribs.preserveDrawingBuffer)&&D.realClearColor.apply(xe,D.clearColor),D.instanceExt&&(0!=Xe&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.position,Xe),0!=st&&D.instanceExt.vertexAttribDivisorANGLE(D.attribs.texCoord,st))}),ht()){var J=E.canvas;(J.width!=D.bufferWidth||J.height!=D.bufferHeight)&&(D.bufferWidth=J.width,D.bufferHeight=J.height,D.onResize())}},Wt.prototype.updateDeviceInfo=function(E){var D=this.gl,X=this;Fe(D,[D.ARRAY_BUFFER_BINDING,D.ELEMENT_ARRAY_BUFFER_BINDING],function(xe){var Xe=X.computeMeshVertices_(X.meshWidth,X.meshHeight,E);if(xe.bindBuffer(xe.ARRAY_BUFFER,X.vertexBuffer),xe.bufferData(xe.ARRAY_BUFFER,Xe,xe.STATIC_DRAW),!X.indexCount){var st=X.computeMeshIndices_(X.meshWidth,X.meshHeight);xe.bindBuffer(xe.ELEMENT_ARRAY_BUFFER,X.indexBuffer),xe.bufferData(xe.ELEMENT_ARRAY_BUFFER,st,xe.STATIC_DRAW),X.indexCount=st.length}})},Wt.prototype.computeMeshVertices_=function(E,D,X){for(var J=new Float32Array(2*E*D*5),xe=X.getLeftEyeVisibleTanAngles(),Xe=X.getLeftEyeNoLensTanAngles(),st=X.getLeftEyeVisibleScreenRect(Xe),$t=0,Ft=0;Ft<2;Ft++){for(var bt=0;bt<D;bt++)for(var Ot=0;Ot<E;Ot++,$t++){var hi=Ot/(E-1),Bi=bt/(D-1),ji=hi,Ki=Bi,Sn=Gt(xe[0],xe[2],hi),vn=Gt(xe[3],xe[1],Bi),pn=Math.sqrt(Sn*Sn+vn*vn),tr=X.distortion.distortInverse(pn);Bi=2*(st.y+(Bi=(vn*tr/pn-Xe[3])/(Xe[1]-Xe[3]))*st.height-.5),J[5*$t+0]=hi=2*(st.x+(hi=(Sn*tr/pn-Xe[0])/(Xe[2]-Xe[0]))*st.width-.5),J[5*$t+1]=Bi,J[5*$t+2]=ji,J[5*$t+3]=Ki,J[5*$t+4]=Ft}var hr=xe[2]-xe[0];xe[0]=-(hr+xe[0]),xe[2]=hr-xe[2],Xe[0]=-((hr=Xe[2]-Xe[0])+Xe[0]),Xe[2]=hr-Xe[2],st.x=1-(st.x+st.width)}return J},Wt.prototype.computeMeshIndices_=function(E,D){for(var X=new Uint16Array(2*(E-1)*(D-1)*6),J=E/2,xe=D/2,Xe=0,st=0,$t=0;$t<2;$t++)for(var Ft=0;Ft<D;Ft++)for(var bt=0;bt<E;bt++,Xe++)0==bt||0==Ft||(bt<=J==Ft<=xe?(X[st++]=Xe,X[st++]=Xe-E-1,X[st++]=Xe-E,X[st++]=Xe-E-1,X[st++]=Xe,X[st++]=Xe-1):(X[st++]=Xe-1,X[st++]=Xe-E,X[st++]=Xe,X[st++]=Xe-E,X[st++]=Xe-1,X[st++]=Xe-E-1));return X},Wt.prototype.getOwnPropertyDescriptor_=function(E,D){var X=Object.getOwnPropertyDescriptor(E,D);return(void 0===X.get||void 0===X.set)&&(X.configurable=!0,X.enumerable=!0,X.get=function(){return this.getAttribute(D)},X.set=function(J){this.setAttribute(D,J)}),X};var ot=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),pi=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),Di=Math.PI/180;function is(E){this.gl=E,this.attribs={position:0},this.program=Mn(E,ot,pi,this.attribs),this.uniforms=Kt(E,this.program),this.vertexBuffer=E.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function eu(E){this.coefficients=E}is.prototype.destroy=function(){var E=this.gl;this.listener&&E.canvas.removeEventListener("click",this.listener,!1),E.deleteProgram(this.program),E.deleteBuffer(this.vertexBuffer)},is.prototype.listen=function(E,D){var X=this.gl.canvas;this.listener=function(J){var xe=X.clientWidth/2;J.clientX>xe-42&&J.clientX<xe+42&&J.clientY>X.clientHeight-42?E(J):J.clientX<42&&J.clientY<42&&D(J)},X.addEventListener("click",this.listener,!1)},is.prototype.onResize=function(){var E=this.gl,D=this;Fe(E,[E.ARRAY_BUFFER_BINDING],function(J){var xe=[],Xe=J.drawingBufferWidth/2,st=Math.max(screen.width,screen.height)*window.devicePixelRatio,Ft=J.drawingBufferWidth/st*window.devicePixelRatio,bt=4*Ft/2,Ot=42*Ft,hi=28*Ft/2,Bi=14*Ft;function ji(tr,fr){var Rr=(90-tr)*Di,hr=Math.cos(Rr),Yr=Math.sin(Rr);xe.push(.3125*hr*hi+Xe,.3125*Yr*hi+hi),xe.push(fr*hr*hi+Xe,fr*Yr*hi+hi)}xe.push(Xe-bt,Ot),xe.push(Xe-bt,J.drawingBufferHeight),xe.push(Xe+bt,Ot),xe.push(Xe+bt,J.drawingBufferHeight),D.gearOffset=xe.length/2;for(var Ki=0;Ki<=6;Ki++){var Sn=60*Ki;ji(Sn,1),ji(Sn+12,1),ji(Sn+20,.75),ji(Sn+40,.75),ji(Sn+48,1)}function vn(tr,fr){xe.push(Bi+tr,J.drawingBufferHeight-Bi-fr)}D.gearVertexCount=xe.length/2-D.gearOffset,D.arrowOffset=xe.length/2;var pn=bt/Math.sin(45*Di);vn(0,hi),vn(hi,0),vn(hi+pn,pn),vn(pn,hi+pn),vn(pn,hi-pn),vn(0,hi),vn(hi,2*hi),vn(hi+pn,2*hi-pn),vn(pn,hi-pn),vn(0,hi),vn(pn,hi-bt),vn(28*Ft,hi-bt),vn(pn,hi+bt),vn(28*Ft,hi+bt),D.arrowVertexCount=xe.length/2-D.arrowOffset,J.bindBuffer(J.ARRAY_BUFFER,D.vertexBuffer),J.bufferData(J.ARRAY_BUFFER,new Float32Array(xe),J.STATIC_DRAW)})},is.prototype.render=function(){var E=this.gl,D=this;Fe(E,[E.CULL_FACE,E.DEPTH_TEST,E.BLEND,E.SCISSOR_TEST,E.STENCIL_TEST,E.COLOR_WRITEMASK,E.VIEWPORT,E.CURRENT_PROGRAM,E.ARRAY_BUFFER_BINDING],function(J){J.disable(J.CULL_FACE),J.disable(J.DEPTH_TEST),J.disable(J.BLEND),J.disable(J.SCISSOR_TEST),J.disable(J.STENCIL_TEST),J.colorMask(!0,!0,!0,!0),J.viewport(0,0,J.drawingBufferWidth,J.drawingBufferHeight),D.renderNoState()})},is.prototype.renderNoState=function(){var D,X,J,xe,Xe,st,$t,Ft,bt,Ot,E=this.gl;E.useProgram(this.program),E.bindBuffer(E.ARRAY_BUFFER,this.vertexBuffer),E.enableVertexAttribArray(this.attribs.position),E.vertexAttribPointer(this.attribs.position,2,E.FLOAT,!1,8,0),E.uniform4f(this.uniforms.color,1,1,1,1),bt=1/((xe=0)-(Xe=E.drawingBufferHeight)),Ot=1/((st=.1)-($t=1024)),(D=this.projMat)[0]=-2*(Ft=1/((X=0)-(J=E.drawingBufferWidth))),D[1]=0,D[2]=0,D[3]=0,D[4]=0,D[5]=-2*bt,D[6]=0,D[7]=0,D[8]=0,D[9]=0,D[10]=2*Ot,D[11]=0,D[12]=(X+J)*Ft,D[13]=(Xe+xe)*bt,D[14]=($t+st)*Ot,D[15]=1,E.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),E.drawArrays(E.TRIANGLE_STRIP,0,4),E.drawArrays(E.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),E.drawArrays(E.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},eu.prototype.distortInverse=function(E){for(var D=0,X=1,J=E-this.distort(D);Math.abs(X-D)>1e-4;){var xe=E-this.distort(X),Xe=X-xe*((X-D)/(xe-J));D=X,X=Xe,J=xe}return X},eu.prototype.distort=function(E){for(var D=E*E,X=0,J=0;J<this.coefficients.length;J++)X=D*(X+this.coefficients[J]);return(X+1)*E};var Aa=Math.PI/180,Ua=180/Math.PI,Kn=function(D,X,J){this.x=D||0,this.y=X||0,this.z=J||0};Kn.prototype={constructor:Kn,set:function(D,X,J){return this.x=D,this.y=X,this.z=J,this},copy:function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var D=this.length();return 0!==D?this.multiplyScalar(1/D):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(D){this.x*=D,this.y*=D,this.z*=D},applyQuaternion:function(D){var X=this.x,J=this.y,xe=this.z,Xe=D.x,st=D.y,$t=D.z,Ft=D.w,bt=Ft*X+st*xe-$t*J,Ot=Ft*J+$t*X-Xe*xe,hi=Ft*xe+Xe*J-st*X,Bi=-Xe*X-st*J-$t*xe;return this.x=bt*Ft+Bi*-Xe+Ot*-$t-hi*-st,this.y=Ot*Ft+Bi*-st+hi*-Xe-bt*-$t,this.z=hi*Ft+Bi*-$t+bt*-st-Ot*-Xe,this},dot:function(D){return this.x*D.x+this.y*D.y+this.z*D.z},crossVectors:function(D,X){var J=D.x,xe=D.y,Xe=D.z,st=X.x,$t=X.y,Ft=X.z;return this.x=xe*Ft-Xe*$t,this.y=Xe*st-J*Ft,this.z=J*$t-xe*st,this}};var fn=function(D,X,J,xe){this.x=D||0,this.y=X||0,this.z=J||0,this.w=void 0!==xe?xe:1};function bs(E){this.width=E.width||ri(),this.height=E.height||di(),this.widthMeters=E.widthMeters,this.heightMeters=E.heightMeters,this.bevelMeters=E.bevelMeters}fn.prototype={constructor:fn,set:function(D,X,J,xe){return this.x=D,this.y=X,this.z=J,this.w=xe,this},copy:function(D){return this.x=D.x,this.y=D.y,this.z=D.z,this.w=D.w,this},setFromEulerXYZ:function(D,X,J){var xe=Math.cos(D/2),Xe=Math.cos(X/2),st=Math.cos(J/2),$t=Math.sin(D/2),Ft=Math.sin(X/2),bt=Math.sin(J/2);return this.x=$t*Xe*st+xe*Ft*bt,this.y=xe*Ft*st-$t*Xe*bt,this.z=xe*Xe*bt+$t*Ft*st,this.w=xe*Xe*st-$t*Ft*bt,this},setFromEulerYXZ:function(D,X,J){var xe=Math.cos(D/2),Xe=Math.cos(X/2),st=Math.cos(J/2),$t=Math.sin(D/2),Ft=Math.sin(X/2),bt=Math.sin(J/2);return this.x=$t*Xe*st+xe*Ft*bt,this.y=xe*Ft*st-$t*Xe*bt,this.z=xe*Xe*bt-$t*Ft*st,this.w=xe*Xe*st+$t*Ft*bt,this},setFromAxisAngle:function(D,X){var J=X/2,xe=Math.sin(J);return this.x=D.x*xe,this.y=D.y*xe,this.z=D.z*xe,this.w=Math.cos(J),this},multiply:function(D){return this.multiplyQuaternions(this,D)},multiplyQuaternions:function(D,X){var J=D.x,xe=D.y,Xe=D.z,st=D.w,$t=X.x,Ft=X.y,bt=X.z,Ot=X.w;return this.x=J*Ot+st*$t+xe*bt-Xe*Ft,this.y=xe*Ot+st*Ft+Xe*$t-J*bt,this.z=Xe*Ot+st*bt+J*Ft-xe*$t,this.w=st*Ot-J*$t-xe*Ft-Xe*bt,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var D=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===D?(this.x=0,this.y=0,this.z=0,this.w=1):(this.x=this.x*(D=1/D),this.y=this.y*D,this.z=this.z*D,this.w=this.w*D),this},slerp:function(D,X){if(0===X)return this;if(1===X)return this.copy(D);var J=this.x,xe=this.y,Xe=this.z,st=this.w,$t=st*D.w+J*D.x+xe*D.y+Xe*D.z;if($t<0?(this.w=-D.w,this.x=-D.x,this.y=-D.y,this.z=-D.z,$t=-$t):this.copy(D),$t>=1)return this.w=st,this.x=J,this.y=xe,this.z=Xe,this;var Ft=Math.acos($t),bt=Math.sqrt(1-$t*$t);if(Math.abs(bt)<.001)return this.w=.5*(st+this.w),this.x=.5*(J+this.x),this.y=.5*(xe+this.y),this.z=.5*(Xe+this.z),this;var Ot=Math.sin((1-X)*Ft)/bt,hi=Math.sin(X*Ft)/bt;return this.w=st*Ot+this.w*hi,this.x=J*Ot+this.x*hi,this.y=xe*Ot+this.y*hi,this.z=Xe*Ot+this.z*hi,this},setFromUnitVectors:function(){var E,D;return function(J,xe){return void 0===E&&(E=new Kn),(D=J.dot(xe)+1)<1e-6?(D=0,Math.abs(J.x)>Math.abs(J.z)?E.set(-J.y,J.x,0):E.set(0,-J.z,J.y)):E.crossVectors(J,xe),this.x=E.x,this.y=E.y,this.z=E.z,this.w=D,this.normalize(),this}}()};var uc=new bs({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Bh=new bs({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),tu={CardboardV1:new iu({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new iu({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};function Bn(E,D){this.viewer=tu.CardboardV2,this.updateDeviceParams(E),this.distortion=new eu(this.viewer.distortionCoefficients);for(var X=0;X<D.length;X++){var J=D[X];tu[J.id]=new iu(J)}}function iu(E){this.id=E.id,this.label=E.label,this.fov=E.fov,this.interLensDistance=E.interLensDistance,this.baselineLensDistance=E.baselineLensDistance,this.screenLensDistance=E.screenLensDistance,this.distortionCoefficients=E.distortionCoefficients,this.inverseCoefficients=E.inverseCoefficients}Bn.prototype.updateDeviceParams=function(E){this.device=this.determineDevice_(E)||this.device},Bn.prototype.getDevice=function(){return this.device},Bn.prototype.setViewer=function(E){this.viewer=E,this.distortion=new eu(this.viewer.distortionCoefficients)},Bn.prototype.determineDevice_=function(E){if(!E)return ht()?(console.warn("Using fallback iOS device measurements."),Bh):(console.warn("Using fallback Android device measurements."),uc);var D=.0254,J=D/E.ydpi;return new bs({widthMeters:D/E.xdpi*ri(),heightMeters:J*di(),bevelMeters:.001*E.bevelMm})},Bn.prototype.getDistortedFieldOfViewLeftEye=function(){var E=this.viewer,D=this.device,X=this.distortion,J=E.screenLensDistance,Xe=E.interLensDistance/2,st=E.baselineLensDistance-D.bevelMeters,$t=D.heightMeters-st,Ft=Ua*Math.atan(X.distort((D.widthMeters-E.interLensDistance)/2/J)),bt=Ua*Math.atan(X.distort(Xe/J)),Ot=Ua*Math.atan(X.distort(st/J)),hi=Ua*Math.atan(X.distort($t/J));return{leftDegrees:Math.min(Ft,E.fov),rightDegrees:Math.min(bt,E.fov),downDegrees:Math.min(Ot,E.fov),upDegrees:Math.min(hi,E.fov)}},Bn.prototype.getLeftEyeVisibleTanAngles=function(){var E=this.viewer,D=this.device,X=this.distortion,J=Math.tan(-Aa*E.fov),xe=Math.tan(Aa*E.fov),Xe=Math.tan(Aa*E.fov),st=Math.tan(-Aa*E.fov),$t=D.widthMeters/4,Ft=D.heightMeters/2,Ot=E.interLensDistance/2-$t,hi=-(E.baselineLensDistance-D.bevelMeters-Ft),Bi=E.screenLensDistance,ji=X.distort((Ot-$t)/Bi),Ki=X.distort((hi+Ft)/Bi),Sn=X.distort((Ot+$t)/Bi),vn=X.distort((hi-Ft)/Bi),pn=new Float32Array(4);return pn[0]=Math.max(J,ji),pn[1]=Math.min(xe,Ki),pn[2]=Math.min(Xe,Sn),pn[3]=Math.max(st,vn),pn},Bn.prototype.getLeftEyeNoLensTanAngles=function(){var E=this.viewer,D=this.device,X=this.distortion,J=new Float32Array(4),xe=X.distortInverse(Math.tan(-Aa*E.fov)),Xe=X.distortInverse(Math.tan(Aa*E.fov)),st=X.distortInverse(Math.tan(Aa*E.fov)),$t=X.distortInverse(Math.tan(-Aa*E.fov)),Ft=D.widthMeters/4,bt=D.heightMeters/2,hi=E.interLensDistance/2-Ft,Bi=-(E.baselineLensDistance-D.bevelMeters-bt),ji=E.screenLensDistance,Sn=(Bi+bt)/ji,vn=(hi+Ft)/ji,pn=(Bi-bt)/ji;return J[0]=Math.max(xe,(hi-Ft)/ji),J[1]=Math.min(Xe,Sn),J[2]=Math.min(st,vn),J[3]=Math.max($t,pn),J},Bn.prototype.getLeftEyeVisibleScreenRect=function(E){var D=this.viewer,X=this.device,J=D.screenLensDistance,xe=(X.widthMeters-D.interLensDistance)/2,Xe=D.baselineLensDistance-X.bevelMeters,st=(E[0]*J+xe)/X.widthMeters,bt=(E[3]*J+Xe)/X.heightMeters;return{x:st,y:bt,width:(E[2]*J+xe)/X.widthMeters-st,height:(E[1]*J+Xe)/X.heightMeters-bt}},Bn.prototype.getFieldOfViewLeftEye=function(E){return E?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},Bn.prototype.getFieldOfViewRightEye=function(E){var D=this.getFieldOfViewLeftEye(E);return{leftDegrees:D.rightDegrees,rightDegrees:D.leftDegrees,upDegrees:D.upDegrees,downDegrees:D.downDegrees}},Bn.prototype.getUndistortedFieldOfViewLeftEye=function(){var E=this.getUndistortedParams_();return{leftDegrees:Ua*Math.atan(E.outerDist),rightDegrees:Ua*Math.atan(E.innerDist),downDegrees:Ua*Math.atan(E.bottomDist),upDegrees:Ua*Math.atan(E.topDist)}},Bn.prototype.getUndistortedViewportLeftEye=function(){var E=this.getUndistortedParams_(),X=this.device,J=this.viewer.screenLensDistance,st=X.width/(X.widthMeters/J),$t=X.height/(X.heightMeters/J),Ft=Math.round((E.eyePosX-E.outerDist)*st),bt=Math.round((E.eyePosY-E.bottomDist)*$t);return{x:Ft,y:bt,width:Math.round((E.eyePosX+E.innerDist)*st)-Ft,height:Math.round((E.eyePosY+E.topDist)*$t)-bt}},Bn.prototype.getUndistortedParams_=function(){var E=this.viewer,D=this.device,J=E.screenLensDistance,xe=E.interLensDistance/2/J,st=D.heightMeters/J,$t=D.widthMeters/J/2-xe,Ft=(E.baselineLensDistance-D.bevelMeters)/J,Ot=this.distortion.distortInverse(Math.tan(Aa*E.fov)),hi=Math.min($t,Ot),Bi=Math.min(xe,Ot),ji=Math.min(Ft,Ot);return{outerDist:hi,innerDist:Bi,topDist:Math.min(st-Ft,Ot),bottomDist:ji,eyePosX:$t,eyePosY:Ft}},Bn.Viewers=tu;var Xt={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function Dt(E,D){if(this.dpdb=Xt,this.recalculateDeviceParams_(),E){this.onDeviceParamsUpdated=D;var X=new XMLHttpRequest,J=this;X.open("GET",E,!0),X.addEventListener("load",function(){J.loading=!1,X.status>=200&&X.status<=299?(J.dpdb=JSON.parse(X.response),J.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),X.send()}}function ii(E){this.xdpi=E.xdpi,this.ydpi=E.ydpi,this.bevelMm=E.bevelMm}function Ei(E,D){this.set(E,D)}function yn(E,D){this.kFilter=E,this.isDebug=D,this.currentAccelMeasurement=new Ei,this.currentGyroMeasurement=new Ei,this.previousGyroMeasurement=new Ei,this.filterQ=ht()?new fn(-1,0,0,1):new fn(1,0,0,1),this.previousFilterQ=new fn,this.previousFilterQ.copy(this.filterQ),this.accelQ=new fn,this.isOrientationInitialized=!1,this.estimatedGravity=new Kn,this.measuredGravity=new Kn,this.gyroIntegralQ=new fn}function Tn(E,D){this.predictionTimeS=E,this.isDebug=D,this.previousQ=new fn,this.previousTimestampS=null,this.deltaQ=new fn,this.outQ=new fn}function c(E,D,X,J){this.yawOnly=X,this.accelerometer=new Kn,this.gyroscope=new Kn,this.filter=new yn(E,J),this.posePredictor=new Tn(D,J),this.isFirefoxAndroid=Yt(),this.isIOS=ht();var xe=Rt();this.isDeviceMotionInRadians=!this.isIOS&&xe&&xe<66,this.isWithoutDeviceMotion=ut()||qe(),this.filterToWorldQ=new fn,ht()?this.filterToWorldQ.setFromAxisAngle(new Kn(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new Kn(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new fn,this.worldToScreenQ=new fn,this.originalPoseAdjustQ=new fn,this.originalPoseAdjustQ.setFromAxisAngle(new Kn(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),zt()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new fn,this.orientationOut_=new Float32Array(4),this.start()}Dt.prototype.getDeviceParams=function(){return this.deviceParams},Dt.prototype.recalculateDeviceParams_=function(){var E=this.calcDeviceParams_();E?(this.deviceParams=E,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},Dt.prototype.calcDeviceParams_=function(){var E=this.dpdb;if(!E)return console.error("DPDB not available."),null;if(1!=E.format)return console.error("DPDB has unexpected format version."),null;if(!E.devices||!E.devices.length)return console.error("DPDB does not have a devices section."),null;var D=navigator.userAgent||navigator.vendor||window.opera,X=ri(),J=di();if(!E.devices)return console.error("DPDB has no devices section."),null;for(var xe=0;xe<E.devices.length;xe++){var Xe=E.devices[xe];if(Xe.rules)if("ios"==Xe.type||"android"==Xe.type){if(ht()==("ios"==Xe.type)){for(var st=!1,$t=0;$t<Xe.rules.length;$t++)if(this.ruleMatches_(Xe.rules[$t],D,X,J)){st=!0;break}if(st)return new ii({xdpi:Xe.dpi[0]||Xe.dpi,ydpi:Xe.dpi[1]||Xe.dpi,bevelMm:Xe.bw})}}else console.warn("Device["+xe+"] has invalid type.");else console.warn("Device["+xe+"] has no rules section.")}return console.warn("No DPDB device match."),null},Dt.prototype.ruleMatches_=function(E,D,X,J){if(!E.ua&&!E.res||(E.ua&&"SM"===E.ua.substring(0,2)&&(E.ua=E.ua.substring(0,7)),E.ua&&D.indexOf(E.ua)<0))return!1;if(E.res){if(!E.res[0]||!E.res[1])return!1;var xe=E.res[0],Xe=E.res[1];if(Math.min(X,J)!=Math.min(xe,Xe)||Math.max(X,J)!=Math.max(xe,Xe))return!1}return!0},Ei.prototype.set=function(E,D){this.sample=E,this.timestampS=D},Ei.prototype.copy=function(E){this.set(E.sample,E.timestampS)},yn.prototype.addAccelMeasurement=function(E,D){this.currentAccelMeasurement.set(E,D)},yn.prototype.addGyroMeasurement=function(E,D){this.currentGyroMeasurement.set(E,D),function(D){return!(isNaN(D)||D<=.001||D>1)}(D-this.previousGyroMeasurement.timestampS)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},yn.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var D=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);this.gyroIntegralQ.multiply(D),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(D);var X=new fn;X.copy(this.filterQ),X.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(X),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var J=new fn;J.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),J.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Ua*function(D){return D.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(D.w)}(J),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var xe=new fn;xe.copy(this.filterQ),xe.multiply(J),this.filterQ.slerp(xe,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},yn.prototype.getOrientation=function(){return this.filterQ},yn.prototype.accelToQuaternion_=function(E){var D=new Kn;D.copy(E),D.normalize();var X=new fn;return X.setFromUnitVectors(new Kn(0,0,-1),D),X.inverse(),X},yn.prototype.gyroToQuaternionDelta_=function(E,D){var X=new fn,J=new Kn;return J.copy(E),J.normalize(),X.setFromAxisAngle(J,E.length()*D),X},Tn.prototype.getPrediction=function(E,D,X){if(!this.previousTimestampS)return this.previousQ.copy(E),this.previousTimestampS=X,E;var J=new Kn;J.copy(D),J.normalize();var xe=D.length();return xe<20*Aa?(this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(Ua*xe).toFixed(1)),this.outQ.copy(E),this.previousQ.copy(E),this.outQ):(this.deltaQ.setFromAxisAngle(J,xe*this.predictionTimeS),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(E),this.previousTimestampS=X,this.outQ)},c.prototype.getPosition=function(){return null},c.prototype.getOrientation=function(){var E=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ)return this.deviceOrientationFixQ=this.deviceOrientationFixQ||(xe=(new fn).setFromAxisAngle(new Kn(0,0,-1),0),Xe=new fn,-90===window.orientation?Xe.setFromAxisAngle(new Kn(0,1,0),Math.PI/-2):Xe.setFromAxisAngle(new Kn(0,1,0),Math.PI/2),xe.multiply(Xe)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var xe=new fn;return xe.setFromAxisAngle(new Kn(1,0,0),-Math.PI/2),xe}(),E=this._deviceOrientationQ,(X=new fn).copy(E),X.multiply(this.deviceOrientationFilterToWorldQ),X.multiply(this.resetQ),X.multiply(this.worldToScreenQ),X.multiplyQuaternions(this.deviceOrientationFixQ,X),this.yawOnly&&(X.x=0,X.z=0,X.normalize()),this.orientationOut_[0]=X.x,this.orientationOut_[1]=X.y,this.orientationOut_[2]=X.z,this.orientationOut_[3]=X.w,this.orientationOut_;var xe,Xe,X,D=this.filter.getOrientation();return E=this.posePredictor.getPrediction(D,this.gyroscope,this.previousTimestampS),(X=new fn).copy(this.filterToWorldQ),X.multiply(this.resetQ),X.multiply(E),X.multiply(this.worldToScreenQ),this.yawOnly&&(X.x=0,X.z=0,X.normalize()),this.orientationOut_[0]=X.x,this.orientationOut_[1]=X.y,this.orientationOut_[2]=X.z,this.orientationOut_[3]=X.w,this.orientationOut_},c.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),zt()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},c.prototype.onDeviceOrientation_=function(E){this._deviceOrientationQ=this._deviceOrientationQ||new fn;var D=E.alpha,X=E.beta,J=E.gamma;D=(D||0)*Math.PI/180,X=(X||0)*Math.PI/180,J=(J||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(X,D,-J)},c.prototype.onDeviceMotion_=function(E){this.updateDeviceMotion_(E)},c.prototype.updateDeviceMotion_=function(E){var D=E.accelerationIncludingGravity,X=E.rotationRate,J=E.timeStamp/1e3,xe=J-this.previousTimestampS;return xe<0?(Si("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),void(this.previousTimestampS=J)):xe<=.001||xe>1?(Si("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),void(this.previousTimestampS=J)):(this.accelerometer.set(-D.x,-D.y,-D.z),X&&(xt()?this.gyroscope.set(-X.beta,X.alpha,X.gamma):this.gyroscope.set(X.alpha,X.beta,X.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,J)),this.filter.addAccelMeasurement(this.accelerometer,J),void(this.previousTimestampS=J))},c.prototype.onOrientationChange_=function(E){this.setScreenTransform_()},c.prototype.onMessage_=function(E){var D=E.data;D&&D.type&&"devicemotion"===D.type.toLowerCase()&&this.updateDeviceMotion_(D.deviceMotionEvent)},c.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Kn(0,0,1),-Math.PI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Kn(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},c.prototype.start=function(){var D,X,J;this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),ht()&&(D=window.self!==window.top,X=fi(document.referrer),J=fi(window.location.href),D&&X!==J)&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},c.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var r=new Kn(1,0,0),o=new Kn(0,0,1),e=new fn;e.setFromAxisAngle(r,-Math.PI/2),e.multiply((new fn).setFromAxisAngle(o,Math.PI/2));var s=function(){function E(D){(function(E,D){if(!(E instanceof D))throw new TypeError("Cannot call a class as a function")})(this,E),this.config=D,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new fn,this._outQ=new fn,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return je(E,[{key:"init",value:function(){var X=null;try{(X=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(J){this.errors.push(J),"SecurityError"===J.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===J.name?this.useDeviceMotion():console.error(J)}X&&(this.api="sensor",this.sensor=X,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new c(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var X=this.sensor.quaternion;this._sensorQ.set(X[0],X[1],X[2],X[3]);var J=this._outQ;return J.copy(e),J.multiply(this._sensorQ),this.config.YAW_ONLY&&(J.x=J.z=0,J.normalize()),this._out[0]=J.x,this._out[1]=J.y,this._out[2]=J.z,this._out[3]=J.w,this._out}},{key:"_onSensorError",value:function(X){this.errors.push(X.error),"NotAllowedError"===X.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===X.error.name?console.error("Sensor could not be read"):console.error(X.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),E}();function d(){this.loadIcon_();var E=document.createElement("div");(st=E.style).position="fixed",st.top=0,st.right=0,st.bottom=0,st.left=0,st.backgroundColor="gray",st.fontFamily="sans-serif",st.zIndex=1e6;var D=document.createElement("img");D.src=this.icon,(st=D.style).marginLeft="25%",st.marginTop="25%",st.width="50%",E.appendChild(D);var X=document.createElement("div");(st=X.style).textAlign="center",st.fontSize="16px",st.lineHeight="24px",st.margin="24px 25%",st.width="50%",X.innerHTML="Place your phone into your Cardboard viewer.",E.appendChild(X);var J=document.createElement("div");(st=J.style).backgroundColor="#CFD8DC",st.position="fixed",st.bottom=0,st.width="100%",st.height="48px",st.padding="14px 24px",st.boxSizing="border-box",st.color="#656A6B",E.appendChild(J);var xe=document.createElement("div");xe.style.float="left",xe.innerHTML="No Cardboard viewer?";var st,Xe=document.createElement("a");Xe.href="https://www.google.com/get/cardboard/get-cardboard/",Xe.innerHTML="get one",Xe.target="_blank",(st=Xe.style).float="right",st.fontWeight=600,st.textTransform="uppercase",st.borderLeft="1px solid gray",st.paddingLeft="24px",st.textDecoration="none",st.color="#656A6B",J.appendChild(xe),J.appendChild(Xe),this.overlay=E,this.text=X,this.hide()}d.prototype.show=function(E){E||this.overlay.parentElement?E&&(this.overlay.parentElement&&this.overlay.parentElement!=E&&this.overlay.parentElement.removeChild(this.overlay),E.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var X=this.overlay.querySelector("img").style;zt()?(X.width="20%",X.marginLeft="40%",X.marginTop="3%"):(X.width="50%",X.marginLeft="25%",X.marginTop="25%")},d.prototype.hide=function(){this.overlay.style.display="none"},d.prototype.showTemporarily=function(E,D){this.show(D),this.timer=setTimeout(this.hide.bind(this),E)},d.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},d.prototype.update=function(){this.disableShowTemporarily(),!zt()&&tn()?this.show():this.hide()},d.prototype.loadIcon_=function(){this.icon="data:"+"image/svg+xml"+","+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var g="WEBVR_CARDBOARD_VIEWER";function L(E){try{this.selectedKey=localStorage.getItem(g)}catch(D){console.error("Failed to load viewer profile: %s",D)}this.selectedKey||(this.selectedKey=E||"CardboardV1"),this.dialog=this.createDialog_(Bn.Viewers),this.root=null,this.onChangeCallbacks_=[]}L.prototype.show=function(E){this.root=E,E.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},L.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},L.prototype.getCurrentViewer=function(){return Bn.Viewers[this.selectedKey]},L.prototype.getSelectedKey_=function(){var E=this.dialog.querySelector("input[name=field]:checked");return E?E.id:null},L.prototype.onChange=function(E){this.onChangeCallbacks_.push(E)},L.prototype.fireOnChange_=function(E){for(var D=0;D<this.onChangeCallbacks_.length;D++)this.onChangeCallbacks_[D](E)},L.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),this.selectedKey&&Bn.Viewers[this.selectedKey]){this.fireOnChange_(Bn.Viewers[this.selectedKey]);try{localStorage.setItem(g,this.selectedKey)}catch(E){console.error("Failed to save viewer profile: %s",E)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")},L.prototype.createDialog_=function(E){var D=document.createElement("div");D.classList.add("webvr-polyfill-viewer-selector"),D.style.display="none";var X=document.createElement("div");(Xe=X.style).position="fixed",Xe.left=0,Xe.top=0,Xe.width="100%",Xe.height="100%",Xe.background="rgba(0, 0, 0, 0.3)",X.addEventListener("click",this.hide.bind(this));var xe=document.createElement("div"),Xe=xe.style;for(var st in Xe.boxSizing="border-box",Xe.position="fixed",Xe.top="24px",Xe.left="50%",Xe.marginLeft="-140px",Xe.width="280px",Xe.padding="24px",Xe.overflow="hidden",Xe.background="#fafafa",Xe.fontFamily="'Roboto', sans-serif",Xe.boxShadow="0px 5px 20px #666",xe.appendChild(this.createH1_("Select your viewer")),E)xe.appendChild(this.createChoice_(st,E[st].label));return xe.appendChild(this.createButton_("Save",this.onSave_.bind(this))),D.appendChild(X),D.appendChild(xe),D},L.prototype.createH1_=function(E){var D=document.createElement("h1"),X=D.style;return X.color="black",X.fontSize="20px",X.fontWeight="bold",X.marginTop=0,X.marginBottom="24px",D.innerHTML=E,D},L.prototype.createChoice_=function(E,D){var X=document.createElement("div");X.style.marginTop="8px",X.style.color="black";var J=document.createElement("input");J.style.fontSize="30px",J.setAttribute("id",E),J.setAttribute("type","radio"),J.setAttribute("value",E),J.setAttribute("name","field");var xe=document.createElement("label");return xe.style.marginLeft="4px",xe.setAttribute("for",E),xe.innerHTML=D,X.appendChild(J),X.appendChild(xe),X},L.prototype.createButton_=function(E,D){var X=document.createElement("button");X.innerHTML=E;var J=X.style;return J.float="right",J.textTransform="uppercase",J.color="#1094f7",J.fontSize="14px",J.letterSpacing=0,J.border=0,J.background="none",J.marginTop="16px",X.addEventListener("click",D),X},typeof window<"u"?window:typeof a<"u"||typeof self<"u"&&self;var _e=function le(E,D){return E(D={exports:{}},D.exports),D.exports}(function(E,D){E.exports=function(){return function(X){var J={};function xe(Xe){if(J[Xe])return J[Xe].exports;var st=J[Xe]={i:Xe,l:!1,exports:{}};return X[Xe].call(st.exports,st,st.exports,xe),st.l=!0,st.exports}return xe.m=X,xe.c=J,xe.d=function(Xe,st,$t){xe.o(Xe,st)||Object.defineProperty(Xe,st,{configurable:!1,enumerable:!0,get:$t})},xe.n=function(Xe){var st=Xe&&Xe.__esModule?function(){return Xe.default}:function(){return Xe};return xe.d(st,"a",st),st},xe.o=function(Xe,st){return Object.prototype.hasOwnProperty.call(Xe,st)},xe.p="",xe(xe.s=0)}([function(X,J,xe){var Xe=function(){function Ot(hi,Bi){for(var ji=0;ji<Bi.length;ji++){var Ki=Bi[ji];Ki.enumerable=Ki.enumerable||!1,Ki.configurable=!0,"value"in Ki&&(Ki.writable=!0),Object.defineProperty(hi,Ki.key,Ki)}}return function(hi,Bi,ji){return Bi&&Ot(hi.prototype,Bi),ji&&Ot(hi,ji),hi}}();var $t=xe(1),Ft=typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,bt=function(){function Ot(){(function st(Ot,hi){if(!(Ot instanceof hi))throw new TypeError("Cannot call a class as a function")})(this,Ot),Ft?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",$t),this.noSleepVideo.addEventListener("timeupdate",function(hi){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return Xe(Ot,[{key:"enable",value:function(){Ft?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){Ft?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),Ot}();X.exports=bt},function(X,J,xe){X.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])}()}),ge=function q(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}(_e),rt=1e3,yt=[0,0,.5,1],ni=[.5,0,.5,1],It=window.requestAnimationFrame,Bt=window.cancelAnimationFrame;function Zt(E){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:E.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:E.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:E.canPresent},maxLayers:{writable:!1,enumerable:!0,value:E.maxLayers},hasOrientation:{enumerable:!0,get:function(){return Ui("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),E.hasOrientation}}})}function Mt(E){var D=!("wakelock"in(E=E||{}))||E.wakelock;this.isPolyfilled=!0,this.displayId=rt++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return Ui("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new Zt({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,D&&tn()&&(this.wakelock_=new ge)}Mt.prototype.getFrameData=function(E){return bn(E,this._getPose(),this)},Mt.prototype.getPose=function(){return Ui("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},Mt.prototype.resetPose=function(){return Ui("VRDisplay.prototype.resetPose"),this._resetPose()},Mt.prototype.getImmediatePose=function(){return Ui("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},Mt.prototype.requestAnimationFrame=function(E){return It(E)},Mt.prototype.cancelAnimationFrame=function(E){return Bt(E)},Mt.prototype.wrapForFullscreen=function(E){if(ht())return E;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var D=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",D.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==E)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=E,this.originalParent_=E.parentElement,this.originalParent_||document.body.appendChild(E),!this.fullscreenWrapper_.parentElement){var X=this.fullscreenElement_.parentElement;X.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),X.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var J=this;return function xe(){if(J.fullscreenElement_){var Xe=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];J.fullscreenElement_.setAttribute("style",Xe.join("; ")+";")}}(),this.fullscreenWrapper_},Mt.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var E=this.fullscreenElement_;this.fullscreenElementCachedStyle_?E.setAttribute("style",this.fullscreenElementCachedStyle_):E.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var D=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(E),this.originalParent_===D?D.insertBefore(E,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(E),D.removeChild(this.fullscreenWrapper_),E}},Mt.prototype.requestPresent=function(E){var D=this.isPresenting,X=this;return E instanceof Array||(Ui("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),E=[E]),new Promise(function(J,xe){if(X.capabilities.canPresent)if(0==E.length||E.length>X.capabilities.maxLayers)xe(new Error("Invalid number of layers."));else{var Xe=E[0];if(Xe.source){var st=Xe.leftBounds||yt,$t=Xe.rightBounds||ni;if(D){var Ft=X.layer_;Ft.source!==Xe.source&&(Ft.source=Xe.source);for(var bt=0;bt<4;bt++)Ft.leftBounds[bt]=st[bt],Ft.rightBounds[bt]=$t[bt];return X.wrapForFullscreen(X.layer_.source),X.updatePresent_(),void J()}if(X.layer_={predistorted:Xe.predistorted,source:Xe.source,leftBounds:st.slice(0),rightBounds:$t.slice(0)},X.waitingForPresent_=!1,X.layer_&&X.layer_.source){var Ot=X.wrapForFullscreen(X.layer_.source);X.addFullscreenListeners_(Ot,function(){var Ki=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;X.isPresenting=Ot===Ki,X.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Sn){console.error("screen.orientation.lock() failed due to",Sn.message)}),X.waitingForPresent_=!1,X.beginPresent_(),J()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),X.removeFullscreenWrapper(),X.disableWakeLock(),X.endPresent_(),X.removeFullscreenListeners_()),X.fireVRDisplayPresentChange_()},function(){!X.waitingForPresent_||(X.removeFullscreenWrapper(),X.removeFullscreenListeners_(),X.disableWakeLock(),X.waitingForPresent_=!1,X.isPresenting=!1,xe(new Error("Unable to present.")))}),function(D){if(At())return!1;if(D.requestFullscreen)D.requestFullscreen();else if(D.webkitRequestFullscreen)D.webkitRequestFullscreen();else if(D.mozRequestFullScreen)D.mozRequestFullScreen();else{if(!D.msRequestFullscreen)return!1;D.msRequestFullscreen()}return!0}(Ot)?(X.enableWakeLock(),X.waitingForPresent_=!0):(ht()||At())&&(X.enableWakeLock(),X.isPresenting=!0,X.beginPresent_(),X.fireVRDisplayPresentChange_(),J())}!X.waitingForPresent_&&!ht()&&(Yi(),xe(new Error("Unable to present.")))}else J()}else xe(new Error("VRDisplay is not capable of presenting."))})},Mt.prototype.exitPresent=function(){var E=this.isPresenting,D=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(X,J){E?(!Yi()&&ht()&&(D.endPresent_(),D.fireVRDisplayPresentChange_()),At()&&(D.removeFullscreenWrapper(),D.removeFullscreenListeners_(),D.endPresent_(),D.fireVRDisplayPresentChange_()),X()):J(new Error("Was not presenting to VRDisplay."))})},Mt.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},Mt.prototype.fireVRDisplayPresentChange_=function(){var E=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(E)},Mt.prototype.fireVRDisplayConnect_=function(){var E=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(E)},Mt.prototype.addFullscreenListeners_=function(E,D,X){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=E,this.fullscreenChangeHandler_=D,this.fullscreenErrorHandler_=X,D&&(document.fullscreenEnabled?E.addEventListener("fullscreenchange",D,!1):document.webkitFullscreenEnabled?E.addEventListener("webkitfullscreenchange",D,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",D,!1):document.msFullscreenEnabled&&E.addEventListener("msfullscreenchange",D,!1)),X&&(document.fullscreenEnabled?E.addEventListener("fullscreenerror",X,!1):document.webkitFullscreenEnabled?E.addEventListener("webkitfullscreenerror",X,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",X,!1):document.msFullscreenEnabled&&E.addEventListener("msfullscreenerror",X,!1))},Mt.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var E=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var D=this.fullscreenChangeHandler_;E.removeEventListener("fullscreenchange",D,!1),E.removeEventListener("webkitfullscreenchange",D,!1),document.removeEventListener("mozfullscreenchange",D,!1),E.removeEventListener("msfullscreenchange",D,!1)}if(this.fullscreenErrorHandler_){var X=this.fullscreenErrorHandler_;E.removeEventListener("fullscreenerror",X,!1),E.removeEventListener("webkitfullscreenerror",X,!1),document.removeEventListener("mozfullscreenerror",X,!1),E.removeEventListener("msfullscreenerror",X,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},Mt.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},Mt.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},Mt.prototype.beginPresent_=function(){},Mt.prototype.endPresent_=function(){},Mt.prototype.submitFrame=function(E){},Mt.prototype.getEyeParameters=function(E){return null};var ai={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},qt_LEFT="left",qt_RIGHT="right";function gi(E){var D=An({},ai);E=An(D,E||{}),Mt.call(this,{wakelock:E.MOBILE_WAKE_LOCK}),this.config=E,this.displayName="Cardboard VRDisplay",this.capabilities=new Zt({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new s(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new Dt(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new Bn(this.dpdb_.getDeviceParams(),E.ADDITIONAL_VIEWERS),this.viewerSelector_=new L(E.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new d),ht()&&window.addEventListener("resize",this.onResize_.bind(this))}return(gi.prototype=Object.create(Mt.prototype))._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},gi.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},gi.prototype._getFieldOfView=function(E){var D;if(E==qt_LEFT)D=this.deviceInfo_.getFieldOfViewLeftEye();else{if(E!=qt_RIGHT)return console.error("Invalid eye provided: %s",E),null;D=this.deviceInfo_.getFieldOfViewRightEye()}return D},gi.prototype._getEyeOffset=function(E){var D;if(E==qt_LEFT)D=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else{if(E!=qt_RIGHT)return console.error("Invalid eye provided: %s",E),null;D=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return D},gi.prototype.getEyeParameters=function(E){var D=this._getEyeOffset(E),X=this._getFieldOfView(E),J={offset:D,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(J,"fieldOfView",{enumerable:!0,get:function(){return Ui("VRFieldOfView","VRFrameData's projection matrices"),X}}),J},gi.prototype.onDeviceParamsUpdated_=function(E){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(E),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},gi.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},gi.prototype.beginPresent_=function(){var E=this.layer_.source.getContext("webgl");E||(E=this.layer_.source.getContext("experimental-webgl")),E||(E=this.layer_.source.getContext("webgl2")),E&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(E.canvas.width=ri()*this.bufferScale_,E.canvas.height=di()*this.bufferScale_,this.cardboardUI_=new is(E)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new is(E)),this.distorter_=new Wt(E,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(D){this.viewerSelector_.show(this.layer_.source.parentElement),D.stopPropagation(),D.preventDefault()}.bind(this),function(D){this.exitPresent(),D.stopPropagation(),D.preventDefault()}.bind(this)),this.rotateInstructions_&&(zt()&&tn()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},gi.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},gi.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},gi.prototype.submitFrame=function(E){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var D=this.layer_.source.getContext("webgl");D||(D=this.layer_.source.getContext("experimental-webgl")),D||(D=this.layer_.source.getContext("webgl2"));var X=D.canvas;(X.width!=this.lastWidth||X.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=X.width,this.lastHeight=X.height,this.cardboardUI_.render()}},gi.prototype.onOrientationChange_=function(E){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},gi.prototype.onResize_=function(E){if(this.layer_){var D=this.layer_.source.getContext("webgl");D||(D=this.layer_.source.getContext("experimental-webgl")),D||(D=this.layer_.source.getContext("webgl2")),D.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";"),nn(D.canvas)}},gi.prototype.onViewerChanged_=function(E){this.deviceInfo_.setViewer(E),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},gi.prototype.fireVRDisplayDeviceParamsChange_=function(){var E=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(E)},gi.VRFrameData=function ci(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},gi.VRDisplay=Mt,gi}()})),M={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",PROVIDE_MOBILE_VRDISPLAY:!0,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function R(ce){this.config=y(y({},M),ce),this.polyfillDisplays=[],this.enabled=!1,this.hasNative="getVRDisplays"in navigator,this.native={},this.native.getVRDisplays=navigator.getVRDisplays,this.native.VRFrameData=window.VRFrameData,this.native.VRDisplay=window.VRDisplay,(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&f())&&(this.enable(),this.getVRDisplays().then(function(V){V&&V[0]&&V[0].fireVRDisplayConnect_&&V[0].fireVRDisplayConnect_()}))}R.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated)return this.polyfillDisplays;if(f()){var ce=new A({ADDITIONAL_VIEWERS:this.config.ADDITIONAL_VIEWERS,DEFAULT_VIEWER:this.config.DEFAULT_VIEWER,MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(ce)}return this._polyfillDisplaysPopulated=!0,this.polyfillDisplays},R.prototype.enable=function(){if(this.enabled=!0,this.hasNative&&this.native.VRFrameData){var ce=this.native.VRFrameData,V=new this.native.VRFrameData,U=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(je){je instanceof ce?U.call(this,je):(U.call(this,V),je.pose=V.pose,p(V.leftProjectionMatrix,je.leftProjectionMatrix),p(V.rightProjectionMatrix,je.rightProjectionMatrix),p(V.leftViewMatrix,je.leftViewMatrix),p(V.rightViewMatrix,je.rightViewMatrix))}}navigator.getVRDisplays=this.getVRDisplays.bind(this),window.VRDisplay=A.VRDisplay,window.VRFrameData=A.VRFrameData},R.prototype.getVRDisplays=function(){var ce=this;return this.hasNative?this.native.getVRDisplays.call(navigator).then(function(U){return U.length>0?U:ce.getPolyfillDisplays()}):Promise.resolve(this.getPolyfillDisplays())},R.version="0.10.12",R.VRFrameData=A.VRFrameData,R.VRDisplay=A.VRDisplay;var k=Object.freeze({default:R}),z=k&&R||k;return typeof a<"u"&&a.window&&(a.document||(a.document=a.window.document),a.navigator||(a.navigator=a.window.navigator)),z}()}),Pe=et(de);const kt=1001,rn=1003,Fi=1006,_n=1015,pa=1020,Ca=1022,Hr=1023,Pa=1026,Ha=1027,ul=2400,go=2401,_o=3e3,hl=35044,Js=35048;function ya(){}Object.assign(ya.prototype,{addEventListener:function(i,t){void 0===this._listeners&&(this._listeners={});const a=this._listeners;void 0===a[i]&&(a[i]=[]),-1===a[i].indexOf(t)&&a[i].push(t)},hasEventListener:function(i,t){if(void 0===this._listeners)return!1;const a=this._listeners;return void 0!==a[i]&&-1!==a[i].indexOf(t)},removeEventListener:function(i,t){if(void 0===this._listeners)return;const l=this._listeners[i];if(void 0!==l){const h=l.indexOf(t);-1!==h&&l.splice(h,1)}},dispatchEvent:function(i){if(void 0===this._listeners)return;const a=this._listeners[i.type];if(void 0!==a){i.target=this;const l=a.slice(0);for(let h=0,f=l.length;h<f;h++)l[h].call(this,i)}}});const Hn=[];for(let i=0;i<256;i++)Hn[i]=(i<16?"0":"")+i.toString(16);let _c=1234567;const hn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const i=4294967295*Math.random()|0,t=4294967295*Math.random()|0,a=4294967295*Math.random()|0,l=4294967295*Math.random()|0;return(Hn[255&i]+Hn[i>>8&255]+Hn[i>>16&255]+Hn[i>>24&255]+"-"+Hn[255&t]+Hn[t>>8&255]+"-"+Hn[t>>16&15|64]+Hn[t>>24&255]+"-"+Hn[63&a|128]+Hn[a>>8&255]+"-"+Hn[a>>16&255]+Hn[a>>24&255]+Hn[255&l]+Hn[l>>8&255]+Hn[l>>16&255]+Hn[l>>24&255]).toUpperCase()},clamp:function(i,t,a){return Math.max(t,Math.min(a,i))},euclideanModulo:function(i,t){return(i%t+t)%t},mapLinear:function(i,t,a,l,h){return l+(i-t)*(h-l)/(a-t)},lerp:function(i,t,a){return(1-a)*i+a*t},damp:function(i,t,a,l){return hn.lerp(i,t,1-Math.exp(-a*l))},pingpong:function(i,t=1){return t-Math.abs(hn.euclideanModulo(i,2*t)-t)},smoothstep:function(i,t,a){return i<=t?0:i>=a?1:(i=(i-t)/(a-t))*i*(3-2*i)},smootherstep:function(i,t,a){return i<=t?0:i>=a?1:(i=(i-t)/(a-t))*i*i*(i*(6*i-15)+10)},randInt:function(i,t){return i+Math.floor(Math.random()*(t-i+1))},randFloat:function(i,t){return i+Math.random()*(t-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){return void 0!==i&&(_c=i%2147483647),_c=16807*_c%2147483647,(_c-1)/2147483646},degToRad:function(i){return i*hn.DEG2RAD},radToDeg:function(i){return i*hn.RAD2DEG},isPowerOfTwo:function(i){return 0==(i&i-1)&&0!==i},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,t,a,l,h){const f=Math.cos,p=Math.sin,y=f(a/2),b=p(a/2),A=f((t+l)/2),C=p((t+l)/2),M=f((t-l)/2),R=p((t-l)/2),k=f((l-t)/2),z=p((l-t)/2);switch(h){case"XYX":i.set(y*C,b*M,b*R,y*A);break;case"YZY":i.set(b*R,y*C,b*M,y*A);break;case"ZXZ":i.set(b*M,b*R,y*C,y*A);break;case"XZX":i.set(y*C,b*z,b*k,y*A);break;case"YXY":i.set(b*k,y*C,b*z,y*A);break;case"ZYZ":i.set(b*z,b*k,y*C,y*A);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+h)}}};class Ct{constructor(t=0,a=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=a}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,a){return this.x=t,this.y=a,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,a){switch(t){case 0:this.x=a;break;case 1:this.y=a;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,a){return void 0!==a?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,a)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,a){return this.x=t.x+a.x,this.y=t.y+a.y,this}addScaledVector(t,a){return this.x+=t.x*a,this.y+=t.y*a,this}sub(t,a){return void 0!==a?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,a)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,a){return this.x=t.x-a.x,this.y=t.y-a.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const a=this.x,l=this.y,h=t.elements;return this.x=h[0]*a+h[3]*l+h[6],this.y=h[1]*a+h[4]*l+h[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,a){return this.x=Math.max(t.x,Math.min(a.x,this.x)),this.y=Math.max(t.y,Math.min(a.y,this.y)),this}clampScalar(t,a){return this.x=Math.max(t,Math.min(a,this.x)),this.y=Math.max(t,Math.min(a,this.y)),this}clampLength(t,a){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(t,Math.min(a,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const a=this.x-t.x,l=this.y-t.y;return a*a+l*l}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,a){return this.x+=(t.x-this.x)*a,this.y+=(t.y-this.y)*a,this}lerpVectors(t,a,l){return this.x=t.x+(a.x-t.x)*l,this.y=t.y+(a.y-t.y)*l,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,a=0){return this.x=t[a],this.y=t[a+1],this}toArray(t=[],a=0){return t[a]=this.x,t[a+1]=this.y,t}fromBufferAttribute(t,a,l){return void 0!==l&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(a),this.y=t.getY(a),this}rotateAround(t,a){const l=Math.cos(a),h=Math.sin(a),f=this.x-t.x,p=this.y-t.y;return this.x=f*l-p*h+t.x,this.y=f*h+p*l+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Or{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,a,l,h,f,p,y,b,A){const C=this.elements;return C[0]=t,C[1]=h,C[2]=y,C[3]=a,C[4]=f,C[5]=b,C[6]=l,C[7]=p,C[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const a=this.elements,l=t.elements;return a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[4]=l[4],a[5]=l[5],a[6]=l[6],a[7]=l[7],a[8]=l[8],this}extractBasis(t,a,l){return t.setFromMatrix3Column(this,0),a.setFromMatrix3Column(this,1),l.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const a=t.elements;return this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,a){const l=t.elements,h=a.elements,f=this.elements,p=l[0],y=l[3],b=l[6],A=l[1],C=l[4],M=l[7],R=l[2],k=l[5],z=l[8],pe=h[0],ce=h[3],V=h[6],U=h[1],je=h[4],Ze=h[7],Je=h[2],Ie=h[5],it=h[8];return f[0]=p*pe+y*U+b*Je,f[3]=p*ce+y*je+b*Ie,f[6]=p*V+y*Ze+b*it,f[1]=A*pe+C*U+M*Je,f[4]=A*ce+C*je+M*Ie,f[7]=A*V+C*Ze+M*it,f[2]=R*pe+k*U+z*Je,f[5]=R*ce+k*je+z*Ie,f[8]=R*V+k*Ze+z*it,this}multiplyScalar(t){const a=this.elements;return a[0]*=t,a[3]*=t,a[6]*=t,a[1]*=t,a[4]*=t,a[7]*=t,a[2]*=t,a[5]*=t,a[8]*=t,this}determinant(){const t=this.elements,a=t[0],l=t[1],h=t[2],f=t[3],p=t[4],y=t[5],b=t[6],A=t[7],C=t[8];return a*p*C-a*y*A-l*f*C+l*y*b+h*f*A-h*p*b}invert(){const t=this.elements,a=t[0],l=t[1],h=t[2],f=t[3],p=t[4],y=t[5],b=t[6],A=t[7],C=t[8],M=C*p-y*A,R=y*b-C*f,k=A*f-p*b,z=a*M+l*R+h*k;if(0===z)return this.set(0,0,0,0,0,0,0,0,0);const pe=1/z;return t[0]=M*pe,t[1]=(h*A-C*l)*pe,t[2]=(y*l-h*p)*pe,t[3]=R*pe,t[4]=(C*a-h*b)*pe,t[5]=(h*f-y*a)*pe,t[6]=k*pe,t[7]=(l*b-A*a)*pe,t[8]=(p*a-l*f)*pe,this}transpose(){let t;const a=this.elements;return t=a[1],a[1]=a[3],a[3]=t,t=a[2],a[2]=a[6],a[6]=t,t=a[5],a[5]=a[7],a[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).copy(this).invert().transpose()}transposeIntoArray(t){const a=this.elements;return t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8],this}setUvTransform(t,a,l,h,f,p,y){const b=Math.cos(f),A=Math.sin(f);return this.set(l*b,l*A,-l*(b*p+A*y)+p+t,-h*A,h*b,-h*(-A*p+b*y)+y+a,0,0,1),this}scale(t,a){const l=this.elements;return l[0]*=t,l[3]*=t,l[6]*=t,l[1]*=a,l[4]*=a,l[7]*=a,this}rotate(t){const a=Math.cos(t),l=Math.sin(t),h=this.elements,f=h[0],p=h[3],y=h[6],b=h[1],A=h[4],C=h[7];return h[0]=a*f+l*b,h[3]=a*p+l*A,h[6]=a*y+l*C,h[1]=-l*f+a*b,h[4]=-l*p+a*A,h[7]=-l*y+a*C,this}translate(t,a){const l=this.elements;return l[0]+=t*l[2],l[3]+=t*l[5],l[6]+=t*l[8],l[1]+=a*l[2],l[4]+=a*l[5],l[7]+=a*l[8],this}equals(t){const a=this.elements,l=t.elements;for(let h=0;h<9;h++)if(a[h]!==l[h])return!1;return!0}fromArray(t,a=0){for(let l=0;l<9;l++)this.elements[l]=t[l+a];return this}toArray(t=[],a=0){const l=this.elements;return t[a]=l[0],t[a+1]=l[1],t[a+2]=l[2],t[a+3]=l[3],t[a+4]=l[4],t[a+5]=l[5],t[a+6]=l[6],t[a+7]=l[7],t[a+8]=l[8],t}}let dl;const fl={getDataURL:function(i){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let t;if(i instanceof HTMLCanvasElement)t=i;else{void 0===dl&&(dl=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),dl.width=i.width,dl.height=i.height;const a=dl.getContext("2d");i instanceof ImageData?a.putImageData(i,0,0):a.drawImage(i,0,0,i.width,i.height),t=dl}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let Yv=0;function zn(i=zn.DEFAULT_IMAGE,t=zn.DEFAULT_MAPPING,a=kt,l=kt,h=Fi,f=1008,p=Hr,y=1009,b=1,A=_o){Object.defineProperty(this,"id",{value:Yv++}),this.uuid=hn.generateUUID(),this.name="",this.image=i,this.mipmaps=[],this.mapping=t,this.wrapS=a,this.wrapT=l,this.magFilter=h,this.minFilter=f,this.anisotropy=b,this.format=p,this.internalFormat=null,this.type=y,this.offset=new Ct(0,0),this.repeat=new Ct(1,1),this.center=new Ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Or,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=A,this.version=0,this.onUpdate=null}function qh(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?fl.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zn.DEFAULT_IMAGE=void 0,zn.DEFAULT_MAPPING=300,zn.prototype=Object.assign(Object.create(ya.prototype),{constructor:zn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(i){return this.name=i.name,this.image=i.image,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this},toJSON:function(i){const t=void 0===i||"string"==typeof i;if(!t&&void 0!==i.textures[this.uuid])return i.textures[this.uuid];const a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const l=this.image;if(void 0===l.uuid&&(l.uuid=hn.generateUUID()),!t&&void 0===i.images[l.uuid]){let h;if(Array.isArray(l)){h=[];for(let f=0,p=l.length;f<p;f++)h.push(qh(l[f].isDataTexture?l[f].image:l[f]))}else h=qh(l);i.images[l.uuid]={uuid:l.uuid,url:h}}a.image=l.uuid}return t||(i.textures[this.uuid]=a),a},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(i){if(300!==this.mapping)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case 1e3:i.x=i.x-Math.floor(i.x);break;case kt:i.x=i.x<0?0:1;break;case 1002:i.x=1===Math.abs(Math.floor(i.x)%2)?Math.ceil(i.x)-i.x:i.x-Math.floor(i.x)}if(i.y<0||i.y>1)switch(this.wrapT){case 1e3:i.y=i.y-Math.floor(i.y);break;case kt:i.y=i.y<0?0:1;break;case 1002:i.y=1===Math.abs(Math.floor(i.y)%2)?Math.ceil(i.y)-i.y:i.y-Math.floor(i.y)}return this.flipY&&(i.y=1-i.y),i}}),Object.defineProperty(zn.prototype,"needsUpdate",{set:function(i){!0===i&&this.version++}});class Wn{constructor(t=0,a=0,l=0,h=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=a,this.z=l,this.w=h}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,a,l,h){return this.x=t,this.y=a,this.z=l,this.w=h,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,a){switch(t){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;case 3:this.w=a;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,a){return void 0!==a?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,a)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,a){return this.x=t.x+a.x,this.y=t.y+a.y,this.z=t.z+a.z,this.w=t.w+a.w,this}addScaledVector(t,a){return this.x+=t.x*a,this.y+=t.y*a,this.z+=t.z*a,this.w+=t.w*a,this}sub(t,a){return void 0!==a?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,a)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,a){return this.x=t.x-a.x,this.y=t.y-a.y,this.z=t.z-a.z,this.w=t.w-a.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const a=this.x,l=this.y,h=this.z,f=this.w,p=t.elements;return this.x=p[0]*a+p[4]*l+p[8]*h+p[12]*f,this.y=p[1]*a+p[5]*l+p[9]*h+p[13]*f,this.z=p[2]*a+p[6]*l+p[10]*h+p[14]*f,this.w=p[3]*a+p[7]*l+p[11]*h+p[15]*f,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const a=Math.sqrt(1-t.w*t.w);return a<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/a,this.y=t.y/a,this.z=t.z/a),this}setAxisAngleFromRotationMatrix(t){let a,l,h,f;const b=t.elements,A=b[0],C=b[4],M=b[8],R=b[1],k=b[5],z=b[9],pe=b[2],ce=b[6],V=b[10];if(Math.abs(C-R)<.01&&Math.abs(M-pe)<.01&&Math.abs(z-ce)<.01){if(Math.abs(C+R)<.1&&Math.abs(M+pe)<.1&&Math.abs(z+ce)<.1&&Math.abs(A+k+V-3)<.1)return this.set(1,0,0,0),this;a=Math.PI;const je=(A+1)/2,Ze=(k+1)/2,Je=(V+1)/2,Ie=(C+R)/4,it=(M+pe)/4,Gt=(z+ce)/4;return je>Ze&&je>Je?je<.01?(l=0,h=.707106781,f=.707106781):(l=Math.sqrt(je),h=Ie/l,f=it/l):Ze>Je?Ze<.01?(l=.707106781,h=0,f=.707106781):(h=Math.sqrt(Ze),l=Ie/h,f=Gt/h):Je<.01?(l=.707106781,h=.707106781,f=0):(f=Math.sqrt(Je),l=it/f,h=Gt/f),this.set(l,h,f,a),this}let U=Math.sqrt((ce-z)*(ce-z)+(M-pe)*(M-pe)+(R-C)*(R-C));return Math.abs(U)<.001&&(U=1),this.x=(ce-z)/U,this.y=(M-pe)/U,this.z=(R-C)/U,this.w=Math.acos((A+k+V-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,a){return this.x=Math.max(t.x,Math.min(a.x,this.x)),this.y=Math.max(t.y,Math.min(a.y,this.y)),this.z=Math.max(t.z,Math.min(a.z,this.z)),this.w=Math.max(t.w,Math.min(a.w,this.w)),this}clampScalar(t,a){return this.x=Math.max(t,Math.min(a,this.x)),this.y=Math.max(t,Math.min(a,this.y)),this.z=Math.max(t,Math.min(a,this.z)),this.w=Math.max(t,Math.min(a,this.w)),this}clampLength(t,a){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(t,Math.min(a,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,a){return this.x+=(t.x-this.x)*a,this.y+=(t.y-this.y)*a,this.z+=(t.z-this.z)*a,this.w+=(t.w-this.w)*a,this}lerpVectors(t,a,l){return this.x=t.x+(a.x-t.x)*l,this.y=t.y+(a.y-t.y)*l,this.z=t.z+(a.z-t.z)*l,this.w=t.w+(a.w-t.w)*l,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,a=0){return this.x=t[a],this.y=t[a+1],this.z=t[a+2],this.w=t[a+3],this}toArray(t=[],a=0){return t[a]=this.x,t[a+1]=this.y,t[a+2]=this.z,t[a+3]=this.w,t}fromBufferAttribute(t,a,l){return void 0!==l&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(a),this.y=t.getY(a),this.z=t.getZ(a),this.w=t.getW(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}class uu extends ya{constructor(t,a,l){super(),Object.defineProperty(this,"isWebGLRenderTarget",{value:!0}),this.width=t,this.height=a,this.scissor=new Wn(0,0,t,a),this.scissorTest=!1,this.viewport=new Wn(0,0,t,a),this.texture=new zn(void 0,(l=l||{}).mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=a,this.texture.generateMipmaps=void 0!==l.generateMipmaps&&l.generateMipmaps,this.texture.minFilter=void 0!==l.minFilter?l.minFilter:Fi,this.depthBuffer=void 0===l.depthBuffer||l.depthBuffer,this.stencilBuffer=void 0!==l.stencilBuffer&&l.stencilBuffer,this.depthTexture=void 0!==l.depthTexture?l.depthTexture:null}setSize(t,a){(this.width!==t||this.height!==a)&&(this.width=t,this.height=a,this.texture.image.width=t,this.texture.image.height=a,this.dispose()),this.viewport.set(0,0,t,a),this.scissor.set(0,0,t,a)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}class br{constructor(t=0,a=0,l=0,h=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=a,this._z=l,this._w=h}static slerp(t,a,l,h){return l.copy(t).slerp(a,h)}static slerpFlat(t,a,l,h,f,p,y){let b=l[h+0],A=l[h+1],C=l[h+2],M=l[h+3];const R=f[p+0],k=f[p+1],z=f[p+2],pe=f[p+3];if(M!==pe||b!==R||A!==k||C!==z){let ce=1-y;const V=b*R+A*k+C*z+M*pe,U=V>=0?1:-1,je=1-V*V;if(je>Number.EPSILON){const Je=Math.sqrt(je),Ie=Math.atan2(Je,V*U);ce=Math.sin(ce*Ie)/Je,y=Math.sin(y*Ie)/Je}const Ze=y*U;if(b=b*ce+R*Ze,A=A*ce+k*Ze,C=C*ce+z*Ze,M=M*ce+pe*Ze,ce===1-y){const Je=1/Math.sqrt(b*b+A*A+C*C+M*M);b*=Je,A*=Je,C*=Je,M*=Je}}t[a]=b,t[a+1]=A,t[a+2]=C,t[a+3]=M}static multiplyQuaternionsFlat(t,a,l,h,f,p){const y=l[h],b=l[h+1],A=l[h+2],C=l[h+3],M=f[p],R=f[p+1],k=f[p+2],z=f[p+3];return t[a]=y*z+C*M+b*k-A*R,t[a+1]=b*z+C*R+A*M-y*k,t[a+2]=A*z+C*k+y*R-b*M,t[a+3]=C*z-y*M-b*R-A*k,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,a,l,h){return this._x=t,this._y=a,this._z=l,this._w=h,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,a){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const l=t._x,h=t._y,f=t._z,p=t._order,y=Math.cos,b=Math.sin,A=y(l/2),C=y(h/2),M=y(f/2),R=b(l/2),k=b(h/2),z=b(f/2);switch(p){case"XYZ":this._x=R*C*M+A*k*z,this._y=A*k*M-R*C*z,this._z=A*C*z+R*k*M,this._w=A*C*M-R*k*z;break;case"YXZ":this._x=R*C*M+A*k*z,this._y=A*k*M-R*C*z,this._z=A*C*z-R*k*M,this._w=A*C*M+R*k*z;break;case"ZXY":this._x=R*C*M-A*k*z,this._y=A*k*M+R*C*z,this._z=A*C*z+R*k*M,this._w=A*C*M-R*k*z;break;case"ZYX":this._x=R*C*M-A*k*z,this._y=A*k*M+R*C*z,this._z=A*C*z-R*k*M,this._w=A*C*M+R*k*z;break;case"YZX":this._x=R*C*M+A*k*z,this._y=A*k*M+R*C*z,this._z=A*C*z-R*k*M,this._w=A*C*M-R*k*z;break;case"XZY":this._x=R*C*M-A*k*z,this._y=A*k*M-R*C*z,this._z=A*C*z+R*k*M,this._w=A*C*M+R*k*z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+p)}return!1!==a&&this._onChangeCallback(),this}setFromAxisAngle(t,a){const l=a/2,h=Math.sin(l);return this._x=t.x*h,this._y=t.y*h,this._z=t.z*h,this._w=Math.cos(l),this._onChangeCallback(),this}setFromRotationMatrix(t){const a=t.elements,l=a[0],h=a[4],f=a[8],p=a[1],y=a[5],b=a[9],A=a[2],C=a[6],M=a[10],R=l+y+M;if(R>0){const k=.5/Math.sqrt(R+1);this._w=.25/k,this._x=(C-b)*k,this._y=(f-A)*k,this._z=(p-h)*k}else if(l>y&&l>M){const k=2*Math.sqrt(1+l-y-M);this._w=(C-b)/k,this._x=.25*k,this._y=(h+p)/k,this._z=(f+A)/k}else if(y>M){const k=2*Math.sqrt(1+y-l-M);this._w=(f-A)/k,this._x=(h+p)/k,this._y=.25*k,this._z=(b+C)/k}else{const k=2*Math.sqrt(1+M-l-y);this._w=(p-h)/k,this._x=(f+A)/k,this._y=(b+C)/k,this._z=.25*k}return this._onChangeCallback(),this}setFromUnitVectors(t,a){let h=t.dot(a)+1;return h<1e-6?(h=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=h):(this._x=0,this._y=-t.z,this._z=t.y,this._w=h)):(this._x=t.y*a.z-t.z*a.y,this._y=t.z*a.x-t.x*a.z,this._z=t.x*a.y-t.y*a.x,this._w=h),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(hn.clamp(this.dot(t),-1,1)))}rotateTowards(t,a){const l=this.angleTo(t);if(0===l)return this;const h=Math.min(1,a/l);return this.slerp(t,h),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,a){return void 0!==a?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,a)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,a){const l=t._x,h=t._y,f=t._z,p=t._w,y=a._x,b=a._y,A=a._z,C=a._w;return this._x=l*C+p*y+h*A-f*b,this._y=h*C+p*b+f*y-l*A,this._z=f*C+p*A+l*b-h*y,this._w=p*C-l*y-h*b-f*A,this._onChangeCallback(),this}slerp(t,a){if(0===a)return this;if(1===a)return this.copy(t);const l=this._x,h=this._y,f=this._z,p=this._w;let y=p*t._w+l*t._x+h*t._y+f*t._z;if(y<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,y=-y):this.copy(t),y>=1)return this._w=p,this._x=l,this._y=h,this._z=f,this;const b=1-y*y;if(b<=Number.EPSILON){const k=1-a;return this._w=k*p+a*this._w,this._x=k*l+a*this._x,this._y=k*h+a*this._y,this._z=k*f+a*this._z,this.normalize(),this._onChangeCallback(),this}const A=Math.sqrt(b),C=Math.atan2(A,y),M=Math.sin((1-a)*C)/A,R=Math.sin(a*C)/A;return this._w=p*M+this._w*R,this._x=l*M+this._x*R,this._y=h*M+this._y*R,this._z=f*M+this._z*R,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,a=0){return this._x=t[a],this._y=t[a+1],this._z=t[a+2],this._w=t[a+3],this._onChangeCallback(),this}toArray(t=[],a=0){return t[a]=this._x,t[a+1]=this._y,t[a+2]=this._z,t[a+3]=this._w,t}fromBufferAttribute(t,a){return this._x=t.getX(a),this._y=t.getY(a),this._z=t.getZ(a),this._w=t.getW(a),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class Ge{constructor(t=0,a=0,l=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=a,this.z=l}set(t,a,l){return void 0===l&&(l=this.z),this.x=t,this.y=a,this.z=l,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,a){switch(t){case 0:this.x=a;break;case 1:this.y=a;break;case 2:this.z=a;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,a){return void 0!==a?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,a)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,a){return this.x=t.x+a.x,this.y=t.y+a.y,this.z=t.z+a.z,this}addScaledVector(t,a){return this.x+=t.x*a,this.y+=t.y*a,this.z+=t.z*a,this}sub(t,a){return void 0!==a?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,a)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,a){return this.x=t.x-a.x,this.y=t.y-a.y,this.z=t.z-a.z,this}multiply(t,a){return void 0!==a?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,a)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,a){return this.x=t.x*a.x,this.y=t.y*a.y,this.z=t.z*a.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ff.setFromEuler(t))}applyAxisAngle(t,a){return this.applyQuaternion(Ff.setFromAxisAngle(t,a))}applyMatrix3(t){const a=this.x,l=this.y,h=this.z,f=t.elements;return this.x=f[0]*a+f[3]*l+f[6]*h,this.y=f[1]*a+f[4]*l+f[7]*h,this.z=f[2]*a+f[5]*l+f[8]*h,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const a=this.x,l=this.y,h=this.z,f=t.elements,p=1/(f[3]*a+f[7]*l+f[11]*h+f[15]);return this.x=(f[0]*a+f[4]*l+f[8]*h+f[12])*p,this.y=(f[1]*a+f[5]*l+f[9]*h+f[13])*p,this.z=(f[2]*a+f[6]*l+f[10]*h+f[14])*p,this}applyQuaternion(t){const a=this.x,l=this.y,h=this.z,f=t.x,p=t.y,y=t.z,b=t.w,A=b*a+p*h-y*l,C=b*l+y*a-f*h,M=b*h+f*l-p*a,R=-f*a-p*l-y*h;return this.x=A*b+R*-f+C*-y-M*-p,this.y=C*b+R*-p+M*-f-A*-y,this.z=M*b+R*-y+A*-p-C*-f,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const a=this.x,l=this.y,h=this.z,f=t.elements;return this.x=f[0]*a+f[4]*l+f[8]*h,this.y=f[1]*a+f[5]*l+f[9]*h,this.z=f[2]*a+f[6]*l+f[10]*h,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,a){return this.x=Math.max(t.x,Math.min(a.x,this.x)),this.y=Math.max(t.y,Math.min(a.y,this.y)),this.z=Math.max(t.z,Math.min(a.z,this.z)),this}clampScalar(t,a){return this.x=Math.max(t,Math.min(a,this.x)),this.y=Math.max(t,Math.min(a,this.y)),this.z=Math.max(t,Math.min(a,this.z)),this}clampLength(t,a){const l=this.length();return this.divideScalar(l||1).multiplyScalar(Math.max(t,Math.min(a,l)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,a){return this.x+=(t.x-this.x)*a,this.y+=(t.y-this.y)*a,this.z+=(t.z-this.z)*a,this}lerpVectors(t,a,l){return this.x=t.x+(a.x-t.x)*l,this.y=t.y+(a.y-t.y)*l,this.z=t.z+(a.z-t.z)*l,this}cross(t,a){return void 0!==a?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,a)):this.crossVectors(this,t)}crossVectors(t,a){const l=t.x,h=t.y,f=t.z,p=a.x,y=a.y,b=a.z;return this.x=h*b-f*y,this.y=f*p-l*b,this.z=l*y-h*p,this}projectOnVector(t){const a=t.lengthSq();if(0===a)return this.set(0,0,0);const l=t.dot(this)/a;return this.copy(t).multiplyScalar(l)}projectOnPlane(t){return xc.copy(this).projectOnVector(t),this.sub(xc)}reflect(t){return this.sub(xc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const a=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===a)return Math.PI/2;const l=this.dot(t)/a;return Math.acos(hn.clamp(l,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const a=this.x-t.x,l=this.y-t.y,h=this.z-t.z;return a*a+l*l+h*h}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,a,l){const h=Math.sin(a)*t;return this.x=h*Math.sin(l),this.y=Math.cos(a)*t,this.z=h*Math.cos(l),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,a,l){return this.x=t*Math.sin(a),this.y=l,this.z=t*Math.cos(a),this}setFromMatrixPosition(t){const a=t.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}setFromMatrixScale(t){const a=this.setFromMatrixColumn(t,0).length(),l=this.setFromMatrixColumn(t,1).length(),h=this.setFromMatrixColumn(t,2).length();return this.x=a,this.y=l,this.z=h,this}setFromMatrixColumn(t,a){return this.fromArray(t.elements,4*a)}setFromMatrix3Column(t,a){return this.fromArray(t.elements,3*a)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,a=0){return this.x=t[a],this.y=t[a+1],this.z=t[a+2],this}toArray(t=[],a=0){return t[a]=this.x,t[a+1]=this.y,t[a+2]=this.z,t}fromBufferAttribute(t,a,l){return void 0!==l&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(a),this.y=t.getY(a),this.z=t.getZ(a),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const xc=new Ge,Ff=new br;class bo{constructor(t,a){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Ge(1/0,1/0,1/0),this.max=void 0!==a?a:new Ge(-1/0,-1/0,-1/0)}set(t,a){return this.min.copy(t),this.max.copy(a),this}setFromArray(t){let a=1/0,l=1/0,h=1/0,f=-1/0,p=-1/0,y=-1/0;for(let b=0,A=t.length;b<A;b+=3){const C=t[b],M=t[b+1],R=t[b+2];C<a&&(a=C),M<l&&(l=M),R<h&&(h=R),C>f&&(f=C),M>p&&(p=M),R>y&&(y=R)}return this.min.set(a,l,h),this.max.set(f,p,y),this}setFromBufferAttribute(t){let a=1/0,l=1/0,h=1/0,f=-1/0,p=-1/0,y=-1/0;for(let b=0,A=t.count;b<A;b++){const C=t.getX(b),M=t.getY(b),R=t.getZ(b);C<a&&(a=C),M<l&&(l=M),R<h&&(h=R),C>f&&(f=C),M>p&&(p=M),R>y&&(y=R)}return this.min.set(a,l,h),this.max.set(f,p,y),this}setFromPoints(t){this.makeEmpty();for(let a=0,l=t.length;a<l;a++)this.expandByPoint(t[a]);return this}setFromCenterAndSize(t,a){const l=Es.copy(a).multiplyScalar(.5);return this.min.copy(t).sub(l),this.max.copy(t).add(l),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Ge),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Ge),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const a=t.geometry;void 0!==a&&(null===a.boundingBox&&a.computeBoundingBox(),Tc.copy(a.boundingBox),Tc.applyMatrix4(t.matrixWorld),this.union(Tc));const l=t.children;for(let h=0,f=l.length;h<f;h++)this.expandByObject(l[h]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,a){return void 0===a&&(console.warn("THREE.Box3: .getParameter() target is now required"),a=new Ge),a.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Es),Es.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let a,l;return t.normal.x>0?(a=t.normal.x*this.min.x,l=t.normal.x*this.max.x):(a=t.normal.x*this.max.x,l=t.normal.x*this.min.x),t.normal.y>0?(a+=t.normal.y*this.min.y,l+=t.normal.y*this.max.y):(a+=t.normal.y*this.max.y,l+=t.normal.y*this.min.y),t.normal.z>0?(a+=t.normal.z*this.min.z,l+=t.normal.z*this.max.z):(a+=t.normal.z*this.max.z,l+=t.normal.z*this.min.z),a<=-t.constant&&l>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vr),Cs.subVectors(this.max,Vr),To.subVectors(t.a,Vr),Ao.subVectors(t.b,Vr),pl.subVectors(t.c,Vr),Ms.subVectors(Ao,To),eo.subVectors(pl,Ao),Ia.subVectors(To,pl);let a=[0,-Ms.z,Ms.y,0,-eo.z,eo.y,0,-Ia.z,Ia.y,Ms.z,0,-Ms.x,eo.z,0,-eo.x,Ia.z,0,-Ia.x,-Ms.y,Ms.x,0,-eo.y,eo.x,0,-Ia.y,Ia.x,0];return!(!bc(a,To,Ao,pl,Cs)||(a=[1,0,0,0,1,0,0,0,1],!bc(a,To,Ao,pl,Cs)))&&(Cr.crossVectors(Ms,eo),a=[Cr.x,Cr.y,Cr.z],bc(a,To,Ao,pl,Cs))}clampPoint(t,a){return void 0===a&&(console.warn("THREE.Box3: .clampPoint() target is now required"),a=new Ge),a.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Es.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Es).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(as[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),as[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),as[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),as[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),as[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),as[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),as[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),as[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(as)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function bc(i,t,a,l,h){for(let f=0,p=i.length-3;f<=p;f+=3){wo.fromArray(i,f);const y=h.x*Math.abs(wo.x)+h.y*Math.abs(wo.y)+h.z*Math.abs(wo.z),b=t.dot(wo),A=a.dot(wo),C=l.dot(wo);if(Math.max(-Math.max(b,A,C),Math.min(b,A,C))>y)return!1}return!0}const as=[new Ge,new Ge,new Ge,new Ge,new Ge,new Ge,new Ge,new Ge],Es=new Ge,Tc=new bo,To=new Ge,Ao=new Ge,pl=new Ge,Ms=new Ge,eo=new Ge,Ia=new Ge,Vr=new Ge,Cs=new Ge,Cr=new Ge,wo=new Ge,Nf=new bo;class za{constructor(t,a){this.center=void 0!==t?t:new Ge,this.radius=void 0!==a?a:-1}set(t,a){return this.center.copy(t),this.radius=a,this}setFromPoints(t,a){const l=this.center;void 0!==a?l.copy(a):Nf.setFromPoints(t).getCenter(l);let h=0;for(let f=0,p=t.length;f<p;f++)h=Math.max(h,l.distanceToSquared(t[f]));return this.radius=Math.sqrt(h),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const a=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=a*a}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,a){const l=this.center.distanceToSquared(t);return void 0===a&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),a=new Ge),a.copy(t),l>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new bo),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const ss=new Ge,cu=new Ge,Gr=new Ge,os=new Ge,So=new Ge,to=new Ge,Yh=new Ge;class Eo{constructor(t,a){this.origin=void 0!==t?t:new Ge,this.direction=void 0!==a?a:new Ge(0,0,-1)}set(t,a){return this.origin.copy(t),this.direction.copy(a),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,a){return void 0===a&&(console.warn("THREE.Ray: .at() target is now required"),a=new Ge),a.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ss)),this}closestPointToPoint(t,a){void 0===a&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),a=new Ge),a.subVectors(t,this.origin);const l=a.dot(this.direction);return l<0?a.copy(this.origin):a.copy(this.direction).multiplyScalar(l).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const a=ss.subVectors(t,this.origin).dot(this.direction);return a<0?this.origin.distanceToSquared(t):(ss.copy(this.direction).multiplyScalar(a).add(this.origin),ss.distanceToSquared(t))}distanceSqToSegment(t,a,l,h){cu.copy(t).add(a).multiplyScalar(.5),Gr.copy(a).sub(t).normalize(),os.copy(this.origin).sub(cu);const f=.5*t.distanceTo(a),p=-this.direction.dot(Gr),y=os.dot(this.direction),b=-os.dot(Gr),A=os.lengthSq(),C=Math.abs(1-p*p);let M,R,k,z;if(C>0)if(M=p*b-y,R=p*y-b,z=f*C,M>=0)if(R>=-z)if(R<=z){const pe=1/C;M*=pe,R*=pe,k=M*(M+p*R+2*y)+R*(p*M+R+2*b)+A}else R=f,M=Math.max(0,-(p*R+y)),k=-M*M+R*(R+2*b)+A;else R=-f,M=Math.max(0,-(p*R+y)),k=-M*M+R*(R+2*b)+A;else R<=-z?(M=Math.max(0,-(-p*f+y)),R=M>0?-f:Math.min(Math.max(-f,-b),f),k=-M*M+R*(R+2*b)+A):R<=z?(M=0,R=Math.min(Math.max(-f,-b),f),k=R*(R+2*b)+A):(M=Math.max(0,-(p*f+y)),R=M>0?f:Math.min(Math.max(-f,-b),f),k=-M*M+R*(R+2*b)+A);else R=p>0?-f:f,M=Math.max(0,-(p*R+y)),k=-M*M+R*(R+2*b)+A;return l&&l.copy(this.direction).multiplyScalar(M).add(this.origin),h&&h.copy(Gr).multiplyScalar(R).add(cu),k}intersectSphere(t,a){ss.subVectors(t.center,this.origin);const l=ss.dot(this.direction),h=ss.dot(ss)-l*l,f=t.radius*t.radius;if(h>f)return null;const p=Math.sqrt(f-h),y=l-p,b=l+p;return y<0&&b<0?null:this.at(y<0?b:y,a)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const a=t.normal.dot(this.direction);if(0===a)return 0===t.distanceToPoint(this.origin)?0:null;const l=-(this.origin.dot(t.normal)+t.constant)/a;return l>=0?l:null}intersectPlane(t,a){const l=this.distanceToPlane(t);return null===l?null:this.at(l,a)}intersectsPlane(t){const a=t.distanceToPoint(this.origin);return 0===a||t.normal.dot(this.direction)*a<0}intersectBox(t,a){let l,h,f,p,y,b;const A=1/this.direction.x,C=1/this.direction.y,M=1/this.direction.z,R=this.origin;return A>=0?(l=(t.min.x-R.x)*A,h=(t.max.x-R.x)*A):(l=(t.max.x-R.x)*A,h=(t.min.x-R.x)*A),C>=0?(f=(t.min.y-R.y)*C,p=(t.max.y-R.y)*C):(f=(t.max.y-R.y)*C,p=(t.min.y-R.y)*C),l>p||f>h||((f>l||l!=l)&&(l=f),(p<h||h!=h)&&(h=p),M>=0?(y=(t.min.z-R.z)*M,b=(t.max.z-R.z)*M):(y=(t.max.z-R.z)*M,b=(t.min.z-R.z)*M),l>b||y>h)||((y>l||l!=l)&&(l=y),(b<h||h!=h)&&(h=b),h<0)?null:this.at(l>=0?l:h,a)}intersectsBox(t){return null!==this.intersectBox(t,ss)}intersectTriangle(t,a,l,h,f){So.subVectors(a,t),to.subVectors(l,t),Yh.crossVectors(So,to);let y,p=this.direction.dot(Yh);if(p>0){if(h)return null;y=1}else{if(!(p<0))return null;y=-1,p=-p}os.subVectors(this.origin,t);const b=y*this.direction.dot(to.crossVectors(os,to));if(b<0)return null;const A=y*this.direction.dot(So.cross(os));if(A<0||b+A>p)return null;const C=-y*os.dot(Yh);return C<0?null:this.at(C/p,f)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class xn{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,a,l,h,f,p,y,b,A,C,M,R,k,z,pe,ce){const V=this.elements;return V[0]=t,V[4]=a,V[8]=l,V[12]=h,V[1]=f,V[5]=p,V[9]=y,V[13]=b,V[2]=A,V[6]=C,V[10]=M,V[14]=R,V[3]=k,V[7]=z,V[11]=pe,V[15]=ce,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new xn).fromArray(this.elements)}copy(t){const a=this.elements,l=t.elements;return a[0]=l[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[4]=l[4],a[5]=l[5],a[6]=l[6],a[7]=l[7],a[8]=l[8],a[9]=l[9],a[10]=l[10],a[11]=l[11],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15],this}copyPosition(t){const a=this.elements,l=t.elements;return a[12]=l[12],a[13]=l[13],a[14]=l[14],this}setFromMatrix3(t){const a=t.elements;return this.set(a[0],a[3],a[6],0,a[1],a[4],a[7],0,a[2],a[5],a[8],0,0,0,0,1),this}extractBasis(t,a,l){return t.setFromMatrixColumn(this,0),a.setFromMatrixColumn(this,1),l.setFromMatrixColumn(this,2),this}makeBasis(t,a,l){return this.set(t.x,a.x,l.x,0,t.y,a.y,l.y,0,t.z,a.z,l.z,0,0,0,0,1),this}extractRotation(t){const a=this.elements,l=t.elements,h=1/Mo.setFromMatrixColumn(t,0).length(),f=1/Mo.setFromMatrixColumn(t,1).length(),p=1/Mo.setFromMatrixColumn(t,2).length();return a[0]=l[0]*h,a[1]=l[1]*h,a[2]=l[2]*h,a[3]=0,a[4]=l[4]*f,a[5]=l[5]*f,a[6]=l[6]*f,a[7]=0,a[8]=l[8]*p,a[9]=l[9]*p,a[10]=l[10]*p,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const a=this.elements,l=t.x,h=t.y,f=t.z,p=Math.cos(l),y=Math.sin(l),b=Math.cos(h),A=Math.sin(h),C=Math.cos(f),M=Math.sin(f);if("XYZ"===t.order){const R=p*C,k=p*M,z=y*C,pe=y*M;a[0]=b*C,a[4]=-b*M,a[8]=A,a[1]=k+z*A,a[5]=R-pe*A,a[9]=-y*b,a[2]=pe-R*A,a[6]=z+k*A,a[10]=p*b}else if("YXZ"===t.order){const R=b*C,k=b*M,z=A*C,pe=A*M;a[0]=R+pe*y,a[4]=z*y-k,a[8]=p*A,a[1]=p*M,a[5]=p*C,a[9]=-y,a[2]=k*y-z,a[6]=pe+R*y,a[10]=p*b}else if("ZXY"===t.order){const R=b*C,k=b*M,z=A*C,pe=A*M;a[0]=R-pe*y,a[4]=-p*M,a[8]=z+k*y,a[1]=k+z*y,a[5]=p*C,a[9]=pe-R*y,a[2]=-p*A,a[6]=y,a[10]=p*b}else if("ZYX"===t.order){const R=p*C,k=p*M,z=y*C,pe=y*M;a[0]=b*C,a[4]=z*A-k,a[8]=R*A+pe,a[1]=b*M,a[5]=pe*A+R,a[9]=k*A-z,a[2]=-A,a[6]=y*b,a[10]=p*b}else if("YZX"===t.order){const R=p*b,k=p*A,z=y*b,pe=y*A;a[0]=b*C,a[4]=pe-R*M,a[8]=z*M+k,a[1]=M,a[5]=p*C,a[9]=-y*C,a[2]=-A*C,a[6]=k*M+z,a[10]=R-pe*M}else if("XZY"===t.order){const R=p*b,k=p*A,z=y*b,pe=y*A;a[0]=b*C,a[4]=-M,a[8]=A*C,a[1]=R*M+pe,a[5]=p*C,a[9]=k*M-z,a[2]=z*M-k,a[6]=y*C,a[10]=pe*M+R}return a[3]=0,a[7]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kf,t,Bf)}lookAt(t,a,l){const h=this.elements;return _a.subVectors(t,a),0===_a.lengthSq()&&(_a.z=1),_a.normalize(),Ps.crossVectors(l,_a),0===Ps.lengthSq()&&(1===Math.abs(l.z)?_a.x+=1e-4:_a.z+=1e-4,_a.normalize(),Ps.crossVectors(l,_a)),Ps.normalize(),Ac.crossVectors(_a,Ps),h[0]=Ps.x,h[4]=Ac.x,h[8]=_a.x,h[1]=Ps.y,h[5]=Ac.y,h[9]=_a.y,h[2]=Ps.z,h[6]=Ac.z,h[10]=_a.z,this}multiply(t,a){return void 0!==a?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,a)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,a){const l=t.elements,h=a.elements,f=this.elements,p=l[0],y=l[4],b=l[8],A=l[12],C=l[1],M=l[5],R=l[9],k=l[13],z=l[2],pe=l[6],ce=l[10],V=l[14],U=l[3],je=l[7],Ze=l[11],Je=l[15],Ie=h[0],it=h[4],Gt=h[8],ht=h[12],At=h[1],Lt=h[5],Yt=h[9],Rt=h[13],qe=h[2],ut=h[6],xt=h[10],zt=h[14],li=h[3],ri=h[7],di=h[11],_i=h[15];return f[0]=p*Ie+y*At+b*qe+A*li,f[4]=p*it+y*Lt+b*ut+A*ri,f[8]=p*Gt+y*Yt+b*xt+A*di,f[12]=p*ht+y*Rt+b*zt+A*_i,f[1]=C*Ie+M*At+R*qe+k*li,f[5]=C*it+M*Lt+R*ut+k*ri,f[9]=C*Gt+M*Yt+R*xt+k*di,f[13]=C*ht+M*Rt+R*zt+k*_i,f[2]=z*Ie+pe*At+ce*qe+V*li,f[6]=z*it+pe*Lt+ce*ut+V*ri,f[10]=z*Gt+pe*Yt+ce*xt+V*di,f[14]=z*ht+pe*Rt+ce*zt+V*_i,f[3]=U*Ie+je*At+Ze*qe+Je*li,f[7]=U*it+je*Lt+Ze*ut+Je*ri,f[11]=U*Gt+je*Yt+Ze*xt+Je*di,f[15]=U*ht+je*Rt+Ze*zt+Je*_i,this}multiplyScalar(t){const a=this.elements;return a[0]*=t,a[4]*=t,a[8]*=t,a[12]*=t,a[1]*=t,a[5]*=t,a[9]*=t,a[13]*=t,a[2]*=t,a[6]*=t,a[10]*=t,a[14]*=t,a[3]*=t,a[7]*=t,a[11]*=t,a[15]*=t,this}determinant(){const t=this.elements,a=t[0],l=t[4],h=t[8],f=t[12],p=t[1],y=t[5],b=t[9],A=t[13],C=t[2],M=t[6],R=t[10],k=t[14];return t[3]*(+f*b*M-h*A*M-f*y*R+l*A*R+h*y*k-l*b*k)+t[7]*(+a*b*k-a*A*R+f*p*R-h*p*k+h*A*C-f*b*C)+t[11]*(+a*A*M-a*y*k-f*p*M+l*p*k+f*y*C-l*A*C)+t[15]*(-h*y*C-a*b*M+a*y*R+h*p*M-l*p*R+l*b*C)}transpose(){const t=this.elements;let a;return a=t[1],t[1]=t[4],t[4]=a,a=t[2],t[2]=t[8],t[8]=a,a=t[6],t[6]=t[9],t[9]=a,a=t[3],t[3]=t[12],t[12]=a,a=t[7],t[7]=t[13],t[13]=a,a=t[11],t[11]=t[14],t[14]=a,this}setPosition(t,a,l){const h=this.elements;return t.isVector3?(h[12]=t.x,h[13]=t.y,h[14]=t.z):(h[12]=t,h[13]=a,h[14]=l),this}invert(){const t=this.elements,a=t[0],l=t[1],h=t[2],f=t[3],p=t[4],y=t[5],b=t[6],A=t[7],C=t[8],M=t[9],R=t[10],k=t[11],z=t[12],pe=t[13],ce=t[14],V=t[15],U=M*ce*A-pe*R*A+pe*b*k-y*ce*k-M*b*V+y*R*V,je=z*R*A-C*ce*A-z*b*k+p*ce*k+C*b*V-p*R*V,Ze=C*pe*A-z*M*A+z*y*k-p*pe*k-C*y*V+p*M*V,Je=z*M*b-C*pe*b-z*y*R+p*pe*R+C*y*ce-p*M*ce,Ie=a*U+l*je+h*Ze+f*Je;if(0===Ie)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const it=1/Ie;return t[0]=U*it,t[1]=(pe*R*f-M*ce*f-pe*h*k+l*ce*k+M*h*V-l*R*V)*it,t[2]=(y*ce*f-pe*b*f+pe*h*A-l*ce*A-y*h*V+l*b*V)*it,t[3]=(M*b*f-y*R*f-M*h*A+l*R*A+y*h*k-l*b*k)*it,t[4]=je*it,t[5]=(C*ce*f-z*R*f+z*h*k-a*ce*k-C*h*V+a*R*V)*it,t[6]=(z*b*f-p*ce*f-z*h*A+a*ce*A+p*h*V-a*b*V)*it,t[7]=(p*R*f-C*b*f+C*h*A-a*R*A-p*h*k+a*b*k)*it,t[8]=Ze*it,t[9]=(z*M*f-C*pe*f-z*l*k+a*pe*k+C*l*V-a*M*V)*it,t[10]=(p*pe*f-z*y*f+z*l*A-a*pe*A-p*l*V+a*y*V)*it,t[11]=(C*y*f-p*M*f-C*l*A+a*M*A+p*l*k-a*y*k)*it,t[12]=Je*it,t[13]=(C*pe*h-z*M*h+z*l*R-a*pe*R-C*l*ce+a*M*ce)*it,t[14]=(z*y*h-p*pe*h-z*l*b+a*pe*b+p*l*ce-a*y*ce)*it,t[15]=(p*M*h-C*y*h+C*l*b-a*M*b-p*l*R+a*y*R)*it,this}scale(t){const a=this.elements,l=t.x,h=t.y,f=t.z;return a[0]*=l,a[4]*=h,a[8]*=f,a[1]*=l,a[5]*=h,a[9]*=f,a[2]*=l,a[6]*=h,a[10]*=f,a[3]*=l,a[7]*=h,a[11]*=f,this}getMaxScaleOnAxis(){const t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))}makeTranslation(t,a,l){return this.set(1,0,0,t,0,1,0,a,0,0,1,l,0,0,0,1),this}makeRotationX(t){const a=Math.cos(t),l=Math.sin(t);return this.set(1,0,0,0,0,a,-l,0,0,l,a,0,0,0,0,1),this}makeRotationY(t){const a=Math.cos(t),l=Math.sin(t);return this.set(a,0,l,0,0,1,0,0,-l,0,a,0,0,0,0,1),this}makeRotationZ(t){const a=Math.cos(t),l=Math.sin(t);return this.set(a,-l,0,0,l,a,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,a){const l=Math.cos(a),h=Math.sin(a),f=1-l,p=t.x,y=t.y,b=t.z,A=f*p,C=f*y;return this.set(A*p+l,A*y-h*b,A*b+h*y,0,A*y+h*b,C*y+l,C*b-h*p,0,A*b-h*y,C*b+h*p,f*b*b+l,0,0,0,0,1),this}makeScale(t,a,l){return this.set(t,0,0,0,0,a,0,0,0,0,l,0,0,0,0,1),this}makeShear(t,a,l){return this.set(1,a,l,0,t,1,l,0,t,a,1,0,0,0,0,1),this}compose(t,a,l){const h=this.elements,f=a._x,p=a._y,y=a._z,b=a._w,A=f+f,C=p+p,M=y+y,R=f*A,k=f*C,z=f*M,pe=p*C,ce=p*M,V=y*M,U=b*A,je=b*C,Ze=b*M,Je=l.x,Ie=l.y,it=l.z;return h[0]=(1-(pe+V))*Je,h[1]=(k+Ze)*Je,h[2]=(z-je)*Je,h[3]=0,h[4]=(k-Ze)*Ie,h[5]=(1-(R+V))*Ie,h[6]=(ce+U)*Ie,h[7]=0,h[8]=(z+je)*it,h[9]=(ce-U)*it,h[10]=(1-(R+pe))*it,h[11]=0,h[12]=t.x,h[13]=t.y,h[14]=t.z,h[15]=1,this}decompose(t,a,l){const h=this.elements;let f=Mo.set(h[0],h[1],h[2]).length();const p=Mo.set(h[4],h[5],h[6]).length(),y=Mo.set(h[8],h[9],h[10]).length();this.determinant()<0&&(f=-f),t.x=h[12],t.y=h[13],t.z=h[14],Va.copy(this);const A=1/f,C=1/p,M=1/y;return Va.elements[0]*=A,Va.elements[1]*=A,Va.elements[2]*=A,Va.elements[4]*=C,Va.elements[5]*=C,Va.elements[6]*=C,Va.elements[8]*=M,Va.elements[9]*=M,Va.elements[10]*=M,a.setFromRotationMatrix(Va),l.x=f,l.y=p,l.z=y,this}makePerspective(t,a,l,h,f,p){void 0===p&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const y=this.elements,A=2*f/(l-h),C=(a+t)/(a-t),M=(l+h)/(l-h),R=-(p+f)/(p-f),k=-2*p*f/(p-f);return y[0]=2*f/(a-t),y[4]=0,y[8]=C,y[12]=0,y[1]=0,y[5]=A,y[9]=M,y[13]=0,y[2]=0,y[6]=0,y[10]=R,y[14]=k,y[3]=0,y[7]=0,y[11]=-1,y[15]=0,this}makeOrthographic(t,a,l,h,f,p){const y=this.elements,b=1/(a-t),A=1/(l-h),C=1/(p-f),M=(a+t)*b,R=(l+h)*A,k=(p+f)*C;return y[0]=2*b,y[4]=0,y[8]=0,y[12]=-M,y[1]=0,y[5]=2*A,y[9]=0,y[13]=-R,y[2]=0,y[6]=0,y[10]=-2*C,y[14]=-k,y[3]=0,y[7]=0,y[11]=0,y[15]=1,this}equals(t){const a=this.elements,l=t.elements;for(let h=0;h<16;h++)if(a[h]!==l[h])return!1;return!0}fromArray(t,a=0){for(let l=0;l<16;l++)this.elements[l]=t[l+a];return this}toArray(t=[],a=0){const l=this.elements;return t[a]=l[0],t[a+1]=l[1],t[a+2]=l[2],t[a+3]=l[3],t[a+4]=l[4],t[a+5]=l[5],t[a+6]=l[6],t[a+7]=l[7],t[a+8]=l[8],t[a+9]=l[9],t[a+10]=l[10],t[a+11]=l[11],t[a+12]=l[12],t[a+13]=l[13],t[a+14]=l[14],t[a+15]=l[15],t}}const Mo=new Ge,Va=new xn,kf=new Ge(0,0,0),Bf=new Ge(1,1,1),Ps=new Ge,Ac=new Ge,_a=new Ge;class ml{constructor(t=0,a=0,l=0,h=ml.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=a,this._z=l,this._order=h}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,a,l,h){return this._x=t,this._y=a,this._z=l,this._order=h||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,a,l){const h=hn.clamp,f=t.elements,p=f[0],y=f[4],b=f[8],A=f[1],C=f[5],M=f[9],R=f[2],k=f[6],z=f[10];switch(a=a||this._order){case"XYZ":this._y=Math.asin(h(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(-M,z),this._z=Math.atan2(-y,p)):(this._x=Math.atan2(k,C),this._z=0);break;case"YXZ":this._x=Math.asin(-h(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(b,z),this._z=Math.atan2(A,C)):(this._y=Math.atan2(-R,p),this._z=0);break;case"ZXY":this._x=Math.asin(h(k,-1,1)),Math.abs(k)<.9999999?(this._y=Math.atan2(-R,z),this._z=Math.atan2(-y,C)):(this._y=0,this._z=Math.atan2(A,p));break;case"ZYX":this._y=Math.asin(-h(R,-1,1)),Math.abs(R)<.9999999?(this._x=Math.atan2(k,z),this._z=Math.atan2(A,p)):(this._x=0,this._z=Math.atan2(-y,C));break;case"YZX":this._z=Math.asin(h(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-M,C),this._y=Math.atan2(-R,p)):(this._x=0,this._y=Math.atan2(b,z));break;case"XZY":this._z=Math.asin(-h(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(k,C),this._y=Math.atan2(b,p)):(this._x=Math.atan2(-M,z),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+a)}return this._order=a,!1!==l&&this._onChangeCallback(),this}setFromQuaternion(t,a,l){return hu.makeRotationFromQuaternion(t),this.setFromRotationMatrix(hu,a,l)}setFromVector3(t,a){return this.set(t.x,t.y,t.z,a||this._order)}reorder(t){return du.setFromEuler(this),this.setFromQuaternion(du,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],a=0){return t[a]=this._x,t[a+1]=this._y,t[a+2]=this._z,t[a+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new Ge(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}ml.DefaultOrder="XYZ",ml.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const hu=new xn,du=new br;class Wr{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Qv=0;const Co=new Ge,vl=new br,Ls=new xn,wc=new Ge,fu=new Ge,Kv=new Ge,Zv=new br,Uf=new Ge(1,0,0),Hf=new Ge(0,1,0),Sc=new Ge(0,0,1),zf={type:"added"},Vf={type:"removed"};function on(){Object.defineProperty(this,"id",{value:Qv++}),this.uuid=hn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=on.DefaultUp.clone();const i=new Ge,t=new ml,a=new br,l=new Ge(1,1,1);t._onChange(function h(){a.setFromEuler(t,!1)}),a._onChange(function f(){t.setFromQuaternion(a,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:l},modelViewMatrix:{value:new xn},normalMatrix:{value:new Or}}),this.matrix=new xn,this.matrixWorld=new xn,this.matrixAutoUpdate=on.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Wr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}on.DefaultUp=new Ge(0,1,0),on.DefaultMatrixAutoUpdate=!0,on.prototype=Object.assign(Object.create(ya.prototype),{constructor:on,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(i){return this.quaternion.premultiply(i),this},setRotationFromAxisAngle:function(i,t){this.quaternion.setFromAxisAngle(i,t)},setRotationFromEuler:function(i){this.quaternion.setFromEuler(i,!0)},setRotationFromMatrix:function(i){this.quaternion.setFromRotationMatrix(i)},setRotationFromQuaternion:function(i){this.quaternion.copy(i)},rotateOnAxis:function(i,t){return vl.setFromAxisAngle(i,t),this.quaternion.multiply(vl),this},rotateOnWorldAxis:function(i,t){return vl.setFromAxisAngle(i,t),this.quaternion.premultiply(vl),this},rotateX:function(i){return this.rotateOnAxis(Uf,i)},rotateY:function(i){return this.rotateOnAxis(Hf,i)},rotateZ:function(i){return this.rotateOnAxis(Sc,i)},translateOnAxis:function(i,t){return Co.copy(i).applyQuaternion(this.quaternion),this.position.add(Co.multiplyScalar(t)),this},translateX:function(i){return this.translateOnAxis(Uf,i)},translateY:function(i){return this.translateOnAxis(Hf,i)},translateZ:function(i){return this.translateOnAxis(Sc,i)},localToWorld:function(i){return i.applyMatrix4(this.matrixWorld)},worldToLocal:function(i){return i.applyMatrix4(Ls.copy(this.matrixWorld).invert())},lookAt:function(i,t,a){i.isVector3?wc.copy(i):wc.set(i,t,a);const l=this.parent;this.updateWorldMatrix(!0,!1),fu.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ls.lookAt(fu,wc,this.up):Ls.lookAt(wc,fu,this.up),this.quaternion.setFromRotationMatrix(Ls),l&&(Ls.extractRotation(l.matrixWorld),vl.setFromRotationMatrix(Ls),this.quaternion.premultiply(vl.invert()))},add:function(i){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(null!==i.parent&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(zf)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)},remove:function(i){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}const t=this.children.indexOf(i);return-1!==t&&(i.parent=null,this.children.splice(t,1),i.dispatchEvent(Vf)),this},clear:function(){for(let i=0;i<this.children.length;i++){const t=this.children[i];t.parent=null,t.dispatchEvent(Vf)}return this.children.length=0,this},attach:function(i){return this.updateWorldMatrix(!0,!1),Ls.copy(this.matrixWorld).invert(),null!==i.parent&&(i.parent.updateWorldMatrix(!0,!1),Ls.multiply(i.parent.matrixWorld)),i.applyMatrix4(Ls),i.updateWorldMatrix(!1,!1),this.add(i),this},getObjectById:function(i){return this.getObjectByProperty("id",i)},getObjectByName:function(i){return this.getObjectByProperty("name",i)},getObjectByProperty:function(i,t){if(this[i]===t)return this;for(let a=0,l=this.children.length;a<l;a++){const f=this.children[a].getObjectByProperty(i,t);if(void 0!==f)return f}},getWorldPosition:function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),i=new Ge),this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new br),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fu,i,Kv),i},getWorldScale:function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new Ge),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fu,Zv,i),i},getWorldDirection:function(i){void 0===i&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),i=new Ge),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return i.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(i){i(this);const t=this.children;for(let a=0,l=t.length;a<l;a++)t[a].traverse(i)},traverseVisible:function(i){if(!1===this.visible)return;i(this);const t=this.children;for(let a=0,l=t.length;a<l;a++)t[a].traverseVisible(i)},traverseAncestors:function(i){const t=this.parent;null!==t&&(i(t),t.traverseAncestors(i))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const t=this.children;for(let a=0,l=t.length;a<l;a++)t[a].updateMatrixWorld(i)},updateWorldMatrix:function(i,t){const a=this.parent;if(!0===i&&null!==a&&a.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const l=this.children;for(let h=0,f=l.length;h<f;h++)l[h].updateWorldMatrix(!1,!0)}},toJSON:function(i){const t=void 0===i||"string"==typeof i,a={};t&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function h(p,y){return void 0===p[y.uuid]&&(p[y.uuid]=y.toJSON(i)),y.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){l.geometry=h(i.geometries,this.geometry);const p=this.geometry.parameters;if(void 0!==p&&void 0!==p.shapes){const y=p.shapes;if(Array.isArray(y))for(let b=0,A=y.length;b<A;b++)h(i.shapes,y[b]);else h(i.shapes,y)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(h(i.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const p=[];for(let y=0,b=this.material.length;y<b;y++)p.push(h(i.materials,this.material[y]));l.material=p}else l.material=h(i.materials,this.material);if(this.children.length>0){l.children=[];for(let p=0;p<this.children.length;p++)l.children.push(this.children[p].toJSON(i).object)}if(this.animations.length>0){l.animations=[];for(let p=0;p<this.animations.length;p++)l.animations.push(h(i.animations,this.animations[p]))}if(t){const p=f(i.geometries),y=f(i.materials),b=f(i.textures),A=f(i.images),C=f(i.shapes),M=f(i.skeletons),R=f(i.animations);p.length>0&&(a.geometries=p),y.length>0&&(a.materials=y),b.length>0&&(a.textures=b),A.length>0&&(a.images=A),C.length>0&&(a.shapes=C),M.length>0&&(a.skeletons=M),R.length>0&&(a.animations=R)}return a.object=l,a;function f(p){const y=[];for(const b in p){const A=p[b];delete A.metadata,y.push(A)}return y}},clone:function(i){return(new this.constructor).copy(this,i)},copy:function(i,t=!0){if(this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData=JSON.parse(JSON.stringify(i.userData)),!0===t)for(let a=0;a<i.children.length;a++)this.add(i.children[a].clone());return this}});const Qh=new Ge,pu=new Ge,$v=new Or;class Is{constructor(t,a){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Ge(1,0,0),this.constant=void 0!==a?a:0}set(t,a){return this.normal.copy(t),this.constant=a,this}setComponents(t,a,l,h){return this.normal.set(t,a,l),this.constant=h,this}setFromNormalAndCoplanarPoint(t,a){return this.normal.copy(t),this.constant=-a.dot(this.normal),this}setFromCoplanarPoints(t,a,l){const h=Qh.subVectors(l,a).cross(pu.subVectors(t,a)).normalize();return this.setFromNormalAndCoplanarPoint(h,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,a){return void 0===a&&(console.warn("THREE.Plane: .projectPoint() target is now required"),a=new Ge),a.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,a){void 0===a&&(console.warn("THREE.Plane: .intersectLine() target is now required"),a=new Ge);const l=t.delta(Qh),h=this.normal.dot(l);if(0===h)return 0===this.distanceToPoint(t.start)?a.copy(t.start):void 0;const f=-(t.start.dot(this.normal)+this.constant)/h;return f<0||f>1?void 0:a.copy(l).multiplyScalar(f).add(t.start)}intersectsLine(t){const a=this.distanceToPoint(t.start),l=this.distanceToPoint(t.end);return a<0&&l>0||l<0&&a>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Ge),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,a){const l=a||$v.getNormalMatrix(t),h=this.coplanarPoint(Qh).applyMatrix4(t),f=this.normal.applyMatrix3(l).normalize();return this.constant=-h.dot(f),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const $r=new Ge,Rs=new Ge,Nn=new Ge,Jr=new Ge,io=new Ge,Ds=new Ge,Gf=new Ge,Kh=new Ge,Zh=new Ge,$h=new Ge;class ea{constructor(t,a,l){this.a=void 0!==t?t:new Ge,this.b=void 0!==a?a:new Ge,this.c=void 0!==l?l:new Ge}static getNormal(t,a,l,h){void 0===h&&(console.warn("THREE.Triangle: .getNormal() target is now required"),h=new Ge),h.subVectors(l,a),$r.subVectors(t,a),h.cross($r);const f=h.lengthSq();return f>0?h.multiplyScalar(1/Math.sqrt(f)):h.set(0,0,0)}static getBarycoord(t,a,l,h,f){$r.subVectors(h,a),Rs.subVectors(l,a),Nn.subVectors(t,a);const p=$r.dot($r),y=$r.dot(Rs),b=$r.dot(Nn),A=Rs.dot(Rs),C=Rs.dot(Nn),M=p*A-y*y;if(void 0===f&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),f=new Ge),0===M)return f.set(-2,-1,-1);const R=1/M,k=(A*b-y*C)*R,z=(p*C-y*b)*R;return f.set(1-k-z,z,k)}static containsPoint(t,a,l,h){return this.getBarycoord(t,a,l,h,Jr),Jr.x>=0&&Jr.y>=0&&Jr.x+Jr.y<=1}static getUV(t,a,l,h,f,p,y,b){return this.getBarycoord(t,a,l,h,Jr),b.set(0,0),b.addScaledVector(f,Jr.x),b.addScaledVector(p,Jr.y),b.addScaledVector(y,Jr.z),b}static isFrontFacing(t,a,l,h){return $r.subVectors(l,a),Rs.subVectors(t,a),$r.cross(Rs).dot(h)<0}set(t,a,l){return this.a.copy(t),this.b.copy(a),this.c.copy(l),this}setFromPointsAndIndices(t,a,l,h){return this.a.copy(t[a]),this.b.copy(t[l]),this.c.copy(t[h]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return $r.subVectors(this.c,this.b),Rs.subVectors(this.a,this.b),.5*$r.cross(Rs).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Ge),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ea.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Is),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,a){return ea.getBarycoord(t,this.a,this.b,this.c,a)}getUV(t,a,l,h,f){return ea.getUV(t,this.a,this.b,this.c,a,l,h,f)}containsPoint(t){return ea.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ea.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,a){void 0===a&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),a=new Ge);const l=this.a,h=this.b,f=this.c;let p,y;io.subVectors(h,l),Ds.subVectors(f,l),Kh.subVectors(t,l);const b=io.dot(Kh),A=Ds.dot(Kh);if(b<=0&&A<=0)return a.copy(l);Zh.subVectors(t,h);const C=io.dot(Zh),M=Ds.dot(Zh);if(C>=0&&M<=C)return a.copy(h);const R=b*M-C*A;if(R<=0&&b>=0&&C<=0)return p=b/(b-C),a.copy(l).addScaledVector(io,p);$h.subVectors(t,f);const k=io.dot($h),z=Ds.dot($h);if(z>=0&&k<=z)return a.copy(f);const pe=k*A-b*z;if(pe<=0&&A>=0&&z<=0)return y=A/(A-z),a.copy(l).addScaledVector(Ds,y);const ce=C*z-k*M;if(ce<=0&&M-C>=0&&k-z>=0)return Gf.subVectors(f,h),y=(M-C)/(M-C+(k-z)),a.copy(h).addScaledVector(Gf,y);const V=1/(ce+pe+R);return p=pe*V,y=R*V,a.copy(l).addScaledVector(io,p).addScaledVector(Ds,y)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Jh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ga={h:0,s:0,l:0},Ec={h:0,s:0,l:0};function Mc(i,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?i+6*(t-i)*a:a<.5?t:a<2/3?i+6*(t-i)*(2/3-a):i}function mu(i){return i<.04045?.0773993808*i:Math.pow(.9478672986*i+.0521327014,2.4)}function ed(i){return i<.0031308?12.92*i:1.055*Math.pow(i,.41666)-.055}class $i{constructor(t,a,l){return Object.defineProperty(this,"isColor",{value:!0}),void 0===a&&void 0===l?this.set(t):this.setRGB(t,a,l)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,a,l){return this.r=t,this.g=a,this.b=l,this}setHSL(t,a,l){if(t=hn.euclideanModulo(t,1),a=hn.clamp(a,0,1),l=hn.clamp(l,0,1),0===a)this.r=this.g=this.b=l;else{const h=l<=.5?l*(1+a):l+a-l*a,f=2*l-h;this.r=Mc(f,h,t+1/3),this.g=Mc(f,h,t),this.b=Mc(f,h,t-1/3)}return this}setStyle(t){function a(h){void 0!==h&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let l;if(l=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let h;const p=l[2];switch(l[1]){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,a(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,a(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(p)){const y=parseFloat(h[1])/360,b=parseInt(h[2],10)/100,A=parseInt(h[3],10)/100;return a(h[4]),this.setHSL(y,b,A)}}}else if(l=/^\#([A-Fa-f\d]+)$/.exec(t)){const h=l[1],f=h.length;if(3===f)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===f)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const a=Jh[t];return void 0!==a?this.setHex(a):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,a=2){return this.r=Math.pow(t.r,a),this.g=Math.pow(t.g,a),this.b=Math.pow(t.b,a),this}copyLinearToGamma(t,a=2){const l=a>0?1/a:1;return this.r=Math.pow(t.r,l),this.g=Math.pow(t.g,l),this.b=Math.pow(t.b,l),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=mu(t.r),this.g=mu(t.g),this.b=mu(t.b),this}copyLinearToSRGB(t){return this.r=ed(t.r),this.g=ed(t.g),this.b=ed(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const a=this.r,l=this.g,h=this.b,f=Math.max(a,l,h),p=Math.min(a,l,h);let y,b;const A=(p+f)/2;if(p===f)y=0,b=0;else{const C=f-p;switch(b=A<=.5?C/(f+p):C/(2-f-p),f){case a:y=(l-h)/C+(l<h?6:0);break;case l:y=(h-a)/C+2;break;case h:y=(a-l)/C+4}y/=6}return t.h=y,t.s=b,t.l=A,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,a,l){return this.getHSL(Ga),Ga.h+=t,Ga.s+=a,Ga.l+=l,this.setHSL(Ga.h,Ga.s,Ga.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,a){return this.r=t.r+a.r,this.g=t.g+a.g,this.b=t.b+a.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,a){return this.r+=(t.r-this.r)*a,this.g+=(t.g-this.g)*a,this.b+=(t.b-this.b)*a,this}lerpColors(t,a,l){return this.r=t.r+(a.r-t.r)*l,this.g=t.g+(a.g-t.g)*l,this.b=t.b+(a.b-t.b)*l,this}lerpHSL(t,a){this.getHSL(Ga),t.getHSL(Ec);const l=hn.lerp(Ga.h,Ec.h,a),h=hn.lerp(Ga.s,Ec.s,a),f=hn.lerp(Ga.l,Ec.l,a);return this.setHSL(l,h,f),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,a=0){return this.r=t[a],this.g=t[a+1],this.b=t[a+2],this}toArray(t=[],a=0){return t[a]=this.r,t[a+1]=this.g,t[a+2]=this.b,t}fromBufferAttribute(t,a){return this.r=t.getX(a),this.g=t.getY(a),this.b=t.getZ(a),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}$i.NAMES=Jh,$i.prototype.r=1,$i.prototype.g=1,$i.prototype.b=1;class Jv{constructor(t,a,l,h,f,p=0){this.a=t,this.b=a,this.c=l,this.normal=h&&h.isVector3?h:new Ge,this.vertexNormals=Array.isArray(h)?h:[],this.color=f&&f.isColor?f:new $i,this.vertexColors=Array.isArray(f)?f:[],this.materialIndex=p}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let a=0,l=t.vertexNormals.length;a<l;a++)this.vertexNormals[a]=t.vertexNormals[a].clone();for(let a=0,l=t.vertexColors.length;a<l;a++)this.vertexColors[a]=t.vertexColors[a].clone();return this}}let Po=0;function dn(){Object.defineProperty(this,"id",{value:Po++}),this.uuid=hn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Fr(i){dn.call(this),this.type="MeshBasicMaterial",this.color=new $i(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(i)}dn.prototype=Object.assign(Object.create(ya.prototype),{constructor:dn,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(i){if(void 0!==i)for(const t in i){const a=i[t];if(void 0===a){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===a;continue}const l=this[t];void 0!==l?l&&l.isColor?l.set(a):l&&l.isVector3&&a&&a.isVector3?l.copy(a):this[t]=a:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(i){const t=void 0===i||"string"==typeof i;t&&(i={textures:{},images:{}});const a={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function l(h){const f=[];for(const p in h){const y=h[p];delete y.metadata,f.push(y)}return f}if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),this.color&&this.color.isColor&&(a.color=this.color.getHex()),void 0!==this.roughness&&(a.roughness=this.roughness),void 0!==this.metalness&&(a.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(a.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(a.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(a.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(a.specular=this.specular.getHex()),void 0!==this.shininess&&(a.shininess=this.shininess),void 0!==this.clearcoat&&(a.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(a.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(a.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(a.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(a.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,a.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(a.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(a.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(a.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(a.lightMap=this.lightMap.toJSON(i).uuid),this.aoMap&&this.aoMap.isTexture&&(a.aoMap=this.aoMap.toJSON(i).uuid,a.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(a.bumpMap=this.bumpMap.toJSON(i).uuid,a.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(a.normalMap=this.normalMap.toJSON(i).uuid,a.normalMapType=this.normalMapType,a.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(a.displacementMap=this.displacementMap.toJSON(i).uuid,a.displacementScale=this.displacementScale,a.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(a.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(a.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(a.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(a.specularMap=this.specularMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(a.envMap=this.envMap.toJSON(i).uuid,a.reflectivity=this.reflectivity,a.refractionRatio=this.refractionRatio,void 0!==this.combine&&(a.combine=this.combine),void 0!==this.envMapIntensity&&(a.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(a.gradientMap=this.gradientMap.toJSON(i).uuid),void 0!==this.size&&(a.size=this.size),void 0!==this.sizeAttenuation&&(a.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(a.blending=this.blending),!0===this.flatShading&&(a.flatShading=this.flatShading),0!==this.side&&(a.side=this.side),this.vertexColors&&(a.vertexColors=!0),this.opacity<1&&(a.opacity=this.opacity),!0===this.transparent&&(a.transparent=this.transparent),a.depthFunc=this.depthFunc,a.depthTest=this.depthTest,a.depthWrite=this.depthWrite,a.stencilWrite=this.stencilWrite,a.stencilWriteMask=this.stencilWriteMask,a.stencilFunc=this.stencilFunc,a.stencilRef=this.stencilRef,a.stencilFuncMask=this.stencilFuncMask,a.stencilFail=this.stencilFail,a.stencilZFail=this.stencilZFail,a.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(a.rotation=this.rotation),!0===this.polygonOffset&&(a.polygonOffset=!0),0!==this.polygonOffsetFactor&&(a.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(a.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(a.linewidth=this.linewidth),void 0!==this.dashSize&&(a.dashSize=this.dashSize),void 0!==this.gapSize&&(a.gapSize=this.gapSize),void 0!==this.scale&&(a.scale=this.scale),!0===this.dithering&&(a.dithering=!0),this.alphaTest>0&&(a.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(a.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(a.wireframe=this.wireframe),this.wireframeLinewidth>1&&(a.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(a.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(a.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(a.morphTargets=!0),!0===this.morphNormals&&(a.morphNormals=!0),!0===this.skinning&&(a.skinning=!0),!1===this.visible&&(a.visible=!1),!1===this.toneMapped&&(a.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),t){const h=l(i.textures),f=l(i.images);h.length>0&&(a.textures=h),f.length>0&&(a.images=f)}return a},clone:function(){return(new this.constructor).copy(this)},copy:function(i){this.name=i.name,this.fog=i.fog,this.blending=i.blending,this.side=i.side,this.flatShading=i.flatShading,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const t=i.clippingPlanes;let a=null;if(null!==t){const l=t.length;a=new Array(l);for(let h=0;h!==l;++h)a[h]=t[h].clone()}return this.clippingPlanes=a,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData=JSON.parse(JSON.stringify(i.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(dn.prototype,"needsUpdate",{set:function(i){!0===i&&this.version++}}),(Fr.prototype=Object.create(dn.prototype)).constructor=Fr,Fr.prototype.isMeshBasicMaterial=!0,Fr.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this};const Yn=new Ge,Cc=new Ct;function wn(i,t,a){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=i,this.itemSize=t,this.count=void 0!==i?i.length/t:0,this.normalized=!0===a,this.usage=hl,this.updateRange={offset:0,count:-1},this.version=0}function td(i,t,a){wn.call(this,new Int8Array(i),t,a)}function gl(i,t,a){wn.call(this,new Uint8Array(i),t,a)}function id(i,t,a){wn.call(this,new Uint8ClampedArray(i),t,a)}function la(i,t,a){wn.call(this,new Int16Array(i),t,a)}function yl(i,t,a){wn.call(this,new Uint16Array(i),t,a)}function nd(i,t,a){wn.call(this,new Int32Array(i),t,a)}function Lo(i,t,a){wn.call(this,new Uint32Array(i),t,a)}function _l(i,t,a){wn.call(this,new Uint16Array(i),t,a)}function jn(i,t,a){wn.call(this,new Float32Array(i),t,a)}function rd(i,t,a){wn.call(this,new Float64Array(i),t,a)}function Ra(i){if(0===i.length)return-1/0;let t=i[0];for(let a=1,l=i.length;a<l;++a)i[a]>t&&(t=i[a]);return t}Object.defineProperty(wn.prototype,"needsUpdate",{set:function(i){!0===i&&this.version++}}),Object.assign(wn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this},copyAt:function(i,t,a){i*=this.itemSize,a*=t.itemSize;for(let l=0,h=this.itemSize;l<h;l++)this.array[i+l]=t.array[a+l];return this},copyArray:function(i){return this.array.set(i),this},copyColorsArray:function(i){const t=this.array;let a=0;for(let l=0,h=i.length;l<h;l++){let f=i[l];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",l),f=new $i),t[a++]=f.r,t[a++]=f.g,t[a++]=f.b}return this},copyVector2sArray:function(i){const t=this.array;let a=0;for(let l=0,h=i.length;l<h;l++){let f=i[l];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",l),f=new Ct),t[a++]=f.x,t[a++]=f.y}return this},copyVector3sArray:function(i){const t=this.array;let a=0;for(let l=0,h=i.length;l<h;l++){let f=i[l];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",l),f=new Ge),t[a++]=f.x,t[a++]=f.y,t[a++]=f.z}return this},copyVector4sArray:function(i){const t=this.array;let a=0;for(let l=0,h=i.length;l<h;l++){let f=i[l];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",l),f=new Wn),t[a++]=f.x,t[a++]=f.y,t[a++]=f.z,t[a++]=f.w}return this},applyMatrix3:function(i){if(2===this.itemSize)for(let t=0,a=this.count;t<a;t++)Cc.fromBufferAttribute(this,t),Cc.applyMatrix3(i),this.setXY(t,Cc.x,Cc.y);else if(3===this.itemSize)for(let t=0,a=this.count;t<a;t++)Yn.fromBufferAttribute(this,t),Yn.applyMatrix3(i),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this},applyMatrix4:function(i){for(let t=0,a=this.count;t<a;t++)Yn.x=this.getX(t),Yn.y=this.getY(t),Yn.z=this.getZ(t),Yn.applyMatrix4(i),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this},applyNormalMatrix:function(i){for(let t=0,a=this.count;t<a;t++)Yn.x=this.getX(t),Yn.y=this.getY(t),Yn.z=this.getZ(t),Yn.applyNormalMatrix(i),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this},transformDirection:function(i){for(let t=0,a=this.count;t<a;t++)Yn.x=this.getX(t),Yn.y=this.getY(t),Yn.z=this.getZ(t),Yn.transformDirection(i),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this},set:function(i,t=0){return this.array.set(i,t),this},getX:function(i){return this.array[i*this.itemSize]},setX:function(i,t){return this.array[i*this.itemSize]=t,this},getY:function(i){return this.array[i*this.itemSize+1]},setY:function(i,t){return this.array[i*this.itemSize+1]=t,this},getZ:function(i){return this.array[i*this.itemSize+2]},setZ:function(i,t){return this.array[i*this.itemSize+2]=t,this},getW:function(i){return this.array[i*this.itemSize+3]},setW:function(i,t){return this.array[i*this.itemSize+3]=t,this},setXY:function(i,t,a){return this.array[0+(i*=this.itemSize)]=t,this.array[i+1]=a,this},setXYZ:function(i,t,a,l){return this.array[0+(i*=this.itemSize)]=t,this.array[i+1]=a,this.array[i+2]=l,this},setXYZW:function(i,t,a,l,h){return this.array[0+(i*=this.itemSize)]=t,this.array[i+1]=a,this.array[i+2]=l,this.array[i+3]=h,this},onUpload:function(i){return this.onUploadCallback=i,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(td.prototype=Object.create(wn.prototype)).constructor=td,(gl.prototype=Object.create(wn.prototype)).constructor=gl,(id.prototype=Object.create(wn.prototype)).constructor=id,(la.prototype=Object.create(wn.prototype)).constructor=la,(yl.prototype=Object.create(wn.prototype)).constructor=yl,(nd.prototype=Object.create(wn.prototype)).constructor=nd,(Lo.prototype=Object.create(wn.prototype)).constructor=Lo,(_l.prototype=Object.create(wn.prototype)).constructor=_l,_l.prototype.isFloat16BufferAttribute=!0,(jn.prototype=Object.create(wn.prototype)).constructor=jn,(rd.prototype=Object.create(wn.prototype)).constructor=rd;const Wf={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Pc(i,t){return new Wf[i](t)}let jf=0;const Wa=new xn,vu=new on,xl=new Ge,xa=new bo,ls=new bo,ar=new Ge;function Ln(){Object.defineProperty(this,"id",{value:jf++}),this.uuid=hn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ln.prototype=Object.assign(Object.create(ya.prototype),{constructor:Ln,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(i){return this.index=Array.isArray(i)?new(Ra(i)>65535?Lo:yl)(i,1):i,this},getAttribute:function(i){return this.attributes[i]},setAttribute:function(i,t){return this.attributes[i]=t,this},deleteAttribute:function(i){return delete this.attributes[i],this},hasAttribute:function(i){return void 0!==this.attributes[i]},addGroup:function(i,t,a=0){this.groups.push({start:i,count:t,materialIndex:a})},clearGroups:function(){this.groups=[]},setDrawRange:function(i,t){this.drawRange.start=i,this.drawRange.count=t},applyMatrix4:function(i){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(i),t.needsUpdate=!0);const a=this.attributes.normal;if(void 0!==a){const h=(new Or).getNormalMatrix(i);a.applyNormalMatrix(h),a.needsUpdate=!0}const l=this.attributes.tangent;return void 0!==l&&(l.transformDirection(i),l.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(i){return Wa.makeRotationX(i),this.applyMatrix4(Wa),this},rotateY:function(i){return Wa.makeRotationY(i),this.applyMatrix4(Wa),this},rotateZ:function(i){return Wa.makeRotationZ(i),this.applyMatrix4(Wa),this},translate:function(i,t,a){return Wa.makeTranslation(i,t,a),this.applyMatrix4(Wa),this},scale:function(i,t,a){return Wa.makeScale(i,t,a),this.applyMatrix4(Wa),this},lookAt:function(i){return vu.lookAt(i),vu.updateMatrix(),this.applyMatrix4(vu.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(xl).negate(),this.translate(xl.x,xl.y,xl.z),this},setFromPoints:function(i){const t=[];for(let a=0,l=i.length;a<l;a++){const h=i[a];t.push(h.x,h.y,h.z||0)}return this.setAttribute("position",new jn(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new bo);const i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ge(-1/0,-1/0,-1/0),new Ge(1/0,1/0,1/0));if(void 0!==i){if(this.boundingBox.setFromBufferAttribute(i),t)for(let a=0,l=t.length;a<l;a++)xa.setFromBufferAttribute(t[a]),this.morphTargetsRelative?(ar.addVectors(this.boundingBox.min,xa.min),this.boundingBox.expandByPoint(ar),ar.addVectors(this.boundingBox.max,xa.max),this.boundingBox.expandByPoint(ar)):(this.boundingBox.expandByPoint(xa.min),this.boundingBox.expandByPoint(xa.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new za);const i=this.attributes.position,t=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ge,1/0);if(i){const a=this.boundingSphere.center;if(xa.setFromBufferAttribute(i),t)for(let h=0,f=t.length;h<f;h++)ls.setFromBufferAttribute(t[h]),this.morphTargetsRelative?(ar.addVectors(xa.min,ls.min),xa.expandByPoint(ar),ar.addVectors(xa.max,ls.max),xa.expandByPoint(ar)):(xa.expandByPoint(ls.min),xa.expandByPoint(ls.max));xa.getCenter(a);let l=0;for(let h=0,f=i.count;h<f;h++)ar.fromBufferAttribute(i,h),l=Math.max(l,a.distanceToSquared(ar));if(t)for(let h=0,f=t.length;h<f;h++){const p=t[h],y=this.morphTargetsRelative;for(let b=0,A=p.count;b<A;b++)ar.fromBufferAttribute(p,b),y&&(xl.fromBufferAttribute(i,b),ar.add(xl)),l=Math.max(l,a.distanceToSquared(ar))}this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const i=this.index,t=this.attributes;if(null===i||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const a=i.array,l=t.position.array,h=t.normal.array,f=t.uv.array,p=l.length/3;void 0===t.tangent&&this.setAttribute("tangent",new wn(new Float32Array(4*p),4));const y=t.tangent.array,b=[],A=[];for(let ht=0;ht<p;ht++)b[ht]=new Ge,A[ht]=new Ge;const C=new Ge,M=new Ge,R=new Ge,k=new Ct,z=new Ct,pe=new Ct,ce=new Ge,V=new Ge;function U(ht,At,Lt){C.fromArray(l,3*ht),M.fromArray(l,3*At),R.fromArray(l,3*Lt),k.fromArray(f,2*ht),z.fromArray(f,2*At),pe.fromArray(f,2*Lt),M.sub(C),R.sub(C),z.sub(k),pe.sub(k);const Yt=1/(z.x*pe.y-pe.x*z.y);!isFinite(Yt)||(ce.copy(M).multiplyScalar(pe.y).addScaledVector(R,-z.y).multiplyScalar(Yt),V.copy(R).multiplyScalar(z.x).addScaledVector(M,-pe.x).multiplyScalar(Yt),b[ht].add(ce),b[At].add(ce),b[Lt].add(ce),A[ht].add(V),A[At].add(V),A[Lt].add(V))}let je=this.groups;0===je.length&&(je=[{start:0,count:a.length}]);for(let ht=0,At=je.length;ht<At;++ht){const Lt=je[ht],Yt=Lt.start;for(let qe=Yt,ut=Yt+Lt.count;qe<ut;qe+=3)U(a[qe+0],a[qe+1],a[qe+2])}const Ze=new Ge,Je=new Ge,Ie=new Ge,it=new Ge;function Gt(ht){Ie.fromArray(h,3*ht),it.copy(Ie);const At=b[ht];Ze.copy(At),Ze.sub(Ie.multiplyScalar(Ie.dot(At))).normalize(),Je.crossVectors(it,At);const Yt=Je.dot(A[ht])<0?-1:1;y[4*ht]=Ze.x,y[4*ht+1]=Ze.y,y[4*ht+2]=Ze.z,y[4*ht+3]=Yt}for(let ht=0,At=je.length;ht<At;++ht){const Lt=je[ht],Yt=Lt.start;for(let qe=Yt,ut=Yt+Lt.count;qe<ut;qe+=3)Gt(a[qe+0]),Gt(a[qe+1]),Gt(a[qe+2])}},computeVertexNormals:function(){const i=this.index,t=this.getAttribute("position");if(void 0!==t){let a=this.getAttribute("normal");if(void 0===a)a=new wn(new Float32Array(3*t.count),3),this.setAttribute("normal",a);else for(let M=0,R=a.count;M<R;M++)a.setXYZ(M,0,0,0);const l=new Ge,h=new Ge,f=new Ge,p=new Ge,y=new Ge,b=new Ge,A=new Ge,C=new Ge;if(i)for(let M=0,R=i.count;M<R;M+=3){const k=i.getX(M+0),z=i.getX(M+1),pe=i.getX(M+2);l.fromBufferAttribute(t,k),h.fromBufferAttribute(t,z),f.fromBufferAttribute(t,pe),A.subVectors(f,h),C.subVectors(l,h),A.cross(C),p.fromBufferAttribute(a,k),y.fromBufferAttribute(a,z),b.fromBufferAttribute(a,pe),p.add(A),y.add(A),b.add(A),a.setXYZ(k,p.x,p.y,p.z),a.setXYZ(z,y.x,y.y,y.z),a.setXYZ(pe,b.x,b.y,b.z)}else for(let M=0,R=t.count;M<R;M+=3)l.fromBufferAttribute(t,M+0),h.fromBufferAttribute(t,M+1),f.fromBufferAttribute(t,M+2),A.subVectors(f,h),C.subVectors(l,h),A.cross(C),a.setXYZ(M+0,A.x,A.y,A.z),a.setXYZ(M+1,A.x,A.y,A.z),a.setXYZ(M+2,A.x,A.y,A.z);this.normalizeNormals(),a.needsUpdate=!0}},merge:function(i,t){if(!i||!i.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",i);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const a=this.attributes;for(const l in a){if(void 0===i.attributes[l])continue;const f=a[l].array,p=i.attributes[l],y=p.array,b=p.itemSize*t,A=Math.min(y.length,f.length-b);for(let C=0,M=b;C<A;C++,M++)f[M]=y[C]}return this},normalizeNormals:function(){const i=this.attributes.normal;for(let t=0,a=i.count;t<a;t++)ar.fromBufferAttribute(i,t),ar.normalize(),i.setXYZ(t,ar.x,ar.y,ar.z)},toNonIndexed:function(){function i(p,y){const b=p.array,A=p.itemSize,C=p.normalized,M=new b.constructor(y.length*A);let R=0,k=0;for(let z=0,pe=y.length;z<pe;z++){R=y[z]*A;for(let ce=0;ce<A;ce++)M[k++]=b[R++]}return new wn(M,A,C)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ln,a=this.index.array,l=this.attributes;for(const p in l){const b=i(l[p],a);t.setAttribute(p,b)}const h=this.morphAttributes;for(const p in h){const y=[],b=h[p];for(let A=0,C=b.length;A<C;A++){const R=i(b[A],a);y.push(R)}t.morphAttributes[p]=y}t.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let p=0,y=f.length;p<y;p++){const b=f[p];t.addGroup(b.start,b.count,b.materialIndex)}return t},toJSON:function(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),void 0!==this.parameters){const y=this.parameters;for(const b in y)void 0!==y[b]&&(i[b]=y[b]);return i}i.data={attributes:{}};const t=this.index;null!==t&&(i.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const a=this.attributes;for(const y in a){const b=a[y],A=b.toJSON(i.data);""!==b.name&&(A.name=b.name),i.data.attributes[y]=A}const l={};let h=!1;for(const y in this.morphAttributes){const b=this.morphAttributes[y],A=[];for(let C=0,M=b.length;C<M;C++){const R=b[C],k=R.toJSON(i.data);""!==R.name&&(k.name=R.name),A.push(k)}A.length>0&&(l[y]=A,h=!0)}h&&(i.data.morphAttributes=l,i.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(i.data.groups=JSON.parse(JSON.stringify(f)));const p=this.boundingSphere;return null!==p&&(i.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),i},clone:function(){return(new Ln).copy(this)},copy:function(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=i.name;const a=i.index;null!==a&&this.setIndex(a.clone(t));const l=i.attributes;for(const b in l)this.setAttribute(b,l[b].clone(t));const h=i.morphAttributes;for(const b in h){const A=[],C=h[b];for(let M=0,R=C.length;M<R;M++)A.push(C[M].clone(t));this.morphAttributes[b]=A}this.morphTargetsRelative=i.morphTargetsRelative;const f=i.groups;for(let b=0,A=f.length;b<A;b++){const C=f[b];this.addGroup(C.start,C.count,C.materialIndex)}const p=i.boundingBox;null!==p&&(this.boundingBox=p.clone());const y=i.boundingSphere;return null!==y&&(this.boundingSphere=y.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Lc=new xn,bl=new Eo,gu=new za,no=new Ge,Os=new Ge,ja=new Ge,yu=new Ge,_u=new Ge,ad=new Ge,Ic=new Ge,Tl=new Ge,xu=new Ge,Io=new Ct,bu=new Ct,Al=new Ct,Rc=new Ge,Tu=new Ge;function $n(i=new Ln,t=new Fr){on.call(this),this.type="Mesh",this.geometry=i,this.material=t,this.updateMorphTargets()}function Dc(i,t,a,l,h,f,p,y,b,A,C,M){no.fromBufferAttribute(h,A),Os.fromBufferAttribute(h,C),ja.fromBufferAttribute(h,M);const R=i.morphTargetInfluences;if(t.morphTargets&&f&&R){Ic.set(0,0,0),Tl.set(0,0,0),xu.set(0,0,0);for(let z=0,pe=f.length;z<pe;z++){const ce=R[z],V=f[z];0!==ce&&(yu.fromBufferAttribute(V,A),_u.fromBufferAttribute(V,C),ad.fromBufferAttribute(V,M),p?(Ic.addScaledVector(yu,ce),Tl.addScaledVector(_u,ce),xu.addScaledVector(ad,ce)):(Ic.addScaledVector(yu.sub(no),ce),Tl.addScaledVector(_u.sub(Os),ce),xu.addScaledVector(ad.sub(ja),ce)))}no.add(Ic),Os.add(Tl),ja.add(xu)}i.isSkinnedMesh&&(i.boneTransform(A,no),i.boneTransform(C,Os),i.boneTransform(M,ja));const k=function eg(i,t,a,l,h,f,p,y){let b;if(b=1===t.side?l.intersectTriangle(p,f,h,!0,y):l.intersectTriangle(h,f,p,2!==t.side,y),null===b)return null;Tu.copy(y),Tu.applyMatrix4(i.matrixWorld);const A=a.ray.origin.distanceTo(Tu);return A<a.near||A>a.far?null:{distance:A,point:Tu.clone(),object:i}}(i,t,a,l,no,Os,ja,Rc);if(k){y&&(Io.fromBufferAttribute(y,A),bu.fromBufferAttribute(y,C),Al.fromBufferAttribute(y,M),k.uv=ea.getUV(Rc,no,Os,ja,Io,bu,Al,new Ct)),b&&(Io.fromBufferAttribute(b,A),bu.fromBufferAttribute(b,C),Al.fromBufferAttribute(b,M),k.uv2=ea.getUV(Rc,no,Os,ja,Io,bu,Al,new Ct));const z=new Jv(A,C,M);ea.getNormal(no,Os,ja,z.normal),k.face=z}return k}$n.prototype=Object.assign(Object.create(on.prototype),{constructor:$n,isMesh:!0,copy:function(i){return on.prototype.copy.call(this,i),void 0!==i.morphTargetInfluences&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),void 0!==i.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,a=Object.keys(t);if(a.length>0){const l=t[a[0]];if(void 0!==l){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,f=l.length;h<f;h++){const p=l[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=h}}}}else{const t=i.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(i,t){const a=this.geometry,l=this.material,h=this.matrixWorld;if(void 0===l||(null===a.boundingSphere&&a.computeBoundingSphere(),gu.copy(a.boundingSphere),gu.applyMatrix4(h),!1===i.ray.intersectsSphere(gu))||(Lc.copy(h).invert(),bl.copy(i.ray).applyMatrix4(Lc),null!==a.boundingBox&&!1===bl.intersectsBox(a.boundingBox)))return;let f;if(a.isBufferGeometry){const p=a.index,y=a.attributes.position,b=a.morphAttributes.position,A=a.morphTargetsRelative,C=a.attributes.uv,M=a.attributes.uv2,R=a.groups,k=a.drawRange;if(null!==p)if(Array.isArray(l))for(let z=0,pe=R.length;z<pe;z++){const ce=R[z],V=l[ce.materialIndex];for(let Ze=Math.max(ce.start,k.start),Je=Math.min(ce.start+ce.count,k.start+k.count);Ze<Je;Ze+=3){const Ie=p.getX(Ze),it=p.getX(Ze+1),Gt=p.getX(Ze+2);f=Dc(this,V,i,bl,y,b,A,C,M,Ie,it,Gt),f&&(f.faceIndex=Math.floor(Ze/3),f.face.materialIndex=ce.materialIndex,t.push(f))}}else for(let ce=Math.max(0,k.start),V=Math.min(p.count,k.start+k.count);ce<V;ce+=3){const U=p.getX(ce),je=p.getX(ce+1),Ze=p.getX(ce+2);f=Dc(this,l,i,bl,y,b,A,C,M,U,je,Ze),f&&(f.faceIndex=Math.floor(ce/3),t.push(f))}else if(void 0!==y)if(Array.isArray(l))for(let z=0,pe=R.length;z<pe;z++){const ce=R[z],V=l[ce.materialIndex];for(let Ze=Math.max(ce.start,k.start),Je=Math.min(ce.start+ce.count,k.start+k.count);Ze<Je;Ze+=3)f=Dc(this,V,i,bl,y,b,A,C,M,Ze,Ze+1,Ze+2),f&&(f.faceIndex=Math.floor(Ze/3),f.face.materialIndex=ce.materialIndex,t.push(f))}else for(let ce=Math.max(0,k.start),V=Math.min(y.count,k.start+k.count);ce<V;ce+=3)f=Dc(this,l,i,bl,y,b,A,C,M,ce,ce+1,ce+2),f&&(f.faceIndex=Math.floor(ce/3),t.push(f))}else a.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class Au extends Ln{constructor(t=1,a=1,l=1,h=1,f=1,p=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:a,depth:l,widthSegments:h,heightSegments:f,depthSegments:p};const y=this;h=Math.floor(h),f=Math.floor(f),p=Math.floor(p);const b=[],A=[],C=[],M=[];let R=0,k=0;function z(pe,ce,V,U,je,Ze,Je,Ie,it,Gt,ht){const At=Ze/it,Lt=Je/Gt,Yt=Ze/2,Rt=Je/2,qe=Ie/2,ut=it+1,xt=Gt+1;let zt=0,li=0;const ri=new Ge;for(let di=0;di<xt;di++){const _i=di*Lt-Rt;for(let Yi=0;Yi<ut;Yi++)ri[pe]=(Yi*At-Yt)*U,ri[ce]=_i*je,ri[V]=qe,A.push(ri.x,ri.y,ri.z),ri[pe]=0,ri[ce]=0,ri[V]=Ie>0?1:-1,C.push(ri.x,ri.y,ri.z),M.push(Yi/it),M.push(1-di/Gt),zt+=1}for(let di=0;di<Gt;di++)for(let _i=0;_i<it;_i++){const Ji=R+_i+ut*(di+1),Mn=R+(_i+1)+ut*(di+1),Kt=R+(_i+1)+ut*di;b.push(R+_i+ut*di,Ji,Kt),b.push(Ji,Mn,Kt),li+=6}y.addGroup(k,li,ht),k+=li,R+=zt}z("z","y","x",-1,-1,l,a,t,p,f,0),z("z","y","x",1,-1,l,a,-t,p,f,1),z("x","z","y",1,1,t,l,a,h,p,2),z("x","z","y",1,-1,t,l,-a,h,p,3),z("x","y","z",1,-1,t,a,l,h,f,4),z("x","y","z",-1,-1,t,a,-l,h,f,5),this.setIndex(b),this.setAttribute("position",new jn(A,3)),this.setAttribute("normal",new jn(C,3)),this.setAttribute("uv",new jn(M,2))}}function Ro(i){const t={};for(const a in i){t[a]={};for(const l in i[a]){const h=i[a][l];t[a][l]=h&&(h.isColor||h.isMatrix3||h.isMatrix4||h.isVector2||h.isVector3||h.isVector4||h.isTexture)?h.clone():Array.isArray(h)?h.slice():h}}return t}function Tr(i){const t={};for(let a=0;a<i.length;a++){const l=Ro(i[a]);for(const h in l)t[h]=l[h]}return t}const Xf={clone:Ro,merge:Tr};function jr(i){dn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==i&&(void 0!==i.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(i))}function Fs(){on.call(this),this.type="Camera",this.matrixWorldInverse=new xn,this.projectionMatrix=new xn,this.projectionMatrixInverse=new xn}function ur(i=50,t=1,a=.1,l=2e3){Fs.call(this),this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=a,this.far=l,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function us(i,t,a){if(on.call(this),this.type="CubeCamera",!0!==a.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=a;const l=new ur(90,1,i,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Ge(1,0,0)),this.add(l);const h=new ur(90,1,i,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new Ge(-1,0,0)),this.add(h);const f=new ur(90,1,i,t);f.layers=this.layers,f.up.set(0,0,1),f.lookAt(new Ge(0,1,0)),this.add(f);const p=new ur(90,1,i,t);p.layers=this.layers,p.up.set(0,0,-1),p.lookAt(new Ge(0,-1,0)),this.add(p);const y=new ur(90,1,i,t);y.layers=this.layers,y.up.set(0,-1,0),y.lookAt(new Ge(0,0,1)),this.add(y);const b=new ur(90,1,i,t);b.layers=this.layers,b.up.set(0,-1,0),b.lookAt(new Ge(0,0,-1)),this.add(b),this.update=function(A,C){null===this.parent&&this.updateMatrixWorld();const M=A.xr.enabled,R=A.getRenderTarget();A.xr.enabled=!1;const k=a.texture.generateMipmaps;a.texture.generateMipmaps=!1,A.setRenderTarget(a,0),A.render(C,l),A.setRenderTarget(a,1),A.render(C,h),A.setRenderTarget(a,2),A.render(C,f),A.setRenderTarget(a,3),A.render(C,p),A.setRenderTarget(a,4),A.render(C,y),a.texture.generateMipmaps=k,A.setRenderTarget(a,5),A.render(C,b),A.setRenderTarget(R),A.xr.enabled=M}}function Da(i,t,a,l,h,f,p,y,b,A){zn.call(this,i=void 0!==i?i:[],t=void 0!==t?t:301,a,l,h,f,p=void 0!==p?p:Ca,y,b,A),this.flipY=!1,this._needsFlipEnvMap=!0}(jr.prototype=Object.create(dn.prototype)).constructor=jr,jr.prototype.isShaderMaterial=!0,jr.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=Ro(i.uniforms),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.lights=i.lights,this.clipping=i.clipping,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this},jr.prototype.toJSON=function(i){const t=dn.prototype.toJSON.call(this,i);t.glslVersion=this.glslVersion,t.uniforms={};for(const l in this.uniforms){const f=this.uniforms[l].value;t.uniforms[l]=f&&f.isTexture?{type:"t",value:f.toJSON(i).uuid}:f&&f.isColor?{type:"c",value:f.getHex()}:f&&f.isVector2?{type:"v2",value:f.toArray()}:f&&f.isVector3?{type:"v3",value:f.toArray()}:f&&f.isVector4?{type:"v4",value:f.toArray()}:f&&f.isMatrix3?{type:"m3",value:f.toArray()}:f&&f.isMatrix4?{type:"m4",value:f.toArray()}:{value:f}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const a={};for(const l in this.extensions)!0===this.extensions[l]&&(a[l]=!0);return Object.keys(a).length>0&&(t.extensions=a),t},Fs.prototype=Object.assign(Object.create(on.prototype),{constructor:Fs,isCamera:!0,copy:function(i,t){return on.prototype.copy.call(this,i,t),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this},getWorldDirection:function(i){void 0===i&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),i=new Ge),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return i.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(i){on.prototype.updateMatrixWorld.call(this,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(i,t){on.prototype.updateWorldMatrix.call(this,i,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),ur.prototype=Object.assign(Object.create(Fs.prototype),{constructor:ur,isPerspectiveCamera:!0,copy:function(i,t){return Fs.prototype.copy.call(this,i,t),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=null===i.view?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this},setFocalLength:function(i){const t=.5*this.getFilmHeight()/i;this.fov=2*hn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const i=Math.tan(.5*hn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/i},getEffectiveFOV:function(){return 2*hn.RAD2DEG*Math.atan(Math.tan(.5*hn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(i,t,a,l,h,f){this.aspect=i/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=a,this.view.offsetY=l,this.view.width=h,this.view.height=f,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=this.near;let t=i*Math.tan(.5*hn.DEG2RAD*this.fov)/this.zoom,a=2*t,l=this.aspect*a,h=-.5*l;const f=this.view;if(null!==this.view&&this.view.enabled){const y=f.fullWidth,b=f.fullHeight;h+=f.offsetX*l/y,t-=f.offsetY*a/b,l*=f.width/y,a*=f.height/b}const p=this.filmOffset;0!==p&&(h+=i*p/this.getFilmWidth()),this.projectionMatrix.makePerspective(h,h+l,t,t-a,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const t=on.prototype.toJSON.call(this,i);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),(us.prototype=Object.create(on.prototype)).constructor=us,(Da.prototype=Object.create(zn.prototype)).constructor=Da,Da.prototype.isCubeTexture=!0,Object.defineProperty(Da.prototype,"images",{get:function(){return this.image},set:function(i){this.image=i}});class Yf extends uu{constructor(t,a,l){Number.isInteger(a)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),a=l),super(t,t,a),Object.defineProperty(this,"isWebGLCubeRenderTarget",{value:!0}),this.texture=new Da(void 0,(a=a||{}).mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,a){this.texture.type=a.type,this.texture.format=Hr,this.texture.encoding=a.encoding,this.texture.generateMipmaps=a.generateMipmaps,this.texture.minFilter=a.minFilter,this.texture.magFilter=a.magFilter;const l_uniforms={tEquirect:{value:null}},l_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",l_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",h=new Au(5,5,5),f=new jr({name:"CubemapFromEquirect",uniforms:Ro(l_uniforms),vertexShader:l_vertexShader,fragmentShader:l_fragmentShader,side:1,blending:0});f.uniforms.tEquirect.value=a;const p=new $n(h,f),y=a.minFilter;return 1008===a.minFilter&&(a.minFilter=Fi),new us(1,10,this).update(t,p),a.minFilter=y,p.geometry.dispose(),p.material.dispose(),this}clear(t,a,l,h){const f=t.getRenderTarget();for(let p=0;p<6;p++)t.setRenderTarget(this,p),t.clear(a,l,h);t.setRenderTarget(f)}}function Xa(i,t,a,l,h,f,p,y,b,A,C,M){zn.call(this,null,f,p,y,b,A,l,h,C,M),this.image={data:i||null,width:t||1,height:a||1},this.magFilter=void 0!==b?b:rn,this.minFilter=void 0!==A?A:rn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}(Xa.prototype=Object.create(zn.prototype)).constructor=Xa,Xa.prototype.isDataTexture=!0;const Do=new za,Sl=new Ge;class El{constructor(t,a,l,h,f,p){this.planes=[void 0!==t?t:new Is,void 0!==a?a:new Is,void 0!==l?l:new Is,void 0!==h?h:new Is,void 0!==f?f:new Is,void 0!==p?p:new Is]}set(t,a,l,h,f,p){const y=this.planes;return y[0].copy(t),y[1].copy(a),y[2].copy(l),y[3].copy(h),y[4].copy(f),y[5].copy(p),this}clone(){return(new this.constructor).copy(this)}copy(t){const a=this.planes;for(let l=0;l<6;l++)a[l].copy(t.planes[l]);return this}setFromProjectionMatrix(t){const a=this.planes,l=t.elements,h=l[0],f=l[1],p=l[2],y=l[3],b=l[4],A=l[5],C=l[6],M=l[7],R=l[8],k=l[9],z=l[10],pe=l[11],ce=l[12],V=l[13],U=l[14],je=l[15];return a[0].setComponents(y-h,M-b,pe-R,je-ce).normalize(),a[1].setComponents(y+h,M+b,pe+R,je+ce).normalize(),a[2].setComponents(y+f,M+A,pe+k,je+V).normalize(),a[3].setComponents(y-f,M-A,pe-k,je-V).normalize(),a[4].setComponents(y-p,M-C,pe-z,je-U).normalize(),a[5].setComponents(y+p,M+C,pe+z,je+U).normalize(),this}intersectsObject(t){const a=t.geometry;return null===a.boundingSphere&&a.computeBoundingSphere(),Do.copy(a.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Do)}intersectsSprite(t){return Do.center.set(0,0,0),Do.radius=.7071067811865476,Do.applyMatrix4(t.matrixWorld),this.intersectsSphere(Do)}intersectsSphere(t){const a=this.planes,l=t.center,h=-t.radius;for(let f=0;f<6;f++)if(a[f].distanceToPoint(l)<h)return!1;return!0}intersectsBox(t){const a=this.planes;for(let l=0;l<6;l++){const h=a[l];if(Sl.x=h.normal.x>0?t.max.x:t.min.x,Sl.y=h.normal.y>0?t.max.y:t.min.y,Sl.z=h.normal.z>0?t.max.z:t.min.z,h.distanceToPoint(Sl)<0)return!1}return!0}containsPoint(t){const a=this.planes;for(let l=0;l<6;l++)if(a[l].distanceToPoint(t)<0)return!1;return!0}}function Oc(){let i=null,t=!1,a=null,l=null;function h(f,p){a(f,p),l=i.requestAnimationFrame(h)}return{start:function(){!0!==t&&null!==a&&(l=i.requestAnimationFrame(h),t=!0)},stop:function(){i.cancelAnimationFrame(l),t=!1},setAnimationLoop:function(f){a=f},setContext:function(f){i=f}}}function sd(i,t){const a=t.isWebGL2,l=new WeakMap;return{get:function p(A){return A.isInterleavedBufferAttribute&&(A=A.data),l.get(A)},remove:function y(A){A.isInterleavedBufferAttribute&&(A=A.data);const C=l.get(A);C&&(i.deleteBuffer(C.buffer),l.delete(A))},update:function b(A,C){if(A.isGLBufferAttribute){const R=l.get(A);return void((!R||R.version<A.version)&&l.set(A,{buffer:A.buffer,type:A.type,bytesPerElement:A.elementSize,version:A.version}))}A.isInterleavedBufferAttribute&&(A=A.data);const M=l.get(A);void 0===M?l.set(A,function h(A,C){const M=A.array,R=A.usage,k=i.createBuffer();i.bindBuffer(C,k),i.bufferData(C,M,R),A.onUploadCallback();let z=5126;return M instanceof Float32Array?z=5126:M instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):M instanceof Uint16Array?A.isFloat16BufferAttribute?a?z=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):z=5123:M instanceof Int16Array?z=5122:M instanceof Uint32Array?z=5125:M instanceof Int32Array?z=5124:M instanceof Int8Array?z=5120:M instanceof Uint8Array&&(z=5121),{buffer:k,type:z,bytesPerElement:M.BYTES_PER_ELEMENT,version:A.version}}(A,C)):M.version<A.version&&(function f(A,C,M){const R=C.array,k=C.updateRange;i.bindBuffer(M,A),-1===k.count?i.bufferSubData(M,0,R):(a?i.bufferSubData(M,k.offset*R.BYTES_PER_ELEMENT,R,k.offset,k.count):i.bufferSubData(M,k.offset*R.BYTES_PER_ELEMENT,R.subarray(k.offset,k.offset+k.count)),k.count=-1)}(M.buffer,A,C),M.version=A.version)}}}class od extends Ln{constructor(t=1,a=1,l=1,h=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:a,widthSegments:l,heightSegments:h};const f=t/2,p=a/2,y=Math.floor(l),b=Math.floor(h),A=y+1,C=b+1,M=t/y,R=a/b,k=[],z=[],pe=[],ce=[];for(let V=0;V<C;V++){const U=V*R-p;for(let je=0;je<A;je++)z.push(je*M-f,-U,0),pe.push(0,0,1),ce.push(je/y),ce.push(1-V/b)}for(let V=0;V<b;V++)for(let U=0;U<y;U++){const Ze=U+A*(V+1),Je=U+1+A*(V+1),Ie=U+1+A*V;k.push(U+A*V,Ze,Ie),k.push(Ze,Je,Ie)}this.setIndex(k),this.setAttribute("position",new jn(z,3)),this.setAttribute("normal",new jn(pe,3)),this.setAttribute("uv",new jn(ce,2))}}const En={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Ii={common:{diffuse:{value:new $i(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Or},uv2Transform:{value:new Or},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $i(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $i(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Or}},sprite:{diffuse:{value:new $i(15658734)},opacity:{value:1},center:{value:new Ct(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Or}}},ua={basic:{uniforms:Tr([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.fog]),vertexShader:En.meshbasic_vert,fragmentShader:En.meshbasic_frag},lambert:{uniforms:Tr([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.fog,Ii.lights,{emissive:{value:new $i(0)}}]),vertexShader:En.meshlambert_vert,fragmentShader:En.meshlambert_frag},phong:{uniforms:Tr([Ii.common,Ii.specularmap,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.fog,Ii.lights,{emissive:{value:new $i(0)},specular:{value:new $i(1118481)},shininess:{value:30}}]),vertexShader:En.meshphong_vert,fragmentShader:En.meshphong_frag},standard:{uniforms:Tr([Ii.common,Ii.envmap,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.roughnessmap,Ii.metalnessmap,Ii.fog,Ii.lights,{emissive:{value:new $i(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag},toon:{uniforms:Tr([Ii.common,Ii.aomap,Ii.lightmap,Ii.emissivemap,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.gradientmap,Ii.fog,Ii.lights,{emissive:{value:new $i(0)}}]),vertexShader:En.meshtoon_vert,fragmentShader:En.meshtoon_frag},matcap:{uniforms:Tr([Ii.common,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,Ii.fog,{matcap:{value:null}}]),vertexShader:En.meshmatcap_vert,fragmentShader:En.meshmatcap_frag},points:{uniforms:Tr([Ii.points,Ii.fog]),vertexShader:En.points_vert,fragmentShader:En.points_frag},dashed:{uniforms:Tr([Ii.common,Ii.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:En.linedashed_vert,fragmentShader:En.linedashed_frag},depth:{uniforms:Tr([Ii.common,Ii.displacementmap]),vertexShader:En.depth_vert,fragmentShader:En.depth_frag},normal:{uniforms:Tr([Ii.common,Ii.bumpmap,Ii.normalmap,Ii.displacementmap,{opacity:{value:1}}]),vertexShader:En.normal_vert,fragmentShader:En.normal_frag},sprite:{uniforms:Tr([Ii.sprite,Ii.fog]),vertexShader:En.sprite_vert,fragmentShader:En.sprite_frag},background:{uniforms:{uvTransform:{value:new Or},t2D:{value:null}},vertexShader:En.background_vert,fragmentShader:En.background_frag},cube:{uniforms:Tr([Ii.envmap,{opacity:{value:1}}]),vertexShader:En.cube_vert,fragmentShader:En.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:En.equirect_vert,fragmentShader:En.equirect_frag},distanceRGBA:{uniforms:Tr([Ii.common,Ii.displacementmap,{referencePosition:{value:new Ge},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:En.distanceRGBA_vert,fragmentShader:En.distanceRGBA_frag},shadow:{uniforms:Tr([Ii.lights,Ii.fog,{color:{value:new $i(0)},opacity:{value:1}}]),vertexShader:En.shadow_vert,fragmentShader:En.shadow_frag}};function ca(i,t,a,l,h){const f=new $i(0);let y,b,p=0,A=null,C=0,M=null;function k(z,pe){a.buffers.color.setClear(z.r,z.g,z.b,pe,h)}return{getClearColor:function(){return f},setClearColor:function(z,pe=1){f.set(z),p=pe,k(f,p)},getClearAlpha:function(){return p},setClearAlpha:function(z){p=z,k(f,p)},render:function R(z,pe,ce,V){let U=!0===pe.isScene?pe.background:null;U&&U.isTexture&&(U=t.get(U));const je=i.xr,Ze=je.getSession&&je.getSession();Ze&&"additive"===Ze.environmentBlendMode&&(U=null),null===U?k(f,p):U&&U.isColor&&(k(U,1),V=!0),(i.autoClear||V)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),U&&(U.isCubeTexture||U.isWebGLCubeRenderTarget||306===U.mapping)?(void 0===b&&(b=new $n(new Au(1,1,1),new jr({name:"BackgroundCubeMaterial",uniforms:Ro(ua.cube.uniforms),vertexShader:ua.cube.vertexShader,fragmentShader:ua.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),b.geometry.deleteAttribute("normal"),b.geometry.deleteAttribute("uv"),b.onBeforeRender=function(Je,Ie,it){this.matrixWorld.copyPosition(it.matrixWorld)},Object.defineProperty(b.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(b)),U.isWebGLCubeRenderTarget&&(U=U.texture),b.material.uniforms.envMap.value=U,b.material.uniforms.flipEnvMap.value=U.isCubeTexture&&U._needsFlipEnvMap?-1:1,(A!==U||C!==U.version||M!==i.toneMapping)&&(b.material.needsUpdate=!0,A=U,C=U.version,M=i.toneMapping),z.unshift(b,b.geometry,b.material,0,0,null)):U&&U.isTexture&&(void 0===y&&(y=new $n(new od(2,2),new jr({name:"BackgroundMaterial",uniforms:Ro(ua.background.uniforms),vertexShader:ua.background.vertexShader,fragmentShader:ua.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),y.geometry.deleteAttribute("normal"),Object.defineProperty(y.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(y)),y.material.uniforms.t2D.value=U,!0===U.matrixAutoUpdate&&U.updateMatrix(),y.material.uniforms.uvTransform.value.copy(U.matrix),(A!==U||C!==U.version||M!==i.toneMapping)&&(y.material.needsUpdate=!0,A=U,C=U.version,M=i.toneMapping),z.unshift(y,y.geometry,y.material,0,0,null))}}}function ha(i,t,a,l){const h=i.getParameter(34921),f=l.isWebGL2?null:t.get("OES_vertex_array_object"),p=l.isWebGL2||null!==f,y={},b=pe(null);let A=b;function R(Rt){return l.isWebGL2?i.bindVertexArray(Rt):f.bindVertexArrayOES(Rt)}function k(Rt){return l.isWebGL2?i.deleteVertexArray(Rt):f.deleteVertexArrayOES(Rt)}function pe(Rt){const qe=[],ut=[],xt=[];for(let zt=0;zt<h;zt++)qe[zt]=0,ut[zt]=0,xt[zt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:qe,enabledAttributes:ut,attributeDivisors:xt,object:Rt,attributes:{},index:null}}function U(){const Rt=A.newAttributes;for(let qe=0,ut=Rt.length;qe<ut;qe++)Rt[qe]=0}function je(Rt){Ze(Rt,0)}function Ze(Rt,qe){const xt=A.enabledAttributes,zt=A.attributeDivisors;A.newAttributes[Rt]=1,0===xt[Rt]&&(i.enableVertexAttribArray(Rt),xt[Rt]=1),zt[Rt]!==qe&&((l.isWebGL2?i:t.get("ANGLE_instanced_arrays"))[l.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Rt,qe),zt[Rt]=qe)}function Je(){const Rt=A.newAttributes,qe=A.enabledAttributes;for(let ut=0,xt=qe.length;ut<xt;ut++)qe[ut]!==Rt[ut]&&(i.disableVertexAttribArray(ut),qe[ut]=0)}function Ie(Rt,qe,ut,xt,zt,li){!0!==l.isWebGL2||5124!==ut&&5125!==ut?i.vertexAttribPointer(Rt,qe,ut,xt,zt,li):i.vertexAttribIPointer(Rt,qe,ut,zt,li)}function Lt(){Yt(),A!==b&&(A=b,R(A.object))}function Yt(){b.geometry=null,b.program=null,b.wireframe=!1}return{setup:function C(Rt,qe,ut,xt,zt){let li=!1;if(p){const ri=function z(Rt,qe,ut){const xt=!0===ut.wireframe;let zt=y[Rt.id];void 0===zt&&(zt={},y[Rt.id]=zt);let li=zt[qe.id];void 0===li&&(li={},zt[qe.id]=li);let ri=li[xt];return void 0===ri&&(ri=pe(function M(){return l.isWebGL2?i.createVertexArray():f.createVertexArrayOES()}()),li[xt]=ri),ri}(xt,ut,qe);A!==ri&&(A=ri,R(A.object)),li=function ce(Rt,qe){const ut=A.attributes,xt=Rt.attributes;let zt=0;for(const li in xt){const ri=ut[li],di=xt[li];if(void 0===ri||ri.attribute!==di||ri.data!==di.data)return!0;zt++}return A.attributesNum!==zt||A.index!==qe}(xt,zt),li&&function V(Rt,qe){const ut={},xt=Rt.attributes;let zt=0;for(const li in xt){const ri=xt[li],di={};di.attribute=ri,ri.data&&(di.data=ri.data),ut[li]=di,zt++}A.attributes=ut,A.attributesNum=zt,A.index=qe}(xt,zt)}else{const ri=!0===qe.wireframe;(A.geometry!==xt.id||A.program!==ut.id||A.wireframe!==ri)&&(A.geometry=xt.id,A.program=ut.id,A.wireframe=ri,li=!0)}!0===Rt.isInstancedMesh&&(li=!0),null!==zt&&a.update(zt,34963),li&&(function it(Rt,qe,ut,xt){if(!1===l.isWebGL2&&(Rt.isInstancedMesh||xt.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;U();const zt=xt.attributes,li=ut.getAttributes(),ri=qe.defaultAttributeValues;for(const di in li){const _i=li[di];if(_i>=0){const Yi=zt[di];if(void 0!==Yi){const Ji=Yi.normalized,Mn=Yi.itemSize,Kt=a.get(Yi);if(void 0===Kt)continue;const Qn=Kt.buffer,tn=Kt.type,An=Kt.bytesPerElement;if(Yi.isInterleavedBufferAttribute){const nn=Yi.data,bn=nn.stride,mn=Yi.offset;nn&&nn.isInstancedInterleavedBuffer?(Ze(_i,nn.meshPerAttribute),void 0===xt._maxInstanceCount&&(xt._maxInstanceCount=nn.meshPerAttribute*nn.count)):je(_i),i.bindBuffer(34962,Qn),Ie(_i,Mn,tn,Ji,bn*An,mn*An)}else Yi.isInstancedBufferAttribute?(Ze(_i,Yi.meshPerAttribute),void 0===xt._maxInstanceCount&&(xt._maxInstanceCount=Yi.meshPerAttribute*Yi.count)):je(_i),i.bindBuffer(34962,Qn),Ie(_i,Mn,tn,Ji,0,0)}else if("instanceMatrix"===di){const Ji=a.get(Rt.instanceMatrix);if(void 0===Ji)continue;const Mn=Ji.buffer,Kt=Ji.type;Ze(_i+0,1),Ze(_i+1,1),Ze(_i+2,1),Ze(_i+3,1),i.bindBuffer(34962,Mn),i.vertexAttribPointer(_i+0,4,Kt,!1,64,0),i.vertexAttribPointer(_i+1,4,Kt,!1,64,16),i.vertexAttribPointer(_i+2,4,Kt,!1,64,32),i.vertexAttribPointer(_i+3,4,Kt,!1,64,48)}else if("instanceColor"===di){const Ji=a.get(Rt.instanceColor);if(void 0===Ji)continue;const Mn=Ji.buffer,Kt=Ji.type;Ze(_i,1),i.bindBuffer(34962,Mn),i.vertexAttribPointer(_i,3,Kt,!1,12,0)}else if(void 0!==ri){const Ji=ri[di];if(void 0!==Ji)switch(Ji.length){case 2:i.vertexAttrib2fv(_i,Ji);break;case 3:i.vertexAttrib3fv(_i,Ji);break;case 4:i.vertexAttrib4fv(_i,Ji);break;default:i.vertexAttrib1fv(_i,Ji)}}}}Je()}(Rt,qe,ut,xt),null!==zt&&i.bindBuffer(34963,a.get(zt).buffer))},reset:Lt,resetDefaultState:Yt,dispose:function Gt(){Lt();for(const Rt in y){const qe=y[Rt];for(const ut in qe){const xt=qe[ut];for(const zt in xt)k(xt[zt].object),delete xt[zt];delete qe[ut]}delete y[Rt]}},releaseStatesOfGeometry:function ht(Rt){if(void 0===y[Rt.id])return;const qe=y[Rt.id];for(const ut in qe){const xt=qe[ut];for(const zt in xt)k(xt[zt].object),delete xt[zt];delete qe[ut]}delete y[Rt.id]},releaseStatesOfProgram:function At(Rt){for(const qe in y){const ut=y[qe];if(void 0===ut[Rt.id])continue;const xt=ut[Rt.id];for(const zt in xt)k(xt[zt].object),delete xt[zt];delete ut[Rt.id]}},initAttributes:U,enableAttribute:je,disableUnusedAttributes:Je}}function Ya(i,t,a,l){const h=l.isWebGL2;let f;this.setMode=function p(A){f=A},this.render=function y(A,C){i.drawArrays(f,A,C),a.update(C,f,1)},this.renderInstances=function b(A,C,M){if(0===M)return;let R,k;if(h)R=i,k="drawArraysInstanced";else if(R=t.get("ANGLE_instanced_arrays"),k="drawArraysInstancedANGLE",null===R)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");R[k](f,A,C,M),a.update(C,f,M)}}function Ll(i,t,a){let l;function f(Ie){if("highp"===Ie){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ie="mediump"}return"mediump"===Ie&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const p=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let y=void 0!==a.precision?a.precision:"highp";const b=f(y);b!==y&&(console.warn("THREE.WebGLRenderer:",y,"not supported, using",b,"instead."),y=b);const A=!0===a.logarithmicDepthBuffer,C=i.getParameter(34930),M=i.getParameter(35660),R=i.getParameter(3379),k=i.getParameter(34076),z=i.getParameter(34921),pe=i.getParameter(36347),ce=i.getParameter(36348),V=i.getParameter(36349),U=M>0,je=p||!!t.get("OES_texture_float");return{isWebGL2:p,getMaxAnisotropy:function h(){if(void 0!==l)return l;const Ie=t.get("EXT_texture_filter_anisotropic");return l=null!==Ie?i.getParameter(Ie.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,l},getMaxPrecision:f,precision:y,logarithmicDepthBuffer:A,maxTextures:C,maxVertexTextures:M,maxTextureSize:R,maxCubemapSize:k,maxAttributes:z,maxVertexUniforms:pe,maxVaryings:ce,maxFragmentUniforms:V,vertexTextures:U,floatFragmentTextures:je,floatVertexTextures:U&&je,maxSamples:p?i.getParameter(36183):0}}function Xc(i){const t=this;let a=null,l=0,h=!1,f=!1;const p=new Is,y=new Or,b={value:null,needsUpdate:!1};function A(){b.value!==a&&(b.value=a,b.needsUpdate=l>0),t.numPlanes=l,t.numIntersection=0}function C(M,R,k,z){const pe=null!==M?M.length:0;let ce=null;if(0!==pe){if(ce=b.value,!0!==z||null===ce){const V=k+4*pe,U=R.matrixWorldInverse;y.getNormalMatrix(U),(null===ce||ce.length<V)&&(ce=new Float32Array(V));for(let je=0,Ze=k;je!==pe;++je,Ze+=4)p.copy(M[je]).applyMatrix4(U,y),p.normal.toArray(ce,Ze),ce[Ze+3]=p.constant}b.value=ce,b.needsUpdate=!0}return t.numPlanes=pe,t.numIntersection=0,ce}this.uniform=b,this.numPlanes=0,this.numIntersection=0,this.init=function(M,R,k){const z=0!==M.length||R||0!==l||h;return h=R,a=C(M,k,0),l=M.length,z},this.beginShadows=function(){f=!0,C(null)},this.endShadows=function(){f=!1,A()},this.setState=function(M,R,k){const z=M.clippingPlanes,pe=M.clipIntersection,ce=M.clipShadows,V=i.get(M);if(!h||null===z||0===z.length||f&&!ce)f?C(null):A();else{const U=f?0:l,je=4*U;let Ze=V.clippingState||null;b.value=Ze,Ze=C(z,R,je,k);for(let Je=0;Je!==je;++Je)Ze[Je]=a[Je];V.clippingState=Ze,this.numIntersection=pe?this.numPlanes:0,this.numPlanes+=U}}}function Pp(i){let t=new WeakMap;function a(p,y){return 303===y?p.mapping=301:304===y&&(p.mapping=302),p}function h(p){const y=p.target;y.removeEventListener("dispose",h);const b=t.get(y);void 0!==b&&(t.delete(y),b.dispose())}return{get:function l(p){if(p&&p.isTexture){const y=p.mapping;if(303===y||304===y){if(t.has(p))return a(t.get(p).texture,p.mapping);{const b=p.image;if(b&&b.height>0){const A=i.getRenderList(),C=i.getRenderTarget(),M=new Yf(b.height/2);return M.fromEquirectangularTexture(i,p),t.set(p,M),i.setRenderTarget(C),i.setRenderList(A),p.addEventListener("dispose",h),a(M.texture,p.mapping)}return null}}}return p},dispose:function f(){t=new WeakMap}}}function Lp(i){const t={};function a(l){if(void 0!==t[l])return t[l];let h;switch(l){case"WEBGL_depth_texture":h=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":h=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":h=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":h=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:h=i.getExtension(l)}return t[l]=h,h}return{has:function(l){return null!==a(l)},init:function(l){l.isWebGL2?a("EXT_color_buffer_float"):(a("WEBGL_depth_texture"),a("OES_texture_float"),a("OES_texture_half_float"),a("OES_texture_half_float_linear"),a("OES_standard_derivatives"),a("OES_element_index_uint"),a("OES_vertex_array_object"),a("ANGLE_instanced_arrays")),a("OES_texture_float_linear"),a("EXT_color_buffer_half_float")},get:function(l){const h=a(l);return null===h&&console.warn("THREE.WebGLRenderer: "+l+" extension not supported."),h}}}function $g(i,t,a,l){const h={},f=new WeakMap;function p(M){const R=M.target;null!==R.index&&t.remove(R.index);for(const z in R.attributes)t.remove(R.attributes[z]);R.removeEventListener("dispose",p),delete h[R.id];const k=f.get(R);k&&(t.remove(k),f.delete(R)),l.releaseStatesOfGeometry(R),!0===R.isInstancedBufferGeometry&&delete R._maxInstanceCount,a.memory.geometries--}function A(M){const R=[],k=M.index,z=M.attributes.position;let pe=0;if(null!==k){const U=k.array;pe=k.version;for(let je=0,Ze=U.length;je<Ze;je+=3){const Je=U[je+0],Ie=U[je+1],it=U[je+2];R.push(Je,Ie,Ie,it,it,Je)}}else{pe=z.version;for(let je=0,Ze=z.array.length/3-1;je<Ze;je+=3){const Je=je+0,Ie=je+1,it=je+2;R.push(Je,Ie,Ie,it,it,Je)}}const ce=new(Ra(R)>65535?Lo:yl)(R,1);ce.version=pe;const V=f.get(M);V&&t.remove(V),f.set(M,ce)}return{get:function y(M,R){return!0===h[R.id]||(R.addEventListener("dispose",p),h[R.id]=!0,a.memory.geometries++),R},update:function b(M){const R=M.attributes;for(const z in R)t.update(R[z],34962);const k=M.morphAttributes;for(const z in k){const pe=k[z];for(let ce=0,V=pe.length;ce<V;ce++)t.update(pe[ce],34962)}},getWireframeAttribute:function C(M){const R=f.get(M);if(R){const k=M.index;null!==k&&R.version<k.version&&A(M)}else A(M);return f.get(M)}}}function Ip(i,t,a,l){const h=l.isWebGL2;let f,y,b;this.setMode=function p(R){f=R},this.setIndex=function A(R){y=R.type,b=R.bytesPerElement},this.render=function C(R,k){i.drawElements(f,k,y,R*b),a.update(k,f,1)},this.renderInstances=function M(R,k,z){if(0===z)return;let pe,ce;if(h)pe=i,ce="drawElementsInstanced";else if(pe=t.get("ANGLE_instanced_arrays"),ce="drawElementsInstancedANGLE",null===pe)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");pe[ce](f,k,y,R*b,z),a.update(k,f,z)}}function Rp(i){const a={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:a,programs:null,autoReset:!0,reset:function h(){a.frame++,a.calls=0,a.triangles=0,a.points=0,a.lines=0},update:function l(f,p,y){switch(a.calls++,p){case 4:a.triangles+=y*(f/3);break;case 1:a.lines+=y*(f/2);break;case 3:a.lines+=y*(f-1);break;case 2:a.lines+=y*f;break;case 0:a.points+=y*f;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",p)}}}}function Dp(i,t){return i[0]-t[0]}function Op(i,t){return Math.abs(t[1])-Math.abs(i[1])}function Ns(i){const t={},a=new Float32Array(8),l=[];for(let f=0;f<8;f++)l[f]=[f,0];return{update:function h(f,p,y,b){const A=f.morphTargetInfluences,C=void 0===A?0:A.length;let M=t[p.id];if(void 0===M){M=[];for(let ce=0;ce<C;ce++)M[ce]=[ce,0];t[p.id]=M}for(let ce=0;ce<C;ce++){const V=M[ce];V[0]=ce,V[1]=A[ce]}M.sort(Op);for(let ce=0;ce<8;ce++)ce<C&&M[ce][1]?(l[ce][0]=M[ce][0],l[ce][1]=M[ce][1]):(l[ce][0]=Number.MAX_SAFE_INTEGER,l[ce][1]=0);l.sort(Dp);const R=y.morphTargets&&p.morphAttributes.position,k=y.morphNormals&&p.morphAttributes.normal;let z=0;for(let ce=0;ce<8;ce++){const V=l[ce],U=V[0],je=V[1];U!==Number.MAX_SAFE_INTEGER&&je?(R&&p.getAttribute("morphTarget"+ce)!==R[U]&&p.setAttribute("morphTarget"+ce,R[U]),k&&p.getAttribute("morphNormal"+ce)!==k[U]&&p.setAttribute("morphNormal"+ce,k[U]),a[ce]=je,z+=je):(R&&!0===p.hasAttribute("morphTarget"+ce)&&p.deleteAttribute("morphTarget"+ce),k&&!0===p.hasAttribute("morphNormal"+ce)&&p.deleteAttribute("morphNormal"+ce),a[ce]=0)}const pe=p.morphTargetsRelative?1:1-z;b.getUniforms().setValue(i,"morphTargetBaseInfluence",pe),b.getUniforms().setValue(i,"morphTargetInfluences",a)}}}function Jg(i,t,a,l){let h=new WeakMap;function y(b){const A=b.target;A.removeEventListener("dispose",y),a.remove(A.instanceMatrix),null!==A.instanceColor&&a.remove(A.instanceColor)}return{update:function f(b){const A=l.render.frame,M=t.get(b,b.geometry);return h.get(M)!==A&&(t.update(M),h.set(M,A)),b.isInstancedMesh&&(!1===b.hasEventListener("dispose",y)&&b.addEventListener("dispose",y),a.update(b.instanceMatrix,34962),null!==b.instanceColor&&a.update(b.instanceColor,34962)),M},dispose:function p(){h=new WeakMap}}}function gr(i=null,t=1,a=1,l=1){zn.call(this,null),this.image={data:i,width:t,height:a,depth:l},this.magFilter=rn,this.minFilter=rn,this.wrapR=kt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function cr(i=null,t=1,a=1,l=1){zn.call(this,null),this.image={data:i,width:t,height:a,depth:l},this.magFilter=rn,this.minFilter=rn,this.wrapR=kt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ua.physical={uniforms:Tr([ua.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ct(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new $i(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:En.meshphysical_vert,fragmentShader:En.meshphysical_frag},(gr.prototype=Object.create(zn.prototype)).constructor=gr,gr.prototype.isDataTexture2DArray=!0,(cr.prototype=Object.create(zn.prototype)).constructor=cr,cr.prototype.isDataTexture3D=!0;const Fp=new zn,e0=new gr,Np=new cr,ao=new Da,ds=[],No=[],qc=new Float32Array(16),Mu=new Float32Array(9),Sd=new Float32Array(4);function ko(i,t,a){const l=i[0];if(l<=0||l>0)return i;const h=t*a;let f=ds[h];if(void 0===f&&(f=new Float32Array(h),ds[h]=f),0!==t){l.toArray(f,0);for(let p=1,y=0;p!==t;++p)y+=a,i[p].toArray(f,y)}return f}function ba(i,t){if(i.length!==t.length)return!1;for(let a=0,l=i.length;a<l;a++)if(i[a]!==t[a])return!1;return!0}function da(i,t){for(let a=0,l=t.length;a<l;a++)i[a]=t[a]}function kr(i,t){let a=No[t];void 0===a&&(a=new Int32Array(t),No[t]=a);for(let l=0;l!==t;++l)a[l]=i.allocateTextureUnit();return a}function kp(i,t){const a=this.cache;a[0]!==t&&(i.uniform1f(this.addr,t),a[0]=t)}function Cu(i,t){const a=this.cache;if(void 0!==t.x)(a[0]!==t.x||a[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),a[0]=t.x,a[1]=t.y);else{if(ba(a,t))return;i.uniform2fv(this.addr,t),da(a,t)}}function Pu(i,t){const a=this.cache;if(void 0!==t.x)(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),a[0]=t.x,a[1]=t.y,a[2]=t.z);else if(void 0!==t.r)(a[0]!==t.r||a[1]!==t.g||a[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),a[0]=t.r,a[1]=t.g,a[2]=t.b);else{if(ba(a,t))return;i.uniform3fv(this.addr,t),da(a,t)}}function t0(i,t){const a=this.cache;if(void 0!==t.x)(a[0]!==t.x||a[1]!==t.y||a[2]!==t.z||a[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),a[0]=t.x,a[1]=t.y,a[2]=t.z,a[3]=t.w);else{if(ba(a,t))return;i.uniform4fv(this.addr,t),da(a,t)}}function Bp(i,t){const a=this.cache,l=t.elements;if(void 0===l){if(ba(a,t))return;i.uniformMatrix2fv(this.addr,!1,t),da(a,t)}else{if(ba(a,l))return;Sd.set(l),i.uniformMatrix2fv(this.addr,!1,Sd),da(a,l)}}function Ed(i,t){const a=this.cache,l=t.elements;if(void 0===l){if(ba(a,t))return;i.uniformMatrix3fv(this.addr,!1,t),da(a,t)}else{if(ba(a,l))return;Mu.set(l),i.uniformMatrix3fv(this.addr,!1,Mu),da(a,l)}}function Up(i,t){const a=this.cache,l=t.elements;if(void 0===l){if(ba(a,t))return;i.uniformMatrix4fv(this.addr,!1,t),da(a,t)}else{if(ba(a,l))return;qc.set(l),i.uniformMatrix4fv(this.addr,!1,qc),da(a,l)}}function Hp(i,t,a){const l=this.cache,h=a.allocateTextureUnit();l[0]!==h&&(i.uniform1i(this.addr,h),l[0]=h),a.safeSetTexture2D(t||Fp,h)}function i0(i,t,a){const l=this.cache,h=a.allocateTextureUnit();l[0]!==h&&(i.uniform1i(this.addr,h),l[0]=h),a.setTexture2DArray(t||e0,h)}function Bo(i,t,a){const l=this.cache,h=a.allocateTextureUnit();l[0]!==h&&(i.uniform1i(this.addr,h),l[0]=h),a.setTexture3D(t||Np,h)}function Yc(i,t,a){const l=this.cache,h=a.allocateTextureUnit();l[0]!==h&&(i.uniform1i(this.addr,h),l[0]=h),a.safeSetTextureCube(t||ao,h)}function Lu(i,t){const a=this.cache;a[0]!==t&&(i.uniform1i(this.addr,t),a[0]=t)}function Md(i,t){const a=this.cache;ba(a,t)||(i.uniform2iv(this.addr,t),da(a,t))}function Cd(i,t){const a=this.cache;ba(a,t)||(i.uniform3iv(this.addr,t),da(a,t))}function Pd(i,t){const a=this.cache;ba(a,t)||(i.uniform4iv(this.addr,t),da(a,t))}function Qc(i,t){const a=this.cache;a[0]!==t&&(i.uniform1ui(this.addr,t),a[0]=t)}function Vp(i,t){i.uniform1fv(this.addr,t)}function Ld(i,t){i.uniform1iv(this.addr,t)}function Kc(i,t){i.uniform2iv(this.addr,t)}function Id(i,t){i.uniform3iv(this.addr,t)}function Gp(i,t){i.uniform4iv(this.addr,t)}function Wp(i,t){const a=ko(t,this.size,2);i.uniform2fv(this.addr,a)}function jp(i,t){const a=ko(t,this.size,3);i.uniform3fv(this.addr,a)}function Rd(i,t){const a=ko(t,this.size,4);i.uniform4fv(this.addr,a)}function Il(i,t){const a=ko(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,a)}function Xp(i,t){const a=ko(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,a)}function Dd(i,t){const a=ko(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,a)}function qp(i,t,a){const l=t.length,h=kr(a,l);i.uniform1iv(this.addr,h);for(let f=0;f!==l;++f)a.safeSetTexture2D(t[f]||Fp,h[f])}function n0(i,t,a){const l=t.length,h=kr(a,l);i.uniform1iv(this.addr,h);for(let f=0;f!==l;++f)a.safeSetTextureCube(t[f]||ao,h[f])}function a0(i,t,a){this.id=i,this.addr=a,this.cache=[],this.setValue=function zp(i){switch(i){case 5126:return kp;case 35664:return Cu;case 35665:return Pu;case 35666:return t0;case 35674:return Bp;case 35675:return Ed;case 35676:return Up;case 5124:case 35670:return Lu;case 35667:case 35671:return Md;case 35668:case 35672:return Cd;case 35669:case 35673:return Pd;case 5125:return Qc;case 35678:case 36198:case 36298:case 36306:case 35682:return Hp;case 35679:case 36299:case 36307:return Bo;case 35680:case 36300:case 36308:case 36293:return Yc;case 36289:case 36303:case 36311:case 36292:return i0}}(t.type)}function Yp(i,t,a){this.id=i,this.addr=a,this.cache=[],this.size=t.size,this.setValue=function r0(i){switch(i){case 5126:return Vp;case 35664:return Wp;case 35665:return jp;case 35666:return Rd;case 35674:return Il;case 35675:return Xp;case 35676:return Dd;case 5124:case 35670:return Ld;case 35667:case 35671:return Kc;case 35668:case 35672:return Id;case 35669:case 35673:return Gp;case 35678:case 36198:case 36298:case 36306:case 35682:return qp;case 35680:case 36300:case 36308:case 36293:return n0}}(t.type)}function Qp(i){this.id=i,this.seq=[],this.map={}}Yp.prototype.updateCache=function(i){const t=this.cache;i instanceof Float32Array&&t.length!==i.length&&(this.cache=new Float32Array(i.length)),da(t,i)},Qp.prototype.setValue=function(i,t,a){const l=this.seq;for(let h=0,f=l.length;h!==f;++h){const p=l[h];p.setValue(i,t[p.id],a)}};const Od=/(\w+)(\])?(\[|\.)?/g;function Kp(i,t){i.seq.push(t),i.map[t.id]=t}function s0(i,t,a){const l=i.name,h=l.length;for(Od.lastIndex=0;;){const f=Od.exec(l),p=Od.lastIndex;let y=f[1];const A=f[3];if("]"===f[2]&&(y|=0),void 0===A||"["===A&&p+2===h){Kp(a,void 0===A?new a0(y,i,t):new Yp(y,i,t));break}{let M=a.map[y];void 0===M&&(M=new Qp(y),Kp(a,M)),a=M}}}function fs(i,t){this.seq=[],this.map={};const a=i.getProgramParameter(t,35718);for(let l=0;l<a;++l){const h=i.getActiveUniform(t,l);s0(h,i.getUniformLocation(t,h.name),this)}}function Rl(i,t,a){const l=i.createShader(t);return i.shaderSource(l,a),i.compileShader(l),l}fs.prototype.setValue=function(i,t,a,l){const h=this.map[t];void 0!==h&&h.setValue(i,a,l)},fs.prototype.setOptional=function(i,t,a){const l=t[a];void 0!==l&&this.setValue(i,a,l)},fs.upload=function(i,t,a,l){for(let h=0,f=t.length;h!==f;++h){const p=t[h],y=a[p.id];!1!==y.needsUpdate&&p.setValue(i,y.value,l)}},fs.seqWithValue=function(i,t){const a=[];for(let l=0,h=i.length;l!==h;++l){const f=i[l];f.id in t&&a.push(f)}return a};let Iu=0;function Nd(i){switch(i){case _o:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function kd(i,t,a){const l=i.getShaderParameter(t,35713),h=i.getShaderInfoLog(t).trim();return l&&""===h?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+a+"\n"+h+function Fd(i){const t=i.split("\n");for(let a=0;a<t.length;a++)t[a]=a+1+": "+t[a];return t.join("\n")}(i.getShaderSource(t))}function ks(i,t){const a=Nd(t);return"vec4 "+i+"( vec4 value ) { return "+a[0]+"ToLinear"+a[1]+"; }"}function so(i,t){const a=Nd(t);return"vec4 "+i+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function Dl(i,t){let a;switch(t){case 1:a="Linear";break;case 2:a="Reinhard";break;case 3:a="OptimizedCineon";break;case 4:a="ACESFilmic";break;case 5:a="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),a="Linear"}return"vec3 "+i+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function Bs(i){return""!==i}function Du(i,t){return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Uo(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Zp=/^[ \t]*#include +<([\w\d./]+)>/gm;function Bd(i){return i.replace(Zp,$p)}function $p(i,t){const a=En[t];if(void 0===a)throw new Error("Can not resolve #include <"+t+">");return Bd(a)}const o0=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Jp=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function em(i){return i.replace(Jp,Ud).replace(o0,l0)}function l0(i,t,a,l){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ud(0,t,a,l)}function Ud(i,t,a,l){let h="";for(let f=parseInt(t);f<parseInt(a);f++)h+=l.replace(/\[\s*i\s*\]/g,"[ "+f+" ]").replace(/UNROLLED_LOOP_INDEX/g,f);return h}function tm(i){let t="precision "+i.precision+" float;\nprecision "+i.precision+" int;";return"highp"===i.precision?t+="\n#define HIGH_PRECISION":"mediump"===i.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===i.precision&&(t+="\n#define LOW_PRECISION"),t}function d0(i,t,a,l){const h=i.getContext(),f=a.defines;let p=a.vertexShader,y=a.fragmentShader;const b=function u0(i){let t="SHADOWMAP_TYPE_BASIC";return 1===i.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===i.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===i.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(a),A=function im(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(a),C=function c0(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(a),M=function h0(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(a),R=i.gammaFactor>0?i.gammaFactor:1,k=a.isWebGL2?"":function Ru(i){return[i.extensionDerivatives||i.envMapCubeUV||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||"physical"===i.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Bs).join("\n")}(a),z=function Ol(i){const t=[];for(const a in i){const l=i[a];!1!==l&&t.push("#define "+a+" "+l)}return t.join("\n")}(f),pe=h.createProgram();let ce,V,U=a.glslVersion?"#version "+a.glslVersion+"\n":"";a.isRawShaderMaterial?(ce=[z].filter(Bs).join("\n"),ce.length>0&&(ce+="\n"),V=[k,z].filter(Bs).join("\n"),V.length>0&&(V+="\n")):(ce=[tm(a),"#define SHADER_NAME "+a.shaderName,z,a.instancing?"#define USE_INSTANCING":"",a.instancingColor?"#define USE_INSTANCING_COLOR":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+R,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+C:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+b:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Bs).join("\n"),V=[k,tm(a),"#define SHADER_NAME "+a.shaderName,z,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+R,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+A:"",a.envMap?"#define "+C:"",a.envMap?"#define "+M:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatMap?"#define USE_CLEARCOATMAP":"",a.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.sheen?"#define USE_SHEEN":"",a.transmissionMap?"#define USE_TRANSMISSIONMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors||a.instancingColor?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+b:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&a.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(a.extensionShaderTextureLOD||a.envMap)&&a.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==a.toneMapping?"#define TONE_MAPPING":"",0!==a.toneMapping?En.tonemapping_pars_fragment:"",0!==a.toneMapping?Dl("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",En.encodings_pars_fragment,a.map?ks("mapTexelToLinear",a.mapEncoding):"",a.matcap?ks("matcapTexelToLinear",a.matcapEncoding):"",a.envMap?ks("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMap?ks("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.lightMap?ks("lightMapTexelToLinear",a.lightMapEncoding):"",so("linearToOutputTexel",a.outputEncoding),a.depthPacking?"#define DEPTH_PACKING "+a.depthPacking:"","\n"].filter(Bs).join("\n")),p=Bd(p),p=Du(p,a),p=Uo(p,a),y=Bd(y),y=Du(y,a),y=Uo(y,a),p=em(p),y=em(y),a.isWebGL2&&!0!==a.isRawShaderMaterial&&(U="#version 300 es\n",ce=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+ce,V=["#define varying in","300 es"===a.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===a.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+V);const Ze=U+V+y,Je=Rl(h,35633,U+ce+p),Ie=Rl(h,35632,Ze);if(h.attachShader(pe,Je),h.attachShader(pe,Ie),void 0!==a.index0AttributeName?h.bindAttribLocation(pe,0,a.index0AttributeName):!0===a.morphTargets&&h.bindAttribLocation(pe,0,"position"),h.linkProgram(pe),i.debug.checkShaderErrors){const ht=h.getProgramInfoLog(pe).trim(),At=h.getShaderInfoLog(Je).trim(),Lt=h.getShaderInfoLog(Ie).trim();let Yt=!0,Rt=!0;if(!1===h.getProgramParameter(pe,35714)){Yt=!1;const qe=kd(h,Je,"vertex"),ut=kd(h,Ie,"fragment");console.error("THREE.WebGLProgram: shader error: ",h.getError(),"35715",h.getProgramParameter(pe,35715),"gl.getProgramInfoLog",ht,qe,ut)}else""!==ht?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",ht):(""===At||""===Lt)&&(Rt=!1);Rt&&(this.diagnostics={runnable:Yt,programLog:ht,vertexShader:{log:At,prefix:ce},fragmentShader:{log:Lt,prefix:V}})}let it,Gt;return h.deleteShader(Je),h.deleteShader(Ie),this.getUniforms=function(){return void 0===it&&(it=new fs(h,pe)),it},this.getAttributes=function(){return void 0===Gt&&(Gt=function Fl(i,t){const a={},l=i.getProgramParameter(t,35721);for(let h=0;h<l;h++){const p=i.getActiveAttrib(t,h).name;a[p]=i.getAttribLocation(t,p)}return a}(h,pe)),Gt},this.destroy=function(){l.releaseStatesOfProgram(this),h.deleteProgram(pe),this.program=void 0},this.name=a.shaderName,this.id=Iu++,this.cacheKey=t,this.usedTimes=1,this.program=pe,this.vertexShader=Je,this.fragmentShader=Ie,this}function nm(i,t,a,l,h,f){const p=[],y=l.isWebGL2,b=l.logarithmicDepthBuffer,A=l.floatVertexTextures,C=l.maxVertexUniforms,M=l.vertexTextures;let R=l.precision;const k={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},z=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function ce(Ie){let it;return Ie&&Ie.isTexture?it=Ie.encoding:Ie&&Ie.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),it=Ie.texture.encoding):it=_o,it}return{getParameters:function V(Ie,it,Gt,ht,At){const Lt=ht.fog,Rt=t.get(Ie.envMap||(Ie.isMeshStandardMaterial?ht.environment:null)),qe=k[Ie.type],ut=At.isSkinnedMesh?function pe(Ie){const Gt=Ie.skeleton.bones;if(A)return 1024;{const At=Math.floor((C-20)/4),Lt=Math.min(At,Gt.length);return Lt<Gt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Gt.length+" bones. This GPU supports "+Lt+"."),0):Lt}}(At):0;let xt,zt;if(null!==Ie.precision&&(R=l.getMaxPrecision(Ie.precision),R!==Ie.precision&&console.warn("THREE.WebGLProgram.getParameters:",Ie.precision,"not supported, using",R,"instead.")),qe){const di=ua[qe];xt=di.vertexShader,zt=di.fragmentShader}else xt=Ie.vertexShader,zt=Ie.fragmentShader;const li=i.getRenderTarget();return{isWebGL2:y,shaderID:qe,shaderName:Ie.type,vertexShader:xt,fragmentShader:zt,defines:Ie.defines,isRawShaderMaterial:!0===Ie.isRawShaderMaterial,glslVersion:Ie.glslVersion,precision:R,instancing:!0===At.isInstancedMesh,instancingColor:!0===At.isInstancedMesh&&null!==At.instanceColor,supportsVertexTextures:M,outputEncoding:null!==li?ce(li.texture):i.outputEncoding,map:!!Ie.map,mapEncoding:ce(Ie.map),matcap:!!Ie.matcap,matcapEncoding:ce(Ie.matcap),envMap:!!Rt,envMapMode:Rt&&Rt.mapping,envMapEncoding:ce(Rt),envMapCubeUV:!!Rt&&(306===Rt.mapping||307===Rt.mapping),lightMap:!!Ie.lightMap,lightMapEncoding:ce(Ie.lightMap),aoMap:!!Ie.aoMap,emissiveMap:!!Ie.emissiveMap,emissiveMapEncoding:ce(Ie.emissiveMap),bumpMap:!!Ie.bumpMap,normalMap:!!Ie.normalMap,objectSpaceNormalMap:1===Ie.normalMapType,tangentSpaceNormalMap:0===Ie.normalMapType,clearcoatMap:!!Ie.clearcoatMap,clearcoatRoughnessMap:!!Ie.clearcoatRoughnessMap,clearcoatNormalMap:!!Ie.clearcoatNormalMap,displacementMap:!!Ie.displacementMap,roughnessMap:!!Ie.roughnessMap,metalnessMap:!!Ie.metalnessMap,specularMap:!!Ie.specularMap,alphaMap:!!Ie.alphaMap,gradientMap:!!Ie.gradientMap,sheen:!!Ie.sheen,transmissionMap:!!Ie.transmissionMap,combine:Ie.combine,vertexTangents:Ie.normalMap&&Ie.vertexTangents,vertexColors:Ie.vertexColors,vertexUvs:!!(Ie.map||Ie.bumpMap||Ie.normalMap||Ie.specularMap||Ie.alphaMap||Ie.emissiveMap||Ie.roughnessMap||Ie.metalnessMap||Ie.clearcoatMap||Ie.clearcoatRoughnessMap||Ie.clearcoatNormalMap||Ie.displacementMap||Ie.transmissionMap),uvsVertexOnly:!(Ie.map||Ie.bumpMap||Ie.normalMap||Ie.specularMap||Ie.alphaMap||Ie.emissiveMap||Ie.roughnessMap||Ie.metalnessMap||Ie.clearcoatNormalMap||Ie.transmissionMap||!Ie.displacementMap),fog:!!Lt,useFog:Ie.fog,fogExp2:Lt&&Lt.isFogExp2,flatShading:Ie.flatShading,sizeAttenuation:Ie.sizeAttenuation,logarithmicDepthBuffer:b,skinning:Ie.skinning&&ut>0,maxBones:ut,useVertexTexture:A,morphTargets:Ie.morphTargets,morphNormals:Ie.morphNormals,maxMorphTargets:i.maxMorphTargets,maxMorphNormals:i.maxMorphNormals,numDirLights:it.directional.length,numPointLights:it.point.length,numSpotLights:it.spot.length,numRectAreaLights:it.rectArea.length,numHemiLights:it.hemi.length,numDirLightShadows:it.directionalShadowMap.length,numPointLightShadows:it.pointShadowMap.length,numSpotLightShadows:it.spotShadowMap.length,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:Ie.dithering,shadowMapEnabled:i.shadowMap.enabled&&Gt.length>0,shadowMapType:i.shadowMap.type,toneMapping:Ie.toneMapped?i.toneMapping:0,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:Ie.premultipliedAlpha,alphaTest:Ie.alphaTest,doubleSided:2===Ie.side,flipSided:1===Ie.side,depthPacking:void 0!==Ie.depthPacking&&Ie.depthPacking,index0AttributeName:Ie.index0AttributeName,extensionDerivatives:Ie.extensions&&Ie.extensions.derivatives,extensionFragDepth:Ie.extensions&&Ie.extensions.fragDepth,extensionDrawBuffers:Ie.extensions&&Ie.extensions.drawBuffers,extensionShaderTextureLOD:Ie.extensions&&Ie.extensions.shaderTextureLOD,rendererExtensionFragDepth:y||a.has("EXT_frag_depth"),rendererExtensionDrawBuffers:y||a.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:y||a.has("EXT_shader_texture_lod"),customProgramCacheKey:Ie.customProgramCacheKey()}},getProgramCacheKey:function U(Ie){const it=[];if(Ie.shaderID?it.push(Ie.shaderID):(it.push(Ie.fragmentShader),it.push(Ie.vertexShader)),void 0!==Ie.defines)for(const Gt in Ie.defines)it.push(Gt),it.push(Ie.defines[Gt]);if(!1===Ie.isRawShaderMaterial){for(let Gt=0;Gt<z.length;Gt++)it.push(Ie[z[Gt]]);it.push(i.outputEncoding),it.push(i.gammaFactor)}return it.push(Ie.customProgramCacheKey),it.join()},getUniforms:function je(Ie){const it=k[Ie.type];let Gt;return Gt=it?Xf.clone(ua[it].uniforms):Ie.uniforms,Gt},acquireProgram:function Ze(Ie,it){let Gt;for(let ht=0,At=p.length;ht<At;ht++){const Lt=p[ht];if(Lt.cacheKey===it){Gt=Lt,++Gt.usedTimes;break}}return void 0===Gt&&(Gt=new d0(i,it,Ie,h),p.push(Gt)),Gt},releaseProgram:function Je(Ie){if(0==--Ie.usedTimes){const it=p.indexOf(Ie);p[it]=p[p.length-1],p.pop(),Ie.destroy()}},programs:p}}function f0(){let i=new WeakMap;return{get:function t(f){let p=i.get(f);return void 0===p&&(p={},i.set(f,p)),p},remove:function a(f){i.delete(f)},update:function l(f,p,y){i.get(f)[p]=y},dispose:function h(){i=new WeakMap}}}function rm(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.program!==t.program?i.program.id-t.program.id:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function p0(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function am(i){const t=[];let a=0;const l=[],h=[],f={id:-1};function y(R,k,z,pe,ce,V){let U=t[a];const je=i.get(z);return void 0===U?(U={id:R.id,object:R,geometry:k,material:z,program:je.program||f,groupOrder:pe,renderOrder:R.renderOrder,z:ce,group:V},t[a]=U):(U.id=R.id,U.object=R,U.geometry=k,U.material=z,U.program=je.program||f,U.groupOrder=pe,U.renderOrder=R.renderOrder,U.z=ce,U.group=V),a++,U}return{opaque:l,transparent:h,init:function p(){a=0,l.length=0,h.length=0},push:function b(R,k,z,pe,ce,V){const U=y(R,k,z,pe,ce,V);(!0===z.transparent?h:l).push(U)},unshift:function A(R,k,z,pe,ce,V){const U=y(R,k,z,pe,ce,V);(!0===z.transparent?h:l).unshift(U)},finish:function M(){for(let R=a,k=t.length;R<k;R++){const z=t[R];if(null===z.id)break;z.id=null,z.object=null,z.geometry=null,z.material=null,z.program=null,z.group=null}},sort:function C(R,k){l.length>1&&l.sort(R||rm),h.length>1&&h.sort(k||p0)}}}function sm(i){let t=new WeakMap;return{get:function a(h,f){const p=t.get(h);let y;return void 0===p?(y=new am(i),t.set(h,new WeakMap),t.get(h).set(f,y)):(y=p.get(f),void 0===y&&(y=new am(i),p.set(f,y))),y},dispose:function l(){t=new WeakMap}}}function m0(){const i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];let a;switch(t.type){case"DirectionalLight":a={direction:new Ge,color:new $i};break;case"SpotLight":a={position:new Ge,direction:new Ge,color:new $i,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":a={position:new Ge,color:new $i,distance:0,decay:0};break;case"HemisphereLight":a={direction:new Ge,skyColor:new $i,groundColor:new $i};break;case"RectAreaLight":a={color:new $i,position:new Ge,halfWidth:new Ge,halfHeight:new Ge}}return i[t.id]=a,a}}}let Nl=0;function Hd(i,t){return(t.castShadow?1:0)-(i.castShadow?1:0)}function om(i,t){const a=new m0,l=function Ou(){const i={};return{get:function(t){if(void 0!==i[t.id])return i[t.id];let a;switch(t.type){case"DirectionalLight":case"SpotLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct};break;case"PointLight":a={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ct,shadowCameraNear:1,shadowCameraFar:1e3}}return i[t.id]=a,a}}}(),h={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let C=0;C<9;C++)h.probe.push(new Ge);const f=new Ge,p=new xn,y=new xn;return{setup:function b(C){let M=0,R=0,k=0;for(let it=0;it<9;it++)h.probe[it].set(0,0,0);let z=0,pe=0,ce=0,V=0,U=0,je=0,Ze=0,Je=0;C.sort(Hd);for(let it=0,Gt=C.length;it<Gt;it++){const ht=C[it],At=ht.color,Lt=ht.intensity,Yt=ht.distance,Rt=ht.shadow&&ht.shadow.map?ht.shadow.map.texture:null;if(ht.isAmbientLight)M+=At.r*Lt,R+=At.g*Lt,k+=At.b*Lt;else if(ht.isLightProbe)for(let qe=0;qe<9;qe++)h.probe[qe].addScaledVector(ht.sh.coefficients[qe],Lt);else if(ht.isDirectionalLight){const qe=a.get(ht);if(qe.color.copy(ht.color).multiplyScalar(ht.intensity),ht.castShadow){const ut=ht.shadow,xt=l.get(ht);xt.shadowBias=ut.bias,xt.shadowNormalBias=ut.normalBias,xt.shadowRadius=ut.radius,xt.shadowMapSize=ut.mapSize,h.directionalShadow[z]=xt,h.directionalShadowMap[z]=Rt,h.directionalShadowMatrix[z]=ht.shadow.matrix,je++}h.directional[z]=qe,z++}else if(ht.isSpotLight){const qe=a.get(ht);if(qe.position.setFromMatrixPosition(ht.matrixWorld),qe.color.copy(At).multiplyScalar(Lt),qe.distance=Yt,qe.coneCos=Math.cos(ht.angle),qe.penumbraCos=Math.cos(ht.angle*(1-ht.penumbra)),qe.decay=ht.decay,ht.castShadow){const ut=ht.shadow,xt=l.get(ht);xt.shadowBias=ut.bias,xt.shadowNormalBias=ut.normalBias,xt.shadowRadius=ut.radius,xt.shadowMapSize=ut.mapSize,h.spotShadow[ce]=xt,h.spotShadowMap[ce]=Rt,h.spotShadowMatrix[ce]=ht.shadow.matrix,Je++}h.spot[ce]=qe,ce++}else if(ht.isRectAreaLight){const qe=a.get(ht);qe.color.copy(At).multiplyScalar(Lt),qe.halfWidth.set(.5*ht.width,0,0),qe.halfHeight.set(0,.5*ht.height,0),h.rectArea[V]=qe,V++}else if(ht.isPointLight){const qe=a.get(ht);if(qe.color.copy(ht.color).multiplyScalar(ht.intensity),qe.distance=ht.distance,qe.decay=ht.decay,ht.castShadow){const ut=ht.shadow,xt=l.get(ht);xt.shadowBias=ut.bias,xt.shadowNormalBias=ut.normalBias,xt.shadowRadius=ut.radius,xt.shadowMapSize=ut.mapSize,xt.shadowCameraNear=ut.camera.near,xt.shadowCameraFar=ut.camera.far,h.pointShadow[pe]=xt,h.pointShadowMap[pe]=Rt,h.pointShadowMatrix[pe]=ht.shadow.matrix,Ze++}h.point[pe]=qe,pe++}else if(ht.isHemisphereLight){const qe=a.get(ht);qe.skyColor.copy(ht.color).multiplyScalar(Lt),qe.groundColor.copy(ht.groundColor).multiplyScalar(Lt),h.hemi[U]=qe,U++}}V>0&&(t.isWebGL2||!0===i.has("OES_texture_float_linear")?(h.rectAreaLTC1=Ii.LTC_FLOAT_1,h.rectAreaLTC2=Ii.LTC_FLOAT_2):!0===i.has("OES_texture_half_float_linear")?(h.rectAreaLTC1=Ii.LTC_HALF_1,h.rectAreaLTC2=Ii.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),h.ambient[0]=M,h.ambient[1]=R,h.ambient[2]=k;const Ie=h.hash;(Ie.directionalLength!==z||Ie.pointLength!==pe||Ie.spotLength!==ce||Ie.rectAreaLength!==V||Ie.hemiLength!==U||Ie.numDirectionalShadows!==je||Ie.numPointShadows!==Ze||Ie.numSpotShadows!==Je)&&(h.directional.length=z,h.spot.length=ce,h.rectArea.length=V,h.point.length=pe,h.hemi.length=U,h.directionalShadow.length=je,h.directionalShadowMap.length=je,h.pointShadow.length=Ze,h.pointShadowMap.length=Ze,h.spotShadow.length=Je,h.spotShadowMap.length=Je,h.directionalShadowMatrix.length=je,h.pointShadowMatrix.length=Ze,h.spotShadowMatrix.length=Je,Ie.directionalLength=z,Ie.pointLength=pe,Ie.spotLength=ce,Ie.rectAreaLength=V,Ie.hemiLength=U,Ie.numDirectionalShadows=je,Ie.numPointShadows=Ze,Ie.numSpotShadows=Je,h.version=Nl++)},setupView:function A(C,M){let R=0,k=0,z=0,pe=0,ce=0;const V=M.matrixWorldInverse;for(let U=0,je=C.length;U<je;U++){const Ze=C[U];if(Ze.isDirectionalLight){const Je=h.directional[R];Je.direction.setFromMatrixPosition(Ze.matrixWorld),f.setFromMatrixPosition(Ze.target.matrixWorld),Je.direction.sub(f),Je.direction.transformDirection(V),R++}else if(Ze.isSpotLight){const Je=h.spot[z];Je.position.setFromMatrixPosition(Ze.matrixWorld),Je.position.applyMatrix4(V),Je.direction.setFromMatrixPosition(Ze.matrixWorld),f.setFromMatrixPosition(Ze.target.matrixWorld),Je.direction.sub(f),Je.direction.transformDirection(V),z++}else if(Ze.isRectAreaLight){const Je=h.rectArea[pe];Je.position.setFromMatrixPosition(Ze.matrixWorld),Je.position.applyMatrix4(V),y.identity(),p.copy(Ze.matrixWorld),p.premultiply(V),y.extractRotation(p),Je.halfWidth.set(.5*Ze.width,0,0),Je.halfHeight.set(0,.5*Ze.height,0),Je.halfWidth.applyMatrix4(y),Je.halfHeight.applyMatrix4(y),pe++}else if(Ze.isPointLight){const Je=h.point[k];Je.position.setFromMatrixPosition(Ze.matrixWorld),Je.position.applyMatrix4(V),k++}else if(Ze.isHemisphereLight){const Je=h.hemi[ce];Je.direction.setFromMatrixPosition(Ze.matrixWorld),Je.direction.transformDirection(V),Je.direction.normalize(),ce++}}},state:h}}function Fu(i,t){const a=new om(i,t),l=[],h=[];return{init:function f(){l.length=0,h.length=0},state:{lightsArray:l,shadowsArray:h,lights:a},setupLights:function b(){a.setup(l)},setupLightsView:function A(M){a.setupView(l,M)},pushLight:function p(M){l.push(M)},pushShadow:function y(M){h.push(M)}}}function v0(i,t){let a=new WeakMap;return{get:function l(f,p=0){let y;return!1===a.has(f)?(y=new Fu(i,t),a.set(f,[]),a.get(f).push(y)):p>=a.get(f).length?(y=new Fu(i,t),a.get(f).push(y)):y=a.get(f)[p],y},dispose:function h(){a=new WeakMap}}}function Ho(i){dn.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(i)}function zo(i){dn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Ge,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(i)}function lm(i,t,a){let l=new El;const h=new Ct,f=new Ct,p=new Wn,y=[],b=[],A={},C={0:1,1:0,2:2},M=new jr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ct},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),R=M.clone();R.defines.HORIZONTAL_PASS=1;const k=new Ln;k.setAttribute("position",new wn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const z=new $n(k,M),pe=this;function ce(Je,Ie){const it=t.update(z);M.uniforms.shadow_pass.value=Je.map.texture,M.uniforms.resolution.value=Je.mapSize,M.uniforms.radius.value=Je.radius,i.setRenderTarget(Je.mapPass),i.clear(),i.renderBufferDirect(Ie,null,it,M,z,null),R.uniforms.shadow_pass.value=Je.mapPass.texture,R.uniforms.resolution.value=Je.mapSize,R.uniforms.radius.value=Je.radius,i.setRenderTarget(Je.map),i.clear(),i.renderBufferDirect(Ie,null,it,R,z,null)}function V(Je,Ie,it){const Gt=Je<<0|Ie<<1|it<<2;let ht=y[Gt];return void 0===ht&&(ht=new Ho({depthPacking:3201,morphTargets:Je,skinning:Ie}),y[Gt]=ht),ht}function U(Je,Ie,it){const Gt=Je<<0|Ie<<1|it<<2;let ht=b[Gt];return void 0===ht&&(ht=new zo({morphTargets:Je,skinning:Ie}),b[Gt]=ht),ht}function je(Je,Ie,it,Gt,ht,At,Lt){let Yt=null,Rt=V,qe=Je.customDepthMaterial;if(!0===Gt.isPointLight&&(Rt=U,qe=Je.customDistanceMaterial),void 0===qe){let ut=!1;!0===it.morphTargets&&(ut=Ie.morphAttributes&&Ie.morphAttributes.position&&Ie.morphAttributes.position.length>0);let xt=!1;!0===Je.isSkinnedMesh&&(!0===it.skinning?xt=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Je)),Yt=Rt(ut,xt,!0===Je.isInstancedMesh)}else Yt=qe;if(i.localClippingEnabled&&!0===it.clipShadows&&0!==it.clippingPlanes.length){const ut=Yt.uuid,xt=it.uuid;let zt=A[ut];void 0===zt&&(zt={},A[ut]=zt);let li=zt[xt];void 0===li&&(li=Yt.clone(),zt[xt]=li),Yt=li}return Yt.visible=it.visible,Yt.wireframe=it.wireframe,Yt.side=3===Lt?null!==it.shadowSide?it.shadowSide:it.side:null!==it.shadowSide?it.shadowSide:C[it.side],Yt.clipShadows=it.clipShadows,Yt.clippingPlanes=it.clippingPlanes,Yt.clipIntersection=it.clipIntersection,Yt.wireframeLinewidth=it.wireframeLinewidth,Yt.linewidth=it.linewidth,!0===Gt.isPointLight&&!0===Yt.isMeshDistanceMaterial&&(Yt.referencePosition.setFromMatrixPosition(Gt.matrixWorld),Yt.nearDistance=ht,Yt.farDistance=At),Yt}function Ze(Je,Ie,it,Gt,ht){if(!1===Je.visible)return;if(Je.layers.test(Ie.layers)&&(Je.isMesh||Je.isLine||Je.isPoints)&&(Je.castShadow||Je.receiveShadow&&3===ht)&&(!Je.frustumCulled||l.intersectsObject(Je))){Je.modelViewMatrix.multiplyMatrices(it.matrixWorldInverse,Je.matrixWorld);const Yt=t.update(Je),Rt=Je.material;if(Array.isArray(Rt)){const qe=Yt.groups;for(let ut=0,xt=qe.length;ut<xt;ut++){const zt=qe[ut],li=Rt[zt.materialIndex];if(li&&li.visible){const ri=je(Je,Yt,li,Gt,it.near,it.far,ht);i.renderBufferDirect(it,null,Yt,ri,Je,zt)}}}else if(Rt.visible){const qe=je(Je,Yt,Rt,Gt,it.near,it.far,ht);i.renderBufferDirect(it,null,Yt,qe,Je,null)}}const Lt=Je.children;for(let Yt=0,Rt=Lt.length;Yt<Rt;Yt++)Ze(Lt[Yt],Ie,it,Gt,ht)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(Je,Ie,it){if(!1===pe.enabled||!1===pe.autoUpdate&&!1===pe.needsUpdate||0===Je.length)return;const Gt=i.getRenderTarget(),ht=i.getActiveCubeFace(),At=i.getActiveMipmapLevel(),Lt=i.state;Lt.setBlending(0),Lt.buffers.color.setClear(1,1,1,1),Lt.buffers.depth.setTest(!0),Lt.setScissorTest(!1);for(let Yt=0,Rt=Je.length;Yt<Rt;Yt++){const qe=Je[Yt],ut=qe.shadow;if(void 0===ut){console.warn("THREE.WebGLShadowMap:",qe,"has no shadow.");continue}if(!1===ut.autoUpdate&&!1===ut.needsUpdate)continue;h.copy(ut.mapSize);const xt=ut.getFrameExtents();if(h.multiply(xt),f.copy(ut.mapSize),(h.x>a||h.y>a)&&(h.x>a&&(f.x=Math.floor(a/xt.x),h.x=f.x*xt.x,ut.mapSize.x=f.x),h.y>a&&(f.y=Math.floor(a/xt.y),h.y=f.y*xt.y,ut.mapSize.y=f.y)),null===ut.map&&!ut.isPointLightShadow&&3===this.type){const li={minFilter:Fi,magFilter:Fi,format:Hr};ut.map=new uu(h.x,h.y,li),ut.map.texture.name=qe.name+".shadowMap",ut.mapPass=new uu(h.x,h.y,li),ut.camera.updateProjectionMatrix()}null===ut.map&&(ut.map=new uu(h.x,h.y,{minFilter:rn,magFilter:rn,format:Hr}),ut.map.texture.name=qe.name+".shadowMap",ut.camera.updateProjectionMatrix()),i.setRenderTarget(ut.map),i.clear();const zt=ut.getViewportCount();for(let li=0;li<zt;li++){const ri=ut.getViewport(li);p.set(f.x*ri.x,f.y*ri.y,f.x*ri.z,f.y*ri.w),Lt.viewport(p),ut.updateMatrices(qe,li),l=ut.getFrustum(),Ze(Ie,it,ut.camera,qe,this.type)}!ut.isPointLightShadow&&3===this.type&&ce(ut,it),ut.needsUpdate=!1}pe.needsUpdate=!1,i.setRenderTarget(Gt,ht,At)}}function um(i,t,a){const l=a.isWebGL2,y=new function h(){let ot=!1;const pi=new Wn;let Di=null;const Gi=new Wn(0,0,0,0);return{setMask:function(Pi){Di!==Pi&&!ot&&(i.colorMask(Pi,Pi,Pi,Pi),Di=Pi)},setLocked:function(Pi){ot=Pi},setClear:function(Pi,Vi,Qi,gn,Hi){!0===Hi&&(Pi*=gn,Vi*=gn,Qi*=gn),pi.set(Pi,Vi,Qi,gn),!1===Gi.equals(pi)&&(i.clearColor(Pi,Vi,Qi,gn),Gi.copy(pi))},reset:function(){ot=!1,Di=null,Gi.set(-1,0,0,0)}}},b=new function f(){let ot=!1,pi=null,Di=null,Gi=null;return{setTest:function(Pi){Pi?di(2929):_i(2929)},setMask:function(Pi){pi!==Pi&&!ot&&(i.depthMask(Pi),pi=Pi)},setFunc:function(Pi){if(Di!==Pi){if(Pi)switch(Pi){case 0:i.depthFunc(512);break;case 1:i.depthFunc(519);break;case 2:i.depthFunc(513);break;case 3:default:i.depthFunc(515);break;case 4:i.depthFunc(514);break;case 5:i.depthFunc(518);break;case 6:i.depthFunc(516);break;case 7:i.depthFunc(517)}else i.depthFunc(515);Di=Pi}},setLocked:function(Pi){ot=Pi},setClear:function(Pi){Gi!==Pi&&(i.clearDepth(Pi),Gi=Pi)},reset:function(){ot=!1,pi=null,Di=null,Gi=null}}},A=new function p(){let ot=!1,pi=null,Di=null,Gi=null,Pi=null,Vi=null,Qi=null,gn=null,Hi=null;return{setTest:function(ln){ot||(ln?di(2960):_i(2960))},setMask:function(ln){pi!==ln&&!ot&&(i.stencilMask(ln),pi=ln)},setFunc:function(ln,In,Ir){(Di!==ln||Gi!==In||Pi!==Ir)&&(i.stencilFunc(ln,In,Ir),Di=ln,Gi=In,Pi=Ir)},setOp:function(ln,In,Ir){(Vi!==ln||Qi!==In||gn!==Ir)&&(i.stencilOp(ln,In,Ir),Vi=ln,Qi=In,gn=Ir)},setLocked:function(ln){ot=ln},setClear:function(ln){Hi!==ln&&(i.clearStencil(ln),Hi=ln)},reset:function(){ot=!1,pi=null,Di=null,Gi=null,Pi=null,Vi=null,Qi=null,gn=null,Hi=null}}};let C={},M=null,R=null,k=null,z=null,pe=null,ce=null,V=null,U=null,je=null,Ze=!1,Je=null,Ie=null,it=null,Gt=null,ht=null;const At=i.getParameter(35661);let Lt=!1,Yt=0;const Rt=i.getParameter(7938);-1!==Rt.indexOf("WebGL")?(Yt=parseFloat(/^WebGL (\d)/.exec(Rt)[1]),Lt=Yt>=1):-1!==Rt.indexOf("OpenGL ES")&&(Yt=parseFloat(/^OpenGL ES (\d)/.exec(Rt)[1]),Lt=Yt>=2);let qe=null,ut={};const xt=new Wn,zt=new Wn;function li(ot,pi,Di){const Gi=new Uint8Array(4),Pi=i.createTexture();i.bindTexture(ot,Pi),i.texParameteri(ot,10241,9728),i.texParameteri(ot,10240,9728);for(let Vi=0;Vi<Di;Vi++)i.texImage2D(pi+Vi,0,6408,1,1,0,6408,5121,Gi);return Pi}const ri={};function di(ot){!0!==C[ot]&&(i.enable(ot),C[ot]=!0)}function _i(ot){!1!==C[ot]&&(i.disable(ot),C[ot]=!1)}ri[3553]=li(3553,3553,1),ri[34067]=li(34067,34069,6),y.setClear(0,0,0,1),b.setClear(1),A.setClear(0),di(2929),b.setFunc(3),tn(!1),An(1),di(2884),Kt(0);const Ji={100:32774,101:32778,102:32779};if(l)Ji[103]=32775,Ji[104]=32776;else{const ot=t.get("EXT_blend_minmax");null!==ot&&(Ji[103]=ot.MIN_EXT,Ji[104]=ot.MAX_EXT)}const Mn={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function Kt(ot,pi,Di,Gi,Pi,Vi,Qi,gn){if(0!==ot){if(R||(di(3042),R=!0),5===ot)Pi=Pi||pi,Vi=Vi||Di,Qi=Qi||Gi,(pi!==z||Pi!==V)&&(i.blendEquationSeparate(Ji[pi],Ji[Pi]),z=pi,V=Pi),(Di!==pe||Gi!==ce||Vi!==U||Qi!==je)&&(i.blendFuncSeparate(Mn[Di],Mn[Gi],Mn[Vi],Mn[Qi]),pe=Di,ce=Gi,U=Vi,je=Qi),k=ot,Ze=null;else if(ot!==k||gn!==Ze){if((100!==z||100!==V)&&(i.blendEquation(32774),z=100,V=100),gn)switch(ot){case 1:i.blendFuncSeparate(1,771,1,771);break;case 2:i.blendFunc(1,1);break;case 3:i.blendFuncSeparate(0,0,769,771);break;case 4:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ot)}else switch(ot){case 1:i.blendFuncSeparate(770,771,1,771);break;case 2:i.blendFunc(770,1);break;case 3:i.blendFunc(0,769);break;case 4:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ot)}pe=null,ce=null,U=null,je=null,k=ot,Ze=gn}}else R&&(_i(3042),R=!1)}function tn(ot){Je!==ot&&(i.frontFace(ot?2304:2305),Je=ot)}function An(ot){0!==ot?(di(2884),ot!==Ie&&i.cullFace(1===ot?1029:2===ot?1028:1032)):_i(2884),Ie=ot}function bn(ot,pi,Di){ot?(di(32823),(Gt!==pi||ht!==Di)&&(i.polygonOffset(pi,Di),Gt=pi,ht=Di)):_i(32823)}function fi(ot){void 0===ot&&(ot=33984+At-1),qe!==ot&&(i.activeTexture(ot),qe=ot)}return{buffers:{color:y,depth:b,stencil:A},enable:di,disable:_i,useProgram:function Yi(ot){return M!==ot&&(i.useProgram(ot),M=ot,!0)},setBlending:Kt,setMaterial:function Qn(ot,pi){2===ot.side?_i(2884):di(2884);let Di=1===ot.side;pi&&(Di=!Di),tn(Di),1===ot.blending&&!1===ot.transparent?Kt(0):Kt(ot.blending,ot.blendEquation,ot.blendSrc,ot.blendDst,ot.blendEquationAlpha,ot.blendSrcAlpha,ot.blendDstAlpha,ot.premultipliedAlpha),b.setFunc(ot.depthFunc),b.setTest(ot.depthTest),b.setMask(ot.depthWrite),y.setMask(ot.colorWrite);const Gi=ot.stencilWrite;A.setTest(Gi),Gi&&(A.setMask(ot.stencilWriteMask),A.setFunc(ot.stencilFunc,ot.stencilRef,ot.stencilFuncMask),A.setOp(ot.stencilFail,ot.stencilZFail,ot.stencilZPass)),bn(ot.polygonOffset,ot.polygonOffsetFactor,ot.polygonOffsetUnits)},setFlipSided:tn,setCullFace:An,setLineWidth:function nn(ot){ot!==it&&(Lt&&i.lineWidth(ot),it=ot)},setPolygonOffset:bn,setScissorTest:function mn(ot){ot?di(3089):_i(3089)},activeTexture:fi,bindTexture:function xi(ot,pi){null===qe&&fi();let Di=ut[qe];void 0===Di&&(Di={type:void 0,texture:void 0},ut[qe]=Di),(Di.type!==ot||Di.texture!==pi)&&(i.bindTexture(ot,pi||ri[ot]),Di.type=ot,Di.texture=pi)},unbindTexture:function Si(){const ot=ut[qe];void 0!==ot&&void 0!==ot.type&&(i.bindTexture(ot.type,null),ot.type=void 0,ot.texture=void 0)},compressedTexImage2D:function Ui(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ot){console.error("THREE.WebGLState:",ot)}},texImage2D:function pt(){try{i.texImage2D.apply(i,arguments)}catch(ot){console.error("THREE.WebGLState:",ot)}},texImage3D:function Fe(){try{i.texImage3D.apply(i,arguments)}catch(ot){console.error("THREE.WebGLState:",ot)}},scissor:function Re(ot){!1===xt.equals(ot)&&(i.scissor(ot.x,ot.y,ot.z,ot.w),xt.copy(ot))},viewport:function oi(ot){!1===zt.equals(ot)&&(i.viewport(ot.x,ot.y,ot.z,ot.w),zt.copy(ot))},reset:function Wt(){C={},qe=null,ut={},M=null,R=null,k=null,z=null,pe=null,ce=null,V=null,U=null,je=null,Ze=!1,Je=null,Ie=null,it=null,Gt=null,ht=null,y.reset(),b.reset(),A.reset()}}}function ta(i,t,a,l,h,f,p){const y=h.isWebGL2,b=h.maxTextures,A=h.maxCubemapSize,C=h.maxTextureSize,M=h.maxSamples,R=new WeakMap;let k,z=!1;try{z=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function pe(Fe,Re){return z?new OffscreenCanvas(Fe,Re):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function ce(Fe,Re,oi,Wt){let ot=1;if((Fe.width>Wt||Fe.height>Wt)&&(ot=Wt/Math.max(Fe.width,Fe.height)),ot<1||!0===Re){if(typeof HTMLImageElement<"u"&&Fe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Fe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Fe instanceof ImageBitmap){const pi=Re?hn.floorPowerOfTwo:Math.floor,Di=pi(ot*Fe.width),Gi=pi(ot*Fe.height);void 0===k&&(k=pe(Di,Gi));const Pi=oi?pe(Di,Gi):k;return Pi.width=Di,Pi.height=Gi,Pi.getContext("2d").drawImage(Fe,0,0,Di,Gi),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Fe.width+"x"+Fe.height+") to ("+Di+"x"+Gi+")."),Pi}return"data"in Fe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Fe.width+"x"+Fe.height+")."),Fe}return Fe}function V(Fe){return hn.isPowerOfTwo(Fe.width)&&hn.isPowerOfTwo(Fe.height)}function je(Fe,Re){return Fe.generateMipmaps&&Re&&Fe.minFilter!==rn&&Fe.minFilter!==Fi}function Ze(Fe,Re,oi,Wt){i.generateMipmap(Fe),l.get(Re).__maxMipLevel=Math.log(Math.max(oi,Wt))*Math.LOG2E}function Je(Fe,Re,oi){if(!1===y)return Re;if(null!==Fe){if(void 0!==i[Fe])return i[Fe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Fe+"'")}let Wt=Re;return 6403===Re&&(5126===oi&&(Wt=33326),5131===oi&&(Wt=33325),5121===oi&&(Wt=33321)),6407===Re&&(5126===oi&&(Wt=34837),5131===oi&&(Wt=34843),5121===oi&&(Wt=32849)),6408===Re&&(5126===oi&&(Wt=34836),5131===oi&&(Wt=34842),5121===oi&&(Wt=32856)),(33325===Wt||33326===Wt||34842===Wt||34836===Wt)&&t.get("EXT_color_buffer_float"),Wt}function Ie(Fe){return Fe===rn||1004===Fe||1005===Fe?9728:9729}function it(Fe){const Re=Fe.target;Re.removeEventListener("dispose",it),function ht(Fe){const Re=l.get(Fe);void 0!==Re.__webglInit&&(i.deleteTexture(Re.__webglTexture),l.remove(Fe))}(Re),Re.isVideoTexture&&R.delete(Re),p.memory.textures--}function Gt(Fe){const Re=Fe.target;Re.removeEventListener("dispose",Gt),function At(Fe){const Re=l.get(Fe),oi=l.get(Fe.texture);if(Fe){if(void 0!==oi.__webglTexture&&i.deleteTexture(oi.__webglTexture),Fe.depthTexture&&Fe.depthTexture.dispose(),Fe.isWebGLCubeRenderTarget)for(let Wt=0;Wt<6;Wt++)i.deleteFramebuffer(Re.__webglFramebuffer[Wt]),Re.__webglDepthbuffer&&i.deleteRenderbuffer(Re.__webglDepthbuffer[Wt]);else i.deleteFramebuffer(Re.__webglFramebuffer),Re.__webglDepthbuffer&&i.deleteRenderbuffer(Re.__webglDepthbuffer),Re.__webglMultisampledFramebuffer&&i.deleteFramebuffer(Re.__webglMultisampledFramebuffer),Re.__webglColorRenderbuffer&&i.deleteRenderbuffer(Re.__webglColorRenderbuffer),Re.__webglDepthRenderbuffer&&i.deleteRenderbuffer(Re.__webglDepthRenderbuffer);l.remove(Fe.texture),l.remove(Fe)}}(Re),p.memory.textures--}let Lt=0;function qe(Fe,Re){const oi=l.get(Fe);if(Fe.isVideoTexture&&function fi(Fe){const Re=p.render.frame;R.get(Fe)!==Re&&(R.set(Fe,Re),Fe.update())}(Fe),Fe.version>0&&oi.__version!==Fe.version){const Wt=Fe.image;if(void 0===Wt)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==Wt.complete)return void Yi(oi,Fe,Re);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}a.activeTexture(33984+Re),a.bindTexture(3553,oi.__webglTexture)}function zt(Fe,Re){const oi=l.get(Fe);Fe.version>0&&oi.__version!==Fe.version?function Ji(Fe,Re,oi){if(6!==Re.image.length)return;_i(Fe,Re),a.activeTexture(33984+oi),a.bindTexture(34067,Fe.__webglTexture),i.pixelStorei(37440,Re.flipY),i.pixelStorei(37441,Re.premultiplyAlpha),i.pixelStorei(3317,Re.unpackAlignment);const Wt=Re&&(Re.isCompressedTexture||Re.image[0].isCompressedTexture),ot=Re.image[0]&&Re.image[0].isDataTexture,pi=[];for(let Hi=0;Hi<6;Hi++)pi[Hi]=Wt||ot?ot?Re.image[Hi].image:Re.image[Hi]:ce(Re.image[Hi],!1,!0,A);const Di=pi[0],Gi=V(Di)||y,Pi=f.convert(Re.format),Vi=f.convert(Re.type),Qi=Je(Re.internalFormat,Pi,Vi);let gn;if(di(34067,Re,Gi),Wt){for(let Hi=0;Hi<6;Hi++){gn=pi[Hi].mipmaps;for(let ln=0;ln<gn.length;ln++){const In=gn[ln];Re.format!==Hr&&Re.format!==Ca?null!==Pi?a.compressedTexImage2D(34069+Hi,ln,Qi,In.width,In.height,0,In.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):a.texImage2D(34069+Hi,ln,Qi,In.width,In.height,0,Pi,Vi,In.data)}}Fe.__maxMipLevel=gn.length-1}else{gn=Re.mipmaps;for(let Hi=0;Hi<6;Hi++)if(ot){a.texImage2D(34069+Hi,0,Qi,pi[Hi].width,pi[Hi].height,0,Pi,Vi,pi[Hi].data);for(let ln=0;ln<gn.length;ln++){const Ir=gn[ln].image[Hi].image;a.texImage2D(34069+Hi,ln+1,Qi,Ir.width,Ir.height,0,Pi,Vi,Ir.data)}}else{a.texImage2D(34069+Hi,0,Qi,Pi,Vi,pi[Hi]);for(let ln=0;ln<gn.length;ln++)a.texImage2D(34069+Hi,ln+1,Qi,Pi,Vi,gn[ln].image[Hi])}Fe.__maxMipLevel=gn.length}je(Re,Gi)&&Ze(34067,Re,Di.width,Di.height),Fe.__version=Re.version,Re.onUpdate&&Re.onUpdate(Re)}(oi,Fe,Re):(a.activeTexture(33984+Re),a.bindTexture(34067,oi.__webglTexture))}const li={1e3:10497,[kt]:33071,1002:33648},ri={[rn]:9728,1004:9984,1005:9986,[Fi]:9729,1007:9985,1008:9987};function di(Fe,Re,oi){oi?(i.texParameteri(Fe,10242,li[Re.wrapS]),i.texParameteri(Fe,10243,li[Re.wrapT]),(32879===Fe||35866===Fe)&&i.texParameteri(Fe,32882,li[Re.wrapR]),i.texParameteri(Fe,10240,ri[Re.magFilter]),i.texParameteri(Fe,10241,ri[Re.minFilter])):(i.texParameteri(Fe,10242,33071),i.texParameteri(Fe,10243,33071),(32879===Fe||35866===Fe)&&i.texParameteri(Fe,32882,33071),(Re.wrapS!==kt||Re.wrapT!==kt)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(Fe,10240,Ie(Re.magFilter)),i.texParameteri(Fe,10241,Ie(Re.minFilter)),Re.minFilter!==rn&&Re.minFilter!==Fi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const Wt=t.get("EXT_texture_filter_anisotropic");if(Wt){if(Re.type===_n&&null===t.get("OES_texture_float_linear")||1016===Re.type&&null===(y||t.get("OES_texture_half_float_linear")))return;(Re.anisotropy>1||l.get(Re).__currentAnisotropy)&&(i.texParameterf(Fe,Wt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Re.anisotropy,h.getMaxAnisotropy())),l.get(Re).__currentAnisotropy=Re.anisotropy)}}function _i(Fe,Re){void 0===Fe.__webglInit&&(Fe.__webglInit=!0,Re.addEventListener("dispose",it),Fe.__webglTexture=i.createTexture(),p.memory.textures++)}function Yi(Fe,Re,oi){let Wt=3553;Re.isDataTexture2DArray&&(Wt=35866),Re.isDataTexture3D&&(Wt=32879),_i(Fe,Re),a.activeTexture(33984+oi),a.bindTexture(Wt,Fe.__webglTexture),i.pixelStorei(37440,Re.flipY),i.pixelStorei(37441,Re.premultiplyAlpha),i.pixelStorei(3317,Re.unpackAlignment);const ot=function U(Fe){return!y&&(Fe.wrapS!==kt||Fe.wrapT!==kt||Fe.minFilter!==rn&&Fe.minFilter!==Fi)}(Re)&&!1===V(Re.image),pi=ce(Re.image,ot,!1,C),Di=V(pi)||y,Gi=f.convert(Re.format);let Qi,Pi=f.convert(Re.type),Vi=Je(Re.internalFormat,Gi,Pi);di(Wt,Re,Di);const gn=Re.mipmaps;if(Re.isDepthTexture)Vi=6402,y?Vi=Re.type===_n?36012:1014===Re.type?33190:Re.type===pa?35056:33189:Re.type===_n&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Re.format===Pa&&6402===Vi&&1012!==Re.type&&1014!==Re.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Re.type=1012,Pi=f.convert(Re.type)),Re.format===Ha&&6402===Vi&&(Vi=34041,Re.type!==pa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Re.type=pa,Pi=f.convert(Re.type))),a.texImage2D(3553,0,Vi,pi.width,pi.height,0,Gi,Pi,null);else if(Re.isDataTexture)if(gn.length>0&&Di){for(let Hi=0,ln=gn.length;Hi<ln;Hi++)Qi=gn[Hi],a.texImage2D(3553,Hi,Vi,Qi.width,Qi.height,0,Gi,Pi,Qi.data);Re.generateMipmaps=!1,Fe.__maxMipLevel=gn.length-1}else a.texImage2D(3553,0,Vi,pi.width,pi.height,0,Gi,Pi,pi.data),Fe.__maxMipLevel=0;else if(Re.isCompressedTexture){for(let Hi=0,ln=gn.length;Hi<ln;Hi++)Qi=gn[Hi],Re.format!==Hr&&Re.format!==Ca?null!==Gi?a.compressedTexImage2D(3553,Hi,Vi,Qi.width,Qi.height,0,Qi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):a.texImage2D(3553,Hi,Vi,Qi.width,Qi.height,0,Gi,Pi,Qi.data);Fe.__maxMipLevel=gn.length-1}else if(Re.isDataTexture2DArray)a.texImage3D(35866,0,Vi,pi.width,pi.height,pi.depth,0,Gi,Pi,pi.data),Fe.__maxMipLevel=0;else if(Re.isDataTexture3D)a.texImage3D(32879,0,Vi,pi.width,pi.height,pi.depth,0,Gi,Pi,pi.data),Fe.__maxMipLevel=0;else if(gn.length>0&&Di){for(let Hi=0,ln=gn.length;Hi<ln;Hi++)Qi=gn[Hi],a.texImage2D(3553,Hi,Vi,Gi,Pi,Qi);Re.generateMipmaps=!1,Fe.__maxMipLevel=gn.length-1}else a.texImage2D(3553,0,Vi,Gi,Pi,pi),Fe.__maxMipLevel=0;je(Re,Di)&&Ze(Wt,Re,pi.width,pi.height),Fe.__version=Re.version,Re.onUpdate&&Re.onUpdate(Re)}function Mn(Fe,Re,oi,Wt){const ot=f.convert(Re.texture.format),pi=f.convert(Re.texture.type),Di=Je(Re.texture.internalFormat,ot,pi);a.texImage2D(Wt,0,Di,Re.width,Re.height,0,ot,pi,null),i.bindFramebuffer(36160,Fe),i.framebufferTexture2D(36160,oi,Wt,l.get(Re.texture).__webglTexture,0),i.bindFramebuffer(36160,null)}function Kt(Fe,Re,oi){if(i.bindRenderbuffer(36161,Fe),Re.depthBuffer&&!Re.stencilBuffer){let Wt=33189;if(oi){const ot=Re.depthTexture;ot&&ot.isDepthTexture&&(ot.type===_n?Wt=36012:1014===ot.type&&(Wt=33190));const pi=mn(Re);i.renderbufferStorageMultisample(36161,pi,Wt,Re.width,Re.height)}else i.renderbufferStorage(36161,Wt,Re.width,Re.height);i.framebufferRenderbuffer(36160,36096,36161,Fe)}else if(Re.depthBuffer&&Re.stencilBuffer){if(oi){const Wt=mn(Re);i.renderbufferStorageMultisample(36161,Wt,35056,Re.width,Re.height)}else i.renderbufferStorage(36161,34041,Re.width,Re.height);i.framebufferRenderbuffer(36160,33306,36161,Fe)}else{const Wt=f.convert(Re.texture.format),ot=f.convert(Re.texture.type),pi=Je(Re.texture.internalFormat,Wt,ot);if(oi){const Di=mn(Re);i.renderbufferStorageMultisample(36161,Di,pi,Re.width,Re.height)}else i.renderbufferStorage(36161,pi,Re.width,Re.height)}i.bindRenderbuffer(36161,null)}function mn(Fe){return y&&Fe.isWebGLMultisampleRenderTarget?Math.min(M,Fe.samples):0}let xi=!1,Si=!1;this.allocateTextureUnit=function Rt(){const Fe=Lt;return Fe>=b&&console.warn("THREE.WebGLTextures: Trying to use "+Fe+" texture units while this GPU supports only "+b),Lt+=1,Fe},this.resetTextureUnits=function Yt(){Lt=0},this.setTexture2D=qe,this.setTexture2DArray=function ut(Fe,Re){const oi=l.get(Fe);Fe.version>0&&oi.__version!==Fe.version?Yi(oi,Fe,Re):(a.activeTexture(33984+Re),a.bindTexture(35866,oi.__webglTexture))},this.setTexture3D=function xt(Fe,Re){const oi=l.get(Fe);Fe.version>0&&oi.__version!==Fe.version?Yi(oi,Fe,Re):(a.activeTexture(33984+Re),a.bindTexture(32879,oi.__webglTexture))},this.setTextureCube=zt,this.setupRenderTarget=function An(Fe){const Re=l.get(Fe),oi=l.get(Fe.texture);Fe.addEventListener("dispose",Gt),oi.__webglTexture=i.createTexture(),p.memory.textures++;const Wt=!0===Fe.isWebGLCubeRenderTarget,ot=!0===Fe.isWebGLMultisampleRenderTarget,pi=V(Fe)||y;if(y&&Fe.texture.format===Ca&&(Fe.texture.type===_n||1016===Fe.texture.type)&&(Fe.texture.format=Hr,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Wt){Re.__webglFramebuffer=[];for(let Di=0;Di<6;Di++)Re.__webglFramebuffer[Di]=i.createFramebuffer()}else if(Re.__webglFramebuffer=i.createFramebuffer(),ot)if(y){Re.__webglMultisampledFramebuffer=i.createFramebuffer(),Re.__webglColorRenderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,Re.__webglColorRenderbuffer);const Di=f.convert(Fe.texture.format),Gi=f.convert(Fe.texture.type),Pi=Je(Fe.texture.internalFormat,Di,Gi),Vi=mn(Fe);i.renderbufferStorageMultisample(36161,Vi,Pi,Fe.width,Fe.height),i.bindFramebuffer(36160,Re.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064,36161,Re.__webglColorRenderbuffer),i.bindRenderbuffer(36161,null),Fe.depthBuffer&&(Re.__webglDepthRenderbuffer=i.createRenderbuffer(),Kt(Re.__webglDepthRenderbuffer,Fe,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Wt){a.bindTexture(34067,oi.__webglTexture),di(34067,Fe.texture,pi);for(let Di=0;Di<6;Di++)Mn(Re.__webglFramebuffer[Di],Fe,36064,34069+Di);je(Fe.texture,pi)&&Ze(34067,Fe.texture,Fe.width,Fe.height),a.bindTexture(34067,null)}else a.bindTexture(3553,oi.__webglTexture),di(3553,Fe.texture,pi),Mn(Re.__webglFramebuffer,Fe,36064,3553),je(Fe.texture,pi)&&Ze(3553,Fe.texture,Fe.width,Fe.height),a.bindTexture(3553,null);Fe.depthBuffer&&function tn(Fe){const Re=l.get(Fe),oi=!0===Fe.isWebGLCubeRenderTarget;if(Fe.depthTexture){if(oi)throw new Error("target.depthTexture not supported in Cube render targets");!function Qn(Fe,Re){if(Re&&Re.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,Fe),!Re.depthTexture||!Re.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!l.get(Re.depthTexture).__webglTexture||Re.depthTexture.image.width!==Re.width||Re.depthTexture.image.height!==Re.height)&&(Re.depthTexture.image.width=Re.width,Re.depthTexture.image.height=Re.height,Re.depthTexture.needsUpdate=!0),qe(Re.depthTexture,0);const Wt=l.get(Re.depthTexture).__webglTexture;if(Re.depthTexture.format===Pa)i.framebufferTexture2D(36160,36096,3553,Wt,0);else{if(Re.depthTexture.format!==Ha)throw new Error("Unknown depthTexture format");i.framebufferTexture2D(36160,33306,3553,Wt,0)}}(Re.__webglFramebuffer,Fe)}else if(oi){Re.__webglDepthbuffer=[];for(let Wt=0;Wt<6;Wt++)i.bindFramebuffer(36160,Re.__webglFramebuffer[Wt]),Re.__webglDepthbuffer[Wt]=i.createRenderbuffer(),Kt(Re.__webglDepthbuffer[Wt],Fe,!1)}else i.bindFramebuffer(36160,Re.__webglFramebuffer),Re.__webglDepthbuffer=i.createRenderbuffer(),Kt(Re.__webglDepthbuffer,Fe,!1);i.bindFramebuffer(36160,null)}(Fe)},this.updateRenderTargetMipmap=function nn(Fe){const Re=Fe.texture;if(je(Re,V(Fe)||y)){const Wt=Fe.isWebGLCubeRenderTarget?34067:3553,ot=l.get(Re).__webglTexture;a.bindTexture(Wt,ot),Ze(Wt,Re,Fe.width,Fe.height),a.bindTexture(Wt,null)}},this.updateMultisampleRenderTarget=function bn(Fe){if(Fe.isWebGLMultisampleRenderTarget)if(y){const Re=l.get(Fe);i.bindFramebuffer(36008,Re.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Re.__webglFramebuffer);const oi=Fe.width,Wt=Fe.height;let ot=16384;Fe.depthBuffer&&(ot|=256),Fe.stencilBuffer&&(ot|=1024),i.blitFramebuffer(0,0,oi,Wt,0,0,oi,Wt,ot,9728),i.bindFramebuffer(36160,Re.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function Ui(Fe,Re){Fe&&Fe.isWebGLRenderTarget&&(!1===xi&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),xi=!0),Fe=Fe.texture),qe(Fe,Re)},this.safeSetTextureCube=function pt(Fe,Re){Fe&&Fe.isWebGLCubeRenderTarget&&(!1===Si&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Si=!0),Fe=Fe.texture),zt(Fe,Re)}}function cm(i,t,a){const l=a.isWebGL2;return{convert:function h(f){let p;if(1009===f)return 5121;if(1017===f)return 32819;if(1018===f)return 32820;if(1019===f)return 33635;if(1010===f)return 5120;if(1011===f)return 5122;if(1012===f)return 5123;if(1013===f)return 5124;if(1014===f)return 5125;if(f===_n)return 5126;if(1016===f)return l?5131:(p=t.get("OES_texture_half_float"),null!==p?p.HALF_FLOAT_OES:null);if(1021===f)return 6406;if(f===Ca)return 6407;if(f===Hr)return 6408;if(1024===f)return 6409;if(1025===f)return 6410;if(f===Pa)return 6402;if(f===Ha)return 34041;if(1028===f)return 6403;if(1029===f)return 36244;if(1030===f)return 33319;if(1031===f)return 33320;if(1032===f)return 36248;if(1033===f)return 36249;if(33776===f||33777===f||33778===f||33779===f){if(p=t.get("WEBGL_compressed_texture_s3tc"),null===p)return null;if(33776===f)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===f)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===f)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===f)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===f||35841===f||35842===f||35843===f){if(p=t.get("WEBGL_compressed_texture_pvrtc"),null===p)return null;if(35840===f)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===f)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===f)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===f)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===f)return p=t.get("WEBGL_compressed_texture_etc1"),null!==p?p.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===f||37496===f)&&(p=t.get("WEBGL_compressed_texture_etc"),null!==p)){if(37492===f)return p.COMPRESSED_RGB8_ETC2;if(37496===f)return p.COMPRESSED_RGBA8_ETC2_EAC}return 37808===f||37809===f||37810===f||37811===f||37812===f||37813===f||37814===f||37815===f||37816===f||37817===f||37818===f||37819===f||37820===f||37821===f||37840===f||37841===f||37842===f||37843===f||37844===f||37845===f||37846===f||37847===f||37848===f||37849===f||37850===f||37851===f||37852===f||37853===f?(p=t.get("WEBGL_compressed_texture_astc"),null!==p?f:null):36492===f?(p=t.get("EXT_texture_compression_bptc"),null!==p?f:null):f===pa?l?34042:(p=t.get("WEBGL_depth_texture"),null!==p?p.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function zd(i=[]){ur.call(this),this.cameras=i}function Us(){on.call(this),this.type="Group"}function kl(){this._targetRay=null,this._grip=null,this._hand=null}function hm(i,t){const a=this;let l=null,h=1,f=null,p="local-floor",y=null;const b=[],A=new Map,C=new ur;C.layers.enable(1),C.viewport=new Wn;const M=new ur;M.layers.enable(2),M.viewport=new Wn;const R=[C,M],k=new zd;k.layers.enable(1),k.layers.enable(2);let z=null,pe=null;function ce(At){const Lt=A.get(At.inputSource);Lt&&Lt.dispatchEvent({type:At.type,data:At.inputSource})}function V(){A.forEach(function(At,Lt){At.disconnect(Lt)}),A.clear(),z=null,pe=null,i.setFramebuffer(null),i.setRenderTarget(i.getRenderTarget()),ht.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function U(At){const Lt=l.inputSources;for(let Yt=0;Yt<b.length;Yt++)A.set(Lt[Yt],b[Yt]);for(let Yt=0;Yt<At.removed.length;Yt++){const Rt=At.removed[Yt],qe=A.get(Rt);qe&&(qe.dispatchEvent({type:"disconnected",data:Rt}),A.delete(Rt))}for(let Yt=0;Yt<At.added.length;Yt++){const Rt=At.added[Yt],qe=A.get(Rt);qe&&qe.dispatchEvent({type:"connected",data:Rt})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(At){let Lt=b[At];return void 0===Lt&&(Lt=new kl,b[At]=Lt),Lt.getTargetRaySpace()},this.getControllerGrip=function(At){let Lt=b[At];return void 0===Lt&&(Lt=new kl,b[At]=Lt),Lt.getGripSpace()},this.getHand=function(At){let Lt=b[At];return void 0===Lt&&(Lt=new kl,b[At]=Lt),Lt.getHandSpace()},this.setFramebufferScaleFactor=function(At){h=At,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(At){p=At,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return f},this.getSession=function(){return l},this.setSession=async function(At){if(l=At,null!==l){l.addEventListener("select",ce),l.addEventListener("selectstart",ce),l.addEventListener("selectend",ce),l.addEventListener("squeeze",ce),l.addEventListener("squeezestart",ce),l.addEventListener("squeezeend",ce),l.addEventListener("end",V),l.addEventListener("inputsourceschange",U);const Lt=t.getContextAttributes();!0!==Lt.xrCompatible&&await t.makeXRCompatible();const Rt=new XRWebGLLayer(l,t,{antialias:Lt.antialias,alpha:Lt.alpha,depth:Lt.depth,stencil:Lt.stencil,framebufferScaleFactor:h});l.updateRenderState({baseLayer:Rt}),f=await l.requestReferenceSpace(p),ht.setContext(l),ht.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"})}};const je=new Ge,Ze=new Ge;function Ie(At,Lt){null===Lt?At.matrixWorld.copy(At.matrix):At.matrixWorld.multiplyMatrices(Lt.matrixWorld,At.matrix),At.matrixWorldInverse.copy(At.matrixWorld).invert()}this.getCamera=function(At){k.near=M.near=C.near=At.near,k.far=M.far=C.far=At.far,(z!==k.near||pe!==k.far)&&(l.updateRenderState({depthNear:k.near,depthFar:k.far}),z=k.near,pe=k.far);const Lt=At.parent,Yt=k.cameras;Ie(k,Lt);for(let qe=0;qe<Yt.length;qe++)Ie(Yt[qe],Lt);At.matrixWorld.copy(k.matrixWorld),At.matrix.copy(k.matrix),At.matrix.decompose(At.position,At.quaternion,At.scale);const Rt=At.children;for(let qe=0,ut=Rt.length;qe<ut;qe++)Rt[qe].updateMatrixWorld(!0);return 2===Yt.length?function Je(At,Lt,Yt){je.setFromMatrixPosition(Lt.matrixWorld),Ze.setFromMatrixPosition(Yt.matrixWorld);const Rt=je.distanceTo(Ze),qe=Lt.projectionMatrix.elements,ut=Yt.projectionMatrix.elements,xt=qe[14]/(qe[10]-1),zt=qe[14]/(qe[10]+1),li=(qe[9]+1)/qe[5],ri=(qe[9]-1)/qe[5],di=(qe[8]-1)/qe[0],_i=(ut[8]+1)/ut[0],Yi=xt*di,Ji=xt*_i,Mn=Rt/(-di+_i),Kt=Mn*-di;Lt.matrixWorld.decompose(At.position,At.quaternion,At.scale),At.translateX(Kt),At.translateZ(Mn),At.matrixWorld.compose(At.position,At.quaternion,At.scale),At.matrixWorldInverse.copy(At.matrixWorld).invert();const Qn=xt+Mn,tn=zt+Mn;At.projectionMatrix.makePerspective(Yi-Kt,Ji+(Rt-Kt),li*zt/tn*Qn,ri*zt/tn*Qn,Qn,tn)}(k,C,M):k.projectionMatrix.copy(C.projectionMatrix),k};let it=null;const ht=new Oc;ht.setAnimationLoop(function Gt(At,Lt){if(y=Lt.getViewerPose(f),null!==y){const Rt=y.views,qe=l.renderState.baseLayer;i.setFramebuffer(qe.framebuffer);let ut=!1;Rt.length!==k.cameras.length&&(k.cameras.length=0,ut=!0);for(let xt=0;xt<Rt.length;xt++){const zt=Rt[xt],li=qe.getViewport(zt),ri=R[xt];ri.matrix.fromArray(zt.transform.matrix),ri.projectionMatrix.fromArray(zt.projectionMatrix),ri.viewport.set(li.x,li.y,li.width,li.height),0===xt&&k.matrix.copy(ri.matrix),!0===ut&&k.cameras.push(ri)}}const Yt=l.inputSources;for(let Rt=0;Rt<b.length;Rt++)b[Rt].update(Yt[Rt],Lt,f);it&&it(At,Lt)}),this.setAnimationLoop=function(At){it=At},this.dispose=function(){}}function Vd(i){function l(V,U){V.opacity.value=U.opacity,U.color&&V.diffuse.value.copy(U.color),U.emissive&&V.emissive.value.copy(U.emissive).multiplyScalar(U.emissiveIntensity),U.map&&(V.map.value=U.map),U.alphaMap&&(V.alphaMap.value=U.alphaMap),U.specularMap&&(V.specularMap.value=U.specularMap);const je=i.get(U).envMap;if(je){V.envMap.value=je,V.flipEnvMap.value=je.isCubeTexture&&je._needsFlipEnvMap?-1:1,V.reflectivity.value=U.reflectivity,V.refractionRatio.value=U.refractionRatio;const Ie=i.get(je).__maxMipLevel;void 0!==Ie&&(V.maxMipLevel.value=Ie)}let Ze,Je;U.lightMap&&(V.lightMap.value=U.lightMap,V.lightMapIntensity.value=U.lightMapIntensity),U.aoMap&&(V.aoMap.value=U.aoMap,V.aoMapIntensity.value=U.aoMapIntensity),U.map?Ze=U.map:U.specularMap?Ze=U.specularMap:U.displacementMap?Ze=U.displacementMap:U.normalMap?Ze=U.normalMap:U.bumpMap?Ze=U.bumpMap:U.roughnessMap?Ze=U.roughnessMap:U.metalnessMap?Ze=U.metalnessMap:U.alphaMap?Ze=U.alphaMap:U.emissiveMap?Ze=U.emissiveMap:U.clearcoatMap?Ze=U.clearcoatMap:U.clearcoatNormalMap?Ze=U.clearcoatNormalMap:U.clearcoatRoughnessMap&&(Ze=U.clearcoatRoughnessMap),void 0!==Ze&&(Ze.isWebGLRenderTarget&&(Ze=Ze.texture),!0===Ze.matrixAutoUpdate&&Ze.updateMatrix(),V.uvTransform.value.copy(Ze.matrix)),U.aoMap?Je=U.aoMap:U.lightMap&&(Je=U.lightMap),void 0!==Je&&(Je.isWebGLRenderTarget&&(Je=Je.texture),!0===Je.matrixAutoUpdate&&Je.updateMatrix(),V.uv2Transform.value.copy(Je.matrix))}function M(V,U){V.roughness.value=U.roughness,V.metalness.value=U.metalness,U.roughnessMap&&(V.roughnessMap.value=U.roughnessMap),U.metalnessMap&&(V.metalnessMap.value=U.metalnessMap),U.emissiveMap&&(V.emissiveMap.value=U.emissiveMap),U.bumpMap&&(V.bumpMap.value=U.bumpMap,V.bumpScale.value=U.bumpScale,1===U.side&&(V.bumpScale.value*=-1)),U.normalMap&&(V.normalMap.value=U.normalMap,V.normalScale.value.copy(U.normalScale),1===U.side&&V.normalScale.value.negate()),U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias),i.get(U).envMap&&(V.envMapIntensity.value=U.envMapIntensity)}return{refreshFogUniforms:function t(V,U){V.fogColor.value.copy(U.color),U.isFog?(V.fogNear.value=U.near,V.fogFar.value=U.far):U.isFogExp2&&(V.fogDensity.value=U.density)},refreshMaterialUniforms:function a(V,U,je,Ze){U.isMeshBasicMaterial?l(V,U):U.isMeshLambertMaterial?(l(V,U),function b(V,U){U.emissiveMap&&(V.emissiveMap.value=U.emissiveMap)}(V,U)):U.isMeshToonMaterial?(l(V,U),function C(V,U){U.gradientMap&&(V.gradientMap.value=U.gradientMap),U.emissiveMap&&(V.emissiveMap.value=U.emissiveMap),U.bumpMap&&(V.bumpMap.value=U.bumpMap,V.bumpScale.value=U.bumpScale,1===U.side&&(V.bumpScale.value*=-1)),U.normalMap&&(V.normalMap.value=U.normalMap,V.normalScale.value.copy(U.normalScale),1===U.side&&V.normalScale.value.negate()),U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias)}(V,U)):U.isMeshPhongMaterial?(l(V,U),function A(V,U){V.specular.value.copy(U.specular),V.shininess.value=Math.max(U.shininess,1e-4),U.emissiveMap&&(V.emissiveMap.value=U.emissiveMap),U.bumpMap&&(V.bumpMap.value=U.bumpMap,V.bumpScale.value=U.bumpScale,1===U.side&&(V.bumpScale.value*=-1)),U.normalMap&&(V.normalMap.value=U.normalMap,V.normalScale.value.copy(U.normalScale),1===U.side&&V.normalScale.value.negate()),U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias)}(V,U)):U.isMeshStandardMaterial?(l(V,U),U.isMeshPhysicalMaterial?function R(V,U){M(V,U),V.reflectivity.value=U.reflectivity,V.clearcoat.value=U.clearcoat,V.clearcoatRoughness.value=U.clearcoatRoughness,U.sheen&&V.sheen.value.copy(U.sheen),U.clearcoatMap&&(V.clearcoatMap.value=U.clearcoatMap),U.clearcoatRoughnessMap&&(V.clearcoatRoughnessMap.value=U.clearcoatRoughnessMap),U.clearcoatNormalMap&&(V.clearcoatNormalScale.value.copy(U.clearcoatNormalScale),V.clearcoatNormalMap.value=U.clearcoatNormalMap,1===U.side&&V.clearcoatNormalScale.value.negate()),V.transmission.value=U.transmission,U.transmissionMap&&(V.transmissionMap.value=U.transmissionMap)}(V,U):M(V,U)):U.isMeshMatcapMaterial?(l(V,U),function k(V,U){U.matcap&&(V.matcap.value=U.matcap),U.bumpMap&&(V.bumpMap.value=U.bumpMap,V.bumpScale.value=U.bumpScale,1===U.side&&(V.bumpScale.value*=-1)),U.normalMap&&(V.normalMap.value=U.normalMap,V.normalScale.value.copy(U.normalScale),1===U.side&&V.normalScale.value.negate()),U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias)}(V,U)):U.isMeshDepthMaterial?(l(V,U),function z(V,U){U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias)}(V,U)):U.isMeshDistanceMaterial?(l(V,U),function pe(V,U){U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias),V.referencePosition.value.copy(U.referencePosition),V.nearDistance.value=U.nearDistance,V.farDistance.value=U.farDistance}(V,U)):U.isMeshNormalMaterial?(l(V,U),function ce(V,U){U.bumpMap&&(V.bumpMap.value=U.bumpMap,V.bumpScale.value=U.bumpScale,1===U.side&&(V.bumpScale.value*=-1)),U.normalMap&&(V.normalMap.value=U.normalMap,V.normalScale.value.copy(U.normalScale),1===U.side&&V.normalScale.value.negate()),U.displacementMap&&(V.displacementMap.value=U.displacementMap,V.displacementScale.value=U.displacementScale,V.displacementBias.value=U.displacementBias)}(V,U)):U.isLineBasicMaterial?(function h(V,U){V.diffuse.value.copy(U.color),V.opacity.value=U.opacity}(V,U),U.isLineDashedMaterial&&function f(V,U){V.dashSize.value=U.dashSize,V.totalSize.value=U.dashSize+U.gapSize,V.scale.value=U.scale}(V,U)):U.isPointsMaterial?function p(V,U,je,Ze){let Je;V.diffuse.value.copy(U.color),V.opacity.value=U.opacity,V.size.value=U.size*je,V.scale.value=.5*Ze,U.map&&(V.map.value=U.map),U.alphaMap&&(V.alphaMap.value=U.alphaMap),U.map?Je=U.map:U.alphaMap&&(Je=U.alphaMap),void 0!==Je&&(!0===Je.matrixAutoUpdate&&Je.updateMatrix(),V.uvTransform.value.copy(Je.matrix))}(V,U,je,Ze):U.isSpriteMaterial?function y(V,U){let je;V.diffuse.value.copy(U.color),V.opacity.value=U.opacity,V.rotation.value=U.rotation,U.map&&(V.map.value=U.map),U.alphaMap&&(V.alphaMap.value=U.alphaMap),U.map?je=U.map:U.alphaMap&&(je=U.alphaMap),void 0!==je&&(!0===je.matrixAutoUpdate&&je.updateMatrix(),V.uvTransform.value.copy(je.matrix))}(V,U):U.isShadowMaterial?(V.color.value.copy(U.color),V.opacity.value=U.opacity):U.isShaderMaterial&&(U.uniformsNeedUpdate=!1)}}}function ps(i){const t=void 0!==(i=i||{}).canvas?i.canvas:function _0(){const i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.style.display="block",i}(),a=void 0!==i.context?i.context:null,l=void 0!==i.alpha&&i.alpha,h=void 0===i.depth||i.depth,f=void 0===i.stencil||i.stencil,p=void 0!==i.antialias&&i.antialias,y=void 0===i.premultipliedAlpha||i.premultipliedAlpha,b=void 0!==i.preserveDrawingBuffer&&i.preserveDrawingBuffer,A=void 0!==i.powerPreference?i.powerPreference:"default",C=void 0!==i.failIfMajorPerformanceCaveat&&i.failIfMajorPerformanceCaveat;let M=null,R=null;const k=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=_o,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const z=this;let pe=!1,ce=null,V=0,U=0,je=null,Ze=null,Je=-1,Ie=null;const it=new Wn,Gt=new Wn;let ht=null,At=t.width,Lt=t.height,Yt=1,Rt=null,qe=null;const ut=new Wn(0,0,At,Lt),xt=new Wn(0,0,At,Lt);let zt=!1;const li=new El;let ri=!1,di=!1;const _i=new xn,Yi=new Ge,Ji={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Mn(){return null===je?Yt:1}let tn,An,nn,bn,mn,fi,xi,Si,Ui,pt,Fe,Re,oi,Wt,ot,pi,Di,Gi,Pi,Vi,Qi,Kt=a;function Qn(ke,Xt){for(let Dt=0;Dt<ke.length;Dt++){const Ei=t.getContext(ke[Dt],Xt);if(null!==Ei)return Ei}return null}try{const ke={alpha:l,depth:h,stencil:f,antialias:p,premultipliedAlpha:y,preserveDrawingBuffer:b,powerPreference:A,failIfMajorPerformanceCaveat:C};if(t.addEventListener("webglcontextlost",In,!1),t.addEventListener("webglcontextrestored",Ir,!1),null===Kt){const Xt=["webgl2","webgl","experimental-webgl"];if(!0===z.isWebGL1Renderer&&Xt.shift(),Kt=Qn(Xt,ke),null===Kt)throw Qn(Xt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Kt.getShaderPrecisionFormat&&(Kt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ke){throw console.error("THREE.WebGLRenderer: "+ke.message),ke}function gn(){tn=new Lp(Kt),An=new Ll(Kt,tn,i),tn.init(An),Vi=new cm(Kt,tn,An),nn=new um(Kt,tn,An),nn.scissor(Gt.copy(xt).multiplyScalar(Yt).floor()),nn.viewport(it.copy(ut).multiplyScalar(Yt).floor()),bn=new Rp(Kt),mn=new f0,fi=new ta(Kt,tn,nn,mn,An,Vi,bn),xi=new Pp(z),Si=new sd(Kt,An),Qi=new ha(Kt,tn,Si,An),Ui=new $g(Kt,Si,bn,Qi),pt=new Jg(Kt,Ui,Si,bn),Di=new Ns(Kt),ot=new Xc(mn),Fe=new nm(z,xi,tn,An,Qi,ot),Re=new Vd(mn),oi=new sm(mn),Wt=new v0(tn,An),pi=new ca(z,xi,nn,pt,y),Gi=new Ya(Kt,tn,bn,An),Pi=new Ip(Kt,tn,bn,An),bn.programs=Fe.programs,z.capabilities=An,z.extensions=tn,z.properties=mn,z.renderLists=oi,z.state=nn,z.info=bn}gn();const Hi=new hm(z,Kt);this.xr=Hi;const ln=new lm(z,pt,An.maxTextureSize);function In(ke){ke.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),pe=!0}function Ir(){console.log("THREE.WebGLRenderer: Context Restored."),pe=!1,gn()}function is(ke){const Xt=ke.target;Xt.removeEventListener("dispose",is),function eu(ke){Aa(ke),mn.remove(ke)}(Xt)}function Aa(ke){const Xt=mn.get(ke).program;void 0!==Xt&&Fe.releaseProgram(Xt)}this.shadowMap=ln,this.getContext=function(){return Kt},this.getContextAttributes=function(){return Kt.getContextAttributes()},this.forceContextLoss=function(){const ke=tn.get("WEBGL_lose_context");ke&&ke.loseContext()},this.forceContextRestore=function(){const ke=tn.get("WEBGL_lose_context");ke&&ke.restoreContext()},this.getPixelRatio=function(){return Yt},this.setPixelRatio=function(ke){void 0!==ke&&(Yt=ke,this.setSize(At,Lt,!1))},this.getSize=function(ke){return void 0===ke&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),ke=new Ct),ke.set(At,Lt)},this.setSize=function(ke,Xt,Dt){Hi.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(At=ke,Lt=Xt,t.width=Math.floor(ke*Yt),t.height=Math.floor(Xt*Yt),!1!==Dt&&(t.style.width=ke+"px",t.style.height=Xt+"px"),this.setViewport(0,0,ke,Xt))},this.getDrawingBufferSize=function(ke){return void 0===ke&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),ke=new Ct),ke.set(At*Yt,Lt*Yt).floor()},this.setDrawingBufferSize=function(ke,Xt,Dt){At=ke,Lt=Xt,Yt=Dt,t.width=Math.floor(ke*Dt),t.height=Math.floor(Xt*Dt),this.setViewport(0,0,ke,Xt)},this.getCurrentViewport=function(ke){return void 0===ke&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),ke=new Wn),ke.copy(it)},this.getViewport=function(ke){return ke.copy(ut)},this.setViewport=function(ke,Xt,Dt,ii){ke.isVector4?ut.set(ke.x,ke.y,ke.z,ke.w):ut.set(ke,Xt,Dt,ii),nn.viewport(it.copy(ut).multiplyScalar(Yt).floor())},this.getScissor=function(ke){return ke.copy(xt)},this.setScissor=function(ke,Xt,Dt,ii){ke.isVector4?xt.set(ke.x,ke.y,ke.z,ke.w):xt.set(ke,Xt,Dt,ii),nn.scissor(Gt.copy(xt).multiplyScalar(Yt).floor())},this.getScissorTest=function(){return zt},this.setScissorTest=function(ke){nn.setScissorTest(zt=ke)},this.setOpaqueSort=function(ke){Rt=ke},this.setTransparentSort=function(ke){qe=ke},this.getClearColor=function(ke){return void 0===ke&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),ke=new $i),ke.copy(pi.getClearColor())},this.setClearColor=function(){pi.setClearColor.apply(pi,arguments)},this.getClearAlpha=function(){return pi.getClearAlpha()},this.setClearAlpha=function(){pi.setClearAlpha.apply(pi,arguments)},this.clear=function(ke,Xt,Dt){let ii=0;(void 0===ke||ke)&&(ii|=16384),(void 0===Xt||Xt)&&(ii|=256),(void 0===Dt||Dt)&&(ii|=1024),Kt.clear(ii)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",In,!1),t.removeEventListener("webglcontextrestored",Ir,!1),oi.dispose(),Wt.dispose(),mn.dispose(),xi.dispose(),pt.dispose(),Qi.dispose(),Hi.dispose(),bs.stop()},this.renderBufferImmediate=function(ke,Xt){Qi.initAttributes();const Dt=mn.get(ke);ke.hasPositions&&!Dt.position&&(Dt.position=Kt.createBuffer()),ke.hasNormals&&!Dt.normal&&(Dt.normal=Kt.createBuffer()),ke.hasUvs&&!Dt.uv&&(Dt.uv=Kt.createBuffer()),ke.hasColors&&!Dt.color&&(Dt.color=Kt.createBuffer());const ii=Xt.getAttributes();ke.hasPositions&&(Kt.bindBuffer(34962,Dt.position),Kt.bufferData(34962,ke.positionArray,35048),Qi.enableAttribute(ii.position),Kt.vertexAttribPointer(ii.position,3,5126,!1,0,0)),ke.hasNormals&&(Kt.bindBuffer(34962,Dt.normal),Kt.bufferData(34962,ke.normalArray,35048),Qi.enableAttribute(ii.normal),Kt.vertexAttribPointer(ii.normal,3,5126,!1,0,0)),ke.hasUvs&&(Kt.bindBuffer(34962,Dt.uv),Kt.bufferData(34962,ke.uvArray,35048),Qi.enableAttribute(ii.uv),Kt.vertexAttribPointer(ii.uv,2,5126,!1,0,0)),ke.hasColors&&(Kt.bindBuffer(34962,Dt.color),Kt.bufferData(34962,ke.colorArray,35048),Qi.enableAttribute(ii.color),Kt.vertexAttribPointer(ii.color,3,5126,!1,0,0)),Qi.disableUnusedAttributes(),Kt.drawArrays(4,0,ke.count),ke.count=0},this.renderBufferDirect=function(ke,Xt,Dt,ii,Ei,yn){null===Xt&&(Xt=Ji);const Tn=Ei.isMesh&&Ei.matrixWorld.determinant()<0,c=iu(ke,Xt,ii,Ei);nn.setMaterial(ii,Tn);let n=Dt.index;const r=Dt.attributes.position;if(null===n){if(void 0===r||0===r.count)return}else if(0===n.count)return;let o=1;!0===ii.wireframe&&(n=Ui.getWireframeAttribute(Dt),o=2),(ii.morphTargets||ii.morphNormals)&&Di.update(Ei,Dt,ii,c),Qi.setup(Ei,ii,c,Dt,n);let e,s=Gi;null!==n&&(e=Si.get(n),s=Pi,s.setIndex(e));const u=null!==n?n.count:r.count,d=Dt.drawRange.start*o,m=Dt.drawRange.count*o,g=null!==yn?yn.start*o:0,T=null!==yn?yn.count*o:1/0,L=Math.max(d,g),P=Math.min(u,d+m,g+T)-1,q=Math.max(0,P-L+1);if(0!==q){if(Ei.isMesh)!0===ii.wireframe?(nn.setLineWidth(ii.wireframeLinewidth*Mn()),s.setMode(1)):s.setMode(4);else if(Ei.isLine){let le=ii.linewidth;void 0===le&&(le=1),nn.setLineWidth(le*Mn()),s.setMode(Ei.isLineSegments?1:Ei.isLineLoop?2:3)}else Ei.isPoints?s.setMode(0):Ei.isSprite&&s.setMode(4);if(Ei.isInstancedMesh)s.renderInstances(L,q,Ei.count);else if(Dt.isInstancedBufferGeometry){const le=Math.min(Dt.instanceCount,Dt._maxInstanceCount);s.renderInstances(L,q,le)}else s.render(L,q)}},this.compile=function(ke,Xt){R=Wt.get(ke),R.init(),ke.traverseVisible(function(ii){ii.isLight&&ii.layers.test(Xt.layers)&&(R.pushLight(ii),ii.castShadow&&R.pushShadow(ii))}),R.setupLights();const Dt=new WeakMap;ke.traverse(function(ii){const Ei=ii.material;if(Ei)if(Array.isArray(Ei))for(let yn=0;yn<Ei.length;yn++){const Tn=Ei[yn];!1===Dt.has(Tn)&&(Bn(Tn,ke,ii),Dt.set(Tn))}else!1===Dt.has(Ei)&&(Bn(Ei,ke,ii),Dt.set(Ei))})};let Kn=null;const bs=new Oc;function uc(ke,Xt,Dt,ii){if(!1===ke.visible)return;if(ke.layers.test(Xt.layers))if(ke.isGroup)Dt=ke.renderOrder;else if(ke.isLOD)!0===ke.autoUpdate&&ke.update(Xt);else if(ke.isLight)R.pushLight(ke),ke.castShadow&&R.pushShadow(ke);else if(ke.isSprite){if(!ke.frustumCulled||li.intersectsSprite(ke)){ii&&Yi.setFromMatrixPosition(ke.matrixWorld).applyMatrix4(_i);const Tn=pt.update(ke),c=ke.material;c.visible&&M.push(ke,Tn,c,Dt,Yi.z,null)}}else if(ke.isImmediateRenderObject)ii&&Yi.setFromMatrixPosition(ke.matrixWorld).applyMatrix4(_i),M.push(ke,null,ke.material,Dt,Yi.z,null);else if((ke.isMesh||ke.isLine||ke.isPoints)&&(ke.isSkinnedMesh&&ke.skeleton.frame!==bn.render.frame&&(ke.skeleton.update(),ke.skeleton.frame=bn.render.frame),!ke.frustumCulled||li.intersectsObject(ke))){ii&&Yi.setFromMatrixPosition(ke.matrixWorld).applyMatrix4(_i);const Tn=pt.update(ke),c=ke.material;if(Array.isArray(c)){const n=Tn.groups;for(let r=0,o=n.length;r<o;r++){const e=n[r],s=c[e.materialIndex];s&&s.visible&&M.push(ke,Tn,s,Dt,Yi.z,e)}}else c.visible&&M.push(ke,Tn,c,Dt,Yi.z,null)}const yn=ke.children;for(let Tn=0,c=yn.length;Tn<c;Tn++)uc(yn[Tn],Xt,Dt,ii)}function Bh(ke,Xt,Dt){const ii=!0===Xt.isScene?Xt.overrideMaterial:null;for(let Ei=0,yn=ke.length;Ei<yn;Ei++){const Tn=ke[Ei],c=Tn.object,n=Tn.geometry,r=null===ii?Tn.material:ii,o=Tn.group;if(Dt.isArrayCamera){const e=Dt.cameras;for(let s=0,u=e.length;s<u;s++){const d=e[s];c.layers.test(d.layers)&&(nn.viewport(it.copy(d.viewport)),R.setupLightsView(d),tu(c,Xt,d,n,r,o))}}else tu(c,Xt,Dt,n,r,o)}}function tu(ke,Xt,Dt,ii,Ei,yn){if(ke.onBeforeRender(z,Xt,Dt,ii,Ei,yn),ke.modelViewMatrix.multiplyMatrices(Dt.matrixWorldInverse,ke.matrixWorld),ke.normalMatrix.getNormalMatrix(ke.modelViewMatrix),ke.isImmediateRenderObject){const Tn=iu(Dt,Xt,Ei,ke);nn.setMaterial(Ei),Qi.reset(),function Ua(ke,Xt){ke.render(function(Dt){z.renderBufferImmediate(Dt,Xt)})}(ke,Tn)}else z.renderBufferDirect(Dt,Xt,ii,Ei,ke,yn);ke.onAfterRender(z,Xt,Dt,ii,Ei,yn)}function Bn(ke,Xt,Dt){!0!==Xt.isScene&&(Xt=Ji);const ii=mn.get(ke),Ei=R.state.lights,Tn=Ei.state.version,c=Fe.getParameters(ke,Ei.state,R.state.shadowsArray,Xt,Dt),n=Fe.getProgramCacheKey(c);let r=ii.program,o=!0;if(ii.environment=ke.isMeshStandardMaterial?Xt.environment:null,ii.fog=Xt.fog,ii.envMap=xi.get(ke.envMap||ii.environment),void 0===r)ke.addEventListener("dispose",is);else if(r.cacheKey!==n)Aa(ke);else if(ii.lightsStateVersion!==Tn)o=!1;else{if(void 0!==c.shaderID)return;o=!1}o&&(c.uniforms=Fe.getUniforms(ke),ke.onBeforeCompile(c,z),r=Fe.acquireProgram(c,n),ii.program=r,ii.uniforms=c.uniforms,ii.outputEncoding=c.outputEncoding);const e=ii.uniforms;(!ke.isShaderMaterial&&!ke.isRawShaderMaterial||!0===ke.clipping)&&(ii.numClippingPlanes=ot.numPlanes,ii.numIntersection=ot.numIntersection,e.clippingPlanes=ot.uniform),ii.needsLights=function Uh(ke){return ke.isMeshLambertMaterial||ke.isMeshToonMaterial||ke.isMeshPhongMaterial||ke.isMeshStandardMaterial||ke.isShadowMaterial||ke.isShaderMaterial&&!0===ke.lights}(ke),ii.lightsStateVersion=Tn,ii.needsLights&&(e.ambientLightColor.value=Ei.state.ambient,e.lightProbe.value=Ei.state.probe,e.directionalLights.value=Ei.state.directional,e.directionalLightShadows.value=Ei.state.directionalShadow,e.spotLights.value=Ei.state.spot,e.spotLightShadows.value=Ei.state.spotShadow,e.rectAreaLights.value=Ei.state.rectArea,e.ltc_1.value=Ei.state.rectAreaLTC1,e.ltc_2.value=Ei.state.rectAreaLTC2,e.pointLights.value=Ei.state.point,e.pointLightShadows.value=Ei.state.pointShadow,e.hemisphereLights.value=Ei.state.hemi,e.directionalShadowMap.value=Ei.state.directionalShadowMap,e.directionalShadowMatrix.value=Ei.state.directionalShadowMatrix,e.spotShadowMap.value=Ei.state.spotShadowMap,e.spotShadowMatrix.value=Ei.state.spotShadowMatrix,e.pointShadowMap.value=Ei.state.pointShadowMap,e.pointShadowMatrix.value=Ei.state.pointShadowMatrix);const s=ii.program.getUniforms(),u=fs.seqWithValue(s.seq,e);ii.uniformsList=u}function iu(ke,Xt,Dt,ii){!0!==Xt.isScene&&(Xt=Ji),fi.resetTextureUnits();const Ei=Xt.fog,yn=Dt.isMeshStandardMaterial?Xt.environment:null,Tn=null===je?z.outputEncoding:je.texture.encoding,c=xi.get(Dt.envMap||yn),n=mn.get(Dt),r=R.state.lights;!0!==ri||!0!==di&&ke===Ie||ot.setState(Dt,ke,ke===Ie&&Dt.id===Je),Dt.version===n.__version?(Dt.fog&&n.fog!==Ei||n.environment!==yn||n.needsLights&&n.lightsStateVersion!==r.state.version||void 0!==n.numClippingPlanes&&(n.numClippingPlanes!==ot.numPlanes||n.numIntersection!==ot.numIntersection)||n.outputEncoding!==Tn||n.envMap!==c)&&Bn(Dt,Xt,ii):(Bn(Dt,Xt,ii),n.__version=Dt.version);let o=!1,e=!1,s=!1;const u=n.program,d=u.getUniforms(),m=n.uniforms;if(nn.useProgram(u.program)&&(o=!0,e=!0,s=!0),Dt.id!==Je&&(Je=Dt.id,e=!0),o||Ie!==ke){if(d.setValue(Kt,"projectionMatrix",ke.projectionMatrix),An.logarithmicDepthBuffer&&d.setValue(Kt,"logDepthBufFC",2/(Math.log(ke.far+1)/Math.LN2)),Ie!==ke&&(Ie=ke,e=!0,s=!0),Dt.isShaderMaterial||Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshStandardMaterial||Dt.envMap){const g=d.map.cameraPosition;void 0!==g&&g.setValue(Kt,Yi.setFromMatrixPosition(ke.matrixWorld))}(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial)&&d.setValue(Kt,"isOrthographic",!0===ke.isOrthographicCamera),(Dt.isMeshPhongMaterial||Dt.isMeshToonMaterial||Dt.isMeshLambertMaterial||Dt.isMeshBasicMaterial||Dt.isMeshStandardMaterial||Dt.isShaderMaterial||Dt.isShadowMaterial||Dt.skinning)&&d.setValue(Kt,"viewMatrix",ke.matrixWorldInverse)}if(Dt.skinning){d.setOptional(Kt,ii,"bindMatrix"),d.setOptional(Kt,ii,"bindMatrixInverse");const g=ii.skeleton;if(g){const T=g.bones;if(An.floatVertexTextures){if(null===g.boneTexture){let L=Math.sqrt(4*T.length);L=hn.ceilPowerOfTwo(L),L=Math.max(L,4);const P=new Float32Array(L*L*4);P.set(g.boneMatrices);const q=new Xa(P,L,L,Hr,_n);g.boneMatrices=P,g.boneTexture=q,g.boneTextureSize=L}d.setValue(Kt,"boneTexture",g.boneTexture,fi),d.setValue(Kt,"boneTextureSize",g.boneTextureSize)}else d.setOptional(Kt,g,"boneMatrices")}}return(e||n.receiveShadow!==ii.receiveShadow)&&(n.receiveShadow=ii.receiveShadow,d.setValue(Kt,"receiveShadow",ii.receiveShadow)),e&&(d.setValue(Kt,"toneMappingExposure",z.toneMappingExposure),n.needsLights&&function xf(ke,Xt){ke.ambientLightColor.needsUpdate=Xt,ke.lightProbe.needsUpdate=Xt,ke.directionalLights.needsUpdate=Xt,ke.directionalLightShadows.needsUpdate=Xt,ke.pointLights.needsUpdate=Xt,ke.pointLightShadows.needsUpdate=Xt,ke.spotLights.needsUpdate=Xt,ke.spotLightShadows.needsUpdate=Xt,ke.rectAreaLights.needsUpdate=Xt,ke.hemisphereLights.needsUpdate=Xt}(m,s),Ei&&Dt.fog&&Re.refreshFogUniforms(m,Ei),Re.refreshMaterialUniforms(m,Dt,Yt,Lt),fs.upload(Kt,n.uniformsList,m,fi)),Dt.isShaderMaterial&&!0===Dt.uniformsNeedUpdate&&(fs.upload(Kt,n.uniformsList,m,fi),Dt.uniformsNeedUpdate=!1),Dt.isSpriteMaterial&&d.setValue(Kt,"center",ii.center),d.setValue(Kt,"modelViewMatrix",ii.modelViewMatrix),d.setValue(Kt,"normalMatrix",ii.normalMatrix),d.setValue(Kt,"modelMatrix",ii.matrixWorld),u}bs.setAnimationLoop(function fn(ke){Hi.isPresenting||Kn&&Kn(ke)}),typeof window<"u"&&bs.setContext(window),this.setAnimationLoop=function(ke){Kn=ke,Hi.setAnimationLoop(ke),null===ke?bs.stop():bs.start()},this.render=function(ke,Xt){let Dt,ii;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Dt=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ii=arguments[3]),void 0!==Xt&&!0!==Xt.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===pe)return;Qi.resetDefaultState(),Je=-1,Ie=null,!0===ke.autoUpdate&&ke.updateMatrixWorld(),null===Xt.parent&&Xt.updateMatrixWorld(),!0===Hi.enabled&&!0===Hi.isPresenting&&(Xt=Hi.getCamera(Xt)),!0===ke.isScene&&ke.onBeforeRender(z,ke,Xt,Dt||je),R=Wt.get(ke,k.length),R.init(),k.push(R),_i.multiplyMatrices(Xt.projectionMatrix,Xt.matrixWorldInverse),li.setFromProjectionMatrix(_i),di=this.localClippingEnabled,ri=ot.init(this.clippingPlanes,di,Xt),M=oi.get(ke,Xt),M.init(),uc(ke,Xt,0,z.sortObjects),M.finish(),!0===z.sortObjects&&M.sort(Rt,qe),!0===ri&&ot.beginShadows();const Ei=R.state.shadowsArray;ln.render(Ei,ke,Xt),R.setupLights(),R.setupLightsView(Xt),!0===ri&&ot.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==Dt&&this.setRenderTarget(Dt),pi.render(M,ke,Xt,ii);const yn=M.opaque,Tn=M.transparent;yn.length>0&&Bh(yn,ke,Xt),Tn.length>0&&Bh(Tn,ke,Xt),!0===ke.isScene&&ke.onAfterRender(z,ke,Xt),null!==je&&(fi.updateRenderTargetMipmap(je),fi.updateMultisampleRenderTarget(je)),nn.buffers.depth.setTest(!0),nn.buffers.depth.setMask(!0),nn.buffers.color.setMask(!0),nn.setPolygonOffset(!1),k.pop(),R=k.length>0?k[k.length-1]:null,M=null},this.setFramebuffer=function(ke){ce!==ke&&null===je&&Kt.bindFramebuffer(36160,ke),ce=ke},this.getActiveCubeFace=function(){return V},this.getActiveMipmapLevel=function(){return U},this.getRenderList=function(){return M},this.setRenderList=function(ke){M=ke},this.getRenderTarget=function(){return je},this.setRenderTarget=function(ke,Xt=0,Dt=0){je=ke,V=Xt,U=Dt,ke&&void 0===mn.get(ke).__webglFramebuffer&&fi.setupRenderTarget(ke);let ii=ce,Ei=!1;if(ke){const yn=mn.get(ke).__webglFramebuffer;ke.isWebGLCubeRenderTarget?(ii=yn[Xt],Ei=!0):ii=ke.isWebGLMultisampleRenderTarget?mn.get(ke).__webglMultisampledFramebuffer:yn,it.copy(ke.viewport),Gt.copy(ke.scissor),ht=ke.scissorTest}else it.copy(ut).multiplyScalar(Yt).floor(),Gt.copy(xt).multiplyScalar(Yt).floor(),ht=zt;if(Ze!==ii&&(Kt.bindFramebuffer(36160,ii),Ze=ii),nn.viewport(it),nn.scissor(Gt),nn.setScissorTest(ht),Ei){const yn=mn.get(ke.texture);Kt.framebufferTexture2D(36160,36064,34069+Xt,yn.__webglTexture,Dt)}},this.readRenderTargetPixels=function(ke,Xt,Dt,ii,Ei,yn,Tn){if(!ke||!ke.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let c=mn.get(ke).__webglFramebuffer;if(ke.isWebGLCubeRenderTarget&&void 0!==Tn&&(c=c[Tn]),c){let n=!1;c!==Ze&&(Kt.bindFramebuffer(36160,c),n=!0);try{const r=ke.texture,o=r.format,e=r.type;if(o!==Hr&&Vi.convert(o)!==Kt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const s=1016===e&&(tn.has("EXT_color_buffer_half_float")||An.isWebGL2&&tn.has("EXT_color_buffer_float"));if(!(1009===e||Vi.convert(e)===Kt.getParameter(35738)||e===_n&&(An.isWebGL2||tn.has("OES_texture_float")||tn.has("WEBGL_color_buffer_float"))||s))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===Kt.checkFramebufferStatus(36160)?Xt>=0&&Xt<=ke.width-ii&&Dt>=0&&Dt<=ke.height-Ei&&Kt.readPixels(Xt,Dt,ii,Ei,Vi.convert(o),Vi.convert(e),yn):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{n&&Kt.bindFramebuffer(36160,Ze)}}},this.copyFramebufferToTexture=function(ke,Xt,Dt=0){const ii=Math.pow(2,-Dt),Ei=Math.floor(Xt.image.width*ii),yn=Math.floor(Xt.image.height*ii),Tn=Vi.convert(Xt.format);fi.setTexture2D(Xt,0),Kt.copyTexImage2D(3553,Dt,Tn,ke.x,ke.y,Ei,yn,0),nn.unbindTexture()},this.copyTextureToTexture=function(ke,Xt,Dt,ii=0){const Ei=Xt.image.width,yn=Xt.image.height,Tn=Vi.convert(Dt.format),c=Vi.convert(Dt.type);fi.setTexture2D(Dt,0),Kt.pixelStorei(37440,Dt.flipY),Kt.pixelStorei(37441,Dt.premultiplyAlpha),Kt.pixelStorei(3317,Dt.unpackAlignment),Xt.isDataTexture?Kt.texSubImage2D(3553,ii,ke.x,ke.y,Ei,yn,Tn,c,Xt.image.data):Xt.isCompressedTexture?Kt.compressedTexSubImage2D(3553,ii,ke.x,ke.y,Xt.mipmaps[0].width,Xt.mipmaps[0].height,Tn,Xt.mipmaps[0].data):Kt.texSubImage2D(3553,ii,ke.x,ke.y,Tn,c,Xt.image),0===ii&&Dt.generateMipmaps&&Kt.generateMipmap(3553),nn.unbindTexture()},this.initTexture=function(ke){fi.setTexture2D(ke,0),nn.unbindTexture()},this.resetState=function(){nn.reset(),Qi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Bl(i){ps.call(this,i)}(Ho.prototype=Object.create(dn.prototype)).constructor=Ho,Ho.prototype.isMeshDepthMaterial=!0,Ho.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.depthPacking=i.depthPacking,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this},(zo.prototype=Object.create(dn.prototype)).constructor=zo,zo.prototype.isMeshDistanceMaterial=!0,zo.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this},zd.prototype=Object.assign(Object.create(ur.prototype),{constructor:zd,isArrayCamera:!0}),Us.prototype=Object.assign(Object.create(on.prototype),{constructor:Us,isGroup:!0}),Object.assign(kl.prototype,{constructor:kl,getHandSpace:function(){return null===this._hand&&(this._hand=new Us,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Us,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Us,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(i){return null!==this._targetRay&&this._targetRay.dispatchEvent(i),null!==this._grip&&this._grip.dispatchEvent(i),null!==this._hand&&this._hand.dispatchEvent(i),this},disconnect:function(i){return this.dispatchEvent({type:"disconnected",data:i}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(i,t,a){let l=null,h=null,f=null;const p=this._targetRay,y=this._grip,b=this._hand;if(i&&"visible-blurred"!==t.session.visibilityState)if(b&&i.hand){f=!0;for(const z of i.hand.values()){const pe=t.getJointPose(z,a);if(void 0===b.joints[z.jointName]){const V=new Us;V.matrixAutoUpdate=!1,V.visible=!1,b.joints[z.jointName]=V,b.add(V)}const ce=b.joints[z.jointName];null!==pe&&(ce.matrix.fromArray(pe.transform.matrix),ce.matrix.decompose(ce.position,ce.rotation,ce.scale),ce.jointRadius=pe.radius),ce.visible=null!==pe}const M=b.joints["index-finger-tip"].position.distanceTo(b.joints["thumb-tip"].position),R=.02,k=.005;b.inputState.pinching&&M>R+k?(b.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!b.inputState.pinching&&M<=R-k&&(b.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else null!==p&&(l=t.getPose(i.targetRaySpace,a),null!==l&&(p.matrix.fromArray(l.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale))),null!==y&&i.gripSpace&&(h=t.getPose(i.gripSpace,a),null!==h&&(y.matrix.fromArray(h.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale)));return null!==p&&(p.visible=null!==l),null!==y&&(y.visible=null!==h),null!==b&&(b.visible=null!==f),this}}),Object.assign(hm.prototype,ya.prototype),Bl.prototype=Object.assign(Object.create(ps.prototype),{constructor:Bl,isWebGL1Renderer:!0});class dm extends on{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,a){return super.copy(t,a),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const a=super.toJSON(t);return null!==this.background&&(a.object.background=this.background.toJSON(t)),null!==this.environment&&(a.object.environment=this.environment.toJSON(t)),null!==this.fog&&(a.object.fog=this.fog.toJSON()),a}}function Ta(i,t){this.array=i,this.stride=t,this.count=void 0!==i?i.length/t:0,this.usage=hl,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=hn.generateUUID()}Object.defineProperty(Ta.prototype,"needsUpdate",{set:function(i){!0===i&&this.version++}}),Object.assign(Ta.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(i){return this.usage=i,this},copy:function(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this},copyAt:function(i,t,a){i*=this.stride,a*=t.stride;for(let l=0,h=this.stride;l<h;l++)this.array[i+l]=t.array[a+l];return this},set:function(i,t=0){return this.array.set(i,t),this},clone:function(i){void 0===i.arrayBuffers&&(i.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=hn.generateUUID()),void 0===i.arrayBuffers[this.array.buffer._uuid]&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const a=new Ta(new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),this.stride);return a.setUsage(this.usage),a},onUpload:function(i){return this.onUploadCallback=i,this},toJSON:function(i){return void 0===i.arrayBuffers&&(i.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=hn.generateUUID()),void 0===i.arrayBuffers[this.array.buffer._uuid]&&(i.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Vo=new Ge;function Go(i,t,a,l){this.name="",this.data=i,this.itemSize=t,this.offset=a,this.normalized=!0===l}function Hs(i){dn.call(this),this.type="SpriteMaterial",this.color=new $i(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(i)}let Wo;Object.defineProperties(Go.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(i){this.data.needsUpdate=i}}}),Object.assign(Go.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(i){for(let t=0,a=this.data.count;t<a;t++)Vo.x=this.getX(t),Vo.y=this.getY(t),Vo.z=this.getZ(t),Vo.applyMatrix4(i),this.setXYZ(t,Vo.x,Vo.y,Vo.z);return this},setX:function(i,t){return this.data.array[i*this.data.stride+this.offset]=t,this},setY:function(i,t){return this.data.array[i*this.data.stride+this.offset+1]=t,this},setZ:function(i,t){return this.data.array[i*this.data.stride+this.offset+2]=t,this},setW:function(i,t){return this.data.array[i*this.data.stride+this.offset+3]=t,this},getX:function(i){return this.data.array[i*this.data.stride+this.offset]},getY:function(i){return this.data.array[i*this.data.stride+this.offset+1]},getZ:function(i){return this.data.array[i*this.data.stride+this.offset+2]},getW:function(i){return this.data.array[i*this.data.stride+this.offset+3]},setXY:function(i,t,a){return this.data.array[(i=i*this.data.stride+this.offset)+0]=t,this.data.array[i+1]=a,this},setXYZ:function(i,t,a,l){return this.data.array[(i=i*this.data.stride+this.offset)+0]=t,this.data.array[i+1]=a,this.data.array[i+2]=l,this},setXYZW:function(i,t,a,l,h){return this.data.array[(i=i*this.data.stride+this.offset)+0]=t,this.data.array[i+1]=a,this.data.array[i+2]=l,this.data.array[i+3]=h,this},clone:function(i){if(void 0===i){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let a=0;a<this.count;a++){const l=a*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)t.push(this.data.array[l+h])}return new wn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===i.interleavedBuffers&&(i.interleavedBuffers={}),void 0===i.interleavedBuffers[this.data.uuid]&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new Go(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(i){if(void 0===i){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let a=0;a<this.count;a++){const l=a*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)t.push(this.data.array[l+h])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===i.interleavedBuffers&&(i.interleavedBuffers={}),void 0===i.interleavedBuffers[this.data.uuid]&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),(Hs.prototype=Object.create(dn.prototype)).constructor=Hs,Hs.prototype.isSpriteMaterial=!0,Hs.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.rotation=i.rotation,this.sizeAttenuation=i.sizeAttenuation,this};const jo=new Ge,Ul=new Ge,Hl=new Ge,Xo=new Ct,Nu=new Ct,Gd=new xn,ku=new Ge,Bu=new Ge,Zc=new Ge,Uu=new Ct,Hu=new Ct,$c=new Ct;function fm(i){if(on.call(this),this.type="Sprite",void 0===Wo){Wo=new Ln;const a=new Ta(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Wo.setIndex([0,1,2,0,2,3]),Wo.setAttribute("position",new Go(a,3,0,!1)),Wo.setAttribute("uv",new Go(a,2,3,!1))}this.geometry=Wo,this.material=void 0!==i?i:new Hs,this.center=new Ct(.5,.5)}function Jc(i,t,a,l,h,f){Xo.subVectors(i,a).addScalar(.5).multiply(l),void 0!==h?(Nu.x=f*Xo.x-h*Xo.y,Nu.y=h*Xo.x+f*Xo.y):Nu.copy(Xo),i.copy(t),i.x+=Nu.x,i.y+=Nu.y,i.applyMatrix4(Gd)}fm.prototype=Object.assign(Object.create(on.prototype),{constructor:fm,isSprite:!0,raycast:function(i,t){null===i.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ul.setFromMatrixScale(this.matrixWorld),Gd.copy(i.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(i.camera.matrixWorldInverse,this.matrixWorld),Hl.setFromMatrixPosition(this.modelViewMatrix),i.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ul.multiplyScalar(-Hl.z);const a=this.material.rotation;let l,h;0!==a&&(h=Math.cos(a),l=Math.sin(a));const f=this.center;Jc(ku.set(-.5,-.5,0),Hl,f,Ul,l,h),Jc(Bu.set(.5,-.5,0),Hl,f,Ul,l,h),Jc(Zc.set(.5,.5,0),Hl,f,Ul,l,h),Uu.set(0,0),Hu.set(1,0),$c.set(1,1);let p=i.ray.intersectTriangle(ku,Bu,Zc,!1,jo);if(null===p&&(Jc(Bu.set(-.5,.5,0),Hl,f,Ul,l,h),Hu.set(0,1),p=i.ray.intersectTriangle(ku,Zc,Bu,!1,jo),null===p))return;const y=i.ray.origin.distanceTo(jo);y<i.near||y>i.far||t.push({distance:y,point:jo.clone(),uv:ea.getUV(jo,ku,Bu,Zc,Uu,Hu,$c,new Ct),face:null,object:this})},copy:function(i){return on.prototype.copy.call(this,i),void 0!==i.center&&this.center.copy(i.center),this.material=i.material,this}});const eh=new Ge,pm=new Ge;function Wd(){on.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Wd.prototype=Object.assign(Object.create(on.prototype),{constructor:Wd,isLOD:!0,copy:function(i){on.prototype.copy.call(this,i,!1);const t=i.levels;for(let a=0,l=t.length;a<l;a++){const h=t[a];this.addLevel(h.object.clone(),h.distance)}return this.autoUpdate=i.autoUpdate,this},addLevel:function(i,t=0){t=Math.abs(t);const a=this.levels;let l;for(l=0;l<a.length&&!(t<a[l].distance);l++);return a.splice(l,0,{distance:t,object:i}),this.add(i),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(i){const t=this.levels;if(t.length>0){let a,l;for(a=1,l=t.length;a<l&&!(i<t[a].distance);a++);return t[a-1].object}return null},raycast:function(i,t){if(this.levels.length>0){eh.setFromMatrixPosition(this.matrixWorld);const l=i.ray.origin.distanceTo(eh);this.getObjectForDistance(l).raycast(i,t)}},update:function(i){const t=this.levels;if(t.length>1){eh.setFromMatrixPosition(i.matrixWorld),pm.setFromMatrixPosition(this.matrixWorld);const a=eh.distanceTo(pm)/i.zoom;let l,h;for(t[0].object.visible=!0,l=1,h=t.length;l<h&&a>=t[l].distance;l++)t[l-1].object.visible=!1,t[l].object.visible=!0;for(this._currentLevel=l-1;l<h;l++)t[l].object.visible=!1}},toJSON:function(i){const t=on.prototype.toJSON.call(this,i);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const a=this.levels;for(let l=0,h=a.length;l<h;l++){const f=a[l];t.object.levels.push({object:f.object.uuid,distance:f.distance})}return t}});const mm=new Ge,vm=new Wn,gm=new Wn,x0=new Ge,ym=new xn;function jd(i,t){i&&i.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),$n.call(this,i,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xn,this.bindMatrixInverse=new xn}function th(){on.call(this),this.type="Bone"}jd.prototype=Object.assign(Object.create($n.prototype),{constructor:jd,isSkinnedMesh:!0,copy:function(i){return $n.prototype.copy.call(this,i),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this},bind:function(i,t){this.skeleton=i,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const i=new Wn,t=this.geometry.attributes.skinWeight;for(let a=0,l=t.count;a<l;a++){i.x=t.getX(a),i.y=t.getY(a),i.z=t.getZ(a),i.w=t.getW(a);const h=1/i.manhattanLength();h!==1/0?i.multiplyScalar(h):i.set(1,0,0,0),t.setXYZW(a,i.x,i.y,i.z,i.w)}},updateMatrixWorld:function(i){$n.prototype.updateMatrixWorld.call(this,i),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(i,t){const a=this.skeleton,l=this.geometry;vm.fromBufferAttribute(l.attributes.skinIndex,i),gm.fromBufferAttribute(l.attributes.skinWeight,i),mm.fromBufferAttribute(l.attributes.position,i).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let h=0;h<4;h++){const f=gm.getComponent(h);if(0!==f){const p=vm.getComponent(h);ym.multiplyMatrices(a.bones[p].matrixWorld,a.boneInverses[p]),t.addScaledVector(x0.copy(mm).applyMatrix4(ym),f)}}return t.applyMatrix4(this.bindMatrixInverse)}}),th.prototype=Object.assign(Object.create(on.prototype),{constructor:th,isBone:!0});const _m=new xn,b0=new xn;function ih(i=[],t=[]){this.uuid=hn.generateUUID(),this.bones=i.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(ih.prototype,{init:function(){const i=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*i.length),0===t.length)this.calculateInverses();else if(i.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let a=0,l=this.bones.length;a<l;a++)this.boneInverses.push(new xn)}},calculateInverses:function(){this.boneInverses.length=0;for(let i=0,t=this.bones.length;i<t;i++){const a=new xn;this.bones[i]&&a.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(a)}},pose:function(){for(let i=0,t=this.bones.length;i<t;i++){const a=this.bones[i];a&&a.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,t=this.bones.length;i<t;i++){const a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){const i=this.bones,t=this.boneInverses,a=this.boneMatrices,l=this.boneTexture;for(let h=0,f=i.length;h<f;h++)_m.multiplyMatrices(i[h]?i[h].matrixWorld:b0,t[h]),_m.toArray(a,16*h);null!==l&&(l.needsUpdate=!0)},clone:function(){return new ih(this.bones,this.boneInverses)},getBoneByName:function(i){for(let t=0,a=this.bones.length;t<a;t++){const l=this.bones[t];if(l.name===i)return l}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(i,t){this.uuid=i.uuid;for(let a=0,l=i.bones.length;a<l;a++){const h=i.bones[a];let f=t[h];void 0===f&&(console.warn("THREE.Skeleton: No bone found with UUID:",h),f=new th),this.bones.push(f),this.boneInverses.push((new xn).fromArray(i.boneInverses[a]))}return this.init(),this},toJSON:function(){const i={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const t=this.bones,a=this.boneInverses;for(let l=0,h=t.length;l<h;l++)i.bones.push(t[l].uuid),i.boneInverses.push(a[l].toArray());return i}});const xm=new xn,bm=new xn,zu=[],Vu=new $n;function Tm(i,t,a){$n.call(this,i,t),this.instanceMatrix=new wn(new Float32Array(16*a),16),this.instanceColor=null,this.count=a,this.frustumCulled=!1}function Oa(i){dn.call(this),this.type="LineBasicMaterial",this.color=new $i(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(i)}Tm.prototype=Object.assign(Object.create($n.prototype),{constructor:Tm,isInstancedMesh:!0,copy:function(i){return $n.prototype.copy.call(this,i),this.instanceMatrix.copy(i.instanceMatrix),null!==i.instanceColor&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this},getColorAt:function(i,t){t.fromArray(this.instanceColor.array,3*i)},getMatrixAt:function(i,t){t.fromArray(this.instanceMatrix.array,16*i)},raycast:function(i,t){const a=this.matrixWorld,l=this.count;if(Vu.geometry=this.geometry,Vu.material=this.material,void 0!==Vu.material)for(let h=0;h<l;h++){this.getMatrixAt(h,xm),bm.multiplyMatrices(a,xm),Vu.matrixWorld=bm,Vu.raycast(i,zu);for(let f=0,p=zu.length;f<p;f++){const y=zu[f];y.instanceId=h,y.object=this,t.push(y)}zu.length=0}},setColorAt:function(i,t){null===this.instanceColor&&(this.instanceColor=new wn(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*i)},setMatrixAt:function(i,t){t.toArray(this.instanceMatrix.array,16*i)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Oa.prototype=Object.create(dn.prototype)).constructor=Oa,Oa.prototype.isLineBasicMaterial=!0,Oa.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.morphTargets=i.morphTargets,this};const Am=new Ge,wm=new Ge,Sm=new xn,sr=new Eo,zl=new za;function Qa(i=new Ln,t=new Oa){on.call(this),this.type="Line",this.geometry=i,this.material=t,this.updateMorphTargets()}Qa.prototype=Object.assign(Object.create(on.prototype),{constructor:Qa,isLine:!0,copy:function(i){return on.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(null===i.index){const t=i.attributes.position,a=[0];for(let l=1,h=t.count;l<h;l++)Am.fromBufferAttribute(t,l-1),wm.fromBufferAttribute(t,l),a[l]=a[l-1],a[l]+=Am.distanceTo(wm);i.setAttribute("lineDistance",new jn(a,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(i,t){const a=this.geometry,l=this.matrixWorld,h=i.params.Line.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),zl.copy(a.boundingSphere),zl.applyMatrix4(l),zl.radius+=h,!1===i.ray.intersectsSphere(zl))return;Sm.copy(l).invert(),sr.copy(i.ray).applyMatrix4(Sm);const f=h/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f,y=new Ge,b=new Ge,A=new Ge,C=new Ge,M=this.isLineSegments?2:1;if(a.isBufferGeometry){const R=a.index,z=a.attributes.position;if(null!==R){const pe=R.array;for(let ce=0,V=pe.length-1;ce<V;ce+=M){const je=pe[ce+1];if(y.fromBufferAttribute(z,pe[ce]),b.fromBufferAttribute(z,je),sr.distanceSqToSegment(y,b,C,A)>p)continue;C.applyMatrix4(this.matrixWorld);const Je=i.ray.origin.distanceTo(C);Je<i.near||Je>i.far||t.push({distance:Je,point:A.clone().applyMatrix4(this.matrixWorld),index:ce,face:null,faceIndex:null,object:this})}}else for(let pe=0,ce=z.count-1;pe<ce;pe+=M){if(y.fromBufferAttribute(z,pe),b.fromBufferAttribute(z,pe+1),sr.distanceSqToSegment(y,b,C,A)>p)continue;C.applyMatrix4(this.matrixWorld);const U=i.ray.origin.distanceTo(C);U<i.near||U>i.far||t.push({distance:U,point:A.clone().applyMatrix4(this.matrixWorld),index:pe,face:null,faceIndex:null,object:this})}}else a.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,a=Object.keys(t);if(a.length>0){const l=t[a[0]];if(void 0!==l){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,f=l.length;h<f;h++){const p=l[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=h}}}}else{const t=i.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Em=new Ge,Xd=new Ge;function Ar(i,t){Qa.call(this,i,t),this.type="LineSegments"}function Mm(i,t){Qa.call(this,i,t),this.type="LineLoop"}function ms(i){dn.call(this),this.type="PointsMaterial",this.color=new $i(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(i)}Ar.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Ar,isLineSegments:!0,computeLineDistances:function(){const i=this.geometry;if(i.isBufferGeometry)if(null===i.index){const t=i.attributes.position,a=[];for(let l=0,h=t.count;l<h;l+=2)Em.fromBufferAttribute(t,l),Xd.fromBufferAttribute(t,l+1),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+Em.distanceTo(Xd);i.setAttribute("lineDistance",new jn(a,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else i.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),Mm.prototype=Object.assign(Object.create(Qa.prototype),{constructor:Mm,isLineLoop:!0}),(ms.prototype=Object.create(dn.prototype)).constructor=ms,ms.prototype.isPointsMaterial=!0,ms.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.morphTargets=i.morphTargets,this};const nh=new xn,qd=new Eo,rh=new za,ah=new Ge;function Cm(i=new Ln,t=new ms){on.call(this),this.type="Points",this.geometry=i,this.material=t,this.updateMorphTargets()}function Pm(i,t,a,l,h,f,p){const y=qd.distanceSqToPoint(i);if(y<a){const b=new Ge;qd.closestPointToPoint(i,b),b.applyMatrix4(l);const A=h.ray.origin.distanceTo(b);if(A<h.near||A>h.far)return;f.push({distance:A,distanceToRay:Math.sqrt(y),point:b,index:t,face:null,object:p})}}function Yd(i,t,a,l,h,f,p,y,b){zn.call(this,i,t,a,l,h,f,p,y,b),this.format=void 0!==p?p:Ca,this.minFilter=void 0!==f?f:Fi,this.magFilter=void 0!==h?h:Fi,this.generateMipmaps=!1;const A=this;"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(function C(){A.needsUpdate=!0,i.requestVideoFrameCallback(C)})}function Gu(i,t,a,l,h,f,p,y,b,A,C,M){zn.call(this,null,f,p,y,b,A,l,h,C,M),this.image={width:t,height:a},this.mipmaps=i,this.flipY=!1,this.generateMipmaps=!1}function Wu(i,t,a,l,h,f,p,y,b){zn.call(this,i,t,a,l,h,f,p,y,b),this.needsUpdate=!0}function sh(i,t,a,l,h,f,p,y,b,A){if((A=void 0!==A?A:Pa)!==Pa&&A!==Ha)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===a&&A===Pa&&(a=1012),void 0===a&&A===Ha&&(a=pa),zn.call(this,null,l,h,f,p,y,A,a,b),this.image={width:i,height:t},this.magFilter=void 0!==p?p:rn,this.minFilter=void 0!==y?y:rn,this.flipY=!1,this.generateMipmaps=!1}Cm.prototype=Object.assign(Object.create(on.prototype),{constructor:Cm,isPoints:!0,copy:function(i){return on.prototype.copy.call(this,i),this.material=i.material,this.geometry=i.geometry,this},raycast:function(i,t){const a=this.geometry,l=this.matrixWorld,h=i.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),rh.copy(a.boundingSphere),rh.applyMatrix4(l),rh.radius+=h,!1===i.ray.intersectsSphere(rh))return;nh.copy(l).invert(),qd.copy(i.ray).applyMatrix4(nh);const f=h/((this.scale.x+this.scale.y+this.scale.z)/3),p=f*f;if(a.isBufferGeometry){const y=a.index,A=a.attributes.position;if(null!==y){const C=y.array;for(let M=0,R=C.length;M<R;M++){const k=C[M];ah.fromBufferAttribute(A,k),Pm(ah,k,p,l,i,t,this)}}else for(let C=0,M=A.count;C<M;C++)ah.fromBufferAttribute(A,C),Pm(ah,C,p,l,i,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const i=this.geometry;if(i.isBufferGeometry){const t=i.morphAttributes,a=Object.keys(t);if(a.length>0){const l=t[a[0]];if(void 0!==l){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,f=l.length;h<f;h++){const p=l[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[p]=h}}}}else{const t=i.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Yd.prototype=Object.assign(Object.create(zn.prototype),{constructor:Yd,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const i=this.image;"requestVideoFrameCallback"in i==0&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(Gu.prototype=Object.create(zn.prototype)).constructor=Gu,Gu.prototype.isCompressedTexture=!0,(Wu.prototype=Object.create(zn.prototype)).constructor=Wu,Wu.prototype.isCanvasTexture=!0,(sh.prototype=Object.create(zn.prototype)).constructor=sh,sh.prototype.isDepthTexture=!0,new Ge,new Ge,new Ge,new ea;function Qd(i,t,a,l,h){let f,p;if(h===function Jd(i,t,a,l){let h=0;for(let f=t,p=a-l;f<a;f+=l)h+=(i[p]-i[f])*(i[f+1]+i[p+1]),p=f;return h}(i,t,a,l)>0)for(f=t;f<a;f+=l)p=Dm(f,i[f],i[f+1],p);else for(f=a-l;f>=t;f-=l)p=Dm(f,i[f],i[f+1],p);return p&&uh(p,p.next)&&(Yo(p),p=p.next),p}function oo(i,t){if(!i)return i;t||(t=i);let l,a=i;do{if(l=!1,a.steiner||!uh(a,a.next)&&0!==or(a.prev,a,a.next))a=a.next;else{if(Yo(a),a=t=a.prev,a===a.next)break;l=!0}}while(l||a!==t);return t}function ju(i,t,a,l,h,f,p){if(!i)return;!p&&f&&function lh(i,t,a,l){let h=i;do{null===h.z&&(h.z=Zd(h.x,h.y,t,a,l)),h.prevZ=h.prev,h.nextZ=h.next,h=h.next}while(h!==i);h.prevZ.nextZ=null,h.prevZ=null,function Im(i){let t,a,l,h,f,p,y,b,A=1;do{for(a=i,i=null,f=null,p=0;a;){for(p++,l=a,y=0,t=0;t<A&&(y++,l=l.nextZ,l);t++);for(b=A;y>0||b>0&&l;)0!==y&&(0===b||!l||a.z<=l.z)?(h=a,a=a.nextZ,y--):(h=l,l=l.nextZ,b--),f?f.nextZ=h:i=h,h.prevZ=f,f=h;a=l}f.nextZ=null,A*=2}while(p>1)}(h)}(i,l,h,f);let b,A,y=i;for(;i.prev!==i.next;)if(b=i.prev,A=i.next,f?S0(i,l,h,f):w0(i))t.push(b.i/a),t.push(i.i/a),t.push(A.i/a),Yo(i),i=A.next,y=A.next;else if((i=A)===y){p?1===p?ju(i=Xu(oo(i),t,a),t,a,l,h,f,2):2===p&&Lm(i,t,a,l,h,f):ju(oo(i),t,a,l,h,f,1);break}}function w0(i){const t=i.prev,a=i,l=i.next;if(or(t,a,l)>=0)return!1;let h=i.next.next;for(;h!==i.prev;){if(qo(t.x,t.y,a.x,a.y,l.x,l.y,h.x,h.y)&&or(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function S0(i,t,a,l){const h=i.prev,f=i,p=i.next;if(or(h,f,p)>=0)return!1;const A=h.x>f.x?h.x>p.x?h.x:p.x:f.x>p.x?f.x:p.x,C=h.y>f.y?h.y>p.y?h.y:p.y:f.y>p.y?f.y:p.y,M=Zd(h.x<f.x?h.x<p.x?h.x:p.x:f.x<p.x?f.x:p.x,h.y<f.y?h.y<p.y?h.y:p.y:f.y<p.y?f.y:p.y,t,a,l),R=Zd(A,C,t,a,l);let k=i.prevZ,z=i.nextZ;for(;k&&k.z>=M&&z&&z.z<=R;){if(k!==i.prev&&k!==i.next&&qo(h.x,h.y,f.x,f.y,p.x,p.y,k.x,k.y)&&or(k.prev,k,k.next)>=0||(k=k.prevZ,z!==i.prev&&z!==i.next&&qo(h.x,h.y,f.x,f.y,p.x,p.y,z.x,z.y)&&or(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;k&&k.z>=M;){if(k!==i.prev&&k!==i.next&&qo(h.x,h.y,f.x,f.y,p.x,p.y,k.x,k.y)&&or(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;z&&z.z<=R;){if(z!==i.prev&&z!==i.next&&qo(h.x,h.y,f.x,f.y,p.x,p.y,z.x,z.y)&&or(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function Xu(i,t,a){let l=i;do{const h=l.prev,f=l.next.next;!uh(h,f)&&Rm(h,l,l.next,f)&&wr(h,f)&&wr(f,h)&&(t.push(h.i/a),t.push(l.i/a),t.push(f.i/a),Yo(l),Yo(l.next),l=i=f),l=l.next}while(l!==i);return oo(l)}function Lm(i,t,a,l,h,f){let p=i;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&L0(p,y)){let b=hh(p,y);return p=oo(p,p.next),b=oo(b,b.next),ju(p,t,a,l,h,f),void ju(b,t,a,l,h,f)}y=y.next}p=p.next}while(p!==i)}function M0(i,t){return i.x-t.x}function oh(i,t){if(t=function Kd(i,t){let a=t;const l=i.x,h=i.y;let p,f=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){const R=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(R<=l&&R>f){if(f=R,R===l){if(h===a.y)return a;if(h===a.next.y)return a.next}p=a.x<a.next.x?a:a.next}}a=a.next}while(a!==t);if(!p)return null;if(l===f)return p;const y=p,b=p.x,A=p.y;let M,C=1/0;a=p;do{l>=a.x&&a.x>=b&&l!==a.x&&qo(h<A?l:f,h,b,A,h<A?f:l,h,a.x,a.y)&&(M=Math.abs(h-a.y)/(l-a.x),wr(a,i)&&(M<C||M===C&&(a.x>p.x||a.x===p.x&&C0(p,a)))&&(p=a,C=M)),a=a.next}while(a!==y);return p}(i,t),t){const a=hh(t,i);oo(t,t.next),oo(a,a.next)}}function C0(i,t){return or(i.prev,i,t.prev)<0&&or(t.next,i,i.next)<0}function Zd(i,t,a,l,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-a)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*h)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function P0(i){let t=i,a=i;do{(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next}while(t!==i);return a}function qo(i,t,a,l,h,f,p,y){return(h-p)*(t-y)-(i-p)*(f-y)>=0&&(i-p)*(l-y)-(a-p)*(t-y)>=0&&(a-p)*(f-y)-(h-p)*(l-y)>=0}function L0(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function I0(i,t){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==t.i&&a.next.i!==t.i&&Rm(a,a.next,i,t))return!0;a=a.next}while(a!==i);return!1}(i,t)&&(wr(i,t)&&wr(t,i)&&function Vl(i,t){let a=i,l=!1;const h=(i.x+t.x)/2,f=(i.y+t.y)/2;do{a.y>f!=a.next.y>f&&a.next.y!==a.y&&h<(a.next.x-a.x)*(f-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next}while(a!==i);return l}(i,t)&&(or(i.prev,i,t.prev)||or(i,t.prev,t))||uh(i,t)&&or(i.prev,i,i.next)>0&&or(t.prev,t,t.next)>0)}function or(i,t,a){return(t.y-i.y)*(a.x-t.x)-(t.x-i.x)*(a.y-t.y)}function uh(i,t){return i.x===t.x&&i.y===t.y}function Rm(i,t,a,l){const h=ch(or(i,t,a)),f=ch(or(i,t,l)),p=ch(or(a,l,i)),y=ch(or(a,l,t));return!!(h!==f&&p!==y||0===h&&qu(i,a,t)||0===f&&qu(i,l,t)||0===p&&qu(a,i,l)||0===y&&qu(a,t,l))}function qu(i,t,a){return t.x<=Math.max(i.x,a.x)&&t.x>=Math.min(i.x,a.x)&&t.y<=Math.max(i.y,a.y)&&t.y>=Math.min(i.y,a.y)}function ch(i){return i>0?1:i<0?-1:0}function wr(i,t){return or(i.prev,i,i.next)<0?or(i,t,i.next)>=0&&or(i,i.prev,t)>=0:or(i,t,i.prev)<0||or(i,i.next,t)<0}function hh(i,t){const a=new $d(i.i,i.x,i.y),l=new $d(t.i,t.x,t.y),h=i.next,f=t.prev;return i.next=t,t.prev=i,a.next=h,h.prev=a,l.next=a,a.prev=l,f.next=l,l.prev=f,l}function Dm(i,t,a,l){const h=new $d(i,t,a);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Yo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function $d(i,t,a){this.i=i,this.x=t,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const vs={area:function(i){const t=i.length;let a=0;for(let l=t-1,h=0;h<t;l=h++)a+=i[l].x*i[h].y-i[h].x*i[l].y;return.5*a},isClockWise:function(i){return vs.area(i)<0},triangulateShape:function(i,t){const a=[],l=[],h=[];dh(i),Yu(a,i);let f=i.length;t.forEach(dh);for(let y=0;y<t.length;y++)l.push(f),f+=t[y].length,Yu(a,t[y]);const p=function(i,t,a){a=a||2;const l=t&&t.length,h=l?t[0]*a:i.length;let f=Qd(i,0,h,a,!0);const p=[];if(!f||f.next===f.prev)return p;let y,b,A,C,M,R,k;if(l&&(f=function E0(i,t,a,l){const h=[];let f,p,y,b,A;for(f=0,p=t.length;f<p;f++)y=t[f]*l,b=f<p-1?t[f+1]*l:i.length,A=Qd(i,y,b,l,!1),A===A.next&&(A.steiner=!0),h.push(P0(A));for(h.sort(M0),f=0;f<h.length;f++)oh(h[f],a),a=oo(a,a.next);return a}(i,t,f,a)),i.length>80*a){y=A=i[0],b=C=i[1];for(let z=a;z<h;z+=a)M=i[z],R=i[z+1],M<y&&(y=M),R<b&&(b=R),M>A&&(A=M),R>C&&(C=R);k=Math.max(A-y,C-b),k=0!==k?1/k:0}return ju(f,p,a,y,b,k),p}(a,l);for(let y=0;y<p.length;y+=3)h.push(p.slice(y,y+3));return h}};function dh(i){const t=i.length;t>2&&i[t-1].equals(i[0])&&i.pop()}function Yu(i,t){for(let a=0;a<t.length;a++)i.push(t[a].x),i.push(t[a].y)}class fh extends Ln{constructor(t,a){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:a},t=Array.isArray(t)?t:[t];const l=this,h=[],f=[];for(let y=0,b=t.length;y<b;y++)p(t[y]);function p(y){const b=[],A=void 0!==a.curveSegments?a.curveSegments:12,C=void 0!==a.steps?a.steps:1;let M=void 0!==a.depth?a.depth:100,R=void 0===a.bevelEnabled||a.bevelEnabled,k=void 0!==a.bevelThickness?a.bevelThickness:6,z=void 0!==a.bevelSize?a.bevelSize:k-2,pe=void 0!==a.bevelOffset?a.bevelOffset:0,ce=void 0!==a.bevelSegments?a.bevelSegments:3;const V=a.extrudePath,U=void 0!==a.UVGenerator?a.UVGenerator:Om;void 0!==a.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),M=a.amount);let je,Je,Ie,it,Gt,Ze=!1;V&&(je=V.getSpacedPoints(C),Ze=!0,R=!1,Je=V.computeFrenetFrames(C,!1),Ie=new Ge,it=new Ge,Gt=new Ge),R||(ce=0,k=0,z=0,pe=0);const ht=y.extractPoints(A);let At=ht.shape;const Lt=ht.holes;if(!vs.isClockWise(At)){At=At.reverse();for(let fi=0,xi=Lt.length;fi<xi;fi++){const Si=Lt[fi];vs.isClockWise(Si)&&(Lt[fi]=Si.reverse())}}const Rt=vs.triangulateShape(At,Lt),qe=At;for(let fi=0,xi=Lt.length;fi<xi;fi++)At=At.concat(Lt[fi]);function ut(fi,xi,Si){return xi||console.error("THREE.ExtrudeGeometry: vec does not exist"),xi.clone().multiplyScalar(Si).add(fi)}const xt=At.length,zt=Rt.length;function li(fi,xi,Si){let Ui,pt,Fe;const Re=fi.x-xi.x,oi=fi.y-xi.y,Wt=Si.x-fi.x,ot=Si.y-fi.y,pi=Re*Re+oi*oi;if(Math.abs(Re*ot-oi*Wt)>Number.EPSILON){const Gi=Math.sqrt(pi),Pi=Math.sqrt(Wt*Wt+ot*ot),Vi=xi.x-oi/Gi,Qi=xi.y+Re/Gi,ln=((Si.x-ot/Pi-Vi)*ot-(Si.y+Wt/Pi-Qi)*Wt)/(Re*ot-oi*Wt);Ui=Vi+Re*ln-fi.x,pt=Qi+oi*ln-fi.y;const In=Ui*Ui+pt*pt;if(In<=2)return new Ct(Ui,pt);Fe=Math.sqrt(In/2)}else{let Gi=!1;Re>Number.EPSILON?Wt>Number.EPSILON&&(Gi=!0):Re<-Number.EPSILON?Wt<-Number.EPSILON&&(Gi=!0):Math.sign(oi)===Math.sign(ot)&&(Gi=!0),Gi?(Ui=-oi,pt=Re,Fe=Math.sqrt(pi)):(Ui=Re,pt=oi,Fe=Math.sqrt(pi/2))}return new Ct(Ui/Fe,pt/Fe)}const ri=[];for(let fi=0,xi=qe.length,Si=xi-1,Ui=fi+1;fi<xi;fi++,Si++,Ui++)Si===xi&&(Si=0),Ui===xi&&(Ui=0),ri[fi]=li(qe[fi],qe[Si],qe[Ui]);const di=[];let _i,Yi=ri.concat();for(let fi=0,xi=Lt.length;fi<xi;fi++){const Si=Lt[fi];_i=[];for(let Ui=0,pt=Si.length,Fe=pt-1,Re=Ui+1;Ui<pt;Ui++,Fe++,Re++)Fe===pt&&(Fe=0),Re===pt&&(Re=0),_i[Ui]=li(Si[Ui],Si[Fe],Si[Re]);di.push(_i),Yi=Yi.concat(_i)}for(let fi=0;fi<ce;fi++){const xi=fi/ce,Si=k*Math.cos(xi*Math.PI/2),Ui=z*Math.sin(xi*Math.PI/2)+pe;for(let pt=0,Fe=qe.length;pt<Fe;pt++){const Re=ut(qe[pt],ri[pt],Ui);tn(Re.x,Re.y,-Si)}for(let pt=0,Fe=Lt.length;pt<Fe;pt++){const Re=Lt[pt];_i=di[pt];for(let oi=0,Wt=Re.length;oi<Wt;oi++){const ot=ut(Re[oi],_i[oi],Ui);tn(ot.x,ot.y,-Si)}}}const Ji=z+pe;for(let fi=0;fi<xt;fi++){const xi=R?ut(At[fi],Yi[fi],Ji):At[fi];Ze?(it.copy(Je.normals[0]).multiplyScalar(xi.x),Ie.copy(Je.binormals[0]).multiplyScalar(xi.y),Gt.copy(je[0]).add(it).add(Ie),tn(Gt.x,Gt.y,Gt.z)):tn(xi.x,xi.y,0)}for(let fi=1;fi<=C;fi++)for(let xi=0;xi<xt;xi++){const Si=R?ut(At[xi],Yi[xi],Ji):At[xi];Ze?(it.copy(Je.normals[fi]).multiplyScalar(Si.x),Ie.copy(Je.binormals[fi]).multiplyScalar(Si.y),Gt.copy(je[fi]).add(it).add(Ie),tn(Gt.x,Gt.y,Gt.z)):tn(Si.x,Si.y,M/C*fi)}for(let fi=ce-1;fi>=0;fi--){const xi=fi/ce,Si=k*Math.cos(xi*Math.PI/2),Ui=z*Math.sin(xi*Math.PI/2)+pe;for(let pt=0,Fe=qe.length;pt<Fe;pt++){const Re=ut(qe[pt],ri[pt],Ui);tn(Re.x,Re.y,M+Si)}for(let pt=0,Fe=Lt.length;pt<Fe;pt++){const Re=Lt[pt];_i=di[pt];for(let oi=0,Wt=Re.length;oi<Wt;oi++){const ot=ut(Re[oi],_i[oi],Ui);Ze?tn(ot.x,ot.y+je[C-1].y,je[C-1].x+Si):tn(ot.x,ot.y,M+Si)}}}function Qn(fi,xi){let Si=fi.length;for(;--Si>=0;){const Ui=Si;let pt=Si-1;pt<0&&(pt=fi.length-1);for(let Fe=0,Re=C+2*ce;Fe<Re;Fe++){const oi=xt*Fe,Wt=xt*(Fe+1);nn(xi+Ui+oi,xi+pt+oi,xi+pt+Wt,xi+Ui+Wt)}}}function tn(fi,xi,Si){b.push(fi),b.push(xi),b.push(Si)}function An(fi,xi,Si){bn(fi),bn(xi),bn(Si);const Ui=h.length/3,pt=U.generateTopUV(l,h,Ui-3,Ui-2,Ui-1);mn(pt[0]),mn(pt[1]),mn(pt[2])}function nn(fi,xi,Si,Ui){bn(fi),bn(xi),bn(Ui),bn(xi),bn(Si),bn(Ui);const pt=h.length/3,Fe=U.generateSideWallUV(l,h,pt-6,pt-3,pt-2,pt-1);mn(Fe[0]),mn(Fe[1]),mn(Fe[3]),mn(Fe[1]),mn(Fe[2]),mn(Fe[3])}function bn(fi){h.push(b[3*fi+0]),h.push(b[3*fi+1]),h.push(b[3*fi+2])}function mn(fi){f.push(fi.x),f.push(fi.y)}(function Mn(){const fi=h.length/3;if(R){let xi=0,Si=xt*xi;for(let Ui=0;Ui<zt;Ui++){const pt=Rt[Ui];An(pt[2]+Si,pt[1]+Si,pt[0]+Si)}xi=C+2*ce,Si=xt*xi;for(let Ui=0;Ui<zt;Ui++){const pt=Rt[Ui];An(pt[0]+Si,pt[1]+Si,pt[2]+Si)}}else{for(let xi=0;xi<zt;xi++){const Si=Rt[xi];An(Si[2],Si[1],Si[0])}for(let xi=0;xi<zt;xi++){const Si=Rt[xi];An(Si[0]+xt*C,Si[1]+xt*C,Si[2]+xt*C)}}l.addGroup(fi,h.length/3-fi,0)})(),function Kt(){const fi=h.length/3;let xi=0;Qn(qe,xi),xi+=qe.length;for(let Si=0,Ui=Lt.length;Si<Ui;Si++){const pt=Lt[Si];Qn(pt,xi),xi+=pt.length}l.addGroup(fi,h.length/3-fi,1)}()}this.setAttribute("position",new jn(h,3)),this.setAttribute("uv",new jn(f,2)),this.computeVertexNormals()}toJSON(){const t=Ln.prototype.toJSON.call(this);return function Fm(i,t,a){if(a.shapes=[],Array.isArray(i))for(let l=0,h=i.length;l<h;l++)a.shapes.push(i[l].uuid);else a.shapes.push(i.uuid);return void 0!==t.extrudePath&&(a.options.extrudePath=t.extrudePath.toJSON()),a}(this.parameters.shapes,this.parameters.options,t)}}const Om={generateTopUV:function(i,t,a,l,h){const y=t[3*l],b=t[3*l+1],A=t[3*h],C=t[3*h+1];return[new Ct(t[3*a],t[3*a+1]),new Ct(y,b),new Ct(A,C)]},generateSideWallUV:function(i,t,a,l,h,f){const p=t[3*a],y=t[3*a+1],b=t[3*a+2],A=t[3*l],C=t[3*l+1],M=t[3*l+2],R=t[3*h],k=t[3*h+1],z=t[3*h+2],pe=t[3*f],ce=t[3*f+1],V=t[3*f+2];return Math.abs(y-C)<.01?[new Ct(p,1-b),new Ct(A,1-M),new Ct(R,1-z),new Ct(pe,1-V)]:[new Ct(y,1-b),new Ct(C,1-M),new Ct(k,1-z),new Ct(ce,1-V)]}};function ph(i,t,a){Ln.call(this),this.type="ParametricGeometry",this.parameters={func:i,slices:t,stacks:a};const l=[],h=[],f=[],p=[],y=1e-5,b=new Ge,A=new Ge,C=new Ge,M=new Ge,R=new Ge;i.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const k=t+1;for(let z=0;z<=a;z++){const pe=z/a;for(let ce=0;ce<=t;ce++){const V=ce/t;i(V,pe,A),h.push(A.x,A.y,A.z),V-y>=0?(i(V-y,pe,C),M.subVectors(A,C)):(i(V+y,pe,C),M.subVectors(C,A)),pe-y>=0?(i(V,pe-y,C),R.subVectors(A,C)):(i(V,pe+y,C),R.subVectors(C,A)),b.crossVectors(M,R).normalize(),f.push(b.x,b.y,b.z),p.push(V,pe)}}for(let z=0;z<a;z++)for(let pe=0;pe<t;pe++){const V=z*k+pe+1,U=(z+1)*k+pe+1,je=(z+1)*k+pe;l.push(z*k+pe,V,je),l.push(V,U,je)}this.setIndex(l),this.setAttribute("position",new jn(h,3)),this.setAttribute("normal",new jn(f,3)),this.setAttribute("uv",new jn(p,2))}(ph.prototype=Object.create(Ln.prototype)).constructor=ph;class R0 extends Ln{constructor(t,a=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:a};const l=[],h=[],f=[],p=[];let y=0,b=0;if(!1===Array.isArray(t))A(t);else for(let C=0;C<t.length;C++)A(t[C]),this.addGroup(y,b,C),y+=b,b=0;function A(C){const M=h.length/3,R=C.extractPoints(a);let k=R.shape;const z=R.holes;!1===vs.isClockWise(k)&&(k=k.reverse());for(let ce=0,V=z.length;ce<V;ce++){const U=z[ce];!0===vs.isClockWise(U)&&(z[ce]=U.reverse())}const pe=vs.triangulateShape(k,z);for(let ce=0,V=z.length;ce<V;ce++)k=k.concat(z[ce]);for(let ce=0,V=k.length;ce<V;ce++){const U=k[ce];h.push(U.x,U.y,0),f.push(0,0,1),p.push(U.x,U.y)}for(let ce=0,V=pe.length;ce<V;ce++){const U=pe[ce];l.push(U[0]+M,U[1]+M,U[2]+M),b+=3}}this.setIndex(l),this.setAttribute("position",new jn(h,3)),this.setAttribute("normal",new jn(f,3)),this.setAttribute("uv",new jn(p,2))}toJSON(){const t=Ln.prototype.toJSON.call(this);return function mh(i,t){if(t.shapes=[],Array.isArray(i))for(let a=0,l=i.length;a<l;a++)t.shapes.push(i[a].uuid);else t.shapes.push(i.uuid);return t}(this.parameters.shapes,t)}}class ia extends Ln{constructor(t=1,a=8,l=6,h=0,f=2*Math.PI,p=0,y=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:a,heightSegments:l,phiStart:h,phiLength:f,thetaStart:p,thetaLength:y},a=Math.max(3,Math.floor(a)),l=Math.max(2,Math.floor(l));const b=Math.min(p+y,Math.PI);let A=0;const C=[],M=new Ge,R=new Ge,k=[],z=[],pe=[],ce=[];for(let V=0;V<=l;V++){const U=[],je=V/l;let Ze=0;0==V&&0==p?Ze=.5/a:V==l&&b==Math.PI&&(Ze=-.5/a);for(let Je=0;Je<=a;Je++){const Ie=Je/a;M.x=-t*Math.cos(h+Ie*f)*Math.sin(p+je*y),M.y=t*Math.cos(p+je*y),M.z=t*Math.sin(h+Ie*f)*Math.sin(p+je*y),z.push(M.x,M.y,M.z),R.copy(M).normalize(),pe.push(R.x,R.y,R.z),ce.push(Ie+Ze,1-je),U.push(A++)}C.push(U)}for(let V=0;V<l;V++)for(let U=0;U<a;U++){const je=C[V][U+1],Ze=C[V][U],Je=C[V+1][U],Ie=C[V+1][U+1];(0!==V||p>0)&&k.push(je,Ze,Ie),(V!==l-1||b<Math.PI)&&k.push(Ze,Je,Ie)}this.setIndex(k),this.setAttribute("position",new jn(z,3)),this.setAttribute("normal",new jn(pe,3)),this.setAttribute("uv",new jn(ce,2))}}function zs(i){dn.call(this),this.type="ShadowMaterial",this.color=new $i(0),this.transparent=!0,this.setValues(i)}function na(i){jr.call(this,i),this.type="RawShaderMaterial"}function Xr(i){dn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $i(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $i(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(i)}function qr(i){Xr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ct(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=hn.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(i)}function lo(i){dn.call(this),this.type="MeshPhongMaterial",this.color=new $i(16777215),this.specular=new $i(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $i(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}function Ka(i){dn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $i(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $i(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}function Vs(i){dn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}function Gl(i){dn.call(this),this.type="MeshLambertMaterial",this.color=new $i(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $i(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}function Wl(i){dn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $i(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(i)}function Qo(i){Oa.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(i)}(zs.prototype=Object.create(dn.prototype)).constructor=zs,zs.prototype.isShadowMaterial=!0,zs.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this},(na.prototype=Object.create(jr.prototype)).constructor=na,na.prototype.isRawShaderMaterial=!0,(Xr.prototype=Object.create(dn.prototype)).constructor=Xr,Xr.prototype.isMeshStandardMaterial=!0,Xr.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this.vertexTangents=i.vertexTangents,this},(qr.prototype=Object.create(Xr.prototype)).constructor=qr,qr.prototype.isMeshPhysicalMaterial=!0,qr.prototype.copy=function(i){return Xr.prototype.copy.call(this,i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.reflectivity=i.reflectivity,this.sheen=i.sheen?(this.sheen||new $i).copy(i.sheen):null,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this},(lo.prototype=Object.create(dn.prototype)).constructor=lo,lo.prototype.isMeshPhongMaterial=!0,lo.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.specular.copy(i.specular),this.shininess=i.shininess,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this},(Ka.prototype=Object.create(dn.prototype)).constructor=Ka,Ka.prototype.isMeshToonMaterial=!0,Ka.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.gradientMap=i.gradientMap,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this},(Vs.prototype=Object.create(dn.prototype)).constructor=Vs,Vs.prototype.isMeshNormalMaterial=!0,Vs.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this},(Gl.prototype=Object.create(dn.prototype)).constructor=Gl,Gl.prototype.isMeshLambertMaterial=!0,Gl.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this},(Wl.prototype=Object.create(dn.prototype)).constructor=Wl,Wl.prototype.isMeshMatcapMaterial=!0,Wl.prototype.copy=function(i){return dn.prototype.copy.call(this,i),this.defines={MATCAP:""},this.color.copy(i.color),this.matcap=i.matcap,this.map=i.map,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.skinning=i.skinning,this.morphTargets=i.morphTargets,this.morphNormals=i.morphNormals,this},(Qo.prototype=Object.create(Oa.prototype)).constructor=Qo,Qo.prototype.isLineDashedMaterial=!0,Qo.prototype.copy=function(i){return Oa.prototype.copy.call(this,i),this.scale=i.scale,this.dashSize=i.dashSize,this.gapSize=i.gapSize,this};var D0=Object.freeze({__proto__:null,ShadowMaterial:zs,SpriteMaterial:Hs,RawShaderMaterial:na,ShaderMaterial:jr,PointsMaterial:ms,MeshPhysicalMaterial:qr,MeshStandardMaterial:Xr,MeshPhongMaterial:lo,MeshToonMaterial:Ka,MeshNormalMaterial:Vs,MeshLambertMaterial:Gl,MeshDepthMaterial:Ho,MeshDistanceMaterial:zo,MeshBasicMaterial:Fr,MeshMatcapMaterial:Wl,LineDashedMaterial:Qo,LineBasicMaterial:Oa,Material:dn});const Rn={arraySlice:function(i,t,a){return Rn.isTypedArray(i)?new i.constructor(i.subarray(t,void 0!==a?a:i.length)):i.slice(t,a)},convertArray:function(i,t,a){return!i||!a&&i.constructor===t?i:"number"==typeof t.BYTES_PER_ELEMENT?new t(i):Array.prototype.slice.call(i)},isTypedArray:function(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)},getKeyframeOrder:function(i){const a=i.length,l=new Array(a);for(let h=0;h!==a;++h)l[h]=h;return l.sort(function t(h,f){return i[h]-i[f]}),l},sortedArray:function(i,t,a){const l=i.length,h=new i.constructor(l);for(let f=0,p=0;p!==l;++f){const y=a[f]*t;for(let b=0;b!==t;++b)h[p++]=i[y+b]}return h},flattenJSON:function(i,t,a,l){let h=1,f=i[0];for(;void 0!==f&&void 0===f[l];)f=i[h++];if(void 0===f)return;let p=f[l];if(void 0!==p)if(Array.isArray(p))do{p=f[l],void 0!==p&&(t.push(f.time),a.push.apply(a,p)),f=i[h++]}while(void 0!==f);else if(void 0!==p.toArray)do{p=f[l],void 0!==p&&(t.push(f.time),p.toArray(a,a.length)),f=i[h++]}while(void 0!==f);else do{p=f[l],void 0!==p&&(t.push(f.time),a.push(p)),f=i[h++]}while(void 0!==f)},subclip:function(i,t,a,l,h=30){const f=i.clone();f.name=t;const p=[];for(let b=0;b<f.tracks.length;++b){const A=f.tracks[b],C=A.getValueSize(),M=[],R=[];for(let k=0;k<A.times.length;++k){const z=A.times[k]*h;if(!(z<a||z>=l)){M.push(A.times[k]);for(let pe=0;pe<C;++pe)R.push(A.values[k*C+pe])}}0!==M.length&&(A.times=Rn.convertArray(M,A.times.constructor),A.values=Rn.convertArray(R,A.values.constructor),p.push(A))}f.tracks=p;let y=1/0;for(let b=0;b<f.tracks.length;++b)y>f.tracks[b].times[0]&&(y=f.tracks[b].times[0]);for(let b=0;b<f.tracks.length;++b)f.tracks[b].shift(-1*y);return f.resetDuration(),f},makeClipAdditive:function(i,t=0,a=i,l=30){l<=0&&(l=30);const h=a.tracks.length,f=t/l;for(let p=0;p<h;++p){const y=a.tracks[p],b=y.ValueTypeName;if("bool"===b||"string"===b)continue;const A=i.tracks.find(function(V){return V.name===y.name&&V.ValueTypeName===b});if(void 0===A)continue;let C=0;const M=y.getValueSize();y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=M/3);let R=0;const k=A.getValueSize();A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(R=k/3);const z=y.times.length-1;let pe;if(f<=y.times[0])pe=Rn.arraySlice(y.values,C,M-C);else if(f>=y.times[z]){const V=z*M+C;pe=Rn.arraySlice(y.values,V,V+M-C)}else{const V=y.createInterpolant(),U=C,je=M-C;V.evaluate(f),pe=Rn.arraySlice(V.resultBuffer,U,je)}"quaternion"===b&&(new br).fromArray(pe).normalize().conjugate().toArray(pe);const ce=A.times.length;for(let V=0;V<ce;++V){const U=V*k+R;if("quaternion"===b)br.multiplyQuaternionsFlat(A.values,U,pe,0,A.values,U);else{const je=k-2*R;for(let Ze=0;Ze<je;++Ze)A.values[U+Ze]-=pe[Ze]}}}return i.blendMode=2501,i}};function Fa(i,t,a,l){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=void 0!==l?l:new t.constructor(a),this.sampleValues=t,this.valueSize=a}function vh(i,t,a,l){Fa.call(this,i,t,a,l),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function jl(i,t,a,l){Fa.call(this,i,t,a,l)}function gh(i,t,a,l){Fa.call(this,i,t,a,l)}function Pr(i,t,a,l){if(void 0===i)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=Rn.convertArray(t,this.TimeBufferType),this.values=Rn.convertArray(a,this.ValueBufferType),this.setInterpolation(l||this.DefaultInterpolation)}function Qu(i,t,a){Pr.call(this,i,t,a)}function yh(i,t,a,l){Pr.call(this,i,t,a,l)}function Xl(i,t,a,l){Pr.call(this,i,t,a,l)}function _h(i,t,a,l){Fa.call(this,i,t,a,l)}function xh(i,t,a,l){Pr.call(this,i,t,a,l)}function ef(i,t,a,l){Pr.call(this,i,t,a,l)}function ql(i,t,a,l){Pr.call(this,i,t,a,l)}function Na(i,t=-1,a,l=2500){this.name=i,this.tracks=a,this.duration=t,this.blendMode=l,this.uuid=hn.generateUUID(),this.duration<0&&this.resetDuration()}function Nm(i){if(void 0===i.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function Ku(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xl;case"vector":case"vector2":case"vector3":case"vector4":return ql;case"color":return yh;case"quaternion":return xh;case"bool":case"boolean":return Qu;case"string":return ef}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}(i.type);if(void 0===i.times){const a=[],l=[];Rn.flattenJSON(i.keys,a,l,"value"),i.times=a,i.values=l}return void 0!==t.parse?t.parse(i):new t(i.name,i.times,i.values,i.interpolation)}Object.assign(Fa.prototype,{evaluate:function(i){const t=this.parameterPositions;let a=this._cachedIndex,l=t[a],h=t[a-1];e:{t:{let f;i:{n:if(!(i<l)){for(let p=a+2;;){if(void 0===l){if(i<h)break n;return a=t.length,this._cachedIndex=a,this.afterEnd_(a-1,i,h)}if(a===p)break;if(h=l,l=t[++a],i<l)break t}f=t.length;break i}if(i>=h)break e;{const p=t[1];i<p&&(a=2,h=p);for(let y=a-2;;){if(void 0===h)return this._cachedIndex=0,this.beforeStart_(0,i,l);if(a===y)break;if(l=h,h=t[--a-1],i>=h)break t}f=a,a=0}}for(;a<f;){const p=a+f>>>1;i<t[p]?f=p:a=p+1}if(l=t[a],h=t[a-1],void 0===h)return this._cachedIndex=0,this.beforeStart_(0,i,l);if(void 0===l)return a=t.length,this._cachedIndex=a,this.afterEnd_(a-1,h,i)}this._cachedIndex=a,this.intervalChanged_(a,h,l)}return this.interpolate_(a,h,i,l)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(i){const t=this.resultBuffer,a=this.sampleValues,l=this.valueSize,h=i*l;for(let f=0;f!==l;++f)t[f]=a[h+f];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Fa.prototype,{beforeStart_:Fa.prototype.copySampleValue_,afterEnd_:Fa.prototype.copySampleValue_}),vh.prototype=Object.assign(Object.create(Fa.prototype),{constructor:vh,DefaultSettings_:{endingStart:ul,endingEnd:ul},intervalChanged_:function(i,t,a){const l=this.parameterPositions;let h=i-2,f=i+1,p=l[h],y=l[f];if(void 0===p)switch(this.getSettings_().endingStart){case go:h=i,p=2*t-a;break;case 2402:h=l.length-2,p=t+l[h]-l[h+1];break;default:h=i,p=a}if(void 0===y)switch(this.getSettings_().endingEnd){case go:f=i,y=2*a-t;break;case 2402:f=1,y=a+l[1]-l[0];break;default:f=i-1,y=t}const b=.5*(a-t),A=this.valueSize;this._weightPrev=b/(t-p),this._weightNext=b/(y-a),this._offsetPrev=h*A,this._offsetNext=f*A},interpolate_:function(i,t,a,l){const h=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=i*p,b=y-p,A=this._offsetPrev,C=this._offsetNext,M=this._weightPrev,R=this._weightNext,k=(a-t)/(l-t),z=k*k,pe=z*k,ce=-M*pe+2*M*z-M*k,V=(1+M)*pe+(-1.5-2*M)*z+(-.5+M)*k+1,U=(-1-R)*pe+(1.5+R)*z+.5*k,je=R*pe-R*z;for(let Ze=0;Ze!==p;++Ze)h[Ze]=ce*f[A+Ze]+V*f[b+Ze]+U*f[y+Ze]+je*f[C+Ze];return h}}),jl.prototype=Object.assign(Object.create(Fa.prototype),{constructor:jl,interpolate_:function(i,t,a,l){const h=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=i*p,b=y-p,A=(a-t)/(l-t),C=1-A;for(let M=0;M!==p;++M)h[M]=f[b+M]*C+f[y+M]*A;return h}}),gh.prototype=Object.assign(Object.create(Fa.prototype),{constructor:gh,interpolate_:function(i){return this.copySampleValue_(i-1)}}),Object.assign(Pr,{toJSON:function(i){const t=i.constructor;let a;if(void 0!==t.toJSON)a=t.toJSON(i);else{a={name:i.name,times:Rn.convertArray(i.times,Array),values:Rn.convertArray(i.values,Array)};const l=i.getInterpolation();l!==i.DefaultInterpolation&&(a.interpolation=l)}return a.type=i.ValueTypeName,a}}),Object.assign(Pr.prototype,{constructor:Pr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(i){return new gh(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodLinear:function(i){return new jl(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:function(i){return new vh(this.times,this.values,this.getValueSize(),i)},setInterpolation:function(i){let t;switch(i){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(i===this.DefaultInterpolation)throw new Error(a);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",a),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(i){if(0!==i){const t=this.times;for(let a=0,l=t.length;a!==l;++a)t[a]+=i}return this},scale:function(i){if(1!==i){const t=this.times;for(let a=0,l=t.length;a!==l;++a)t[a]*=i}return this},trim:function(i,t){const a=this.times,l=a.length;let h=0,f=l-1;for(;h!==l&&a[h]<i;)++h;for(;-1!==f&&a[f]>t;)--f;if(++f,0!==h||f!==l){h>=f&&(f=Math.max(f,1),h=f-1);const p=this.getValueSize();this.times=Rn.arraySlice(a,h,f),this.values=Rn.arraySlice(this.values,h*p,f*p)}return this},validate:function(){let i=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);const a=this.times,l=this.values,h=a.length;0===h&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let f=null;for(let p=0;p!==h;p++){const y=a[p];if("number"==typeof y&&isNaN(y)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,p,y),i=!1;break}if(null!==f&&f>y){console.error("THREE.KeyframeTrack: Out of order keys.",this,p,y,f),i=!1;break}f=y}if(void 0!==l&&Rn.isTypedArray(l))for(let p=0,y=l.length;p!==y;++p){const b=l[p];if(isNaN(b)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,p,b),i=!1;break}}return i},optimize:function(){const i=Rn.arraySlice(this.times),t=Rn.arraySlice(this.values),a=this.getValueSize(),l=2302===this.getInterpolation(),h=i.length-1;let f=1;for(let p=1;p<h;++p){let y=!1;const b=i[p];if(b!==i[p+1]&&(1!==p||b!==i[0]))if(l)y=!0;else{const C=p*a,M=C-a,R=C+a;for(let k=0;k!==a;++k){const z=t[C+k];if(z!==t[M+k]||z!==t[R+k]){y=!0;break}}}if(y){if(p!==f){i[f]=i[p];const C=p*a,M=f*a;for(let R=0;R!==a;++R)t[M+R]=t[C+R]}++f}}if(h>0){i[f]=i[h];for(let p=h*a,y=f*a,b=0;b!==a;++b)t[y+b]=t[p+b];++f}return f!==i.length?(this.times=Rn.arraySlice(i,0,f),this.values=Rn.arraySlice(t,0,f*a)):(this.times=i,this.values=t),this},clone:function(){const i=Rn.arraySlice(this.times,0),t=Rn.arraySlice(this.values,0),l=new(0,this.constructor)(this.name,i,t);return l.createInterpolant=this.createInterpolant,l}}),Qu.prototype=Object.assign(Object.create(Pr.prototype),{constructor:Qu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),yh.prototype=Object.assign(Object.create(Pr.prototype),{constructor:yh,ValueTypeName:"color"}),Xl.prototype=Object.assign(Object.create(Pr.prototype),{constructor:Xl,ValueTypeName:"number"}),_h.prototype=Object.assign(Object.create(Fa.prototype),{constructor:_h,interpolate_:function(i,t,a,l){const h=this.resultBuffer,f=this.sampleValues,p=this.valueSize,y=(a-t)/(l-t);let b=i*p;for(let A=b+p;b!==A;b+=4)br.slerpFlat(h,0,f,b-p,f,b,y);return h}}),xh.prototype=Object.assign(Object.create(Pr.prototype),{constructor:xh,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(i){return new _h(this.times,this.values,this.getValueSize(),i)},InterpolantFactoryMethodSmooth:void 0}),ef.prototype=Object.assign(Object.create(Pr.prototype),{constructor:ef,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ql.prototype=Object.assign(Object.create(Pr.prototype),{constructor:ql,ValueTypeName:"vector"}),Object.assign(Na,{parse:function(i){const t=[],a=i.tracks,l=1/(i.fps||1);for(let f=0,p=a.length;f!==p;++f)t.push(Nm(a[f]).scale(l));const h=new Na(i.name,i.duration,t,i.blendMode);return h.uuid=i.uuid,h},toJSON:function(i){const t=[],a=i.tracks,l={name:i.name,duration:i.duration,tracks:t,uuid:i.uuid,blendMode:i.blendMode};for(let h=0,f=a.length;h!==f;++h)t.push(Pr.toJSON(a[h]));return l},CreateFromMorphTargetSequence:function(i,t,a,l){const h=t.length,f=[];for(let p=0;p<h;p++){let y=[],b=[];y.push((p+h-1)%h,p,(p+1)%h),b.push(0,1,0);const A=Rn.getKeyframeOrder(y);y=Rn.sortedArray(y,1,A),b=Rn.sortedArray(b,1,A),!l&&0===y[0]&&(y.push(h),b.push(b[0])),f.push(new Xl(".morphTargetInfluences["+t[p].name+"]",y,b).scale(1/a))}return new Na(i,-1,f)},findByName:function(i,t){let a=i;if(!Array.isArray(i)){const l=i;a=l.geometry&&l.geometry.animations||l.animations}for(let l=0;l<a.length;l++)if(a[l].name===t)return a[l];return null},CreateClipsFromMorphTargetSequences:function(i,t,a){const l={},h=/^([\w-]*?)([\d]+)$/;for(let p=0,y=i.length;p<y;p++){const b=i[p],A=b.name.match(h);if(A&&A.length>1){const C=A[1];let M=l[C];M||(l[C]=M=[]),M.push(b)}}const f=[];for(const p in l)f.push(Na.CreateFromMorphTargetSequence(p,l[p],t,a));return f},parseAnimation:function(i,t){if(!i)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const a=function(C,M,R,k,z){if(0!==R.length){const pe=[],ce=[];Rn.flattenJSON(R,pe,ce,k),0!==pe.length&&z.push(new C(M,pe,ce))}},l=[],h=i.name||"default",f=i.fps||30,p=i.blendMode;let y=i.length||-1;const b=i.hierarchy||[];for(let C=0;C<b.length;C++){const M=b[C].keys;if(M&&0!==M.length)if(M[0].morphTargets){const R={};let k;for(k=0;k<M.length;k++)if(M[k].morphTargets)for(let z=0;z<M[k].morphTargets.length;z++)R[M[k].morphTargets[z]]=-1;for(const z in R){const pe=[],ce=[];for(let V=0;V!==M[k].morphTargets.length;++V){const U=M[k];pe.push(U.time),ce.push(U.morphTarget===z?1:0)}l.push(new Xl(".morphTargetInfluence["+z+"]",pe,ce))}y=R.length*(f||1)}else{const R=".bones["+t[C].name+"]";a(ql,R+".position",M,"pos",l),a(xh,R+".quaternion",M,"rot",l),a(ql,R+".scale",M,"scl",l)}}return 0===l.length?null:new Na(h,y,l,p)}}),Object.assign(Na.prototype,{resetDuration:function(){let t=0;for(let a=0,l=this.tracks.length;a!==l;++a){const h=this.tracks[a];t=Math.max(t,h.times[h.times.length-1])}return this.duration=t,this},trim:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){let i=!0;for(let t=0;t<this.tracks.length;t++)i=i&&this.tracks[t].validate();return i},optimize:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){const i=[];for(let t=0;t<this.tracks.length;t++)i.push(this.tracks[t].clone());return new Na(this.name,this.duration,i,this.blendMode)},toJSON:function(){return Na.toJSON(this)}});const Yl={enabled:!1,files:{},add:function(i,t){!1!==this.enabled&&(this.files[i]=t)},get:function(i){if(!1!==this.enabled)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}},km=new function O0(i,t,a){const l=this;let y,h=!1,f=0,p=0;const b=[];this.onStart=void 0,this.onLoad=i,this.onProgress=t,this.onError=a,this.itemStart=function(A){p++,!1===h&&void 0!==l.onStart&&l.onStart(A,f,p),h=!0},this.itemEnd=function(A){f++,void 0!==l.onProgress&&l.onProgress(A,f,p),f===p&&(h=!1,void 0!==l.onLoad&&l.onLoad())},this.itemError=function(A){void 0!==l.onError&&l.onError(A)},this.resolveURL=function(A){return y?y(A):A},this.setURLModifier=function(A){return y=A,this},this.addHandler=function(A,C){return b.push(A,C),this},this.removeHandler=function(A){const C=b.indexOf(A);return-1!==C&&b.splice(C,2),this},this.getHandler=function(A){for(let C=0,M=b.length;C<M;C+=2){const R=b[C],k=b[C+1];if(R.global&&(R.lastIndex=0),R.test(A))return k}return null}};function kn(i){this.manager=void 0!==i?i:km,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(kn.prototype,{load:function(){},loadAsync:function(i,t){const a=this;return new Promise(function(l,h){a.load(i,l,t,h)})},parse:function(){},setCrossOrigin:function(i){return this.crossOrigin=i,this},setWithCredentials:function(i){return this.withCredentials=i,this},setPath:function(i){return this.path=i,this},setResourcePath:function(i){return this.resourcePath=i,this},setRequestHeader:function(i){return this.requestHeader=i,this}});const fa={};function Gs(i){kn.call(this,i)}function Bm(i){kn.call(this,i)}function tf(i){kn.call(this,i)}function bh(i){kn.call(this,i)}function Zu(i){kn.call(this,i)}function Th(i){kn.call(this,i)}function Ah(i){kn.call(this,i)}function Wi(){this.type="Curve",this.arcLengthDivisions=200}function Jn(i,t,a,l,h,f,p,y){Wi.call(this),this.type="EllipseCurve",this.aX=i||0,this.aY=t||0,this.xRadius=a||1,this.yRadius=l||1,this.aStartAngle=h||0,this.aEndAngle=f||2*Math.PI,this.aClockwise=p||!1,this.aRotation=y||0}function Ql(i,t,a,l,h,f){Jn.call(this,i,t,a,a,l,h,f),this.type="ArcCurve"}function $u(){let i=0,t=0,a=0,l=0;function h(f,p,y,b){i=f,t=y,a=-3*f+3*p-2*y-b,l=2*f-2*p+y+b}return{initCatmullRom:function(f,p,y,b,A){h(p,y,A*(y-f),A*(b-p))},initNonuniformCatmullRom:function(f,p,y,b,A,C,M){let R=(p-f)/A-(y-f)/(A+C)+(y-p)/C,k=(y-p)/C-(b-p)/(C+M)+(b-y)/M;R*=C,k*=C,h(p,y,R,k)},calc:function(f){const p=f*f;return i+t*f+a*p+l*(p*f)}}}Gs.prototype=Object.assign(Object.create(kn.prototype),{constructor:Gs,load:function(i,t,a,l){void 0===i&&(i=""),void 0!==this.path&&(i=this.path+i),i=this.manager.resolveURL(i);const h=this,f=Yl.get(i);if(void 0!==f)return h.manager.itemStart(i),setTimeout(function(){t&&t(f),h.manager.itemEnd(i)},0),f;if(void 0!==fa[i])return void fa[i].push({onLoad:t,onProgress:a,onError:l});const y=i.match(/^data:(.*?)(;base64)?,(.*)$/);let b;if(y){const A=y[1],C=!!y[2];let M=y[3];M=decodeURIComponent(M),C&&(M=atob(M));try{let R;const k=(this.responseType||"").toLowerCase();switch(k){case"arraybuffer":case"blob":const z=new Uint8Array(M.length);for(let ce=0;ce<M.length;ce++)z[ce]=M.charCodeAt(ce);R="blob"===k?new Blob([z.buffer],{type:A}):z.buffer;break;case"document":R=(new DOMParser).parseFromString(M,A);break;case"json":R=JSON.parse(M);break;default:R=M}setTimeout(function(){t&&t(R),h.manager.itemEnd(i)},0)}catch(R){setTimeout(function(){l&&l(R),h.manager.itemError(i),h.manager.itemEnd(i)},0)}}else{fa[i]=[],fa[i].push({onLoad:t,onProgress:a,onError:l}),b=new XMLHttpRequest,b.open("GET",i,!0),b.addEventListener("load",function(A){const C=this.response,M=fa[i];if(delete fa[i],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Yl.add(i,C);for(let R=0,k=M.length;R<k;R++){const z=M[R];z.onLoad&&z.onLoad(C)}h.manager.itemEnd(i)}else{for(let R=0,k=M.length;R<k;R++){const z=M[R];z.onError&&z.onError(A)}h.manager.itemError(i),h.manager.itemEnd(i)}},!1),b.addEventListener("progress",function(A){const C=fa[i];for(let M=0,R=C.length;M<R;M++){const k=C[M];k.onProgress&&k.onProgress(A)}},!1),b.addEventListener("error",function(A){const C=fa[i];delete fa[i];for(let M=0,R=C.length;M<R;M++){const k=C[M];k.onError&&k.onError(A)}h.manager.itemError(i),h.manager.itemEnd(i)},!1),b.addEventListener("abort",function(A){const C=fa[i];delete fa[i];for(let M=0,R=C.length;M<R;M++){const k=C[M];k.onError&&k.onError(A)}h.manager.itemError(i),h.manager.itemEnd(i)},!1),void 0!==this.responseType&&(b.responseType=this.responseType),void 0!==this.withCredentials&&(b.withCredentials=this.withCredentials),b.overrideMimeType&&b.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const A in this.requestHeader)b.setRequestHeader(A,this.requestHeader[A]);b.send(null)}return h.manager.itemStart(i),b},setResponseType:function(i){return this.responseType=i,this},setMimeType:function(i){return this.mimeType=i,this}}),Bm.prototype=Object.assign(Object.create(kn.prototype),{constructor:Bm,load:function(i,t,a,l){const h=this,f=new Gs(h.manager);f.setPath(h.path),f.setRequestHeader(h.requestHeader),f.setWithCredentials(h.withCredentials),f.load(i,function(p){try{t(h.parse(JSON.parse(p)))}catch(y){l?l(y):console.error(y),h.manager.itemError(i)}},a,l)},parse:function(i){const t=[];for(let a=0;a<i.length;a++){const l=Na.parse(i[a]);t.push(l)}return t}}),tf.prototype=Object.assign(Object.create(kn.prototype),{constructor:tf,load:function(i,t,a,l){const h=this,f=[],p=new Gu,y=new Gs(this.manager);y.setPath(this.path),y.setResponseType("arraybuffer"),y.setRequestHeader(this.requestHeader),y.setWithCredentials(h.withCredentials);let b=0;function A(C){y.load(i[C],function(M){const R=h.parse(M,!0);f[C]={width:R.width,height:R.height,format:R.format,mipmaps:R.mipmaps},b+=1,6===b&&(1===R.mipmapCount&&(p.minFilter=Fi),p.image=f,p.format=R.format,p.needsUpdate=!0,t&&t(p))},a,l)}if(Array.isArray(i))for(let C=0,M=i.length;C<M;++C)A(C);else y.load(i,function(C){const M=h.parse(C,!0);if(M.isCubemap){const R=M.mipmaps.length/M.mipmapCount;for(let k=0;k<R;k++){f[k]={mipmaps:[]};for(let z=0;z<M.mipmapCount;z++)f[k].mipmaps.push(M.mipmaps[k*M.mipmapCount+z]),f[k].format=M.format,f[k].width=M.width,f[k].height=M.height}p.image=f}else p.image.width=M.width,p.image.height=M.height,p.mipmaps=M.mipmaps;1===M.mipmapCount&&(p.minFilter=Fi),p.format=M.format,p.needsUpdate=!0,t&&t(p)},a,l);return p}}),bh.prototype=Object.assign(Object.create(kn.prototype),{constructor:bh,load:function(i,t,a,l){void 0!==this.path&&(i=this.path+i),i=this.manager.resolveURL(i);const h=this,f=Yl.get(i);if(void 0!==f)return h.manager.itemStart(i),setTimeout(function(){t&&t(f),h.manager.itemEnd(i)},0),f;const p=document.createElementNS("http://www.w3.org/1999/xhtml","img");function y(){p.removeEventListener("load",y,!1),p.removeEventListener("error",b,!1),Yl.add(i,this),t&&t(this),h.manager.itemEnd(i)}function b(A){p.removeEventListener("load",y,!1),p.removeEventListener("error",b,!1),l&&l(A),h.manager.itemError(i),h.manager.itemEnd(i)}return p.addEventListener("load",y,!1),p.addEventListener("error",b,!1),"data:"!==i.substr(0,5)&&void 0!==this.crossOrigin&&(p.crossOrigin=this.crossOrigin),h.manager.itemStart(i),p.src=i,p}}),Zu.prototype=Object.assign(Object.create(kn.prototype),{constructor:Zu,load:function(i,t,a,l){const h=new Da,f=new bh(this.manager);f.setCrossOrigin(this.crossOrigin),f.setPath(this.path);let p=0;function y(b){f.load(i[b],function(A){h.images[b]=A,p++,6===p&&(h.needsUpdate=!0,t&&t(h))},void 0,l)}for(let b=0;b<i.length;++b)y(b);return h}}),Th.prototype=Object.assign(Object.create(kn.prototype),{constructor:Th,load:function(i,t,a,l){const h=this,f=new Xa,p=new Gs(this.manager);return p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setPath(this.path),p.setWithCredentials(h.withCredentials),p.load(i,function(y){const b=h.parse(y);!b||(void 0!==b.image?f.image=b.image:void 0!==b.data&&(f.image.width=b.width,f.image.height=b.height,f.image.data=b.data),f.wrapS=void 0!==b.wrapS?b.wrapS:kt,f.wrapT=void 0!==b.wrapT?b.wrapT:kt,f.magFilter=void 0!==b.magFilter?b.magFilter:Fi,f.minFilter=void 0!==b.minFilter?b.minFilter:Fi,f.anisotropy=void 0!==b.anisotropy?b.anisotropy:1,void 0!==b.encoding&&(f.encoding=b.encoding),void 0!==b.flipY&&(f.flipY=b.flipY),void 0!==b.format&&(f.format=b.format),void 0!==b.type&&(f.type=b.type),void 0!==b.mipmaps&&(f.mipmaps=b.mipmaps,f.minFilter=1008),1===b.mipmapCount&&(f.minFilter=Fi),f.needsUpdate=!0,t&&t(f,b))},a,l),f}}),Ah.prototype=Object.assign(Object.create(kn.prototype),{constructor:Ah,load:function(i,t,a,l){const h=new zn,f=new bh(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(i,function(p){h.image=p;const y=i.search(/\.jpe?g($|\?)/i)>0||0===i.search(/^data\:image\/jpeg/);h.format=y?Ca:Hr,h.needsUpdate=!0,void 0!==t&&t(h)},a,l),h}}),Object.assign(Wi.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(i,t){const a=this.getUtoTmapping(i);return this.getPoint(a,t)},getPoints:function(i=5){const t=[];for(let a=0;a<=i;a++)t.push(this.getPoint(a/i));return t},getSpacedPoints:function(i=5){const t=[];for(let a=0;a<=i;a++)t.push(this.getPointAt(a/i));return t},getLength:function(){const i=this.getLengths();return i[i.length-1]},getLengths:function(i){if(void 0===i&&(i=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let a,l=this.getPoint(0),h=0;t.push(0);for(let f=1;f<=i;f++)a=this.getPoint(f/i),h+=a.distanceTo(l),t.push(h),l=a;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(i,t){const a=this.getLengths();let l=0;const h=a.length;let f;f=t||i*a[h-1];let b,p=0,y=h-1;for(;p<=y;)if(l=Math.floor(p+(y-p)/2),b=a[l]-f,b<0)p=l+1;else{if(!(b>0)){y=l;break}y=l-1}if(l=y,a[l]===f)return l/(h-1);const A=a[l];return(l+(f-A)/(a[l+1]-A))/(h-1)},getTangent:function(i,t){let l=i-1e-4,h=i+1e-4;l<0&&(l=0),h>1&&(h=1);const f=this.getPoint(l),p=this.getPoint(h),y=t||(f.isVector2?new Ct:new Ge);return y.copy(p).sub(f).normalize(),y},getTangentAt:function(i,t){const a=this.getUtoTmapping(i);return this.getTangent(a,t)},computeFrenetFrames:function(i,t){const a=new Ge,l=[],h=[],f=[],p=new Ge,y=new xn;for(let R=0;R<=i;R++)l[R]=this.getTangentAt(R/i,new Ge),l[R].normalize();h[0]=new Ge,f[0]=new Ge;let b=Number.MAX_VALUE;const A=Math.abs(l[0].x),C=Math.abs(l[0].y),M=Math.abs(l[0].z);A<=b&&(b=A,a.set(1,0,0)),C<=b&&(b=C,a.set(0,1,0)),M<=b&&a.set(0,0,1),p.crossVectors(l[0],a).normalize(),h[0].crossVectors(l[0],p),f[0].crossVectors(l[0],h[0]);for(let R=1;R<=i;R++){if(h[R]=h[R-1].clone(),f[R]=f[R-1].clone(),p.crossVectors(l[R-1],l[R]),p.length()>Number.EPSILON){p.normalize();const k=Math.acos(hn.clamp(l[R-1].dot(l[R]),-1,1));h[R].applyMatrix4(y.makeRotationAxis(p,k))}f[R].crossVectors(l[R],h[R])}if(!0===t){let R=Math.acos(hn.clamp(h[0].dot(h[i]),-1,1));R/=i,l[0].dot(p.crossVectors(h[0],h[i]))>0&&(R=-R);for(let k=1;k<=i;k++)h[k].applyMatrix4(y.makeRotationAxis(l[k],R*k)),f[k].crossVectors(l[k],h[k])}return{tangents:l,normals:h,binormals:f}},clone:function(){return(new this.constructor).copy(this)},copy:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this},toJSON:function(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i},fromJSON:function(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}}),(Jn.prototype=Object.create(Wi.prototype)).constructor=Jn,Jn.prototype.isEllipseCurve=!0,Jn.prototype.getPoint=function(i,t){const a=t||new Ct,l=2*Math.PI;let h=this.aEndAngle-this.aStartAngle;const f=Math.abs(h)<Number.EPSILON;for(;h<0;)h+=l;for(;h>l;)h-=l;h<Number.EPSILON&&(h=f?0:l),!0===this.aClockwise&&!f&&(h===l?h=-l:h-=l);const p=this.aStartAngle+i*h;let y=this.aX+this.xRadius*Math.cos(p),b=this.aY+this.yRadius*Math.sin(p);if(0!==this.aRotation){const A=Math.cos(this.aRotation),C=Math.sin(this.aRotation),M=y-this.aX,R=b-this.aY;y=M*A-R*C+this.aX,b=M*C+R*A+this.aY}return a.set(y,b)},Jn.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this},Jn.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.aX=this.aX,i.aY=this.aY,i.xRadius=this.xRadius,i.yRadius=this.yRadius,i.aStartAngle=this.aStartAngle,i.aEndAngle=this.aEndAngle,i.aClockwise=this.aClockwise,i.aRotation=this.aRotation,i},Jn.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this},(Ql.prototype=Object.create(Jn.prototype)).constructor=Ql,Ql.prototype.isArcCurve=!0;const wh=new Ge,Ko=new $u,Sh=new $u,nf=new $u;function Za(i=[],t=!1,a="centripetal",l=.5){Wi.call(this),this.type="CatmullRomCurve3",this.points=i,this.closed=t,this.curveType=a,this.tension=l}function Um(i,t,a,l,h){const f=.5*(l-t),p=.5*(h-a),y=i*i;return(2*a-2*l+f+p)*(i*y)+(-3*a+3*l-2*f-p)*y+f*i+a}function Ju(i,t,a,l){return function Hm(i,t){const a=1-i;return a*a*t}(i,t)+function Eh(i,t){return 2*(1-i)*i*t}(i,a)+function F0(i,t){return i*i*t}(i,l)}function Kl(i,t,a,l,h){return function N0(i,t){const a=1-i;return a*a*a*t}(i,t)+function k0(i,t){const a=1-i;return 3*a*a*i*t}(i,a)+function zm(i,t){return 3*(1-i)*i*i*t}(i,l)+function Vm(i,t){return i*i*i*t}(i,h)}function ka(i=new Ct,t=new Ct,a=new Ct,l=new Ct){Wi.call(this),this.type="CubicBezierCurve",this.v0=i,this.v1=t,this.v2=a,this.v3=l}function $a(i=new Ge,t=new Ge,a=new Ge,l=new Ge){Wi.call(this),this.type="CubicBezierCurve3",this.v0=i,this.v1=t,this.v2=a,this.v3=l}function Lr(i=new Ct,t=new Ct){Wi.call(this),this.type="LineCurve",this.v1=i,this.v2=t}function gs(i=new Ge,t=new Ge){Wi.call(this),this.type="LineCurve3",this.v1=i,this.v2=t}function ys(i=new Ct,t=new Ct,a=new Ct){Wi.call(this),this.type="QuadraticBezierCurve",this.v0=i,this.v1=t,this.v2=a}function Ja(i=new Ge,t=new Ge,a=new Ge){Wi.call(this),this.type="QuadraticBezierCurve3",this.v0=i,this.v1=t,this.v2=a}function es(i=[]){Wi.call(this),this.type="SplineCurve",this.points=i}(Za.prototype=Object.create(Wi.prototype)).constructor=Za,Za.prototype.isCatmullRomCurve3=!0,Za.prototype.getPoint=function(i,t=new Ge){const a=t,l=this.points,h=l.length,f=(h-(this.closed?0:1))*i;let b,A,p=Math.floor(f),y=f-p;this.closed?p+=p>0?0:(Math.floor(Math.abs(p)/h)+1)*h:0===y&&p===h-1&&(p=h-2,y=1),this.closed||p>0?b=l[(p-1)%h]:(wh.subVectors(l[0],l[1]).add(l[0]),b=wh);const C=l[p%h],M=l[(p+1)%h];if(this.closed||p+2<h?A=l[(p+2)%h]:(wh.subVectors(l[h-1],l[h-2]).add(l[h-1]),A=wh),"centripetal"===this.curveType||"chordal"===this.curveType){const R="chordal"===this.curveType?.5:.25;let k=Math.pow(b.distanceToSquared(C),R),z=Math.pow(C.distanceToSquared(M),R),pe=Math.pow(M.distanceToSquared(A),R);z<1e-4&&(z=1),k<1e-4&&(k=z),pe<1e-4&&(pe=z),Ko.initNonuniformCatmullRom(b.x,C.x,M.x,A.x,k,z,pe),Sh.initNonuniformCatmullRom(b.y,C.y,M.y,A.y,k,z,pe),nf.initNonuniformCatmullRom(b.z,C.z,M.z,A.z,k,z,pe)}else"catmullrom"===this.curveType&&(Ko.initCatmullRom(b.x,C.x,M.x,A.x,this.tension),Sh.initCatmullRom(b.y,C.y,M.y,A.y,this.tension),nf.initCatmullRom(b.z,C.z,M.z,A.z,this.tension));return a.set(Ko.calc(y),Sh.calc(y),nf.calc(y)),a},Za.prototype.copy=function(i){Wi.prototype.copy.call(this,i),this.points=[];for(let t=0,a=i.points.length;t<a;t++)this.points.push(i.points[t].clone());return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this},Za.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);i.points=[];for(let t=0,a=this.points.length;t<a;t++)i.points.push(this.points[t].toArray());return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i},Za.prototype.fromJSON=function(i){Wi.prototype.fromJSON.call(this,i),this.points=[];for(let t=0,a=i.points.length;t<a;t++){const l=i.points[t];this.points.push((new Ge).fromArray(l))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this},(ka.prototype=Object.create(Wi.prototype)).constructor=ka,ka.prototype.isCubicBezierCurve=!0,ka.prototype.getPoint=function(i,t=new Ct){const a=t,l=this.v0,h=this.v1,f=this.v2,p=this.v3;return a.set(Kl(i,l.x,h.x,f.x,p.x),Kl(i,l.y,h.y,f.y,p.y)),a},ka.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},ka.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},ka.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this},($a.prototype=Object.create(Wi.prototype)).constructor=$a,$a.prototype.isCubicBezierCurve3=!0,$a.prototype.getPoint=function(i,t=new Ge){const a=t,l=this.v0,h=this.v1,f=this.v2,p=this.v3;return a.set(Kl(i,l.x,h.x,f.x,p.x),Kl(i,l.y,h.y,f.y,p.y),Kl(i,l.z,h.z,f.z,p.z)),a},$a.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this},$a.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i},$a.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this},(Lr.prototype=Object.create(Wi.prototype)).constructor=Lr,Lr.prototype.isLineCurve=!0,Lr.prototype.getPoint=function(i,t=new Ct){const a=t;return 1===i?a.copy(this.v2):(a.copy(this.v2).sub(this.v1),a.multiplyScalar(i).add(this.v1)),a},Lr.prototype.getPointAt=function(i,t){return this.getPoint(i,t)},Lr.prototype.getTangent=function(i,t){const a=t||new Ct;return a.copy(this.v2).sub(this.v1).normalize(),a},Lr.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Lr.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Lr.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this},(gs.prototype=Object.create(Wi.prototype)).constructor=gs,gs.prototype.isLineCurve3=!0,gs.prototype.getPoint=function(i,t=new Ge){const a=t;return 1===i?a.copy(this.v2):(a.copy(this.v2).sub(this.v1),a.multiplyScalar(i).add(this.v1)),a},gs.prototype.getPointAt=function(i,t){return this.getPoint(i,t)},gs.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v1.copy(i.v1),this.v2.copy(i.v2),this},gs.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},gs.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this},(ys.prototype=Object.create(Wi.prototype)).constructor=ys,ys.prototype.isQuadraticBezierCurve=!0,ys.prototype.getPoint=function(i,t=new Ct){const a=t,l=this.v0,h=this.v1,f=this.v2;return a.set(Ju(i,l.x,h.x,f.x),Ju(i,l.y,h.y,f.y)),a},ys.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},ys.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},ys.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this},(Ja.prototype=Object.create(Wi.prototype)).constructor=Ja,Ja.prototype.isQuadraticBezierCurve3=!0,Ja.prototype.getPoint=function(i,t=new Ge){const a=t,l=this.v0,h=this.v1,f=this.v2;return a.set(Ju(i,l.x,h.x,f.x),Ju(i,l.y,h.y,f.y),Ju(i,l.z,h.z,f.z)),a},Ja.prototype.copy=function(i){return Wi.prototype.copy.call(this,i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this},Ja.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i},Ja.prototype.fromJSON=function(i){return Wi.prototype.fromJSON.call(this,i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this},(es.prototype=Object.create(Wi.prototype)).constructor=es,es.prototype.isSplineCurve=!0,es.prototype.getPoint=function(i,t=new Ct){const a=t,l=this.points,h=(l.length-1)*i,f=Math.floor(h),p=h-f,y=l[0===f?f:f-1],b=l[f],A=l[f>l.length-2?l.length-1:f+1],C=l[f>l.length-3?l.length-1:f+2];return a.set(Um(p,y.x,b.x,A.x,C.x),Um(p,y.y,b.y,A.y,C.y)),a},es.prototype.copy=function(i){Wi.prototype.copy.call(this,i),this.points=[];for(let t=0,a=i.points.length;t<a;t++)this.points.push(i.points[t].clone());return this},es.prototype.toJSON=function(){const i=Wi.prototype.toJSON.call(this);i.points=[];for(let t=0,a=this.points.length;t<a;t++)i.points.push(this.points[t].toArray());return i},es.prototype.fromJSON=function(i){Wi.prototype.fromJSON.call(this,i),this.points=[];for(let t=0,a=i.points.length;t<a;t++){const l=i.points[t];this.points.push((new Ct).fromArray(l))}return this};var B0=Object.freeze({__proto__:null,ArcCurve:Ql,CatmullRomCurve3:Za,CubicBezierCurve:ka,CubicBezierCurve3:$a,EllipseCurve:Jn,LineCurve:Lr,LineCurve3:gs,QuadraticBezierCurve:ys,QuadraticBezierCurve3:Ja,SplineCurve:es});function Ws(){Wi.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function _s(i){Ws.call(this),this.type="Path",this.currentPoint=new Ct,i&&this.setFromPoints(i)}function Zl(i){_s.call(this,i),this.uuid=hn.generateUUID(),this.type="Shape",this.holes=[]}function er(i,t=1){on.call(this),this.type="Light",this.color=new $i(i),this.intensity=t}function rf(i,t,a){er.call(this,i,a),this.type="HemisphereLight",this.position.copy(on.DefaultUp),this.updateMatrix(),this.groundColor=new $i(t)}function Ba(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ct(512,512),this.map=null,this.mapPass=null,this.matrix=new xn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new El,this._frameExtents=new Ct(1,1),this._viewportCount=1,this._viewports=[new Wn(0,0,1,1)]}function Mh(){Ba.call(this,new ur(50,1,.5,500)),this.focus=1}function af(i,t,a,l,h,f){er.call(this,i,t),this.type="SpotLight",this.position.copy(on.DefaultUp),this.updateMatrix(),this.target=new on,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(p){this.intensity=p/Math.PI}}),this.distance=void 0!==a?a:0,this.angle=void 0!==l?l:Math.PI/3,this.penumbra=void 0!==h?h:0,this.decay=void 0!==f?f:1,this.shadow=new Mh}function sf(){Ba.call(this,new ur(90,1,.5,500)),this._frameExtents=new Ct(4,2),this._viewportCount=6,this._viewports=[new Wn(2,1,1,1),new Wn(0,1,1,1),new Wn(3,1,1,1),new Wn(1,1,1,1),new Wn(3,0,1,1),new Wn(1,0,1,1)],this._cubeDirections=[new Ge(1,0,0),new Ge(-1,0,0),new Ge(0,0,1),new Ge(0,0,-1),new Ge(0,1,0),new Ge(0,-1,0)],this._cubeUps=[new Ge(0,1,0),new Ge(0,1,0),new Ge(0,1,0),new Ge(0,1,0),new Ge(0,0,1),new Ge(0,0,-1)]}function Gm(i,t,a,l){er.call(this,i,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(h){this.intensity=h/(4*Math.PI)}}),this.distance=void 0!==a?a:0,this.decay=void 0!==l?l:1,this.shadow=new sf}function of(i=-1,t=1,a=1,l=-1,h=.1,f=2e3){Fs.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=t,this.top=a,this.bottom=l,this.near=h,this.far=f,this.updateProjectionMatrix()}function Ch(){Ba.call(this,new of(-5,5,5,-5,.5,500))}function Wm(i,t){er.call(this,i,t),this.type="DirectionalLight",this.position.copy(on.DefaultUp),this.updateMatrix(),this.target=new on,this.shadow=new Ch}function jm(i,t){er.call(this,i,t),this.type="AmbientLight"}function Xm(i,t,a,l){er.call(this,i,t),this.type="RectAreaLight",this.width=void 0!==a?a:10,this.height=void 0!==l?l:10}Ws.prototype=Object.assign(Object.create(Wi.prototype),{constructor:Ws,add:function(i){this.curves.push(i)},closePath:function(){const i=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);i.equals(t)||this.curves.push(new Lr(t,i))},getPoint:function(i){const t=i*this.getLength(),a=this.getCurveLengths();let l=0;for(;l<a.length;){if(a[l]>=t){const h=a[l]-t,f=this.curves[l],p=f.getLength();return f.getPointAt(0===p?0:1-h/p)}l++}return null},getLength:function(){const i=this.getCurveLengths();return i[i.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let t=0;for(let a=0,l=this.curves.length;a<l;a++)t+=this.curves[a].getLength(),i.push(t);return this.cacheLengths=i,i},getSpacedPoints:function(i=40){const t=[];for(let a=0;a<=i;a++)t.push(this.getPoint(a/i));return this.autoClose&&t.push(t[0]),t},getPoints:function(i=12){const t=[];let a;for(let l=0,h=this.curves;l<h.length;l++){const f=h[l],y=f.getPoints(f&&f.isEllipseCurve?2*i:f&&(f.isLineCurve||f.isLineCurve3)?1:f&&f.isSplineCurve?i*f.points.length:i);for(let b=0;b<y.length;b++){const A=y[b];a&&a.equals(A)||(t.push(A),a=A)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(i){Wi.prototype.copy.call(this,i),this.curves=[];for(let t=0,a=i.curves.length;t<a;t++)this.curves.push(i.curves[t].clone());return this.autoClose=i.autoClose,this},toJSON:function(){const i=Wi.prototype.toJSON.call(this);i.autoClose=this.autoClose,i.curves=[];for(let t=0,a=this.curves.length;t<a;t++)i.curves.push(this.curves[t].toJSON());return i},fromJSON:function(i){Wi.prototype.fromJSON.call(this,i),this.autoClose=i.autoClose,this.curves=[];for(let t=0,a=i.curves.length;t<a;t++){const l=i.curves[t];this.curves.push((new B0[l.type]).fromJSON(l))}return this}}),_s.prototype=Object.assign(Object.create(Ws.prototype),{constructor:_s,setFromPoints:function(i){this.moveTo(i[0].x,i[0].y);for(let t=1,a=i.length;t<a;t++)this.lineTo(i[t].x,i[t].y);return this},moveTo:function(i,t){return this.currentPoint.set(i,t),this},lineTo:function(i,t){const a=new Lr(this.currentPoint.clone(),new Ct(i,t));return this.curves.push(a),this.currentPoint.set(i,t),this},quadraticCurveTo:function(i,t,a,l){const h=new ys(this.currentPoint.clone(),new Ct(i,t),new Ct(a,l));return this.curves.push(h),this.currentPoint.set(a,l),this},bezierCurveTo:function(i,t,a,l,h,f){const p=new ka(this.currentPoint.clone(),new Ct(i,t),new Ct(a,l),new Ct(h,f));return this.curves.push(p),this.currentPoint.set(h,f),this},splineThru:function(i){const a=new es([this.currentPoint.clone()].concat(i));return this.curves.push(a),this.currentPoint.copy(i[i.length-1]),this},arc:function(i,t,a,l,h,f){return this.absarc(i+this.currentPoint.x,t+this.currentPoint.y,a,l,h,f),this},absarc:function(i,t,a,l,h,f){return this.absellipse(i,t,a,a,l,h,f),this},ellipse:function(i,t,a,l,h,f,p,y){return this.absellipse(i+this.currentPoint.x,t+this.currentPoint.y,a,l,h,f,p,y),this},absellipse:function(i,t,a,l,h,f,p,y){const b=new Jn(i,t,a,l,h,f,p,y);if(this.curves.length>0){const C=b.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(b);const A=b.getPoint(1);return this.currentPoint.copy(A),this},copy:function(i){return Ws.prototype.copy.call(this,i),this.currentPoint.copy(i.currentPoint),this},toJSON:function(){const i=Ws.prototype.toJSON.call(this);return i.currentPoint=this.currentPoint.toArray(),i},fromJSON:function(i){return Ws.prototype.fromJSON.call(this,i),this.currentPoint.fromArray(i.currentPoint),this}}),Zl.prototype=Object.assign(Object.create(_s.prototype),{constructor:Zl,getPointsHoles:function(i){const t=[];for(let a=0,l=this.holes.length;a<l;a++)t[a]=this.holes[a].getPoints(i);return t},extractPoints:function(i){return{shape:this.getPoints(i),holes:this.getPointsHoles(i)}},copy:function(i){_s.prototype.copy.call(this,i),this.holes=[];for(let t=0,a=i.holes.length;t<a;t++)this.holes.push(i.holes[t].clone());return this},toJSON:function(){const i=_s.prototype.toJSON.call(this);i.uuid=this.uuid,i.holes=[];for(let t=0,a=this.holes.length;t<a;t++)i.holes.push(this.holes[t].toJSON());return i},fromJSON:function(i){_s.prototype.fromJSON.call(this,i),this.uuid=i.uuid,this.holes=[];for(let t=0,a=i.holes.length;t<a;t++){const l=i.holes[t];this.holes.push((new _s).fromJSON(l))}return this}}),er.prototype=Object.assign(Object.create(on.prototype),{constructor:er,isLight:!0,copy:function(i){return on.prototype.copy.call(this,i),this.color.copy(i.color),this.intensity=i.intensity,this},toJSON:function(i){const t=on.prototype.toJSON.call(this,i);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),rf.prototype=Object.assign(Object.create(er.prototype),{constructor:rf,isHemisphereLight:!0,copy:function(i){return er.prototype.copy.call(this,i),this.groundColor.copy(i.groundColor),this}}),Object.assign(Ba.prototype,{_projScreenMatrix:new xn,_lightPositionWorld:new Ge,_lookTarget:new Ge,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(i){const t=this.camera,a=this.matrix,l=this._projScreenMatrix,h=this._lookTarget,f=this._lightPositionWorld;f.setFromMatrixPosition(i.matrixWorld),t.position.copy(f),h.setFromMatrixPosition(i.target.matrixWorld),t.lookAt(h),t.updateMatrixWorld(),l.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(l),a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),a.multiply(t.projectionMatrix),a.multiply(t.matrixWorldInverse)},getViewport:function(i){return this._viewports[i]},getFrameExtents:function(){return this._frameExtents},copy:function(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const i={};return 0!==this.bias&&(i.bias=this.bias),0!==this.normalBias&&(i.normalBias=this.normalBias),1!==this.radius&&(i.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}}),Mh.prototype=Object.assign(Object.create(Ba.prototype),{constructor:Mh,isSpotLightShadow:!0,updateMatrices:function(i){const t=this.camera,a=2*hn.RAD2DEG*i.angle*this.focus,l=this.mapSize.width/this.mapSize.height,h=i.distance||t.far;(a!==t.fov||l!==t.aspect||h!==t.far)&&(t.fov=a,t.aspect=l,t.far=h,t.updateProjectionMatrix()),Ba.prototype.updateMatrices.call(this,i)}}),af.prototype=Object.assign(Object.create(er.prototype),{constructor:af,isSpotLight:!0,copy:function(i){return er.prototype.copy.call(this,i),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}),sf.prototype=Object.assign(Object.create(Ba.prototype),{constructor:sf,isPointLightShadow:!0,updateMatrices:function(i,t=0){const a=this.camera,l=this.matrix,h=this._lightPositionWorld,f=this._lookTarget,p=this._projScreenMatrix;h.setFromMatrixPosition(i.matrixWorld),a.position.copy(h),f.copy(a.position),f.add(this._cubeDirections[t]),a.up.copy(this._cubeUps[t]),a.lookAt(f),a.updateMatrixWorld(),l.makeTranslation(-h.x,-h.y,-h.z),p.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(p)}}),Gm.prototype=Object.assign(Object.create(er.prototype),{constructor:Gm,isPointLight:!0,copy:function(i){return er.prototype.copy.call(this,i),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}}),of.prototype=Object.assign(Object.create(Fs.prototype),{constructor:of,isOrthographicCamera:!0,copy:function(i,t){return Fs.prototype.copy.call(this,i,t),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=null===i.view?null:Object.assign({},i.view),this},setViewOffset:function(i,t,a,l,h,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=t,this.view.offsetX=a,this.view.offsetY=l,this.view.width=h,this.view.height=f,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const i=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,l=(this.top+this.bottom)/2;let h=a-i,f=a+i,p=l+t,y=l-t;if(null!==this.view&&this.view.enabled){const b=(this.right-this.left)/this.view.fullWidth/this.zoom,A=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=b*this.view.offsetX,f=h+b*this.view.width,p-=A*this.view.offsetY,y=p-A*this.view.height}this.projectionMatrix.makeOrthographic(h,f,p,y,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(i){const t=on.prototype.toJSON.call(this,i);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Ch.prototype=Object.assign(Object.create(Ba.prototype),{constructor:Ch,isDirectionalLightShadow:!0,updateMatrices:function(i){Ba.prototype.updateMatrices.call(this,i)}}),Wm.prototype=Object.assign(Object.create(er.prototype),{constructor:Wm,isDirectionalLight:!0,copy:function(i){return er.prototype.copy.call(this,i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}),jm.prototype=Object.assign(Object.create(er.prototype),{constructor:jm,isAmbientLight:!0}),Xm.prototype=Object.assign(Object.create(er.prototype),{constructor:Xm,isRectAreaLight:!0,copy:function(i){return er.prototype.copy.call(this,i),this.width=i.width,this.height=i.height,this},toJSON:function(i){const t=er.prototype.toJSON.call(this,i);return t.object.width=this.width,t.object.height=this.height,t}});class U0{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new Ge)}set(t){for(let a=0;a<9;a++)this.coefficients[a].copy(t[a]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,a){const l=t.x,h=t.y,f=t.z,p=this.coefficients;return a.copy(p[0]).multiplyScalar(.282095),a.addScaledVector(p[1],.488603*h),a.addScaledVector(p[2],.488603*f),a.addScaledVector(p[3],.488603*l),a.addScaledVector(p[4],l*h*1.092548),a.addScaledVector(p[5],h*f*1.092548),a.addScaledVector(p[6],.315392*(3*f*f-1)),a.addScaledVector(p[7],l*f*1.092548),a.addScaledVector(p[8],.546274*(l*l-h*h)),a}getIrradianceAt(t,a){const l=t.x,h=t.y,f=t.z,p=this.coefficients;return a.copy(p[0]).multiplyScalar(.886227),a.addScaledVector(p[1],1.023328*h),a.addScaledVector(p[2],1.023328*f),a.addScaledVector(p[3],1.023328*l),a.addScaledVector(p[4],.858086*l*h),a.addScaledVector(p[5],.858086*h*f),a.addScaledVector(p[6],.743125*f*f-.247708),a.addScaledVector(p[7],.858086*l*f),a.addScaledVector(p[8],.429043*(l*l-h*h)),a}add(t){for(let a=0;a<9;a++)this.coefficients[a].add(t.coefficients[a]);return this}addScaledSH(t,a){for(let l=0;l<9;l++)this.coefficients[l].addScaledVector(t.coefficients[l],a);return this}scale(t){for(let a=0;a<9;a++)this.coefficients[a].multiplyScalar(t);return this}lerp(t,a){for(let l=0;l<9;l++)this.coefficients[l].lerp(t.coefficients[l],a);return this}equals(t){for(let a=0;a<9;a++)if(!this.coefficients[a].equals(t.coefficients[a]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,a=0){const l=this.coefficients;for(let h=0;h<9;h++)l[h].fromArray(t,a+3*h);return this}toArray(t=[],a=0){const l=this.coefficients;for(let h=0;h<9;h++)l[h].toArray(t,a+3*h);return t}static getBasisAt(t,a){const l=t.x,h=t.y,f=t.z;a[0]=.282095,a[1]=.488603*h,a[2]=.488603*f,a[3]=.488603*l,a[4]=1.092548*l*h,a[5]=1.092548*h*f,a[6]=.315392*(3*f*f-1),a[7]=1.092548*l*f,a[8]=.546274*(l*l-h*h)}}function xs(i,t){er.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==i?i:new U0}function qm(i){kn.call(this,i),this.textures={}}xs.prototype=Object.assign(Object.create(er.prototype),{constructor:xs,isLightProbe:!0,copy:function(i){return er.prototype.copy.call(this,i),this.sh.copy(i.sh),this},fromJSON:function(i){return this.intensity=i.intensity,this.sh.fromArray(i.sh),this},toJSON:function(i){const t=er.prototype.toJSON.call(this,i);return t.object.sh=this.sh.toArray(),t}}),qm.prototype=Object.assign(Object.create(kn.prototype),{constructor:qm,load:function(i,t,a,l){const h=this,f=new Gs(h.manager);f.setPath(h.path),f.setRequestHeader(h.requestHeader),f.setWithCredentials(h.withCredentials),f.load(i,function(p){try{t(h.parse(JSON.parse(p)))}catch(y){l?l(y):console.error(y),h.manager.itemError(i)}},a,l)},parse:function(i){const t=this.textures;function a(h){return void 0===t[h]&&console.warn("THREE.MaterialLoader: Undefined texture",h),t[h]}const l=new D0[i.type];if(void 0!==i.uuid&&(l.uuid=i.uuid),void 0!==i.name&&(l.name=i.name),void 0!==i.color&&void 0!==l.color&&l.color.setHex(i.color),void 0!==i.roughness&&(l.roughness=i.roughness),void 0!==i.metalness&&(l.metalness=i.metalness),void 0!==i.sheen&&(l.sheen=(new $i).setHex(i.sheen)),void 0!==i.emissive&&void 0!==l.emissive&&l.emissive.setHex(i.emissive),void 0!==i.specular&&void 0!==l.specular&&l.specular.setHex(i.specular),void 0!==i.shininess&&(l.shininess=i.shininess),void 0!==i.clearcoat&&(l.clearcoat=i.clearcoat),void 0!==i.clearcoatRoughness&&(l.clearcoatRoughness=i.clearcoatRoughness),void 0!==i.fog&&(l.fog=i.fog),void 0!==i.flatShading&&(l.flatShading=i.flatShading),void 0!==i.blending&&(l.blending=i.blending),void 0!==i.combine&&(l.combine=i.combine),void 0!==i.side&&(l.side=i.side),void 0!==i.opacity&&(l.opacity=i.opacity),void 0!==i.transparent&&(l.transparent=i.transparent),void 0!==i.alphaTest&&(l.alphaTest=i.alphaTest),void 0!==i.depthTest&&(l.depthTest=i.depthTest),void 0!==i.depthWrite&&(l.depthWrite=i.depthWrite),void 0!==i.colorWrite&&(l.colorWrite=i.colorWrite),void 0!==i.stencilWrite&&(l.stencilWrite=i.stencilWrite),void 0!==i.stencilWriteMask&&(l.stencilWriteMask=i.stencilWriteMask),void 0!==i.stencilFunc&&(l.stencilFunc=i.stencilFunc),void 0!==i.stencilRef&&(l.stencilRef=i.stencilRef),void 0!==i.stencilFuncMask&&(l.stencilFuncMask=i.stencilFuncMask),void 0!==i.stencilFail&&(l.stencilFail=i.stencilFail),void 0!==i.stencilZFail&&(l.stencilZFail=i.stencilZFail),void 0!==i.stencilZPass&&(l.stencilZPass=i.stencilZPass),void 0!==i.wireframe&&(l.wireframe=i.wireframe),void 0!==i.wireframeLinewidth&&(l.wireframeLinewidth=i.wireframeLinewidth),void 0!==i.wireframeLinecap&&(l.wireframeLinecap=i.wireframeLinecap),void 0!==i.wireframeLinejoin&&(l.wireframeLinejoin=i.wireframeLinejoin),void 0!==i.rotation&&(l.rotation=i.rotation),1!==i.linewidth&&(l.linewidth=i.linewidth),void 0!==i.dashSize&&(l.dashSize=i.dashSize),void 0!==i.gapSize&&(l.gapSize=i.gapSize),void 0!==i.scale&&(l.scale=i.scale),void 0!==i.polygonOffset&&(l.polygonOffset=i.polygonOffset),void 0!==i.polygonOffsetFactor&&(l.polygonOffsetFactor=i.polygonOffsetFactor),void 0!==i.polygonOffsetUnits&&(l.polygonOffsetUnits=i.polygonOffsetUnits),void 0!==i.skinning&&(l.skinning=i.skinning),void 0!==i.morphTargets&&(l.morphTargets=i.morphTargets),void 0!==i.morphNormals&&(l.morphNormals=i.morphNormals),void 0!==i.dithering&&(l.dithering=i.dithering),void 0!==i.vertexTangents&&(l.vertexTangents=i.vertexTangents),void 0!==i.visible&&(l.visible=i.visible),void 0!==i.toneMapped&&(l.toneMapped=i.toneMapped),void 0!==i.userData&&(l.userData=i.userData),void 0!==i.vertexColors&&(l.vertexColors="number"==typeof i.vertexColors?i.vertexColors>0:i.vertexColors),void 0!==i.uniforms)for(const h in i.uniforms){const f=i.uniforms[h];switch(l.uniforms[h]={},f.type){case"t":l.uniforms[h].value=a(f.value);break;case"c":l.uniforms[h].value=(new $i).setHex(f.value);break;case"v2":l.uniforms[h].value=(new Ct).fromArray(f.value);break;case"v3":l.uniforms[h].value=(new Ge).fromArray(f.value);break;case"v4":l.uniforms[h].value=(new Wn).fromArray(f.value);break;case"m3":l.uniforms[h].value=(new Or).fromArray(f.value);break;case"m4":l.uniforms[h].value=(new xn).fromArray(f.value);break;default:l.uniforms[h].value=f.value}}if(void 0!==i.defines&&(l.defines=i.defines),void 0!==i.vertexShader&&(l.vertexShader=i.vertexShader),void 0!==i.fragmentShader&&(l.fragmentShader=i.fragmentShader),void 0!==i.extensions)for(const h in i.extensions)l.extensions[h]=i.extensions[h];if(void 0!==i.shading&&(l.flatShading=1===i.shading),void 0!==i.size&&(l.size=i.size),void 0!==i.sizeAttenuation&&(l.sizeAttenuation=i.sizeAttenuation),void 0!==i.map&&(l.map=a(i.map)),void 0!==i.matcap&&(l.matcap=a(i.matcap)),void 0!==i.alphaMap&&(l.alphaMap=a(i.alphaMap)),void 0!==i.bumpMap&&(l.bumpMap=a(i.bumpMap)),void 0!==i.bumpScale&&(l.bumpScale=i.bumpScale),void 0!==i.normalMap&&(l.normalMap=a(i.normalMap)),void 0!==i.normalMapType&&(l.normalMapType=i.normalMapType),void 0!==i.normalScale){let h=i.normalScale;!1===Array.isArray(h)&&(h=[h,h]),l.normalScale=(new Ct).fromArray(h)}return void 0!==i.displacementMap&&(l.displacementMap=a(i.displacementMap)),void 0!==i.displacementScale&&(l.displacementScale=i.displacementScale),void 0!==i.displacementBias&&(l.displacementBias=i.displacementBias),void 0!==i.roughnessMap&&(l.roughnessMap=a(i.roughnessMap)),void 0!==i.metalnessMap&&(l.metalnessMap=a(i.metalnessMap)),void 0!==i.emissiveMap&&(l.emissiveMap=a(i.emissiveMap)),void 0!==i.emissiveIntensity&&(l.emissiveIntensity=i.emissiveIntensity),void 0!==i.specularMap&&(l.specularMap=a(i.specularMap)),void 0!==i.envMap&&(l.envMap=a(i.envMap)),void 0!==i.envMapIntensity&&(l.envMapIntensity=i.envMapIntensity),void 0!==i.reflectivity&&(l.reflectivity=i.reflectivity),void 0!==i.refractionRatio&&(l.refractionRatio=i.refractionRatio),void 0!==i.lightMap&&(l.lightMap=a(i.lightMap)),void 0!==i.lightMapIntensity&&(l.lightMapIntensity=i.lightMapIntensity),void 0!==i.aoMap&&(l.aoMap=a(i.aoMap)),void 0!==i.aoMapIntensity&&(l.aoMapIntensity=i.aoMapIntensity),void 0!==i.gradientMap&&(l.gradientMap=a(i.gradientMap)),void 0!==i.clearcoatMap&&(l.clearcoatMap=a(i.clearcoatMap)),void 0!==i.clearcoatRoughnessMap&&(l.clearcoatRoughnessMap=a(i.clearcoatRoughnessMap)),void 0!==i.clearcoatNormalMap&&(l.clearcoatNormalMap=a(i.clearcoatNormalMap)),void 0!==i.clearcoatNormalScale&&(l.clearcoatNormalScale=(new Ct).fromArray(i.clearcoatNormalScale)),void 0!==i.transmission&&(l.transmission=i.transmission),void 0!==i.transmissionMap&&(l.transmissionMap=a(i.transmissionMap)),l},setTextures:function(i){return this.textures=i,this}});function Ph(){Ln.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function ec(i,t,a,l){"number"==typeof a&&(l=a,a=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),wn.call(this,i,t,a),this.meshPerAttribute=l||1}function Ym(i){kn.call(this,i)}function Qm(i){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),kn.call(this,i),this.options={premultiplyAlpha:"none"}}function lf(){this.type="ShapePath",this.color=new $i,this.subPaths=[],this.currentPath=null}Ph.prototype=Object.assign(Object.create(Ln.prototype),{constructor:Ph,isInstancedBufferGeometry:!0,copy:function(i){return Ln.prototype.copy.call(this,i),this.instanceCount=i.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const i=Ln.prototype.toJSON.call(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}}),ec.prototype=Object.assign(Object.create(wn.prototype),{constructor:ec,isInstancedBufferAttribute:!0,copy:function(i){return wn.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},toJSON:function(){const i=wn.prototype.toJSON.call(this);return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}}),Ym.prototype=Object.assign(Object.create(kn.prototype),{constructor:Ym,load:function(i,t,a,l){const h=this,f=new Gs(h.manager);f.setPath(h.path),f.setRequestHeader(h.requestHeader),f.setWithCredentials(h.withCredentials),f.load(i,function(p){try{t(h.parse(JSON.parse(p)))}catch(y){l?l(y):console.error(y),h.manager.itemError(i)}},a,l)},parse:function(i){const t={},a={};function l(R,k){if(void 0!==t[k])return t[k];const pe=R.interleavedBuffers[k],ce=function h(R,k){if(void 0!==a[k])return a[k];const ce=new Uint32Array(R.arrayBuffers[k]).buffer;return a[k]=ce,ce}(R,pe.buffer),U=new Ta(Pc(pe.type,ce),pe.stride);return U.uuid=pe.uuid,t[k]=U,U}const f=i.isInstancedBufferGeometry?new Ph:new Ln,p=i.data.index;if(void 0!==p){const R=Pc(p.type,p.array);f.setIndex(new wn(R,1))}const y=i.data.attributes;for(const R in y){const k=y[R];let z;if(k.isInterleavedBufferAttribute)z=new Go(l(i.data,k.data),k.itemSize,k.offset,k.normalized);else{const pe=Pc(k.type,k.array);z=new(k.isInstancedBufferAttribute?ec:wn)(pe,k.itemSize,k.normalized)}void 0!==k.name&&(z.name=k.name),f.setAttribute(R,z)}const b=i.data.morphAttributes;if(b)for(const R in b){const k=b[R],z=[];for(let pe=0,ce=k.length;pe<ce;pe++){const V=k[pe];let U;U=V.isInterleavedBufferAttribute?new Go(l(i.data,V.data),V.itemSize,V.offset,V.normalized):new wn(Pc(V.type,V.array),V.itemSize,V.normalized),void 0!==V.name&&(U.name=V.name),z.push(U)}f.morphAttributes[R]=z}i.data.morphTargetsRelative&&(f.morphTargetsRelative=!0);const C=i.data.groups||i.data.drawcalls||i.data.offsets;if(void 0!==C)for(let R=0,k=C.length;R!==k;++R){const z=C[R];f.addGroup(z.start,z.count,z.materialIndex)}const M=i.data.boundingSphere;if(void 0!==M){const R=new Ge;void 0!==M.center&&R.fromArray(M.center),f.boundingSphere=new za(R,M.radius)}return i.name&&(f.name=i.name),i.userData&&(f.userData=i.userData),f}}),Qm.prototype=Object.assign(Object.create(kn.prototype),{constructor:Qm,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(i,t,a,l){void 0===i&&(i=""),void 0!==this.path&&(i=this.path+i),i=this.manager.resolveURL(i);const h=this,f=Yl.get(i);if(void 0!==f)return h.manager.itemStart(i),setTimeout(function(){t&&t(f),h.manager.itemEnd(i)},0),f;const p={};p.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(i,p).then(function(y){return y.blob()}).then(function(y){return createImageBitmap(y,h.options)}).then(function(y){Yl.add(i,y),t&&t(y),h.manager.itemEnd(i)}).catch(function(y){l&&l(y),h.manager.itemError(i),h.manager.itemEnd(i)}),h.manager.itemStart(i)}}),Object.assign(lf.prototype,{moveTo:function(i,t){return this.currentPath=new _s,this.subPaths.push(this.currentPath),this.currentPath.moveTo(i,t),this},lineTo:function(i,t){return this.currentPath.lineTo(i,t),this},quadraticCurveTo:function(i,t,a,l){return this.currentPath.quadraticCurveTo(i,t,a,l),this},bezierCurveTo:function(i,t,a,l,h,f){return this.currentPath.bezierCurveTo(i,t,a,l,h,f),this},splineThru:function(i){return this.currentPath.splineThru(i),this},toShapes:function(i,t){function a(V){const U=[];for(let je=0,Ze=V.length;je<Ze;je++){const Je=V[je],Ie=new Zl;Ie.curves=Je.curves,U.push(Ie)}return U}function l(V,U){const je=U.length;let Ze=!1;for(let Je=je-1,Ie=0;Ie<je;Je=Ie++){let it=U[Je],Gt=U[Ie],ht=Gt.x-it.x,At=Gt.y-it.y;if(Math.abs(At)>Number.EPSILON){if(At<0&&(it=U[Ie],ht=-ht,Gt=U[Je],At=-At),V.y<it.y||V.y>Gt.y)continue;if(V.y===it.y){if(V.x===it.x)return!0}else{const Lt=At*(V.x-it.x)-ht*(V.y-it.y);if(0===Lt)return!0;if(Lt<0)continue;Ze=!Ze}}else{if(V.y!==it.y)continue;if(Gt.x<=V.x&&V.x<=it.x||it.x<=V.x&&V.x<=Gt.x)return!0}}return Ze}const h=vs.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===t)return a(f);let p,y,b;const A=[];if(1===f.length)return y=f[0],b=new Zl,b.curves=y.curves,A.push(b),A;let C=!h(f[0].getPoints());C=i?!C:C;const M=[],R=[];let pe,ce,k=[],z=0;R[z]=void 0,k[z]=[];for(let V=0,U=f.length;V<U;V++)y=f[V],pe=y.getPoints(),p=h(pe),p=i?!p:p,p?(!C&&R[z]&&z++,R[z]={s:new Zl,p:pe},R[z].s.curves=y.curves,C&&z++,k[z]=[]):k[z].push({h:y,p:pe[0]});if(!R[0])return a(f);if(R.length>1){let V=!1;const U=[];for(let je=0,Ze=R.length;je<Ze;je++)M[je]=[];for(let je=0,Ze=R.length;je<Ze;je++){const Je=k[je];for(let Ie=0;Ie<Je.length;Ie++){const it=Je[Ie];let Gt=!0;for(let ht=0;ht<R.length;ht++)l(it.p,R[ht].p)&&(je!==ht&&U.push({froms:je,tos:ht,hole:Ie}),Gt?(Gt=!1,M[ht].push(it)):V=!0);Gt&&M[je].push(it)}}U.length>0&&(V||(k=M))}for(let V=0,U=R.length;V<U;V++){b=R[V].s,A.push(b),ce=k[V];for(let je=0,Ze=ce.length;je<Ze;je++)b.holes.push(ce[je].h)}return A}});class Km{constructor(t){Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}generateShapes(t,a=100){const l=[],h=function z0(i,t,a){const l=Array.from?Array.from(i):String(i).split(""),h=t/a.resolution,f=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*h,p=[];let y=0,b=0;for(let A=0;A<l.length;A++){const C=l[A];if("\n"===C)y=0,b-=f;else{const M=V0(C,h,y,b,a);y+=M.offsetX,p.push(M.path)}}return p}(t,a,this.data);for(let f=0,p=h.length;f<p;f++)Array.prototype.push.apply(l,h[f].toShapes());return l}}function V0(i,t,a,l,h){const f=h.glyphs[i]||h.glyphs["?"];if(!f)return void console.error('THREE.Font: character "'+i+'" does not exists in font family '+h.familyName+".");const p=new lf;let y,b,A,C,M,R,k,z;if(f.o){const pe=f._cachedOutline||(f._cachedOutline=f.o.split(" "));for(let ce=0,V=pe.length;ce<V;)switch(pe[ce++]){case"m":y=pe[ce++]*t+a,b=pe[ce++]*t+l,p.moveTo(y,b);break;case"l":y=pe[ce++]*t+a,b=pe[ce++]*t+l,p.lineTo(y,b);break;case"q":A=pe[ce++]*t+a,C=pe[ce++]*t+l,M=pe[ce++]*t+a,R=pe[ce++]*t+l,p.quadraticCurveTo(M,R,A,C);break;case"b":A=pe[ce++]*t+a,C=pe[ce++]*t+l,M=pe[ce++]*t+a,R=pe[ce++]*t+l,k=pe[ce++]*t+a,z=pe[ce++]*t+l,p.bezierCurveTo(M,R,k,z,A,C)}}return{offsetX:f.ha*t,path:p}}function Zm(i){kn.call(this,i)}let tc;Zm.prototype=Object.assign(Object.create(kn.prototype),{constructor:Zm,load:function(i,t,a,l){const h=this,f=new Gs(this.manager);f.setPath(this.path),f.setRequestHeader(this.requestHeader),f.setWithCredentials(h.withCredentials),f.load(i,function(p){let y;try{y=JSON.parse(p)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),y=JSON.parse(p.substring(65,p.length-2))}const b=h.parse(y);t&&t(b)},a,l)},parse:function(i){return new Km(i)}});const $m_getContext=function(){return void 0===tc&&(tc=new(window.AudioContext||window.webkitAudioContext)),tc};function ic(i){kn.call(this,i)}function Sr(i,t,a){xs.call(this,void 0,a);const l=(new $i).set(i),h=(new $i).set(t),f=new Ge(l.r,l.g,l.b),p=new Ge(h.r,h.g,h.b),y=Math.sqrt(Math.PI),b=y*Math.sqrt(.75);this.sh.coefficients[0].copy(f).add(p).multiplyScalar(y),this.sh.coefficients[1].copy(f).sub(p).multiplyScalar(b)}function Jm(i,t){xs.call(this,void 0,t);const a=(new $i).set(i);this.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI))}ic.prototype=Object.assign(Object.create(kn.prototype),{constructor:ic,load:function(i,t,a,l){const h=this,f=new Gs(h.manager);f.setResponseType("arraybuffer"),f.setPath(h.path),f.setRequestHeader(h.requestHeader),f.setWithCredentials(h.withCredentials),f.load(i,function(p){try{const y=p.slice(0);$m_getContext().decodeAudioData(y,function(A){t(A)})}catch(y){l?l(y):console.error(y),h.manager.itemError(i)}},a,l)}}),Sr.prototype=Object.assign(Object.create(xs.prototype),{constructor:Sr,isHemisphereLightProbe:!0,copy:function(i){return xs.prototype.copy.call(this,i),this},toJSON:function(i){return xs.prototype.toJSON.call(this,i)}}),Jm.prototype=Object.assign(Object.create(xs.prototype),{constructor:Jm,isAmbientLightProbe:!0,copy:function(i){return xs.prototype.copy.call(this,i),this},toJSON:function(i){return xs.prototype.toJSON.call(this,i)}});const uf=new xn,ev=new xn;function rv(i,t,a){let l,h,f;switch(this.binding=i,this.valueSize=a,t){case"quaternion":l=this._slerp,h=this._slerpAdditive,f=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*a),this._workIndex=5;break;case"string":case"bool":l=this._select,h=this._select,f=this._setAdditiveIdentityOther,this.buffer=new Array(5*a);break;default:l=this._lerp,h=this._lerpAdditive,f=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*a)}this._mixBufferRegion=l,this._mixBufferRegionAdditive=h,this._setIdentity=f,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(function tv(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ur,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ur,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(i){const t=this._cache;if(t.focus!==i.focus||t.fov!==i.fov||t.aspect!==i.aspect*this.aspect||t.near!==i.near||t.far!==i.far||t.zoom!==i.zoom||t.eyeSep!==this.eyeSep){t.focus=i.focus,t.fov=i.fov,t.aspect=i.aspect*this.aspect,t.near=i.near,t.far=i.far,t.zoom=i.zoom,t.eyeSep=this.eyeSep;const l=i.projectionMatrix.clone(),h=t.eyeSep/2,f=h*t.near/t.focus,p=t.near*Math.tan(hn.DEG2RAD*t.fov*.5)/t.zoom;let y,b;ev.elements[12]=-h,uf.elements[12]=h,y=-p*t.aspect+f,b=p*t.aspect+f,l.elements[0]=2*t.near/(b-y),l.elements[8]=(b+y)/(b-y),this.cameraL.projectionMatrix.copy(l),y=-p*t.aspect-f,b=p*t.aspect-f,l.elements[0]=2*t.near/(b-y),l.elements[8]=(b+y)/(b-y),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(ev),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(uf)}}),Object.assign(rv.prototype,{accumulate:function(i,t){const a=this.buffer,l=this.valueSize,h=i*l+l;let f=this.cumulativeWeight;if(0===f){for(let p=0;p!==l;++p)a[h+p]=a[p];f=t}else f+=t,this._mixBufferRegion(a,h,0,t/f,l);this.cumulativeWeight=f},accumulateAdditive:function(i){const t=this.buffer,a=this.valueSize,l=a*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,l,0,i,a),this.cumulativeWeightAdditive+=i},apply:function(i){const t=this.valueSize,a=this.buffer,l=i*t+t,h=this.cumulativeWeight,f=this.cumulativeWeightAdditive,p=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,h<1&&this._mixBufferRegion(a,l,t*this._origIndex,1-h,t),f>0&&this._mixBufferRegionAdditive(a,l,this._addIndex*t,1,t);for(let y=t,b=t+t;y!==b;++y)if(a[y]!==a[y+t]){p.setValue(a,l);break}},saveOriginalState:function(){const t=this.buffer,a=this.valueSize,l=a*this._origIndex;this.binding.getValue(t,l);for(let h=a,f=l;h!==f;++h)t[h]=t[l+h%a];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_setAdditiveIdentityNumeric:function(){const i=this._addIndex*this.valueSize,t=i+this.valueSize;for(let a=i;a<t;a++)this.buffer[a]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const i=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let a=0;a<this.valueSize;a++)this.buffer[t+a]=this.buffer[i+a]},_select:function(i,t,a,l,h){if(l>=.5)for(let f=0;f!==h;++f)i[t+f]=i[a+f]},_slerp:function(i,t,a,l){br.slerpFlat(i,t,i,t,i,a,l)},_slerpAdditive:function(i,t,a,l,h){const f=this._workIndex*h;br.multiplyQuaternionsFlat(i,f,i,t,i,a),br.slerpFlat(i,t,i,t,i,f,l)},_lerp:function(i,t,a,l,h){const f=1-l;for(let p=0;p!==h;++p){const y=t+p;i[y]=i[y]*f+i[a+p]*l}},_lerpAdditive:function(i,t,a,l,h){for(let f=0;f!==h;++f){const p=t+f;i[p]=i[p]+i[a+f]*l}}});const cf="\\[\\]\\.:\\/",G0=new RegExp("["+cf+"]","g"),hf="[^"+cf+"]",W0="[^"+cf.replace("\\.","")+"]",av=/((?:WC+[\/:])*)/.source.replace("WC",hf),sv=/(WCOD+)?/.source.replace("WCOD",W0),ov=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",hf),lv=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",hf),j0=new RegExp("^"+av+sv+ov+lv+"$"),X0=["material","materials","bones"];function df(i,t,a){const l=a||ra.parseTrackName(t);this._targetGroup=i,this._bindings=i.subscribe_(t,l)}function ra(i,t,a){this.path=t,this.parsedPath=a||ra.parseTrackName(t),this.node=ra.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i}Object.assign(df.prototype,{getValue:function(i,t){this.bind();const l=this._bindings[this._targetGroup.nCachedObjects_];void 0!==l&&l.getValue(i,t)},setValue:function(i,t){const a=this._bindings;for(let l=this._targetGroup.nCachedObjects_,h=a.length;l!==h;++l)a[l].setValue(i,t)},bind:function(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,a=i.length;t!==a;++t)i[t].bind()},unbind:function(){const i=this._bindings;for(let t=this._targetGroup.nCachedObjects_,a=i.length;t!==a;++t)i[t].unbind()}}),Object.assign(ra,{Composite:df,create:function(i,t,a){return i&&i.isAnimationObjectGroup?new ra.Composite(i,t,a):new ra(i,t,a)},sanitizeNodeName:function(i){return i.replace(/\s/g,"_").replace(G0,"")},parseTrackName:function(i){const t=j0.exec(i);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},l=a.nodeName&&a.nodeName.lastIndexOf(".");if(void 0!==l&&-1!==l){const h=a.nodeName.substring(l+1);-1!==X0.indexOf(h)&&(a.nodeName=a.nodeName.substring(0,l),a.objectName=h)}if(null===a.propertyName||0===a.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return a},findNode:function(i,t){if(!t||""===t||"."===t||-1===t||t===i.name||t===i.uuid)return i;if(i.skeleton){const a=i.skeleton.getBoneByName(t);if(void 0!==a)return a}if(i.children){const a=function(h){for(let f=0;f<h.length;f++){const p=h[f];if(p.name===t||p.uuid===t)return p;const y=a(p.children);if(y)return y}return null},l=a(i.children);if(l)return l}return null}}),Object.assign(ra.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,a){t[a]=this.node[this.propertyName]},function(t,a){const l=this.resolvedProperty;for(let h=0,f=l.length;h!==f;++h)t[a++]=l[h]},function(t,a){t[a]=this.resolvedProperty[this.propertyIndex]},function(t,a){this.resolvedProperty.toArray(t,a)}],SetterByBindingTypeAndVersioning:[[function(t,a){this.targetObject[this.propertyName]=t[a]},function(t,a){this.targetObject[this.propertyName]=t[a],this.targetObject.needsUpdate=!0},function(t,a){this.targetObject[this.propertyName]=t[a],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,a){const l=this.resolvedProperty;for(let h=0,f=l.length;h!==f;++h)l[h]=t[a++]},function(t,a){const l=this.resolvedProperty;for(let h=0,f=l.length;h!==f;++h)l[h]=t[a++];this.targetObject.needsUpdate=!0},function(t,a){const l=this.resolvedProperty;for(let h=0,f=l.length;h!==f;++h)l[h]=t[a++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,a){this.resolvedProperty[this.propertyIndex]=t[a]},function(t,a){this.resolvedProperty[this.propertyIndex]=t[a],this.targetObject.needsUpdate=!0},function(t,a){this.resolvedProperty[this.propertyIndex]=t[a],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,a){this.resolvedProperty.fromArray(t,a)},function(t,a){this.resolvedProperty.fromArray(t,a),this.targetObject.needsUpdate=!0},function(t,a){this.resolvedProperty.fromArray(t,a),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,a){this.bind(),this.getValue(t,a)},setValue:function(t,a){this.bind(),this.setValue(t,a)},bind:function(){let i=this.node;const t=this.parsedPath,a=t.objectName,l=t.propertyName;let h=t.propertyIndex;if(i||(i=ra.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(a){let b=t.objectIndex;switch(a){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(let A=0;A<i.length;A++)if(i[A].name===b){b=A;break}break;default:if(void 0===i[a])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[a]}if(void 0!==b){if(void 0===i[b])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[b]}}const f=i[l];if(void 0===f)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+l+" but it wasn't found.",i);let p=this.Versioning.None;this.targetObject=i,void 0!==i.needsUpdate?p=this.Versioning.NeedsUpdate:void 0!==i.matrixWorldNeedsUpdate&&(p=this.Versioning.MatrixWorldNeedsUpdate);let y=this.BindingType.Direct;if(void 0!==h){if("morphTargetInfluences"===l){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==i.morphTargetDictionary[h]&&(h=i.morphTargetDictionary[h])}y=this.BindingType.ArrayElement,this.resolvedProperty=f,this.propertyIndex=h}else void 0!==f.fromArray&&void 0!==f.toArray?(y=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(y=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=l;this.getValue=this.GetterByBindingType[y],this.setValue=this.SetterByBindingTypeAndVersioning[y][p]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(ra.prototype,{_getValue_unbound:ra.prototype.getValue,_setValue_unbound:ra.prototype.setValue}),Object.assign(function ff(){this.uuid=hn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let a=0,l=arguments.length;a!==l;++a)i[arguments[a].uuid]=a;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const i=this._objects,t=this._indicesByUUID,a=this._paths,l=this._parsedPaths,h=this._bindings,f=h.length;let p,y=i.length,b=this.nCachedObjects_;for(let A=0,C=arguments.length;A!==C;++A){const M=arguments[A],R=M.uuid;let k=t[R];if(void 0===k){k=y++,t[R]=k,i.push(M);for(let z=0,pe=f;z!==pe;++z)h[z].push(new ra(M,a[z],l[z]))}else if(k<b){p=i[k];const z=--b,pe=i[z];t[pe.uuid]=k,i[k]=pe,t[R]=z,i[z]=M;for(let ce=0,V=f;ce!==V;++ce){const U=h[ce];let Ze=U[k];U[k]=U[z],void 0===Ze&&(Ze=new ra(M,a[ce],l[ce])),U[z]=Ze}}else i[k]!==p&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=b},remove:function(){const i=this._objects,t=this._indicesByUUID,a=this._bindings,l=a.length;let h=this.nCachedObjects_;for(let f=0,p=arguments.length;f!==p;++f){const y=arguments[f],b=y.uuid,A=t[b];if(void 0!==A&&A>=h){const C=h++,M=i[C];t[M.uuid]=A,i[A]=M,t[b]=C,i[C]=y;for(let R=0,k=l;R!==k;++R){const z=a[R],ce=z[A];z[A]=z[C],z[C]=ce}}}this.nCachedObjects_=h},uncache:function(){const i=this._objects,t=this._indicesByUUID,a=this._bindings,l=a.length;let h=this.nCachedObjects_,f=i.length;for(let p=0,y=arguments.length;p!==y;++p){const A=arguments[p].uuid,C=t[A];if(void 0!==C)if(delete t[A],C<h){const M=--h,R=i[M],k=--f,z=i[k];t[R.uuid]=C,i[C]=R,t[z.uuid]=M,i[M]=z,i.pop();for(let pe=0,ce=l;pe!==ce;++pe){const V=a[pe],je=V[k];V[C]=V[M],V[M]=je,V.pop()}}else{const M=--f,R=i[M];M>0&&(t[R.uuid]=C),i[C]=R,i.pop();for(let k=0,z=l;k!==z;++k){const pe=a[k];pe[C]=pe[M],pe.pop()}}}this.nCachedObjects_=h},subscribe_:function(i,t){const a=this._bindingsIndicesByPath;let l=a[i];const h=this._bindings;if(void 0!==l)return h[l];const f=this._paths,p=this._parsedPaths,y=this._objects,A=this.nCachedObjects_,C=new Array(y.length);l=h.length,a[i]=l,f.push(i),p.push(t),h.push(C);for(let M=A,R=y.length;M!==R;++M)C[M]=new ra(y[M],i,t);return C},unsubscribe_:function(i){const t=this._bindingsIndicesByPath,a=t[i];if(void 0!==a){const l=this._paths,h=this._parsedPaths,f=this._bindings,p=f.length-1,y=f[p];t[i[p]]=a,f[a]=y,f.pop(),h[a]=h[p],h.pop(),l[a]=l[p],l.pop()}}});class Lh{constructor(t,a,l=null,h=a.blendMode){this._mixer=t,this._clip=a,this._localRoot=l,this.blendMode=h;const f=a.tracks,p=f.length,y=new Array(p),b={endingStart:ul,endingEnd:ul};for(let A=0;A!==p;++A){const C=f[A].createInterpolant(null);y[A]=C,C.settings=b}this._interpolantSettings=b,this._interpolants=y,this._propertyBindings=new Array(p),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,a){return this.loop=t,this.repetitions=a,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,a,l){if(t.fadeOut(a),this.fadeIn(a),l){const h=this._clip.duration,f=t._clip.duration,y=h/f;t.warp(1,f/h,a),this.warp(y,1,a)}return this}crossFadeTo(t,a,l){return t.crossFadeFrom(this,a,l)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,a,l){const h=this._mixer,f=h.time,p=this.timeScale;let y=this._timeScaleInterpolant;null===y&&(y=h._lendControlInterpolant(),this._timeScaleInterpolant=y);const b=y.parameterPositions,A=y.sampleValues;return b[0]=f,b[1]=f+l,A[0]=t/p,A[1]=a/p,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,a,l,h){if(!this.enabled)return void this._updateWeight(t);const f=this._startTime;if(null!==f){const b=(t-f)*l;if(b<0||0===l)return;this._startTime=null,a=l*b}a*=this._updateTimeScale(t);const p=this._updateTime(a),y=this._updateWeight(t);if(y>0){const b=this._interpolants,A=this._propertyBindings;if(2501===this.blendMode)for(let C=0,M=b.length;C!==M;++C)b[C].evaluate(p),A[C].accumulateAdditive(y);else for(let C=0,M=b.length;C!==M;++C)b[C].evaluate(p),A[C].accumulate(h,y)}}_updateWeight(t){let a=0;if(this.enabled){a=this.weight;const l=this._weightInterpolant;if(null!==l){const h=l.evaluate(t)[0];a*=h,t>l.parameterPositions[1]&&(this.stopFading(),0===h&&(this.enabled=!1))}}return this._effectiveWeight=a,a}_updateTimeScale(t){let a=0;if(!this.paused){a=this.timeScale;const l=this._timeScaleInterpolant;null!==l&&(a*=l.evaluate(t)[0],t>l.parameterPositions[1]&&(this.stopWarping(),0===a?this.paused=!0:this.timeScale=a))}return this._effectiveTimeScale=a,a}_updateTime(t){const a=this._clip.duration,l=this.loop;let h=this.time+t,f=this._loopCount;const p=2202===l;if(0===t)return-1===f?h:p&&1==(1&f)?a-h:h;if(2200===l){-1===f&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(h>=a)h=a;else{if(!(h<0)){this.time=h;break e}h=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===f&&(t>=0?(f=0,this._setEndings(!0,0===this.repetitions,p)):this._setEndings(0===this.repetitions,!0,p)),h>=a||h<0){const y=Math.floor(h/a);h-=a*y,f+=Math.abs(y);const b=this.repetitions-f;if(b<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,h=t>0?a:0,this.time=h,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===b){const A=t<0;this._setEndings(A,!A,p)}else this._setEndings(!1,!1,p);this._loopCount=f,this.time=h,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:y})}}else this.time=h;if(p&&1==(1&f))return a-h}return h}_setEndings(t,a,l){const h=this._interpolantSettings;l?(h.endingStart=go,h.endingEnd=go):(h.endingStart=t?this.zeroSlopeAtStart?go:ul:2402,h.endingEnd=a?this.zeroSlopeAtEnd?go:ul:2402)}_scheduleFading(t,a,l){const h=this._mixer,f=h.time;let p=this._weightInterpolant;null===p&&(p=h._lendControlInterpolant(),this._weightInterpolant=p);const y=p.parameterPositions,b=p.sampleValues;return y[0]=f,b[0]=a,y[1]=f+t,b[1]=l,this}}function ts(i){this._root=i,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}ts.prototype=Object.assign(Object.create(ya.prototype),{constructor:ts,_bindAction:function(i,t){const a=i._localRoot||this._root,l=i._clip.tracks,h=l.length,f=i._propertyBindings,p=i._interpolants,y=a.uuid,b=this._bindingsByRootAndName;let A=b[y];void 0===A&&(A={},b[y]=A);for(let C=0;C!==h;++C){const M=l[C],R=M.name;let k=A[R];if(void 0!==k)f[C]=k;else{if(k=f[C],void 0!==k){null===k._cacheIndex&&(++k.referenceCount,this._addInactiveBinding(k,y,R));continue}k=new rv(ra.create(a,R,t&&t._propertyBindings[C].binding.parsedPath),M.ValueTypeName,M.getValueSize()),++k.referenceCount,this._addInactiveBinding(k,y,R),f[C]=k}p[C].resultBuffer=k.buffer}},_activateAction:function(i){if(!this._isActiveAction(i)){if(null===i._cacheIndex){const a=(i._localRoot||this._root).uuid,l=i._clip.uuid,h=this._actionsByClip[l];this._bindAction(i,h&&h.knownActions[0]),this._addInactiveAction(i,l,a)}const t=i._propertyBindings;for(let a=0,l=t.length;a!==l;++a){const h=t[a];0==h.useCount++&&(this._lendBinding(h),h.saveOriginalState())}this._lendAction(i)}},_deactivateAction:function(i){if(this._isActiveAction(i)){const t=i._propertyBindings;for(let a=0,l=t.length;a!==l;++a){const h=t[a];0==--h.useCount&&(h.restoreOriginalState(),this._takeBackBinding(h))}this._takeBackAction(i)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const i=this;this.stats={actions:{get total(){return i._actions.length},get inUse(){return i._nActiveActions}},bindings:{get total(){return i._bindings.length},get inUse(){return i._nActiveBindings}},controlInterpolants:{get total(){return i._controlInterpolants.length},get inUse(){return i._nActiveControlInterpolants}}}},_isActiveAction:function(i){const t=i._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(i,t,a){const l=this._actions,h=this._actionsByClip;let f=h[t];if(void 0===f)f={knownActions:[i],actionByRoot:{}},i._byClipCacheIndex=0,h[t]=f;else{const p=f.knownActions;i._byClipCacheIndex=p.length,p.push(i)}i._cacheIndex=l.length,l.push(i),f.actionByRoot[a]=i},_removeInactiveAction:function(i){const t=this._actions,a=t[t.length-1],l=i._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),i._cacheIndex=null;const h=i._clip.uuid,f=this._actionsByClip,p=f[h],y=p.knownActions,b=y[y.length-1],A=i._byClipCacheIndex;b._byClipCacheIndex=A,y[A]=b,y.pop(),i._byClipCacheIndex=null,delete p.actionByRoot[(i._localRoot||this._root).uuid],0===y.length&&delete f[h],this._removeInactiveBindingsForAction(i)},_removeInactiveBindingsForAction:function(i){const t=i._propertyBindings;for(let a=0,l=t.length;a!==l;++a){const h=t[a];0==--h.referenceCount&&this._removeInactiveBinding(h)}},_lendAction:function(i){const t=this._actions,a=i._cacheIndex,l=this._nActiveActions++,h=t[l];i._cacheIndex=l,t[l]=i,h._cacheIndex=a,t[a]=h},_takeBackAction:function(i){const t=this._actions,a=i._cacheIndex,l=--this._nActiveActions,h=t[l];i._cacheIndex=l,t[l]=i,h._cacheIndex=a,t[a]=h},_addInactiveBinding:function(i,t,a){const l=this._bindingsByRootAndName,h=this._bindings;let f=l[t];void 0===f&&(f={},l[t]=f),f[a]=i,i._cacheIndex=h.length,h.push(i)},_removeInactiveBinding:function(i){const t=this._bindings,a=i.binding,l=a.rootNode.uuid,h=a.path,f=this._bindingsByRootAndName,p=f[l],y=t[t.length-1],b=i._cacheIndex;y._cacheIndex=b,t[b]=y,t.pop(),delete p[h],0===Object.keys(p).length&&delete f[l]},_lendBinding:function(i){const t=this._bindings,a=i._cacheIndex,l=this._nActiveBindings++,h=t[l];i._cacheIndex=l,t[l]=i,h._cacheIndex=a,t[a]=h},_takeBackBinding:function(i){const t=this._bindings,a=i._cacheIndex,l=--this._nActiveBindings,h=t[l];i._cacheIndex=l,t[l]=i,h._cacheIndex=a,t[a]=h},_lendControlInterpolant:function(){const i=this._controlInterpolants,t=this._nActiveControlInterpolants++;let a=i[t];return void 0===a&&(a=new jl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),a.__cacheIndex=t,i[t]=a),a},_takeBackControlInterpolant:function(i){const t=this._controlInterpolants,a=i.__cacheIndex,l=--this._nActiveControlInterpolants,h=t[l];i.__cacheIndex=l,t[l]=i,h.__cacheIndex=a,t[a]=h},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(i,t,a){const l=t||this._root,h=l.uuid;let f="string"==typeof i?Na.findByName(l,i):i;const p=null!==f?f.uuid:i,y=this._actionsByClip[p];let b=null;if(void 0===a&&(a=null!==f?f.blendMode:2500),void 0!==y){const C=y.actionByRoot[h];if(void 0!==C&&C.blendMode===a)return C;b=y.knownActions[0],null===f&&(f=b._clip)}if(null===f)return null;const A=new Lh(this,f,t,a);return this._bindAction(A,b),this._addInactiveAction(A,p,h),A},existingAction:function(i,t){const a=t||this._root,l=a.uuid,h="string"==typeof i?Na.findByName(a,i):i,p=this._actionsByClip[h?h.uuid:i];return void 0!==p&&p.actionByRoot[l]||null},stopAllAction:function(){const i=this._actions;for(let a=this._nActiveActions-1;a>=0;--a)i[a].stop();return this},update:function(i){const t=this._actions,a=this._nActiveActions,l=this.time+=i*=this.timeScale,h=Math.sign(i),f=this._accuIndex^=1;for(let b=0;b!==a;++b)t[b]._update(l,i,h,f);const p=this._bindings,y=this._nActiveBindings;for(let b=0;b!==y;++b)p[b].apply(f);return this},setTime:function(i){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(i)},getRoot:function(){return this._root},uncacheClip:function(i){const t=this._actions,a=i.uuid,l=this._actionsByClip,h=l[a];if(void 0!==h){const f=h.knownActions;for(let p=0,y=f.length;p!==y;++p){const b=f[p];this._deactivateAction(b);const A=b._cacheIndex,C=t[t.length-1];b._cacheIndex=null,b._byClipCacheIndex=null,C._cacheIndex=A,t[A]=C,t.pop(),this._removeInactiveBindingsForAction(b)}delete l[a]}},uncacheRoot:function(i){const t=i.uuid,a=this._actionsByClip;for(const f in a){const y=a[f].actionByRoot[t];void 0!==y&&(this._deactivateAction(y),this._removeInactiveAction(y))}const h=this._bindingsByRootAndName[t];if(void 0!==h)for(const f in h){const p=h[f];p.restoreOriginalState(),this._removeInactiveBinding(p)}},uncacheAction:function(i,t){const a=this.existingAction(i,t);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});class nc{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new nc(void 0===this.value.clone?this.value:this.value.clone())}}function uv(i,t,a){Ta.call(this,i,t),this.meshPerAttribute=a||1}function cv(i,t,a,l,h){this.buffer=i,this.type=t,this.itemSize=a,this.elementSize=l,this.count=h,this.version=0}function Ih(i,t,a,l){this.ray=new Eo(i,t),this.near=a||0,this.far=l||1/0,this.camera=null,this.layers=new Wr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function pf(i,t){return i.distance-t.distance}function Rh(i,t,a,l){if(i.layers.test(t.layers)&&i.raycast(t,a),!0===l){const h=i.children;for(let f=0,p=h.length;f<p;f++)Rh(h[f],t,a,!0)}}uv.prototype=Object.assign(Object.create(Ta.prototype),{constructor:uv,isInstancedInterleavedBuffer:!0,copy:function(i){return Ta.prototype.copy.call(this,i),this.meshPerAttribute=i.meshPerAttribute,this},clone:function(i){const t=Ta.prototype.clone.call(this,i);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(i){const t=Ta.prototype.toJSON.call(this,i);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(cv.prototype,"needsUpdate",{set:function(i){!0===i&&this.version++}}),Object.assign(cv.prototype,{isGLBufferAttribute:!0,setBuffer:function(i){return this.buffer=i,this},setType:function(i,t){return this.type=i,this.elementSize=t,this},setItemSize:function(i){return this.itemSize=i,this},setCount:function(i){return this.count=i,this}}),Object.assign(Ih.prototype,{set:function(i,t){this.ray.set(i,t)},setFromCamera:function(i,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(i,t,a){const l=a||[];return Rh(i,this,l,t),l.sort(pf),l},intersectObjects:function(i,t,a){const l=a||[];if(!1===Array.isArray(i))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),l;for(let h=0,f=i.length;h<f;h++)Rh(i[h],this,l,t);return l.sort(pf),l}});class hv{constructor(t=1,a=0,l=0){return this.radius=t,this.phi=a,this.theta=l,this}set(t,a,l){return this.radius=t,this.phi=a,this.theta=l,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,a,l){return this.radius=Math.sqrt(t*t+a*a+l*l),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,l),this.phi=Math.acos(hn.clamp(a/this.radius,-1,1))),this}}const dv=new Ct;function Dh(i){on.call(this),this.material=i,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}(Dh.prototype=Object.create(on.prototype)).constructor=Dh,Dh.prototype.isImmediateRenderObject=!0;const uo=new Ge,Oh=new xn,vf=new xn;function fv(i){const t=[];i&&i.isBone&&t.push(i);for(let a=0;a<i.children.length;a++)t.push.apply(t,fv(i.children[a]));return t}const K0=new Fr({side:1,depthWrite:!1,depthTest:!1});function yf(i){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Za.call(this,i),this.type="catmullrom"}new $n(new Au,K0),Wi.create=function(i,t){return console.log("THREE.Curve.create() has been deprecated"),i.prototype=Object.create(Wi.prototype),i.prototype.constructor=i,i.prototype.getPoint=t,i},Object.assign(_s.prototype,{fromPoints:function(i){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(i)}}),yf.prototype=Object.create(Za.prototype),Object.assign(yf.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),class pv extends Ar{constructor(t=10,a=10,l=4473924,h=8947848){l=new $i(l),h=new $i(h);const f=a/2,p=t/a,y=t/2,b=[],A=[];for(let R=0,k=0,z=-y;R<=a;R++,z+=p){b.push(-y,0,z,y,0,z),b.push(z,0,-y,z,0,y);const pe=R===f?l:h;pe.toArray(A,k),k+=3,pe.toArray(A,k),k+=3,pe.toArray(A,k),k+=3,pe.toArray(A,k),k+=3}const C=new Ln;C.setAttribute("position",new jn(b,3)),C.setAttribute("color",new jn(A,3)),super(C,new Oa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class Q0 extends Ar{constructor(t){const a=fv(t),l=new Ln,h=[],f=[],p=new $i(0,0,1),y=new $i(0,1,0);for(let A=0;A<a.length;A++){const C=a[A];C.parent&&C.parent.isBone&&(h.push(0,0,0),h.push(0,0,0),f.push(p.r,p.g,p.b),f.push(y.r,y.g,y.b))}l.setAttribute("position",new jn(h,3)),l.setAttribute("color",new jn(f,3)),super(l,new Oa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=a,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const a=this.bones,l=this.geometry,h=l.getAttribute("position");vf.copy(this.root.matrixWorld).invert();for(let f=0,p=0;f<a.length;f++){const y=a[f];y.parent&&y.parent.isBone&&(Oh.multiplyMatrices(vf,y.matrixWorld),uo.setFromMatrixPosition(Oh),h.setXYZ(p,uo.x,uo.y,uo.z),Oh.multiplyMatrices(vf,y.parent.matrixWorld),uo.setFromMatrixPosition(Oh),h.setXYZ(p+1,uo.x,uo.y,uo.z),p+=2)}l.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(kn.prototype,{extractUrlBase:function(i){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),function(i){const t=i.lastIndexOf("/");return-1===t?"./":i.substr(0,t+1)}(i)}}),kn.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(class q0{constructor(t,a){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Ct(1/0,1/0),this.max=void 0!==a?a:new Ct(-1/0,-1/0)}set(t,a){return this.min.copy(t),this.max.copy(a),this}setFromPoints(t){this.makeEmpty();for(let a=0,l=t.length;a<l;a++)this.expandByPoint(t[a]);return this}setFromCenterAndSize(t,a){const l=dv.copy(a).multiplyScalar(.5);return this.min.copy(t).sub(l),this.max.copy(t).add(l),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Ct),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Ct),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,a){return void 0===a&&(console.warn("THREE.Box2: .getParameter() target is now required"),a=new Ct),a.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,a){return void 0===a&&(console.warn("THREE.Box2: .clampPoint() target is now required"),a=new Ct),a.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return dv.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}.prototype,{center:function(i){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},size:function(i){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(i)}}),Object.assign(bo.prototype,{center:function(i){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(i)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(i){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionSphere:function(i){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)},size:function(i){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(i)}}),Object.assign(za.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),El.prototype.setFromMatrix=function(i){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(i)},Object.assign(hn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(i){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),hn.floorPowerOfTwo(i)},nextPowerOfTwo:function(i){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),hn.ceilPowerOfTwo(i)}}),Object.assign(Or.prototype,{flattenToArrayOffset:function(i,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)},multiplyVector3:function(i){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),i.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(i){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),Object.assign(xn.prototype,{extractPosition:function(i){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(i)},flattenToArrayOffset:function(i,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(i,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ge).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(i){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(i)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(i){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector4:function(i){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(i){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),i.transformDirection(this)},crossVector:function(i){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(i){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),i.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(i,t,a,l,h,f){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(i,t,l,a,h,f)},getInverse:function(i){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(i).invert()}}),Is.prototype.isIntersectionLine=function(i){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(i)},Object.assign(br.prototype,{multiplyVector3:function(i){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),i.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Eo.prototype,{isIntersectionBox:function(i){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(i)},isIntersectionPlane:function(i){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(i)},isIntersectionSphere:function(i){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(i)}}),Object.assign(ea.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(i,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(i,t)},midpoint:function(i){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(i)},normal:function(i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(i)},plane:function(i){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(i)}}),Object.assign(ea,{barycoordFromPoint:function(i,t,a,l,h){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ea.getBarycoord(i,t,a,l,h)},normal:function(i,t,a,l){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ea.getNormal(i,t,a,l)}}),Object.assign(Zl.prototype,{extractAllPoints:function(i){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(i)},extrude:function(i){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new fh(this,i)},makeGeometry:function(i){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new R0(this,i)}}),Object.assign(Ct.prototype,{fromAttribute:function(i,t,a){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,a)},distanceToManhattan:function(i){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ge.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(i){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(i)},getScaleFromMatrix:function(i){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(i)},getColumnFromMatrix:function(i,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,i)},applyProjection:function(i){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(i)},fromAttribute:function(i,t,a){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,a)},distanceToManhattan:function(i){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(i)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Wn.prototype,{fromAttribute:function(i,t,a){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(i,t,a)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(on.prototype,{getChildByName:function(i){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(i)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(i,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,i)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(i){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(on.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(i){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=i}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign($n.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties($n.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Wd.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ih.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),jd.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Wi.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(i){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=i}}),ur.prototype.setLens=function(i,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(i)},Object.defineProperties(er.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(i){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=i}},shadowCameraLeft:{set:function(i){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=i}},shadowCameraRight:{set:function(i){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=i}},shadowCameraTop:{set:function(i){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=i}},shadowCameraBottom:{set:function(i){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=i}},shadowCameraNear:{set:function(i){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=i}},shadowCameraFar:{set:function(i){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=i}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(i){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=i}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(i){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=i}},shadowMapHeight:{set:function(i){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=i}}}),Object.defineProperties(wn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Js},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Js)}}}),Object.assign(wn.prototype,{setDynamic:function(i){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===i?Js:hl),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ln.prototype,{addIndex:function(i){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(i)},addAttribute:function(i,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===i?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(i,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(i,new wn(arguments[1],arguments[2])))},addDrawCall:function(i,t,a){void 0!==a&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(i,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(i){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(i)},applyMatrix:function(i){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(i)}}),Object.defineProperties(Ln.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ph.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(i){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=i}}}),Object.defineProperties(Ih.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(i){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=i}}}),Object.defineProperties(Ta.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Js},set:function(i){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(i)}}}),Object.assign(Ta.prototype,{setDynamic:function(i){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===i?Js:hl),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(fh.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(dm.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(nc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(dn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new $i}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(i){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(i){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=i}}}),Object.defineProperties(lo.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(qr.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(i){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=i}}}),Object.defineProperties(jr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(i){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=i}}}),Object.assign(ps.prototype,{clearTarget:function(i,t,a,l){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(i),this.clear(t,a,l)},animate:function(i){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(i)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(i){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(i)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ps.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=i}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(i){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=i}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(i){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===i?3001:_o}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(lm.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(uu.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=i}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(i){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=i}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=i}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(i){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=i}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(i){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=i}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(i){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=i}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(i){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=i}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(i){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=i}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(i){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=i}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(i){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=i}}}),Object.defineProperties(class iv extends on{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const a=this.context.createBufferSource();return a.buffer=this.buffer,a.loop=this.loop,a.loopStart=this.loopStart,a.loopEnd=this.loopEnd,a.onended=this.onEnded.bind(this),a.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=a,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,a=this.filters.length;t<a;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,a=this.filters.length;t<a;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}.prototype,{load:{value:function(i){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new ic).load(i,function(l){t.setBuffer(l)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),us.prototype.updateCubeMap=function(i,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(i,t)},us.prototype.clear=function(i,t,a,l){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(i,t,a,l)},fl.crossOrigin=void 0,fl.loadTexture=function(i,t,a,l){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const h=new Ah;h.setCrossOrigin(this.crossOrigin);const f=h.load(i,a,void 0,l);return t&&(f.mapping=t),f},fl.loadTextureCube=function(i,t,a,l){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const h=new Zu;h.setCrossOrigin(this.crossOrigin);const f=h.load(i,a,void 0,l);return t&&(f.mapping=t),f},fl.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},fl.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125");var ac=function(t,a){var h,f,l=this,p=new xn,y=null;"VRFrameData"in window&&(y=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(function b(A){f=A,A.length>0?h=A[0]:a&&a("VR input not available.")}).catch(function(){console.warn("THREE.VRControls: Unable to get VR Displays")}),this.scale=1,this.standing=!1,this.userHeight=1.6,this.getVRDisplay=function(){return h},this.setVRDisplay=function(A){h=A},this.getVRDisplays=function(){return console.warn("THREE.VRControls: getVRDisplays() is being deprecated."),f},this.getStandingMatrix=function(){return p},this.update=function(){var A;h&&(h.getFrameData?(h.getFrameData(y),A=y.pose):h.getPose&&(A=h.getPose()),null!==A.orientation&&t.quaternion.fromArray(A.orientation),null!==A.position?t.position.fromArray(A.position):t.position.set(0,0,0),this.standing&&(h.stageParameters?(t.updateMatrix(),p.fromArray(h.stageParameters.sittingToStandingTransform),t.applyMatrix(p)):t.position.setY(t.position.y+this.userHeight)),t.position.multiplyScalar(l.scale))},this.dispose=function(){h=null}},Fh=function(t,a){var l,h,y,b,f=new Ge,p=new Ge,A=new xn,C=new xn,M=new xn,R=null;"VRFrameData"in window&&(R=new window.VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(function k(qe){h=qe,qe.length>0?l=qe[0]:a&&a("HMD not available")}).catch(function(){console.warn("THREE.VREffect: Unable to get VR Displays")}),this.isPresenting=!1;var z=this,pe=t.getSize(),ce=!1,V=t.getPixelRatio();this.getVRDisplay=function(){return l},this.setVRDisplay=function(qe){l=qe},this.getVRDisplays=function(){return console.warn("THREE.VREffect: getVRDisplays() is being deprecated."),h},this.setSize=function(qe,ut,xt){if(pe={width:qe,height:ut},ce=xt,z.isPresenting){var zt=l.getEyeParameters("left");t.setPixelRatio(1),t.setSize(2*zt.renderWidth,zt.renderHeight,!1)}else t.setPixelRatio(V),t.setSize(qe,ut,xt)};var U=t.domElement,je=[0,0,.5,1],Ze=[.5,0,.5,1];function Je(){var qe=z.isPresenting;if(z.isPresenting=void 0!==l&&l.isPresenting,z.isPresenting){var ut=l.getEyeParameters("left"),xt=ut.renderWidth,zt=ut.renderHeight;qe||(V=t.getPixelRatio(),pe=t.getSize(),t.setPixelRatio(1),t.setSize(2*xt,zt,!1))}else qe&&(t.setPixelRatio(V),t.setSize(pe.width,pe.height,ce))}window.addEventListener("vrdisplaypresentchange",Je,!1),this.setFullScreen=function(qe){return new Promise(function(ut,xt){void 0!==l?z.isPresenting!==qe?ut(qe?l.requestPresent([{source:U}]):l.exitPresent()):ut():xt(new Error("No VR hardware found."))})},this.requestPresent=function(){return this.setFullScreen(!0)},this.exitPresent=function(){return this.setFullScreen(!1)},this.requestAnimationFrame=function(qe){return void 0!==l?l.requestAnimationFrame(qe):window.requestAnimationFrame(qe)},this.cancelAnimationFrame=function(qe){void 0!==l?l.cancelAnimationFrame(qe):window.cancelAnimationFrame(qe)},this.submitFrame=function(){void 0!==l&&z.isPresenting&&l.submitFrame()},this.autoSubmitFrame=!0;var Ie=new ur;Ie.layers.enable(1);var it=new ur;it.layers.enable(2),this.render=function(qe,ut,xt,zt){if(l&&z.isPresenting){var li=qe.autoUpdate;li&&(qe.updateMatrixWorld(),qe.autoUpdate=!1),Array.isArray(qe)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),qe=qe[0]);var _i,Yi,ri=t.getSize(),di=l.getLayers();if(di.length){var Ji=di[0];_i=null!==Ji.leftBounds&&4===Ji.leftBounds.length?Ji.leftBounds:je,Yi=null!==Ji.rightBounds&&4===Ji.rightBounds.length?Ji.rightBounds:Ze}else _i=je,Yi=Ze;if(y={x:Math.round(ri.width*_i[0]),y:Math.round(ri.height*_i[1]),width:Math.round(ri.width*_i[2]),height:Math.round(ri.height*_i[3])},b={x:Math.round(ri.width*Yi[0]),y:Math.round(ri.height*Yi[1]),width:Math.round(ri.width*Yi[2]),height:Math.round(ri.height*Yi[3])},xt?(t.setRenderTarget(xt),xt.scissorTest=!0):(t.setRenderTarget(null),t.setScissorTest(!0)),(t.autoClear||zt)&&t.clear(),null===ut.parent&&ut.updateMatrixWorld(),ut.matrixWorld.decompose(Ie.position,Ie.quaternion,Ie.scale),it.position.copy(Ie.position),it.quaternion.copy(Ie.quaternion),it.scale.copy(Ie.scale),l.getFrameData)l.depthNear=ut.near,l.depthFar=ut.far,l.getFrameData(R),Ie.projectionMatrix.elements=R.leftProjectionMatrix,it.projectionMatrix.elements=R.rightProjectionMatrix,function At(qe){qe.pose.orientation?(Gt.fromArray(qe.pose.orientation),A.makeRotationFromQuaternion(Gt)):A.identity(),qe.pose.position&&(ht.fromArray(qe.pose.position),A.setPosition(ht)),C.fromArray(qe.leftViewMatrix),C.multiply(A),M.fromArray(qe.rightViewMatrix),M.multiply(A),C.getInverse(C),M.getInverse(M)}(R),Ie.updateMatrix(),Ie.matrix.multiply(C),Ie.matrix.decompose(Ie.position,Ie.quaternion,Ie.scale),it.updateMatrix(),it.matrix.multiply(M),it.matrix.decompose(it.position,it.quaternion,it.scale);else{var Mn=l.getEyeParameters("left"),Kt=l.getEyeParameters("right");Ie.projectionMatrix=Rt(Mn.fieldOfView,!0,ut.near,ut.far),it.projectionMatrix=Rt(Kt.fieldOfView,!0,ut.near,ut.far),f.fromArray(Mn.offset),p.fromArray(Kt.offset),Ie.translateOnAxis(f,Ie.scale.x),it.translateOnAxis(p,it.scale.x)}return xt?(xt.viewport.set(y.x,y.y,y.width,y.height),xt.scissor.set(y.x,y.y,y.width,y.height)):(t.setViewport(y.x,y.y,y.width,y.height),t.setScissor(y.x,y.y,y.width,y.height)),t.render(qe,Ie,xt,zt),xt?(xt.viewport.set(b.x,b.y,b.width,b.height),xt.scissor.set(b.x,b.y,b.width,b.height)):(t.setViewport(b.x,b.y,b.width,b.height),t.setScissor(b.x,b.y,b.width,b.height)),t.render(qe,it,xt,zt),xt?(xt.viewport.set(0,0,ri.width,ri.height),xt.scissor.set(0,0,ri.width,ri.height),xt.scissorTest=!1,t.setRenderTarget(null)):(t.setViewport(0,0,ri.width,ri.height),t.setScissorTest(!1)),li&&(qe.autoUpdate=!0),void(z.autoSubmitFrame&&z.submitFrame())}t.render(qe,ut,xt,zt)},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",Je,!1)};var Gt=new br,ht=new Ge;function Rt(qe,ut,xt,zt){var li=Math.PI/180;return function Yt(qe,ut,xt,zt){xt=void 0===xt?.01:xt,zt=void 0===zt?1e4:zt;var li=(ut=void 0===ut||ut)?-1:1,ri=new xn,di=ri.elements,_i=function Lt(qe){var ut=2/(qe.leftTan+qe.rightTan),zt=2/(qe.upTan+qe.downTan);return{scale:[ut,zt],offset:[(qe.leftTan-qe.rightTan)*ut*.5,(qe.upTan-qe.downTan)*zt*.5]}}(qe);return di[0]=_i.scale[0],di[1]=0,di[2]=_i.offset[0]*li,di[3]=0,di[4]=0,di[5]=_i.scale[1],di[6]=-_i.offset[1]*li,di[7]=0,di[8]=0,di[9]=0,di[10]=zt/(xt-zt)*-li,di[11]=zt*xt/(xt-zt),di[12]=0,di[13]=0,di[14]=li,di[15]=0,ri.transpose(),ri}({upTan:Math.tan(qe.upDegrees*li),downTan:Math.tan(qe.downDegrees*li),leftTan:Math.tan(qe.leftDegrees*li),rightTan:Math.tan(qe.rightDegrees*li)},ut,xt,zt)}},$l=function(t,a){var pt,Fe,Re,oi,Wt;this.object=t,this.domElement=void 0!==a?a:document,this.enabled=!0,this.target=new Ge,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return C.phi},this.getAzimuthalAngle=function(){return C.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(h),l.update(),b=y.NONE},this.update=(pt=new Ge,Fe=(new br).setFromUnitVectors(t.up,new Ge(0,1,0)),Re=Fe.clone().inverse(),oi=new Ge,Wt=new br,function(){var pi=l.object.position;return pt.copy(pi).sub(l.target),pt.applyQuaternion(Fe),C.setFromVector3(pt),l.autoRotate&&b===y.NONE&&l.rotateLeft(function Gt(){return 2*Math.PI/60/60*l.autoRotateSpeed}()),C.theta+=M.theta,C.phi+=M.phi,C.theta=Math.max(l.minAzimuthAngle,Math.min(l.maxAzimuthAngle,C.theta)),C.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,C.phi)),C.makeSafe(),C.radius*=R,C.radius=Math.max(l.minDistance,Math.min(l.maxDistance,C.radius)),l.target.add(k),pt.setFromSpherical(C),pt.applyQuaternion(Re),pi.copy(l.target).add(pt),l.object.lookAt(l.target),!0===l.enableDamping?(M.theta*=1-l.dampingFactor,M.phi*=1-l.dampingFactor,k.multiplyScalar(1-l.dampingFactor)):(M.set(0,0,0),k.set(0,0,0)),R=1,!!(z||oi.distanceToSquared(l.object.position)>A||8*(1-Wt.dot(l.object.quaternion))>A)&&(l.dispatchEvent(h),oi.copy(l.object.position),Wt.copy(l.object.quaternion),z=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",Ui,!1),l.domElement.removeEventListener("mousedown",tn,!1),l.domElement.removeEventListener("wheel",bn,!1),l.domElement.removeEventListener("touchstart",fi,!1),l.domElement.removeEventListener("touchend",Si,!1),l.domElement.removeEventListener("touchmove",xi,!1),document.removeEventListener("mousemove",An,!1),document.removeEventListener("mouseup",nn,!1),window.removeEventListener("keydown",mn,!1)};var l=this,h={type:"change"},f={type:"start"},p={type:"end"},y={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},b=y.NONE,A=1e-6,C=new hv,M=new hv,R=1,k=new Ge,z=!1,pe=new Ct,ce=new Ct,V=new Ct,U=new Ct,je=new Ct,Ze=new Ct,Je=new Ct,Ie=new Ct,it=new Ct;function ht(){return Math.pow(.95,l.zoomSpeed)}l.rotateLeft=function(Fe){M.theta-=Fe},l.rotateUp=function(Fe){M.phi-=Fe};var At=function(){var pt=new Ge;return function(Re,oi){pt.setFromMatrixColumn(oi,0),pt.multiplyScalar(-Re),k.add(pt)}}(),Lt=function(){var pt=new Ge;return function(Re,oi){!0===l.screenSpacePanning?pt.setFromMatrixColumn(oi,1):(pt.setFromMatrixColumn(oi,0),pt.crossVectors(l.object.up,pt)),pt.multiplyScalar(Re),k.add(pt)}}(),Yt=function(){var pt=new Ge;return function(Re,oi){var Wt=l.domElement===document?l.domElement.body:l.domElement;if(l.object.isPerspectiveCamera){pt.copy(l.object.position).sub(l.target);var pi=pt.length();pi*=Math.tan(l.object.fov/2*Math.PI/180),At(2*Re*pi/Wt.clientHeight,l.object.matrix),Lt(2*oi*pi/Wt.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(At(Re*(l.object.right-l.object.left)/l.object.zoom/Wt.clientWidth,l.object.matrix),Lt(oi*(l.object.top-l.object.bottom)/l.object.zoom/Wt.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function Rt(pt){l.object.isPerspectiveCamera?R/=pt:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*pt)),l.object.updateProjectionMatrix(),z=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function qe(pt){l.object.isPerspectiveCamera?R*=pt:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/pt)),l.object.updateProjectionMatrix(),z=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function tn(pt){if(!1!==l.enabled){switch(pt.preventDefault(),pt.button){case l.mouseButtons.ORBIT:if(!1===l.enableRotate)return;(function ut(pt){pe.set(pt.clientX,pt.clientY)})(pt),b=y.ROTATE;break;case l.mouseButtons.ZOOM:if(!1===l.enableZoom)return;(function xt(pt){Je.set(pt.clientX,pt.clientY)})(pt),b=y.DOLLY;break;case l.mouseButtons.PAN:if(!1===l.enablePan)return;(function zt(pt){U.set(pt.clientX,pt.clientY)})(pt),b=y.PAN}b!==y.NONE&&(document.addEventListener("mousemove",An,!1),document.addEventListener("mouseup",nn,!1),l.dispatchEvent(f))}}function An(pt){if(!1!==l.enabled)switch(pt.preventDefault(),b){case y.ROTATE:if(!1===l.enableRotate)return;!function li(pt){ce.set(pt.clientX,pt.clientY),V.subVectors(ce,pe).multiplyScalar(l.rotateSpeed);var Fe=l.domElement===document?l.domElement.body:l.domElement;l.rotateLeft(2*Math.PI*V.x/Fe.clientHeight),l.rotateUp(2*Math.PI*V.y/Fe.clientHeight),pe.copy(ce),l.update()}(pt);break;case y.DOLLY:if(!1===l.enableZoom)return;!function ri(pt){Ie.set(pt.clientX,pt.clientY),it.subVectors(Ie,Je),it.y>0?Rt(ht()):it.y<0&&qe(ht()),Je.copy(Ie),l.update()}(pt);break;case y.PAN:if(!1===l.enablePan)return;!function di(pt){je.set(pt.clientX,pt.clientY),Ze.subVectors(je,U).multiplyScalar(l.panSpeed),Yt(Ze.x,Ze.y),U.copy(je),l.update()}(pt)}}function nn(pt){!1!==l.enabled&&(document.removeEventListener("mousemove",An,!1),document.removeEventListener("mouseup",nn,!1),l.dispatchEvent(p),b=y.NONE)}function bn(pt){!1===l.enabled||!1===l.enableZoom||b!==y.NONE&&b!==y.ROTATE||(pt.preventDefault(),pt.stopPropagation(),l.dispatchEvent(f),function _i(pt){pt.deltaY<0?qe(ht()):pt.deltaY>0&&Rt(ht()),l.update()}(pt),l.dispatchEvent(p))}function mn(pt){!1===l.enabled||!1===l.enableKeys||!1===l.enablePan||function Yi(pt){switch(pt.keyCode){case l.keys.UP:Yt(0,l.keyPanSpeed),l.update();break;case l.keys.BOTTOM:Yt(0,-l.keyPanSpeed),l.update();break;case l.keys.LEFT:Yt(l.keyPanSpeed,0),l.update();break;case l.keys.RIGHT:Yt(-l.keyPanSpeed,0),l.update()}}(pt)}function fi(pt){if(!1!==l.enabled){switch(pt.preventDefault(),pt.touches.length){case 1:if(!1===l.enableRotate)return;(function Ji(pt){pe.set(pt.touches[0].pageX,pt.touches[0].pageY)})(pt),b=y.TOUCH_ROTATE;break;case 2:if(!1===l.enableZoom&&!1===l.enablePan)return;(function Mn(pt){if(l.enableZoom){var Fe=pt.touches[0].pageX-pt.touches[1].pageX,Re=pt.touches[0].pageY-pt.touches[1].pageY,oi=Math.sqrt(Fe*Fe+Re*Re);Je.set(0,oi)}l.enablePan&&U.set(.5*(pt.touches[0].pageX+pt.touches[1].pageX),.5*(pt.touches[0].pageY+pt.touches[1].pageY))})(pt),b=y.TOUCH_DOLLY_PAN;break;default:b=y.NONE}b!==y.NONE&&l.dispatchEvent(f)}}function xi(pt){if(!1!==l.enabled)switch(pt.preventDefault(),pt.stopPropagation(),pt.touches.length){case 1:if(!1===l.enableRotate||b!==y.TOUCH_ROTATE)return;!function Kt(pt){ce.set(pt.touches[0].pageX,pt.touches[0].pageY),V.subVectors(ce,pe).multiplyScalar(l.rotateSpeed);var Fe=l.domElement===document?l.domElement.body:l.domElement;l.rotateLeft(2*Math.PI*V.x/Fe.clientHeight),l.rotateUp(2*Math.PI*V.y/Fe.clientHeight),pe.copy(ce),l.update()}(pt);break;case 2:if(!1===l.enableZoom&&!1===l.enablePan||b!==y.TOUCH_DOLLY_PAN)return;!function Qn(pt){if(l.enableZoom){var Fe=pt.touches[0].pageX-pt.touches[1].pageX,Re=pt.touches[0].pageY-pt.touches[1].pageY,oi=Math.sqrt(Fe*Fe+Re*Re);Ie.set(0,oi),it.set(0,Math.pow(Ie.y/Je.y,l.zoomSpeed)),Rt(it.y),Je.copy(Ie)}l.enablePan&&(je.set(.5*(pt.touches[0].pageX+pt.touches[1].pageX),.5*(pt.touches[0].pageY+pt.touches[1].pageY)),Ze.subVectors(je,U).multiplyScalar(l.panSpeed),Yt(Ze.x,Ze.y),U.copy(je)),l.update()}(pt);break;default:b=y.NONE}}function Si(pt){!1!==l.enabled&&(l.dispatchEvent(p),b=y.NONE)}function Ui(pt){!1!==l.enabled&&pt.preventDefault()}l.domElement.addEventListener("mousedown",tn,!1),l.domElement.addEventListener("wheel",bn,!1),l.domElement.addEventListener("touchstart",fi,!1),l.domElement.addEventListener("touchend",Si,!1),l.domElement.addEventListener("touchmove",xi,!1),window.addEventListener("keydown",mn,!1),this.update()};($l.prototype=Object.create(ya.prototype)).constructor=$l,Object.defineProperties($l.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(t){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!t}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(t){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!t}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(t){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!t}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(t){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!t}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(t){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(t){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=t}}});var i,Nh=function(t){var a=this;this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var p,y,b,A,l=function(y){a.deviceOrientation=y},h=function(){a.screenOrientation=window.orientation||0},f=(p=new Ge(0,0,1),y=new ml,b=new br,A=new br(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(C,M,R,k,z){y.set(R,M,-k,"YXZ"),C.setFromEuler(y),C.multiply(A),C.multiply(b.setFromAxisAngle(p,-z))});this.connect=function(){h(),window.addEventListener("orientationchange",h,!1),window.addEventListener("deviceorientation",l,!1),a.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",h,!1),window.removeEventListener("deviceorientation",l,!1),a.enabled=!1},this.update=function(){if(!1!==a.enabled){var p=a.deviceOrientation;if(p){var y=p.alpha?hn.degToRad(p.alpha)+a.alphaOffset:0,b=p.beta?hn.degToRad(p.beta):0,A=p.gamma?hn.degToRad(p.gamma):0,C=a.screenOrientation?hn.degToRad(a.screenOrientation):0;f(a.object.quaternion,y,b,A,C)}}},this.dispose=function(){a.disconnect()},this.connect()},_f=function(){function i(a){this.object=a.camera,this.domElement=a.canvas,this.orbit=new $l(this.object,this.domElement),this.speed=.5,this.orbit.target.set(0,0,-1),this.orbit.enableZoom=!1,this.orbit.enablePan=!1,this.orbit.rotateSpeed=-this.speed,a.orientation&&(this.orientation=new Nh(this.object)),a.halfView&&(this.orbit.minAzimuthAngle=-Math.PI/4,this.orbit.maxAzimuthAngle=Math.PI/4)}var t=i.prototype;return t.update=function(){if(this.orientation){this.orientation.update();var l=this.orientation.object.quaternion,h=function Jl(i,t,a,l){var h=i*t+a*l;if(h>.499){var f=2*Math.atan2(i,l),p=Math.PI/2;return new Ge(p,0,f)}if(h<-.499){var b=-2*Math.atan2(i,l),A=-Math.PI/2;return new Ge(A,0,b)}var M=i*i,k=a*a,z=Math.atan2(2*t*l-2*i*a,1-t*t*2-2*k),pe=Math.asin(2*h),ce=Math.atan2(2*i*l-2*t*a,1-2*M-2*k);return new Ge(pe,ce,z)}(l.x,l.y,l.z,l.w);typeof this.lastAngle_>"u"&&(this.lastAngle_=h),this.orbit.rotateLeft((this.lastAngle_.z-h.z)*(1+this.speed)),this.orbit.rotateUp((this.lastAngle_.y-h.y)*(1+this.speed)),this.lastAngle_=h}this.orbit.update()},t.dispose=function(){this.orbit.dispose(),this.orientation&&this.orientation.dispose()},i}(),Z0=((i=Ni.createElement("video")).crossOrigin="anonymous",i.hasAttribute("crossorigin")),sc=["360","360_LR","360_TB","360_CUBE","EAC","EAC_LR","NONE","AUTO","Sphere","Cube","equirectangular","180","180_LR","180_MONO"],kh=function(t){if(t){if(t=t.toString().trim(),/sphere/i.test(t))return"360";if(/cube/i.test(t))return"360_CUBE";if(/equirectangular/i.test(t))return"360";for(var a=0;a<sc.length;a++)if(new RegExp("^"+sc[a]+"$","i").test(t))return sc[a]}},$0=function(i){function t(l,h,f){var p;return(p=i.call(this)||this).player=l,p.canvas=h,p.options=f,p.onMoveEnd=Ri.bind(ie(p),p.onMoveEnd),p.onMoveStart=Ri.bind(ie(p),p.onMoveStart),p.onMove=Ri.bind(ie(p),p.onMove),p.onControlBarMove=Ri.bind(ie(p),p.onControlBarMove),p.player.controlBar.on(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],p.onControlBarMove),p.oldReportUserActivity=p.player.reportUserActivity,p.player.reportUserActivity=function(){},p.canvas.addEventListener("mousedown",p.onMoveStart),p.canvas.addEventListener("touchstart",p.onMoveStart),p.canvas.addEventListener("mousemove",p.onMove),p.canvas.addEventListener("touchmove",p.onMove),p.canvas.addEventListener("mouseup",p.onMoveEnd),p.canvas.addEventListener("touchend",p.onMoveEnd),p.shouldTogglePlay=!1,p}Q(t,i);var a=t.prototype;return a.togglePlay=function(){this.player.paused()?this.player.play():this.player.pause()},a.onMoveStart=function(h){this.options.disableTogglePlay||!this.player.controls()||"mousedown"===h.type&&!Ri.dom.isSingleLeftClick(h)?this.shouldTogglePlay=!1:(this.shouldTogglePlay=!0,this.touchMoveCount_=0)},a.onMoveEnd=function(h){if("touchend"===h.type&&this.touchMoveCount_<10)return!1===this.player.userActive()?void this.player.userActive(!0):void this.player.userActive(!1);!this.shouldTogglePlay||"mouseup"===h.type&&this.togglePlay()},a.onMove=function(h){this.touchMoveCount_++,this.shouldTogglePlay=!1},a.onControlBarMove=function(h){this.player.userActive(!0)},a.dispose=function(){this.canvas.removeEventListener("mousedown",this.onMoveStart),this.canvas.removeEventListener("touchstart",this.onMoveStart),this.canvas.removeEventListener("mousemove",this.onMove),this.canvas.removeEventListener("touchmove",this.onMove),this.canvas.removeEventListener("mouseup",this.onMoveEnd),this.canvas.removeEventListener("touchend",this.onMoveEnd),this.player.controlBar.off(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],this.onControlBarMove),this.player.reportUserActivity=this.oldReportUserActivity},t}(Ri.EventTarget),J0=function(i){function t(l,h,f,p){var y;y=i.call(this)||this;var b=Ri.mergeOptions({channelMap:Ri.browser.IS_SAFARI?[2,0,1,3]:[0,1,2,3],ambisonicOrder:1},p);return y.videoElementSource=l.createMediaElementSource(f),y.foaRenderer=h.createFOARenderer(l,b),y.foaRenderer.initialize().then(function(){"suspended"===l.state&&y.trigger({type:"audiocontext-suspended"}),y.videoElementSource.connect(y.foaRenderer.input),y.foaRenderer.output.connect(l.destination),y.initialized=!0,y.trigger({type:"omnitone-ready"})},function(A){Ri.log.warn("videojs-vr: Omnitone initializes failed with the following error: "+A+")")}),y}Q(t,i);var a=t.prototype;return a.update=function(h){!this.initialized||this.foaRenderer.setRotationMatrixFromCamera(h.matrix)},a.dispose=function(){this.initialized=!1,this.foaRenderer.setRenderingMode("bypass"),this.foaRenderer=null},t}(Ri.EventTarget),ty=function(i){function t(l,h){var f;return(f=i.call(this,l,h)||this).handleVrDisplayActivate_=Ri.bind(ie(f),f.handleVrDisplayActivate_),f.handleVrDisplayDeactivate_=Ri.bind(ie(f),f.handleVrDisplayDeactivate_),f.handleVrDisplayPresentChange_=Ri.bind(ie(f),f.handleVrDisplayPresentChange_),f.handleOrientationChange_=Ri.bind(ie(f),f.handleOrientationChange_),Nt.addEventListener("orientationchange",f.handleOrientationChange_),Nt.addEventListener("vrdisplayactivate",f.handleVrDisplayActivate_),Nt.addEventListener("vrdisplaydeactivate",f.handleVrDisplayDeactivate_),Nt.addEventListener("vrdisplaypresentchange",f.handleVrDisplayPresentChange_),Ri.browser.IS_ANDROID&&f.on(l,"fullscreenchange",function(){l.isFullscreen()?f.hide():f.show()}),f}Q(t,i);var a=t.prototype;return a.buildCSSClass=function(){return"vjs-button-vr "+i.prototype.buildCSSClass.call(this)},a.handleVrDisplayPresentChange_=function(){!this.player_.vr().vrDisplay.isPresenting&&this.active_&&this.handleVrDisplayDeactivate_(),this.player_.vr().vrDisplay.isPresenting&&!this.active_&&this.handleVrDisplayActivate_()},a.handleOrientationChange_=function(){this.active_&&Ri.browser.IS_IOS&&this.changeSize_()},a.changeSize_=function(){this.player_.width(Nt.innerWidth),this.player_.height(Nt.innerHeight),Nt.dispatchEvent(new Nt.Event("resize"))},a.handleVrDisplayActivate_=function(){Ri.browser.IS_IOS&&(this.oldWidth_=this.player_.currentWidth(),this.oldHeight_=this.player_.currentHeight(),this.player_.enterFullWindow(),this.changeSize_()),this.active_=!0},a.handleVrDisplayDeactivate_=function(){Ri.browser.IS_IOS&&(this.oldWidth_&&this.player_.width(this.oldWidth_),this.oldHeight_&&this.player_.height(this.oldHeight_),this.player_.exitFullWindow()),this.active_=!1},a.handleClick=function(h){this.active_?Nt.dispatchEvent(new Nt.Event("vrdisplaydeactivate")):(!this.player_.hasStarted()&&Ri.browser.IS_ANDROID&&this.player_.play(),Nt.dispatchEvent(new Nt.Event("vrdisplayactivate")))},a.dispose=function(){i.prototype.dispose.call(this),Nt.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_),Nt.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_),Nt.removeEventListener("vrdisplaypresentchange",this.handleVrDisplayPresentChange_)},t}(Ri.getComponent("Button"));Ri.registerComponent("CardboardButton",ty);var ny=function(i){function t(){return i.apply(this,arguments)||this}return Q(t,i),t.prototype.buildCSSClass=function(){return"vjs-big-vr-play-button "+i.prototype.buildCSSClass.call(this)},t}(Ri.getComponent("BigPlayButton"));function mv(i,t){var a=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(a)return(a=a.call(i)).next.bind(a);if(Array.isArray(i)||(a=function ry(i,t){if(i){if("string"==typeof i)return vv(i,t);var a=Object.prototype.toString.call(i).slice(8,-1);if("Object"===a&&i.constructor&&(a=i.constructor.name),"Map"===a||"Set"===a)return Array.from(i);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vv(i,t)}}(i))||t&&i&&"number"==typeof i.length){a&&(i=a);var l=0;return function(){return l>=i.length?{done:!0}:{done:!1,value:i[l++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function vv(i,t){(null==t||t>i.length)&&(t=i.length);for(var a=0,l=new Array(t);a<t;a++)l[a]=i[a];return l}Ri.registerComponent("BigVrPlayButton",ny);var oc={debug:!1,omnitone:!1,forceCardboard:!1,omnitoneOptions:{},projection:"AUTO",sphereDetail:32,disableTogglePlay:!1},gv={"web-vr-out-of-date":{headline:"360 is out of date",type:"360_OUT_OF_DATE",message:"Your browser supports 360 but not the latest version. See <a href='http://webvr.info'>http://webvr.info</a> for more info."},"web-vr-not-supported":{headline:"360 not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser does not support 360. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."},"web-vr-hls-cors-not-supported":{headline:"360 HLS video not supported on this device",type:"360_NOT_SUPPORTED",message:"Your browser/device does not support HLS 360 video. See <a href='http://webvr.info'>http://webvr.info</a> for assistance."}},ay=Ri.getPlugin("plugin"),yv=Ri.getComponent("Component"),lc=function(i){function t(l,h){var f,p=Ri.mergeOptions(oc,h);return(f=i.call(this,l,p)||this).options_=p,f.player_=l,f.bigPlayButtonIndex_=l.children().indexOf(l.getChild("BigPlayButton"))||0,f.videojsErrorsSupport_=!!Ri.errors,f.videojsErrorsSupport_&&l.errors({errors:gv}),Ri.browser.IE_VERSION||!Z0?(f.player_.on("loadstart",function(){f.triggerError_({code:"web-vr-not-supported",dismiss:!1})}),ie(f)):(f.polyfill_=new Pe({ROTATE_INSTRUCTIONS_DISABLED:!0}),f.polyfill_=new Pe,f.handleVrDisplayActivate_=Ri.bind(ie(f),f.handleVrDisplayActivate_),f.handleVrDisplayDeactivate_=Ri.bind(ie(f),f.handleVrDisplayDeactivate_),f.handleResize_=Ri.bind(ie(f),f.handleResize_),f.animate_=Ri.bind(ie(f),f.animate_),f.setProjection(f.options_.projection),f.on(l,"adstart",function(){return l.setTimeout(function(){l.ads&&l.ads.videoElementRecycled()?(f.log("video element recycled for this ad, reseting"),f.reset(),f.one(l,"playing",f.init)):f.log("video element not recycled for this ad, no need to reset")})},1),f.on(l,"loadedmetadata",f.init),f)}Q(t,i);var a=t.prototype;return a.changeProjection_=function(h){var f=this;(h=kh(h))||(h="NONE");if(this.scene&&this.scene.remove(this.movieScreen),"AUTO"===h){if(this.player_.mediainfo&&this.player_.mediainfo.projection&&"AUTO"!==this.player_.mediainfo.projection){var y=kh(this.player_.mediainfo.projection);return this.changeProjection_(y)}return this.changeProjection_("NONE")}if("360"===h)this.movieGeometry=new ia(256,this.options_.sphereDetail,this.options_.sphereDetail),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0,side:1}),this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(0,0,0),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.scene.add(this.movieScreen);else if("360_LR"===h||"360_TB"===h){for(var b=new ia(256,this.options_.sphereDetail,this.options_.sphereDetail),A=b.faceVertexUvs[0],C=0;C<A.length;C++)for(var M=0;M<3;M++)"360_LR"===h?A[C][M].x*=.5:(A[C][M].y*=.5,A[C][M].y+=.5);this.movieGeometry=(new Ln).fromGeometry(b),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0,side:1}),this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),A=(b=new ia(256,this.options_.sphereDetail,this.options_.sphereDetail)).faceVertexUvs[0];for(var R=0;R<A.length;R++)for(var k=0;k<3;k++)"360_LR"===h?(A[R][k].x*=.5,A[R][k].x+=.5):A[R][k].y*=.5;this.movieGeometry=(new Ln).fromGeometry(b),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0,side:1}),this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.scale.x=-1,this.movieScreen.quaternion.setFromAxisAngle({x:0,y:1,z:0},-Math.PI/2),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("360_CUBE"===h){this.movieGeometry=new Au(256,256,256),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0,side:1});var z=[new Ct(0,.5),new Ct(.333,.5),new Ct(.333,1),new Ct(0,1)],pe=[new Ct(.333,.5),new Ct(.666,.5),new Ct(.666,1),new Ct(.333,1)],ce=[new Ct(.666,.5),new Ct(1,.5),new Ct(1,1),new Ct(.666,1)],V=[new Ct(0,0),new Ct(.333,0),new Ct(.333,.5),new Ct(0,.5)],U=[new Ct(.333,0),new Ct(.666,0),new Ct(.666,.5),new Ct(.333,.5)],je=[new Ct(.666,0),new Ct(1,0),new Ct(1,.5),new Ct(.666,.5)];this.movieGeometry.faceVertexUvs[0]=[],this.movieGeometry.faceVertexUvs[0][0]=[pe[2],pe[1],pe[3]],this.movieGeometry.faceVertexUvs[0][1]=[pe[1],pe[0],pe[3]],this.movieGeometry.faceVertexUvs[0][2]=[z[2],z[1],z[3]],this.movieGeometry.faceVertexUvs[0][3]=[z[1],z[0],z[3]],this.movieGeometry.faceVertexUvs[0][4]=[ce[2],ce[1],ce[3]],this.movieGeometry.faceVertexUvs[0][5]=[ce[1],ce[0],ce[3]],this.movieGeometry.faceVertexUvs[0][6]=[V[2],V[1],V[3]],this.movieGeometry.faceVertexUvs[0][7]=[V[1],V[0],V[3]],this.movieGeometry.faceVertexUvs[0][8]=[U[2],U[1],U[3]],this.movieGeometry.faceVertexUvs[0][9]=[U[1],U[0],U[3]],this.movieGeometry.faceVertexUvs[0][10]=[je[2],je[1],je[3]],this.movieGeometry.faceVertexUvs[0][11]=[je[1],je[0],je[3]],this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.position.set(0,0,0),this.movieScreen.rotation.y=-Math.PI,this.scene.add(this.movieScreen)}else if("180"===h||"180_LR"===h||"180_MONO"===h){var Ze=new ia(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI);Ze.scale(-1,1,1);var Je=Ze.faceVertexUvs[0];if("180_MONO"!==h)for(var Ie=0;Ie<Je.length;Ie++)for(var it=0;it<3;it++)Je[Ie][it].x*=.5;this.movieGeometry=(new Ln).fromGeometry(Ze),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0}),this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),(Ze=new ia(256,this.options_.sphereDetail,this.options_.sphereDetail,Math.PI,Math.PI)).scale(-1,1,1),Je=Ze.faceVertexUvs[0];for(var Gt=0;Gt<Je.length;Gt++)for(var ht=0;ht<3;ht++)Je[Gt][ht].x*=.5,Je[Gt][ht].x+=.5;this.movieGeometry=(new Ln).fromGeometry(Ze),this.movieMaterial=new Fr({map:this.videoTexture,overdraw:!0}),this.movieScreen=new $n(this.movieGeometry,this.movieMaterial),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}else if("EAC"===h||"EAC_LR"===h){var At=function(Rt,qe){f.movieGeometry=new Au(256,256,256),f.movieMaterial=new jr({overdraw:!0,side:1,uniforms:{mapped:{value:f.videoTexture},mapMatrix:{value:Rt},contCorrect:{value:2},faceWH:{value:new Ct(.3333333333333333,.5).applyMatrix3(qe)},vidWH:{value:new Ct(f.videoTexture.image.videoWidth,f.videoTexture.image.videoHeight).applyMatrix3(qe)}},vertexShader:"\nvarying vec2 vUv;\nuniform mat3 mapMatrix;\n\nvoid main() {\n  vUv = (mapMatrix * vec3(uv, 1.)).xy;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);\n}",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D mapped;\nuniform vec2 faceWH;\nuniform vec2 vidWH;\nuniform float contCorrect;\n\nconst float PI = 3.1415926535897932384626433832795;\n\nvoid main() {\n  vec2 corner = vUv - mod(vUv, faceWH) + vec2(0, contCorrect / vidWH.y);\n\n  vec2 faceWHadj = faceWH - vec2(0, contCorrect * 2. / vidWH.y);\n\n  vec2 p = (vUv - corner) / faceWHadj - .5;\n  vec2 q = 2. / PI * atan(2. * p) + .5;\n\n  vec2 eUv = corner + q * faceWHadj;\n\n  gl_FragColor = texture2D(mapped, eUv);\n}"});for(var xt=[new Ct(0,.5),new Ct(1/3,.5),new Ct(1/3,1),new Ct(0,1)],zt=[new Ct(1/3,.5),new Ct(2/3,.5),new Ct(2/3,1),new Ct(1/3,1)],li=[new Ct(2/3,.5),new Ct(1,.5),new Ct(1,1),new Ct(2/3,1)],ri=[new Ct(1/3,0),new Ct(1/3,.5),new Ct(0,.5),new Ct(0,0)],di=[new Ct(1/3,.5),new Ct(1/3,0),new Ct(2/3,0),new Ct(2/3,.5)],_i=[new Ct(1,0),new Ct(1,.5),new Ct(2/3,.5),new Ct(2/3,0)],Yi=0,Ji=[xt,zt,li,ri,di,_i];Yi<Ji.length;Yi++){for(var nn,Mn=Ji[Yi],Kt=f.videoTexture.image.videoHeight,Qn=1,tn=0,An=mv(Mn);!(nn=An()).done;){var bn=nn.value;bn.y<Qn&&(Qn=bn.y),bn.y>tn&&(tn=bn.y)}for(var fi,mn=mv(Mn);!(fi=mn()).done;){var xi=fi.value;Math.abs(xi.y-Qn)<Number.EPSILON&&(xi.y+=2/Kt),Math.abs(xi.y-tn)<Number.EPSILON&&(xi.y-=2/Kt),xi.x=xi.x/Kt*(Kt-4)+2/Kt}}return f.movieGeometry.faceVertexUvs[0]=[],f.movieGeometry.faceVertexUvs[0][0]=[xt[2],xt[1],xt[3]],f.movieGeometry.faceVertexUvs[0][1]=[xt[1],xt[0],xt[3]],f.movieGeometry.faceVertexUvs[0][2]=[li[2],li[1],li[3]],f.movieGeometry.faceVertexUvs[0][3]=[li[1],li[0],li[3]],f.movieGeometry.faceVertexUvs[0][4]=[_i[2],_i[1],_i[3]],f.movieGeometry.faceVertexUvs[0][5]=[_i[1],_i[0],_i[3]],f.movieGeometry.faceVertexUvs[0][6]=[ri[2],ri[1],ri[3]],f.movieGeometry.faceVertexUvs[0][7]=[ri[1],ri[0],ri[3]],f.movieGeometry.faceVertexUvs[0][8]=[zt[2],zt[1],zt[3]],f.movieGeometry.faceVertexUvs[0][9]=[zt[1],zt[0],zt[3]],f.movieGeometry.faceVertexUvs[0][10]=[di[2],di[1],di[3]],f.movieGeometry.faceVertexUvs[0][11]=[di[1],di[0],di[3]],f.movieScreen=new $n(f.movieGeometry,f.movieMaterial),f.movieScreen.position.set(0,0,0),f.movieScreen.rotation.y=-Math.PI,f.movieScreen};if("EAC"===h)this.scene.add(At(new Or,new Or));else{var Lt=(new Or).set(0,.5,0,1,0,0,0,0,1);At((new Or).set(0,-.5,.5,1,0,0,0,0,1),Lt),this.movieScreen.layers.set(1),this.scene.add(this.movieScreen),At((new Or).set(0,-.5,1,1,0,0,0,0,1),Lt),this.movieScreen.layers.set(2),this.scene.add(this.movieScreen)}}this.currentProjection_=h},a.triggerError_=function(h){if(this.videojsErrorsSupport_)this.player_.error(h);else{var f=Ni.createElement("div");f.innerHTML=gv[h.code].message,this.player_.error({code:h.code,message:f.textContent||f.innerText||""})}},a.log=function(){if(this.options_.debug){for(var h=arguments.length,f=new Array(h),p=0;p<h;p++)f[p]=arguments[p];f.forEach(function(y){Ri.log("VR: ",y)})}},a.handleVrDisplayActivate_=function(){var h=this;!this.vrDisplay||this.vrDisplay.requestPresent([{source:this.renderedCanvas}]).then(function(){if(h.vrDisplay.cardboardUI_&&Ri.browser.IS_IOS){var f=[],p=function(A){for(var C=0;C<A.touches.length;C++)f.push(A.touches[C])},y=function(A){!f.length||(f.forEach(function(C){var M=new Nt.MouseEvent("click",{screenX:C.screenX,screenY:C.screenY,clientX:C.clientX,clientY:C.clientY});h.renderedCanvas.dispatchEvent(M)}),f=[])};h.renderedCanvas.addEventListener("touchstart",p),h.renderedCanvas.addEventListener("touchend",y),h.iosRevertTouchToClick_=function(){h.renderedCanvas.removeEventListener("touchstart",p),h.renderedCanvas.removeEventListener("touchend",y),h.iosRevertTouchToClick_=null}}})},a.handleVrDisplayDeactivate_=function(){!this.vrDisplay||!this.vrDisplay.isPresenting||(this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.vrDisplay.exitPresent())},a.requestAnimationFrame=function(h){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(h):this.player_.requestAnimationFrame(h)},a.cancelAnimationFrame=function(h){return this.vrDisplay?this.vrDisplay.cancelAnimationFrame(h):this.player_.cancelAnimationFrame(h)},a.togglePlay_=function(){this.player_.paused()?this.player_.play():this.player_.pause()},a.animate_=function(){if(this.initialized_){if(this.getVideoEl_().readyState===this.getVideoEl_().HAVE_ENOUGH_DATA&&this.videoTexture&&(this.videoTexture.needsUpdate=!0),this.controls3d.update(),this.omniController&&this.omniController.update(this.camera),this.effect.render(this.scene,this.camera),Nt.navigator.getGamepads)for(var h=Nt.navigator.getGamepads(),f=0;f<h.length;++f){var p=h[f];if(p&&p.timestamp&&p.timestamp!==this.prevTimestamps_[f])for(var y=0;y<p.buttons.length;++y)if(p.buttons[y].pressed){this.togglePlay_(),this.prevTimestamps_[f]=p.timestamp;break}}this.camera.getWorldDirection(this.cameraVector),this.animationFrameId_=this.requestAnimationFrame(this.animate_)}},a.handleResize_=function(){var h=this.player_.currentWidth(),f=this.player_.currentHeight();this.effect.setSize(h,f,!1),this.camera.aspect=h/f,this.camera.updateProjectionMatrix()},a.setProjection=function(h){kh(h)?(this.currentProjection_=h,this.defaultProjection_=h):Ri.log.error("videojs-vr: please pass a valid projection "+sc.join(", "))},a.init=function(){var h=this;if(this.reset(),this.camera=new ur(75,this.player_.currentWidth()/this.player_.currentHeight(),1,1e3),this.cameraVector=new Ge,("360_LR"===this.currentProjection_||"360_TB"===this.currentProjection_||"180"===this.currentProjection_||"180_LR"===this.currentProjection_||"180_MONO"===this.currentProjection_||"EAC_LR"===this.currentProjection_)&&this.camera.layers.enable(1),this.scene=new dm,this.videoTexture=new Yd(this.getVideoEl_()),this.videoTexture.generateMipmaps=!1,this.videoTexture.minFilter=Fi,this.videoTexture.magFilter=Fi,this.videoTexture.format=Ca,this.changeProjection_(this.currentProjection_),"NONE"===this.currentProjection_)return this.log("Projection is NONE, dont init"),void this.reset();this.player_.removeChild("BigPlayButton"),this.player_.addChild("BigVrPlayButton",{},this.bigPlayButtonIndex_),this.player_.bigPlayButton=this.player_.getChild("BigVrPlayButton"),(this.options_.forceCardboard||Ri.browser.IS_ANDROID||Ri.browser.IS_IOS)&&this.addCardboardButton_(),Ri.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.hide(),this.camera.position.set(0,0,0),this.renderer=new ps({devicePixelRatio:Nt.devicePixelRatio,alpha:!1,clearColor:16777215,antialias:!0});var f=this.renderer.getContext("webgl"),p=f.texImage2D;f.texImage2D=function(){try{for(var A=arguments.length,C=new Array(A),M=0;M<A;M++)C[M]=arguments[M];return p.apply(f,C)}catch(R){throw h.reset(),h.player_.pause(),h.triggerError_({code:"web-vr-hls-cors-not-supported",dismiss:!1}),new Error(R)}},this.renderer.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.effect=new Fh(this.renderer),this.effect.setSize(this.player_.currentWidth(),this.player_.currentHeight(),!1),this.vrDisplay=null,this.prevTimestamps_=[],this.renderedCanvas=this.renderer.domElement,this.renderedCanvas.setAttribute("style","width: 100%; height: 100%; position: absolute; top:0;");var y=this.getVideoEl_().style;if(this.player_.el().insertBefore(this.renderedCanvas,this.player_.el().firstChild),y.zIndex="-1",y.opacity="0",Nt.navigator.getVRDisplays?(this.log("is supported, getting vr displays"),Nt.navigator.getVRDisplays().then(function(A){if(A.length>0&&(h.log("Displays found",A),h.vrDisplay=A[0],h.vrDisplay.isPolyfilled||(h.log("Real HMD found using VRControls",h.vrDisplay),h.addCardboardButton_(),h.controls3d=new ac(h.camera))),!h.controls3d){h.log("no HMD found Using Orbit & Orientation Controls");var C={camera:h.camera,canvas:h.renderedCanvas,halfView:0===h.currentProjection_.indexOf("180"),orientation:Ri.browser.IS_IOS||Ri.browser.IS_ANDROID||!1};!1===h.options_.motionControls&&(C.orientation=!1),h.controls3d=new _f(C),h.canvasPlayerControls=new $0(h.player_,h.renderedCanvas,h.options_)}h.animationFrameId_=h.requestAnimationFrame(h.animate_)})):this.triggerError_(Nt.navigator.getVRDevices?{code:"web-vr-out-of-date",dismiss:!1}:{code:"web-vr-not-supported",dismiss:!1}),this.options_.omnitone){var b=$m_getContext();this.omniController=new J0(b,this.options_.omnitone,this.getVideoEl_(),this.options_.omnitoneOptions),this.omniController.one("audiocontext-suspended",function(){h.player.pause(),h.player.one("playing",function(){b.resume()})})}this.on(this.player_,"fullscreenchange",this.handleResize_),Nt.addEventListener("vrdisplaypresentchange",this.handleResize_,!0),Nt.addEventListener("resize",this.handleResize_,!0),Nt.addEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),Nt.addEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.initialized_=!0,this.trigger("initialized")},a.addCardboardButton_=function(){this.player_.controlBar.getChild("CardboardButton")||this.player_.controlBar.addChild("CardboardButton",{})},a.getVideoEl_=function(){return this.player_.el().getElementsByTagName("video")[0]},a.reset=function(){if(this.initialized_){this.omniController&&(this.omniController.off("audiocontext-suspended"),this.omniController.dispose(),this.omniController=void 0),this.controls3d&&(this.controls3d.dispose(),this.controls3d=null),this.canvasPlayerControls&&(this.canvasPlayerControls.dispose(),this.canvasPlayerControls=null),this.effect&&(this.effect.dispose(),this.effect=null),Nt.removeEventListener("resize",this.handleResize_,!0),Nt.removeEventListener("vrdisplaypresentchange",this.handleResize_,!0),Nt.removeEventListener("vrdisplayactivate",this.handleVrDisplayActivate_,!0),Nt.removeEventListener("vrdisplaydeactivate",this.handleVrDisplayDeactivate_,!0),this.player_.getChild("BigPlayButton")||this.player_.addChild("BigPlayButton",{},this.bigPlayButtonIndex_),this.player_.getChild("BigVrPlayButton")&&this.player_.removeChild("BigVrPlayButton"),this.player_.getChild("CardboardButton")&&this.player_.controlBar.removeChild("CardboardButton"),Ri.browser.IS_IOS&&this.player_.controlBar&&this.player_.controlBar.fullscreenToggle&&this.player_.controlBar.fullscreenToggle.show();var h=this.getVideoEl_().style;h.zIndex="",h.opacity="",this.currentProjection_=this.defaultProjection_,this.iosRevertTouchToClick_&&this.iosRevertTouchToClick_(),this.renderedCanvas&&this.renderedCanvas.parentNode.removeChild(this.renderedCanvas),this.animationFrameId_&&this.cancelAnimationFrame(this.animationFrameId_),this.initialized_=!1}},a.dispose=function(){i.prototype.dispose.call(this),this.reset()},a.polyfillVersion=function(){return Pe.version},t}(ay);return lc.prototype.setTimeout=yv.prototype.setTimeout,lc.prototype.clearTimeout=yv.prototype.clearTimeout,lc.VERSION="1.10.1",Ri.registerPlugin("vr",lc),lc});